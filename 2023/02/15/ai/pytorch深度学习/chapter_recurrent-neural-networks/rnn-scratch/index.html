<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#FFF"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"><link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="alternate" type="application/rss+xml" title="yuan" href="https://jyuanhust.github.io/rss.xml"><link rel="alternate" type="application/atom+xml" title="yuan" href="https://jyuanhust.github.io/atom.xml"><link rel="alternate" type="application/json" title="yuan" href="https://jyuanhust.github.io/feed.json"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/css/app.css?v=0.2.5"><meta name="keywords" content="chapter_recurrent-neural-networks"><link rel="canonical" href="https://jyuanhust.github.io/2023/02/15/ai/pytorch%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/chapter_recurrent-neural-networks/rnn-scratch/"><title>rnn-scratch - chapter_recurrent-neural-networks - pytorchæ·±åº¦å­¦ä¹  - ai | Mi Manchi = yuan = Whatever is worth doing at all is worth doing well</title><meta name="generator" content="Hexo 6.2.0"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">rnn-scratch</h1><div class="meta"><span class="item" title="åˆ›å»ºæ—¶é—´ï¼š2023-02-15 00:00:00"><span class="icon"><i class="ic i-calendar"></i> </span><span class="text">å‘è¡¨äº</span> <time itemprop="dateCreated datePublished" datetime="2023-02-15T00:00:00+08:00">2023-02-15</time> </span><span class="item" title="æœ¬æ–‡å­—æ•°"><span class="icon"><i class="ic i-pen"></i> </span><span class="text">æœ¬æ–‡å­—æ•°</span> <span>9.2k</span> <span class="text">å­—</span> </span><span class="item" title="é˜…è¯»æ—¶é•¿"><span class="icon"><i class="ic i-clock"></i> </span><span class="text">é˜…è¯»æ—¶é•¿</span> <span>8 åˆ†é’Ÿ</span></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="åˆ‡æ¢å¯¼èˆªæ "><span class="line"></span> <span class="line"></span> <span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">Mi Manchi</a></li></ul><ul class="right"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div id="imgs" class="pjax"><ul><li class="item" data-background-image="https://gitee.com/zkz0/image/raw/master/img/img(5).webp"></li><li class="item" data-background-image="https://gitee.com/zkz0/image/raw/master/img/img(17).webp"></li><li class="item" data-background-image="https://gitee.com/zkz0/image/raw/master/img/img(73).webp"></li><li class="item" data-background-image="https://gitee.com/zkz0/image/raw/master/img/img(61).webp"></li><li class="item" data-background-image="https://gitee.com/zkz0/image/raw/master/img/img(51).webp"></li><li class="item" data-background-image="https://gitee.com/zkz0/image/raw/master/img/img(64).webp"></li></ul></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"/></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"/><use xlink:href="#gentle-wave" x="48" y="3"/><use xlink:href="#gentle-wave" x="48" y="5"/><use xlink:href="#gentle-wave" x="48" y="7"/></g></svg></div><main><div class="inner"><div id="main" class="pjax"><div class="article wrap"><div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i> <span><a href="/">é¦–é¡µ</a></span><i class="ic i-angle-right"></i> <span itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/ai/" itemprop="item" rel="index" title="åˆ†ç±»äº ai"><span itemprop="name">ai</span></a><meta itemprop="position" content="1"></span><i class="ic i-angle-right"></i> <span itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/ai/pytorch%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/" itemprop="item" rel="index" title="åˆ†ç±»äº pytorchæ·±åº¦å­¦ä¹ "><span itemprop="name">pytorchæ·±åº¦å­¦ä¹ </span></a><meta itemprop="position" content="2"></span><i class="ic i-angle-right"></i> <span class="current" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/ai/pytorch%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/chapter-recurrent-neural-networks/" itemprop="item" rel="index" title="åˆ†ç±»äº chapter_recurrent-neural-networks"><span itemprop="name">chapter_recurrent-neural-networks</span></a><meta itemprop="position" content="3"></span></div><article itemscope itemtype="http://schema.org/Article" class="post block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://jyuanhust.github.io/2023/02/15/ai/pytorch%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/chapter_recurrent-neural-networks/rnn-scratch/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="yuan"><meta itemprop="description" content="Whatever is worth doing at all is worth doing well, "></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="yuan"></span><div class="body md" itemprop="articleBody"><h1 id="å¾ªç¯ç¥ç»ç½‘ç»œçš„ä»é›¶å¼€å§‹å®ç°"><a class="anchor" href="#å¾ªç¯ç¥ç»ç½‘ç»œçš„ä»é›¶å¼€å§‹å®ç°">#</a> å¾ªç¯ç¥ç»ç½‘ç»œçš„ä»é›¶å¼€å§‹å®ç°</h1><p>ğŸ· <code>sec_rnn_scratch</code></p><p>æœ¬èŠ‚å°†æ ¹æ® :numref: <code>sec_rnn</code> ä¸­çš„æè¿°ï¼Œ<br>ä»å¤´å¼€å§‹åŸºäºå¾ªç¯ç¥ç»ç½‘ç»œå®ç°å­—ç¬¦çº§è¯­è¨€æ¨¡å‹ã€‚<br>è¿™æ ·çš„æ¨¡å‹å°†åœ¨ H.G.Wells çš„æ—¶å…‰æœºå™¨æ•°æ®é›†ä¸Šè®­ç»ƒã€‚<br>å’Œå‰é¢ :numref: <code>sec_language_model</code> ä¸­ä»‹ç»è¿‡çš„ä¸€æ ·ï¼Œ<br>æˆ‘ä»¬å…ˆè¯»å–æ•°æ®é›†ã€‚</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">%</span>matplotlib inline</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">import</span> math</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">import</span> torch</pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">from</span> torch <span class="token keyword">import</span> nn</pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">from</span> torch<span class="token punctuation">.</span>nn <span class="token keyword">import</span> functional <span class="token keyword">as</span> F</pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">from</span> d2l <span class="token keyword">import</span> torch <span class="token keyword">as</span> d2l</pre></td></tr></table></figure><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>batch_size<span class="token punctuation">,</span> num_steps <span class="token operator">=</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">35</span></pre></td></tr><tr><td data-num="2"></td><td><pre>train_iter<span class="token punctuation">,</span> vocab <span class="token operator">=</span> d2l<span class="token punctuation">.</span>load_data_time_machine<span class="token punctuation">(</span>batch_size<span class="token punctuation">,</span> num_steps<span class="token punctuation">)</span></pre></td></tr></table></figure><h2 id="ç‹¬çƒ­ç¼–ç "><a class="anchor" href="#ç‹¬çƒ­ç¼–ç ">#</a> [<strong>ç‹¬çƒ­ç¼–ç </strong>]</h2><p>å›æƒ³ä¸€ä¸‹ï¼Œåœ¨ <code>train_iter</code> ä¸­ï¼Œæ¯ä¸ªè¯å…ƒéƒ½è¡¨ç¤ºä¸ºä¸€ä¸ªæ•°å­—ç´¢å¼•ï¼Œ<br>å°†è¿™äº›ç´¢å¼•ç›´æ¥è¾“å…¥ç¥ç»ç½‘ç»œå¯èƒ½ä¼šä½¿å­¦ä¹ å˜å¾—å›°éš¾ã€‚<br>æˆ‘ä»¬é€šå¸¸å°†æ¯ä¸ªè¯å…ƒè¡¨ç¤ºä¸ºæ›´å…·è¡¨ç°åŠ›çš„ç‰¹å¾å‘é‡ã€‚<br>æœ€ç®€å•çš„è¡¨ç¤ºç§°ä¸º<em>ç‹¬çƒ­ç¼–ç </em>ï¼ˆone-hot encodingï¼‰ï¼Œ<br>å®ƒåœ¨ :numref: <code>subsec_classification-problem</code> ä¸­ä»‹ç»è¿‡ã€‚</p><p>ç®€è¨€ä¹‹ï¼Œå°†æ¯ä¸ªç´¢å¼•æ˜ å°„ä¸ºç›¸äº’ä¸åŒçš„å•ä½å‘é‡ï¼š<br>å‡è®¾è¯è¡¨ä¸­ä¸åŒè¯å…ƒçš„æ•°ç›®ä¸º<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi></mrow><annotation encoding="application/x-tex">N</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.68333em;vertical-align:0"></span><span class="mord mathnormal" style="margin-right:.10903em">N</span></span></span></span>ï¼ˆå³ <code>len(vocab)</code> ï¼‰ï¼Œ<br>è¯å…ƒç´¢å¼•çš„èŒƒå›´ä¸º<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0</mn></mrow><annotation encoding="application/x-tex">0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.64444em;vertical-align:0"></span><span class="mord">0</span></span></span></span> åˆ°<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi><mo>âˆ’</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">N-1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.76666em;vertical-align:-.08333em"></span><span class="mord mathnormal" style="margin-right:.10903em">N</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:.64444em;vertical-align:0"></span><span class="mord">1</span></span></span></span>ã€‚<br>å¦‚æœè¯å…ƒçš„ç´¢å¼•æ˜¯æ•´æ•°<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.65952em;vertical-align:0"></span><span class="mord mathnormal">i</span></span></span></span>ï¼Œ<br>é‚£ä¹ˆæˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªé•¿åº¦ä¸º<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi></mrow><annotation encoding="application/x-tex">N</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.68333em;vertical-align:0"></span><span class="mord mathnormal" style="margin-right:.10903em">N</span></span></span></span> çš„å…¨<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0</mn></mrow><annotation encoding="application/x-tex">0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.64444em;vertical-align:0"></span><span class="mord">0</span></span></span></span> å‘é‡ï¼Œ<br>å¹¶å°†ç¬¬<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.65952em;vertical-align:0"></span><span class="mord mathnormal">i</span></span></span></span> å¤„çš„å…ƒç´ è®¾ç½®ä¸º<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.64444em;vertical-align:0"></span><span class="mord">1</span></span></span></span>ã€‚<br>æ­¤å‘é‡æ˜¯åŸå§‹è¯å…ƒçš„ä¸€ä¸ªç‹¬çƒ­å‘é‡ã€‚<br>ç´¢å¼•ä¸º<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0</mn></mrow><annotation encoding="application/x-tex">0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.64444em;vertical-align:0"></span><span class="mord">0</span></span></span></span> å’Œ<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>2</mn></mrow><annotation encoding="application/x-tex">2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.64444em;vertical-align:0"></span><span class="mord">2</span></span></span></span> çš„ç‹¬çƒ­å‘é‡å¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>F<span class="token punctuation">.</span>one_hot<span class="token punctuation">(</span>torch<span class="token punctuation">.</span>tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>vocab<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr></table></figure><pre><code>tensor([[1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
         0, 0, 0, 0],
        [0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
         0, 0, 0, 0]])
</code></pre><p>æˆ‘ä»¬æ¯æ¬¡é‡‡æ ·çš„ (<strong>å°æ‰¹é‡æ•°æ®å½¢çŠ¶æ˜¯äºŒç»´å¼ é‡ï¼š<br>ï¼ˆæ‰¹é‡å¤§å°ï¼Œæ—¶é—´æ­¥æ•°ï¼‰ã€‚</strong>)<br><code>one_hot</code> å‡½æ•°å°†è¿™æ ·ä¸€ä¸ªå°æ‰¹é‡æ•°æ®è½¬æ¢æˆä¸‰ç»´å¼ é‡ï¼Œ<br>å¼ é‡çš„æœ€åä¸€ä¸ªç»´åº¦ç­‰äºè¯è¡¨å¤§å°ï¼ˆ <code>len(vocab)</code> ï¼‰ã€‚<br>æˆ‘ä»¬ç»å¸¸è½¬æ¢è¾“å…¥çš„ç»´åº¦ï¼Œä»¥ä¾¿è·å¾—å½¢çŠ¶ä¸º<br>ï¼ˆæ—¶é—´æ­¥æ•°ï¼Œæ‰¹é‡å¤§å°ï¼Œè¯è¡¨å¤§å°ï¼‰çš„è¾“å‡ºã€‚<br>è¿™å°†ä½¿æˆ‘ä»¬èƒ½å¤Ÿæ›´æ–¹ä¾¿åœ°é€šè¿‡æœ€å¤–å±‚çš„ç»´åº¦ï¼Œ<br>ä¸€æ­¥ä¸€æ­¥åœ°æ›´æ–°å°æ‰¹é‡æ•°æ®çš„éšçŠ¶æ€ã€‚</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>X <span class="token operator">=</span> torch<span class="token punctuation">.</span>arange<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre>F<span class="token punctuation">.</span>one_hot<span class="token punctuation">(</span>X<span class="token punctuation">.</span>T<span class="token punctuation">,</span> <span class="token number">28</span><span class="token punctuation">)</span><span class="token punctuation">.</span>shape</pre></td></tr></table></figure><pre><code>torch.Size([5, 2, 28])
</code></pre><h2 id="åˆå§‹åŒ–æ¨¡å‹å‚æ•°"><a class="anchor" href="#åˆå§‹åŒ–æ¨¡å‹å‚æ•°">#</a> åˆå§‹åŒ–æ¨¡å‹å‚æ•°</h2><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ [<strong>åˆå§‹åŒ–å¾ªç¯ç¥ç»ç½‘ç»œæ¨¡å‹çš„æ¨¡å‹å‚æ•°</strong>]ã€‚<br>éšè—å•å…ƒæ•° <code>num_hiddens</code> æ˜¯ä¸€ä¸ªå¯è°ƒçš„è¶…å‚æ•°ã€‚<br>å½“è®­ç»ƒè¯­è¨€æ¨¡å‹æ—¶ï¼Œè¾“å…¥å’Œè¾“å‡ºæ¥è‡ªç›¸åŒçš„è¯è¡¨ã€‚<br>å› æ­¤ï¼Œå®ƒä»¬å…·æœ‰ç›¸åŒçš„ç»´åº¦ï¼Œå³è¯è¡¨çš„å¤§å°ã€‚</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">def</span> <span class="token function">get_params</span><span class="token punctuation">(</span>vocab_size<span class="token punctuation">,</span> num_hiddens<span class="token punctuation">,</span> device<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    num_inputs <span class="token operator">=</span> num_outputs <span class="token operator">=</span> vocab_size</pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">normal</span><span class="token punctuation">(</span>shape<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        <span class="token keyword">return</span> torch<span class="token punctuation">.</span>randn<span class="token punctuation">(</span>size<span class="token operator">=</span>shape<span class="token punctuation">,</span> device<span class="token operator">=</span>device<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">0.01</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token comment"># éšè—å±‚å‚æ•°</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    W_xh <span class="token operator">=</span> normal<span class="token punctuation">(</span><span class="token punctuation">(</span>num_inputs<span class="token punctuation">,</span> num_hiddens<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    W_hh <span class="token operator">=</span> normal<span class="token punctuation">(</span><span class="token punctuation">(</span>num_hiddens<span class="token punctuation">,</span> num_hiddens<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    b_h <span class="token operator">=</span> torch<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span>num_hiddens<span class="token punctuation">,</span> device<span class="token operator">=</span>device<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token comment"># è¾“å‡ºå±‚å‚æ•°</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    W_hq <span class="token operator">=</span> normal<span class="token punctuation">(</span><span class="token punctuation">(</span>num_hiddens<span class="token punctuation">,</span> num_outputs<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    b_q <span class="token operator">=</span> torch<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span>num_outputs<span class="token punctuation">,</span> device<span class="token operator">=</span>device<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token comment"># é™„åŠ æ¢¯åº¦</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    params <span class="token operator">=</span> <span class="token punctuation">[</span>W_xh<span class="token punctuation">,</span> W_hh<span class="token punctuation">,</span> b_h<span class="token punctuation">,</span> W_hq<span class="token punctuation">,</span> b_q<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token keyword">for</span> param <span class="token keyword">in</span> params<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="17"></td><td><pre>        param<span class="token punctuation">.</span>requires_grad_<span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="18"></td><td><pre>    <span class="token keyword">return</span> params</pre></td></tr></table></figure><h2 id="å¾ªç¯ç¥ç»ç½‘ç»œæ¨¡å‹"><a class="anchor" href="#å¾ªç¯ç¥ç»ç½‘ç»œæ¨¡å‹">#</a> å¾ªç¯ç¥ç»ç½‘ç»œæ¨¡å‹</h2><p>ä¸ºäº†å®šä¹‰å¾ªç¯ç¥ç»ç½‘ç»œæ¨¡å‹ï¼Œ<br>æˆ‘ä»¬é¦–å…ˆéœ€è¦ [<strong>ä¸€ä¸ª <code>init_rnn_state</code> å‡½æ•°åœ¨åˆå§‹åŒ–æ—¶è¿”å›éšçŠ¶æ€</strong>]ã€‚<br>è¿™ä¸ªå‡½æ•°çš„è¿”å›æ˜¯ä¸€ä¸ªå¼ é‡ï¼Œå¼ é‡å…¨ç”¨ 0 å¡«å……ï¼Œ<br>å½¢çŠ¶ä¸ºï¼ˆæ‰¹é‡å¤§å°ï¼Œéšè—å•å…ƒæ•°ï¼‰ã€‚<br>åœ¨åé¢çš„ç« èŠ‚ä¸­æˆ‘ä»¬å°†ä¼šé‡åˆ°éšçŠ¶æ€åŒ…å«å¤šä¸ªå˜é‡çš„æƒ…å†µï¼Œ<br>è€Œä½¿ç”¨å…ƒç»„å¯ä»¥æ›´å®¹æ˜“åœ°å¤„ç†äº›ã€‚</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">def</span> <span class="token function">init_rnn_state</span><span class="token punctuation">(</span>batch_size<span class="token punctuation">,</span> num_hiddens<span class="token punctuation">,</span> device<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">return</span> <span class="token punctuation">(</span>torch<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">(</span>batch_size<span class="token punctuation">,</span> num_hiddens<span class="token punctuation">)</span><span class="token punctuation">,</span> device<span class="token operator">=</span>device<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">)</span></pre></td></tr></table></figure><p>[<strong>ä¸‹é¢çš„ <code>rnn</code> å‡½æ•°å®šä¹‰äº†å¦‚ä½•åœ¨ä¸€ä¸ªæ—¶é—´æ­¥å†…è®¡ç®—éšçŠ¶æ€å’Œè¾“å‡ºã€‚</strong>]<br>å¾ªç¯ç¥ç»ç½‘ç»œæ¨¡å‹é€šè¿‡ <code>inputs</code> æœ€å¤–å±‚çš„ç»´åº¦å®ç°å¾ªç¯ï¼Œ<br>ä»¥ä¾¿é€æ—¶é—´æ­¥æ›´æ–°å°æ‰¹é‡æ•°æ®çš„éšçŠ¶æ€ <code>H</code> ã€‚<br>æ­¤å¤–ï¼Œè¿™é‡Œä½¿ç”¨<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>tanh</mi><mo>â¡</mo></mrow><annotation encoding="application/x-tex">\tanh</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.69444em;vertical-align:0"></span><span class="mop">tanh</span></span></span></span> å‡½æ•°ä½œä¸ºæ¿€æ´»å‡½æ•°ã€‚<br>å¦‚ :numref: <code>sec_mlp</code> æ‰€è¿°ï¼Œ<br>å½“å…ƒç´ åœ¨å®æ•°ä¸Šæ»¡è¶³å‡åŒ€åˆ†å¸ƒæ—¶ï¼Œ<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>tanh</mi><mo>â¡</mo></mrow><annotation encoding="application/x-tex">\tanh</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.69444em;vertical-align:0"></span><span class="mop">tanh</span></span></span></span> å‡½æ•°çš„å¹³å‡å€¼ä¸º 0ã€‚</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">def</span> <span class="token function">rnn</span><span class="token punctuation">(</span>inputs<span class="token punctuation">,</span> state<span class="token punctuation">,</span> params<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token comment"># inputs çš„å½¢çŠ¶ï¼š(æ—¶é—´æ­¥æ•°é‡ï¼Œæ‰¹é‡å¤§å°ï¼Œè¯è¡¨å¤§å°)</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    W_xh<span class="token punctuation">,</span> W_hh<span class="token punctuation">,</span> b_h<span class="token punctuation">,</span> W_hq<span class="token punctuation">,</span> b_q <span class="token operator">=</span> params</pre></td></tr><tr><td data-num="4"></td><td><pre>    H<span class="token punctuation">,</span> <span class="token operator">=</span> state</pre></td></tr><tr><td data-num="5"></td><td><pre>    outputs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token comment"># X çš„å½¢çŠ¶ï¼š(æ‰¹é‡å¤§å°ï¼Œè¯è¡¨å¤§å°)</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token keyword">for</span> X <span class="token keyword">in</span> inputs<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        H <span class="token operator">=</span> torch<span class="token punctuation">.</span>tanh<span class="token punctuation">(</span>torch<span class="token punctuation">.</span>mm<span class="token punctuation">(</span>X<span class="token punctuation">,</span> W_xh<span class="token punctuation">)</span> <span class="token operator">+</span> torch<span class="token punctuation">.</span>mm<span class="token punctuation">(</span>H<span class="token punctuation">,</span> W_hh<span class="token punctuation">)</span> <span class="token operator">+</span> b_h<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        Y <span class="token operator">=</span> torch<span class="token punctuation">.</span>mm<span class="token punctuation">(</span>H<span class="token punctuation">,</span> W_hq<span class="token punctuation">)</span> <span class="token operator">+</span> b_q</pre></td></tr><tr><td data-num="10"></td><td><pre>        outputs<span class="token punctuation">.</span>append<span class="token punctuation">(</span>Y<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token keyword">return</span> torch<span class="token punctuation">.</span>cat<span class="token punctuation">(</span>outputs<span class="token punctuation">,</span> dim<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>H<span class="token punctuation">,</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>å®šä¹‰äº†æ‰€æœ‰éœ€è¦çš„å‡½æ•°ä¹‹åï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬ [<strong>åˆ›å»ºä¸€ä¸ªç±»æ¥åŒ…è£…è¿™äº›å‡½æ•°</strong>]ï¼Œ<br>å¹¶å­˜å‚¨ä»é›¶å¼€å§‹å®ç°çš„å¾ªç¯ç¥ç»ç½‘ç»œæ¨¡å‹çš„å‚æ•°ã€‚</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">RNNModelScratch</span><span class="token punctuation">:</span> <span class="token comment">#@save</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token triple-quoted-string string">"""ä»é›¶å¼€å§‹å®ç°çš„å¾ªç¯ç¥ç»ç½‘ç»œæ¨¡å‹"""</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> vocab_size<span class="token punctuation">,</span> num_hiddens<span class="token punctuation">,</span> device<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="4"></td><td><pre>                 get_params<span class="token punctuation">,</span> init_state<span class="token punctuation">,</span> forward_fn<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        self<span class="token punctuation">.</span>vocab_size<span class="token punctuation">,</span> self<span class="token punctuation">.</span>num_hiddens <span class="token operator">=</span> vocab_size<span class="token punctuation">,</span> num_hiddens</pre></td></tr><tr><td data-num="6"></td><td><pre>        self<span class="token punctuation">.</span>params <span class="token operator">=</span> get_params<span class="token punctuation">(</span>vocab_size<span class="token punctuation">,</span> num_hiddens<span class="token punctuation">,</span> device<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        self<span class="token punctuation">.</span>init_state<span class="token punctuation">,</span> self<span class="token punctuation">.</span>forward_fn <span class="token operator">=</span> init_state<span class="token punctuation">,</span> forward_fn</pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">__call__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> X<span class="token punctuation">,</span> state<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="10"></td><td><pre>        X <span class="token operator">=</span> F<span class="token punctuation">.</span>one_hot<span class="token punctuation">(</span>X<span class="token punctuation">.</span>T<span class="token punctuation">,</span> self<span class="token punctuation">.</span>vocab_size<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">type</span><span class="token punctuation">(</span>torch<span class="token punctuation">.</span>float32<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre>        <span class="token keyword">return</span> self<span class="token punctuation">.</span>forward_fn<span class="token punctuation">(</span>X<span class="token punctuation">,</span> state<span class="token punctuation">,</span> self<span class="token punctuation">.</span>params<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">begin_state</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> batch_size<span class="token punctuation">,</span> device<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="14"></td><td><pre>        <span class="token keyword">return</span> self<span class="token punctuation">.</span>init_state<span class="token punctuation">(</span>batch_size<span class="token punctuation">,</span> self<span class="token punctuation">.</span>num_hiddens<span class="token punctuation">,</span> device<span class="token punctuation">)</span></pre></td></tr></table></figure><p>è®©æˆ‘ä»¬ [<strong>æ£€æŸ¥è¾“å‡ºæ˜¯å¦å…·æœ‰æ­£ç¡®çš„å½¢çŠ¶</strong>]ã€‚<br>ä¾‹å¦‚ï¼ŒéšçŠ¶æ€çš„ç»´æ•°æ˜¯å¦ä¿æŒä¸å˜ã€‚</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>num_hiddens <span class="token operator">=</span> <span class="token number">512</span></pre></td></tr><tr><td data-num="2"></td><td><pre>net <span class="token operator">=</span> RNNModelScratch<span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>vocab<span class="token punctuation">)</span><span class="token punctuation">,</span> num_hiddens<span class="token punctuation">,</span> d2l<span class="token punctuation">.</span>try_gpu<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> get_params<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="3"></td><td><pre>                      init_rnn_state<span class="token punctuation">,</span> rnn<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre>state <span class="token operator">=</span> net<span class="token punctuation">.</span>begin_state<span class="token punctuation">(</span>X<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> d2l<span class="token punctuation">.</span>try_gpu<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre>Y<span class="token punctuation">,</span> new_state <span class="token operator">=</span> net<span class="token punctuation">(</span>X<span class="token punctuation">.</span>to<span class="token punctuation">(</span>d2l<span class="token punctuation">.</span>try_gpu<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> state<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre>Y<span class="token punctuation">.</span>shape<span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>new_state<span class="token punctuation">)</span><span class="token punctuation">,</span> new_state<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>shape</pre></td></tr></table></figure><pre><code>(torch.Size([10, 28]), 1, torch.Size([2, 512]))
</code></pre><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¾“å‡ºå½¢çŠ¶æ˜¯ï¼ˆæ—¶é—´æ­¥æ•°<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>Ã—</mo></mrow><annotation encoding="application/x-tex">\times</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.66666em;vertical-align:-.08333em"></span><span class="mord">Ã—</span></span></span></span> æ‰¹é‡å¤§å°ï¼Œè¯è¡¨å¤§å°ï¼‰ï¼Œ<br>è€ŒéšçŠ¶æ€å½¢çŠ¶ä¿æŒä¸å˜ï¼Œå³ï¼ˆæ‰¹é‡å¤§å°ï¼Œéšè—å•å…ƒæ•°ï¼‰ã€‚</p><h2 id="é¢„æµ‹"><a class="anchor" href="#é¢„æµ‹">#</a> é¢„æµ‹</h2><p>è®©æˆ‘ä»¬ [<strong>é¦–å…ˆå®šä¹‰é¢„æµ‹å‡½æ•°æ¥ç”Ÿæˆ <code>prefix</code> ä¹‹åçš„æ–°å­—ç¬¦</strong>]ï¼Œ<br>å…¶ä¸­çš„ <code>prefix</code> æ˜¯ä¸€ä¸ªç”¨æˆ·æä¾›çš„åŒ…å«å¤šä¸ªå­—ç¬¦çš„å­—ç¬¦ä¸²ã€‚<br>åœ¨å¾ªç¯éå† <code>prefix</code> ä¸­çš„å¼€å§‹å­—ç¬¦æ—¶ï¼Œ<br>æˆ‘ä»¬ä¸æ–­åœ°å°†éšçŠ¶æ€ä¼ é€’åˆ°ä¸‹ä¸€ä¸ªæ—¶é—´æ­¥ï¼Œä½†æ˜¯ä¸ç”Ÿæˆä»»ä½•è¾“å‡ºã€‚<br>è¿™è¢«ç§°ä¸º<em>é¢„çƒ­</em>ï¼ˆwarm-upï¼‰æœŸï¼Œ<br>å› ä¸ºåœ¨æ­¤æœŸé—´æ¨¡å‹ä¼šè‡ªæˆ‘æ›´æ–°ï¼ˆä¾‹å¦‚ï¼Œæ›´æ–°éšçŠ¶æ€ï¼‰ï¼Œ<br>ä½†ä¸ä¼šè¿›è¡Œé¢„æµ‹ã€‚<br>é¢„çƒ­æœŸç»“æŸåï¼ŒéšçŠ¶æ€çš„å€¼é€šå¸¸æ¯”åˆšå¼€å§‹çš„åˆå§‹å€¼æ›´é€‚åˆé¢„æµ‹ï¼Œ<br>ä»è€Œé¢„æµ‹å­—ç¬¦å¹¶è¾“å‡ºå®ƒä»¬ã€‚</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">def</span> <span class="token function">predict_ch8</span><span class="token punctuation">(</span>prefix<span class="token punctuation">,</span> num_preds<span class="token punctuation">,</span> net<span class="token punctuation">,</span> vocab<span class="token punctuation">,</span> device<span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment">#@save</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token triple-quoted-string string">"""åœ¨prefixåé¢ç”Ÿæˆæ–°å­—ç¬¦"""</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    state <span class="token operator">=</span> net<span class="token punctuation">.</span>begin_state<span class="token punctuation">(</span>batch_size<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> device<span class="token operator">=</span>device<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    outputs <span class="token operator">=</span> <span class="token punctuation">[</span>vocab<span class="token punctuation">[</span>prefix<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    get_input <span class="token operator">=</span> <span class="token keyword">lambda</span><span class="token punctuation">:</span> torch<span class="token punctuation">.</span>tensor<span class="token punctuation">(</span><span class="token punctuation">[</span>outputs<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span> device<span class="token operator">=</span>device<span class="token punctuation">)</span><span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">for</span> y <span class="token keyword">in</span> prefix<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">:</span>  <span class="token comment"># é¢„çƒ­æœŸ</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        _<span class="token punctuation">,</span> state <span class="token operator">=</span> net<span class="token punctuation">(</span>get_input<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> state<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        outputs<span class="token punctuation">.</span>append<span class="token punctuation">(</span>vocab<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>num_preds<span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># é¢„æµ‹ num_preds æ­¥</span></pre></td></tr><tr><td data-num="10"></td><td><pre>        y<span class="token punctuation">,</span> state <span class="token operator">=</span> net<span class="token punctuation">(</span>get_input<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> state<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre>        outputs<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>y<span class="token punctuation">.</span>argmax<span class="token punctuation">(</span>dim<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token keyword">return</span> <span class="token string">''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">[</span>vocab<span class="token punctuation">.</span>idx_to_token<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> outputs<span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>ç°åœ¨æˆ‘ä»¬å¯ä»¥æµ‹è¯• <code>predict_ch8</code> å‡½æ•°ã€‚<br>æˆ‘ä»¬å°†å‰ç¼€æŒ‡å®šä¸º <code>time traveller</code> ï¼Œ<br>å¹¶åŸºäºè¿™ä¸ªå‰ç¼€ç”Ÿæˆ 10 ä¸ªåç»­å­—ç¬¦ã€‚<br>é‰´äºæˆ‘ä»¬è¿˜æ²¡æœ‰è®­ç»ƒç½‘ç»œï¼Œå®ƒä¼šç”Ÿæˆè’è°¬çš„é¢„æµ‹ç»“æœã€‚</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>predict_ch8<span class="token punctuation">(</span><span class="token string">'time traveller '</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> net<span class="token punctuation">,</span> vocab<span class="token punctuation">,</span> d2l<span class="token punctuation">.</span>try_gpu<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr></table></figure><pre><code>'time traveller vxs dyhmat'
</code></pre><h2 id="æ¢¯åº¦è£å‰ª"><a class="anchor" href="#æ¢¯åº¦è£å‰ª">#</a> [<strong>æ¢¯åº¦è£å‰ª</strong>]</h2><p>å¯¹äºé•¿åº¦ä¸º<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>T</mi></mrow><annotation encoding="application/x-tex">T</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.68333em;vertical-align:0"></span><span class="mord mathnormal" style="margin-right:.13889em">T</span></span></span></span> çš„åºåˆ—ï¼Œæˆ‘ä»¬åœ¨è¿­ä»£ä¸­è®¡ç®—è¿™<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>T</mi></mrow><annotation encoding="application/x-tex">T</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.68333em;vertical-align:0"></span><span class="mord mathnormal" style="margin-right:.13889em">T</span></span></span></span> ä¸ªæ—¶é—´æ­¥ä¸Šçš„æ¢¯åº¦ï¼Œ<br>å°†ä¼šåœ¨åå‘ä¼ æ’­è¿‡ç¨‹ä¸­äº§ç”Ÿé•¿åº¦ä¸º<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="script">O</mi><mo stretchy="false">(</mo><mi>T</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\mathcal{O}(T)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mord"><span class="mord mathcal" style="margin-right:.02778em">O</span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:.13889em">T</span><span class="mclose">)</span></span></span></span> çš„çŸ©é˜µä¹˜æ³•é“¾ã€‚<br>å¦‚ :numref: <code>sec_numerical_stability</code> æ‰€è¿°ï¼Œ<br>å½“<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>T</mi></mrow><annotation encoding="application/x-tex">T</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.68333em;vertical-align:0"></span><span class="mord mathnormal" style="margin-right:.13889em">T</span></span></span></span> è¾ƒå¤§æ—¶ï¼Œå®ƒå¯èƒ½å¯¼è‡´æ•°å€¼ä¸ç¨³å®šï¼Œ<br>ä¾‹å¦‚å¯èƒ½å¯¼è‡´æ¢¯åº¦çˆ†ç‚¸æˆ–æ¢¯åº¦æ¶ˆå¤±ã€‚<br>å› æ­¤ï¼Œå¾ªç¯ç¥ç»ç½‘ç»œæ¨¡å‹å¾€å¾€éœ€è¦é¢å¤–çš„æ–¹å¼æ¥æ”¯æŒç¨³å®šè®­ç»ƒã€‚</p><p>ä¸€èˆ¬æ¥è¯´ï¼Œå½“è§£å†³ä¼˜åŒ–é—®é¢˜æ—¶ï¼Œæˆ‘ä»¬å¯¹æ¨¡å‹å‚æ•°é‡‡ç”¨æ›´æ–°æ­¥éª¤ã€‚<br>å‡å®šåœ¨å‘é‡å½¢å¼çš„<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="bold">x</mi></mrow><annotation encoding="application/x-tex">\mathbf{x}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.44444em;vertical-align:0"></span><span class="mord"><span class="mord mathbf">x</span></span></span></span></span> ä¸­ï¼Œ<br>æˆ–è€…åœ¨å°æ‰¹é‡æ•°æ®çš„è´Ÿæ¢¯åº¦<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="bold">g</mi></mrow><annotation encoding="application/x-tex">\mathbf{g}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.63888em;vertical-align:-.19444em"></span><span class="mord"><span class="mord mathbf" style="margin-right:.01597em">g</span></span></span></span></span> æ–¹å‘ä¸Šã€‚<br>ä¾‹å¦‚ï¼Œä½¿ç”¨<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Î·</mi><mo>&gt;</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">\eta &gt; 0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.7335400000000001em;vertical-align:-.19444em"></span><span class="mord mathnormal" style="margin-right:.03588em">Î·</span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:.64444em;vertical-align:0"></span><span class="mord">0</span></span></span></span> ä½œä¸ºå­¦ä¹ ç‡æ—¶ï¼Œåœ¨ä¸€æ¬¡è¿­ä»£ä¸­ï¼Œ<br>æˆ‘ä»¬å°†<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="bold">x</mi></mrow><annotation encoding="application/x-tex">\mathbf{x}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.44444em;vertical-align:0"></span><span class="mord"><span class="mord mathbf">x</span></span></span></span></span> æ›´æ–°ä¸º<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="bold">x</mi><mo>âˆ’</mo><mi>Î·</mi><mi mathvariant="bold">g</mi></mrow><annotation encoding="application/x-tex">\mathbf{x} - \eta \mathbf{g}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.66666em;vertical-align:-.08333em"></span><span class="mord"><span class="mord mathbf">x</span></span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:.63888em;vertical-align:-.19444em"></span><span class="mord mathnormal" style="margin-right:.03588em">Î·</span><span class="mord"><span class="mord mathbf" style="margin-right:.01597em">g</span></span></span></span></span>ã€‚<br>å¦‚æœæˆ‘ä»¬è¿›ä¸€æ­¥å‡è®¾ç›®æ ‡å‡½æ•°<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi></mrow><annotation encoding="application/x-tex">f</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.8888799999999999em;vertical-align:-.19444em"></span><span class="mord mathnormal" style="margin-right:.10764em">f</span></span></span></span> è¡¨ç°è‰¯å¥½ï¼Œ<br>å³å‡½æ•°<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi></mrow><annotation encoding="application/x-tex">f</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.8888799999999999em;vertical-align:-.19444em"></span><span class="mord mathnormal" style="margin-right:.10764em">f</span></span></span></span> åœ¨å¸¸æ•°<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi></mrow><annotation encoding="application/x-tex">L</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.68333em;vertical-align:0"></span><span class="mord mathnormal">L</span></span></span></span> ä¸‹æ˜¯<em>åˆ©æ™®å¸ŒèŒ¨è¿ç»­çš„</em>ï¼ˆLipschitz continuousï¼‰ã€‚<br>ä¹Ÿå°±æ˜¯è¯´ï¼Œå¯¹äºä»»æ„<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="bold">x</mi></mrow><annotation encoding="application/x-tex">\mathbf{x}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.44444em;vertical-align:0"></span><span class="mord"><span class="mord mathbf">x</span></span></span></span></span> å’Œ<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="bold">y</mi></mrow><annotation encoding="application/x-tex">\mathbf{y}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.63888em;vertical-align:-.19444em"></span><span class="mord"><span class="mord mathbf" style="margin-right:.01597em">y</span></span></span></span></span> æˆ‘ä»¬æœ‰ï¼š</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi mathvariant="normal">âˆ£</mi><mi>f</mi><mo stretchy="false">(</mo><mi mathvariant="bold">x</mi><mo stretchy="false">)</mo><mo>âˆ’</mo><mi>f</mi><mo stretchy="false">(</mo><mi mathvariant="bold">y</mi><mo stretchy="false">)</mo><mi mathvariant="normal">âˆ£</mi><mo>â‰¤</mo><mi>L</mi><mi mathvariant="normal">âˆ¥</mi><mi mathvariant="bold">x</mi><mo>âˆ’</mo><mi mathvariant="bold">y</mi><mi mathvariant="normal">âˆ¥</mi><mi mathvariant="normal">.</mi></mrow><annotation encoding="application/x-tex">|f(\mathbf{x}) - f(\mathbf{y})| \leq L \|\mathbf{x} - \mathbf{y}\|.</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mord">âˆ£</span><span class="mord mathnormal" style="margin-right:.10764em">f</span><span class="mopen">(</span><span class="mord"><span class="mord mathbf">x</span></span><span class="mclose">)</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mord mathnormal" style="margin-right:.10764em">f</span><span class="mopen">(</span><span class="mord"><span class="mord mathbf" style="margin-right:.01597em">y</span></span><span class="mclose">)</span><span class="mord">âˆ£</span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mrel">â‰¤</span><span class="mspace" style="margin-right:.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mord mathnormal">L</span><span class="mord">âˆ¥</span><span class="mord"><span class="mord mathbf">x</span></span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mord"><span class="mord mathbf" style="margin-right:.01597em">y</span></span><span class="mord">âˆ¥</span><span class="mord">.</span></span></span></span></span></p><p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥å®‰å…¨åœ°å‡è®¾ï¼š<br>å¦‚æœæˆ‘ä»¬é€šè¿‡<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Î·</mi><mi mathvariant="bold">g</mi></mrow><annotation encoding="application/x-tex">\eta \mathbf{g}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.63888em;vertical-align:-.19444em"></span><span class="mord mathnormal" style="margin-right:.03588em">Î·</span><span class="mord"><span class="mord mathbf" style="margin-right:.01597em">g</span></span></span></span></span> æ›´æ–°å‚æ•°å‘é‡ï¼Œåˆ™</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi mathvariant="normal">âˆ£</mi><mi>f</mi><mo stretchy="false">(</mo><mi mathvariant="bold">x</mi><mo stretchy="false">)</mo><mo>âˆ’</mo><mi>f</mi><mo stretchy="false">(</mo><mi mathvariant="bold">x</mi><mo>âˆ’</mo><mi>Î·</mi><mi mathvariant="bold">g</mi><mo stretchy="false">)</mo><mi mathvariant="normal">âˆ£</mi><mo>â‰¤</mo><mi>L</mi><mi>Î·</mi><mi mathvariant="normal">âˆ¥</mi><mi mathvariant="bold">g</mi><mi mathvariant="normal">âˆ¥</mi><mo separator="true">,</mo></mrow><annotation encoding="application/x-tex">|f(\mathbf{x}) - f(\mathbf{x} - \eta\mathbf{g})| \leq L \eta\|\mathbf{g}\|,</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mord">âˆ£</span><span class="mord mathnormal" style="margin-right:.10764em">f</span><span class="mopen">(</span><span class="mord"><span class="mord mathbf">x</span></span><span class="mclose">)</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mord mathnormal" style="margin-right:.10764em">f</span><span class="mopen">(</span><span class="mord"><span class="mord mathbf">x</span></span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mord mathnormal" style="margin-right:.03588em">Î·</span><span class="mord"><span class="mord mathbf" style="margin-right:.01597em">g</span></span><span class="mclose">)</span><span class="mord">âˆ£</span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mrel">â‰¤</span><span class="mspace" style="margin-right:.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mord mathnormal">L</span><span class="mord mathnormal" style="margin-right:.03588em">Î·</span><span class="mord">âˆ¥</span><span class="mord"><span class="mord mathbf" style="margin-right:.01597em">g</span></span><span class="mord">âˆ¥</span><span class="mpunct">,</span></span></span></span></span></p><p>è¿™æ„å‘³ç€æˆ‘ä»¬ä¸ä¼šè§‚å¯Ÿåˆ°è¶…è¿‡<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi><mi>Î·</mi><mi mathvariant="normal">âˆ¥</mi><mi mathvariant="bold">g</mi><mi mathvariant="normal">âˆ¥</mi></mrow><annotation encoding="application/x-tex">L \eta \|\mathbf{g}\|</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mord mathnormal">L</span><span class="mord mathnormal" style="margin-right:.03588em">Î·</span><span class="mord">âˆ¥</span><span class="mord"><span class="mord mathbf" style="margin-right:.01597em">g</span></span><span class="mord">âˆ¥</span></span></span></span> çš„å˜åŒ–ã€‚<br>è¿™æ—¢æ˜¯åäº‹ä¹Ÿæ˜¯å¥½äº‹ã€‚<br>åçš„æ–¹é¢ï¼Œå®ƒé™åˆ¶äº†å–å¾—è¿›å±•çš„é€Ÿåº¦ï¼›<br>å¥½çš„æ–¹é¢ï¼Œå®ƒé™åˆ¶äº†äº‹æƒ…å˜ç³Ÿçš„ç¨‹åº¦ï¼Œå°¤å…¶å½“æˆ‘ä»¬æœç€é”™è¯¯çš„æ–¹å‘å‰è¿›æ—¶ã€‚</p><p>æœ‰æ—¶æ¢¯åº¦å¯èƒ½å¾ˆå¤§ï¼Œä»è€Œä¼˜åŒ–ç®—æ³•å¯èƒ½æ— æ³•æ”¶æ•›ã€‚<br>æˆ‘ä»¬å¯ä»¥é€šè¿‡é™ä½<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Î·</mi></mrow><annotation encoding="application/x-tex">\eta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.625em;vertical-align:-.19444em"></span><span class="mord mathnormal" style="margin-right:.03588em">Î·</span></span></span></span> çš„å­¦ä¹ ç‡æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚<br>ä½†æ˜¯å¦‚æœæˆ‘ä»¬å¾ˆå°‘å¾—åˆ°å¤§çš„æ¢¯åº¦å‘¢ï¼Ÿ<br>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¿™ç§åšæ³•ä¼¼ä¹æ¯«æ— é“ç†ã€‚<br>ä¸€ä¸ªæµè¡Œçš„æ›¿ä»£æ–¹æ¡ˆæ˜¯é€šè¿‡å°†æ¢¯åº¦<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="bold">g</mi></mrow><annotation encoding="application/x-tex">\mathbf{g}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.63888em;vertical-align:-.19444em"></span><span class="mord"><span class="mord mathbf" style="margin-right:.01597em">g</span></span></span></span></span> æŠ•å½±å›ç»™å®šåŠå¾„<br>ï¼ˆä¾‹å¦‚<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Î¸</mi></mrow><annotation encoding="application/x-tex">\theta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.69444em;vertical-align:0"></span><span class="mord mathnormal" style="margin-right:.02778em">Î¸</span></span></span></span>ï¼‰çš„çƒæ¥è£å‰ªæ¢¯åº¦<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="bold">g</mi></mrow><annotation encoding="application/x-tex">\mathbf{g}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.63888em;vertical-align:-.19444em"></span><span class="mord"><span class="mord mathbf" style="margin-right:.01597em">g</span></span></span></span></span>ã€‚<br>å¦‚ä¸‹å¼ï¼š</p><p>(<strong>$$\mathbf{g} \leftarrow \min\left(1, \frac{\theta}{|\mathbf{g}|}\right) \mathbf{g}.$$</strong>)</p><p>é€šè¿‡è¿™æ ·åšï¼Œæˆ‘ä»¬çŸ¥é“æ¢¯åº¦èŒƒæ•°æ°¸è¿œä¸ä¼šè¶…è¿‡<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Î¸</mi></mrow><annotation encoding="application/x-tex">\theta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.69444em;vertical-align:0"></span><span class="mord mathnormal" style="margin-right:.02778em">Î¸</span></span></span></span>ï¼Œ<br>å¹¶ä¸”æ›´æ–°åçš„æ¢¯åº¦å®Œå…¨ä¸<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="bold">g</mi></mrow><annotation encoding="application/x-tex">\mathbf{g}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.63888em;vertical-align:-.19444em"></span><span class="mord"><span class="mord mathbf" style="margin-right:.01597em">g</span></span></span></span></span> çš„åŸå§‹æ–¹å‘å¯¹é½ã€‚<br>å®ƒè¿˜æœ‰ä¸€ä¸ªå€¼å¾—æ‹¥æœ‰çš„å‰¯ä½œç”¨ï¼Œ<br>å³é™åˆ¶ä»»ä½•ç»™å®šçš„å°æ‰¹é‡æ•°æ®ï¼ˆä»¥åŠå…¶ä¸­ä»»ä½•ç»™å®šçš„æ ·æœ¬ï¼‰å¯¹å‚æ•°å‘é‡çš„å½±å“ï¼Œ<br>è¿™èµ‹äºˆäº†æ¨¡å‹ä¸€å®šç¨‹åº¦çš„ç¨³å®šæ€§ã€‚<br>æ¢¯åº¦è£å‰ªæä¾›äº†ä¸€ä¸ªå¿«é€Ÿä¿®å¤æ¢¯åº¦çˆ†ç‚¸çš„æ–¹æ³•ï¼Œ<br>è™½ç„¶å®ƒå¹¶ä¸èƒ½å®Œå…¨è§£å†³é—®é¢˜ï¼Œä½†å®ƒæ˜¯ä¼—å¤šæœ‰æ•ˆçš„æŠ€æœ¯ä¹‹ä¸€ã€‚</p><p>ä¸‹é¢æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªå‡½æ•°æ¥è£å‰ªæ¨¡å‹çš„æ¢¯åº¦ï¼Œ<br>æ¨¡å‹æ˜¯ä»é›¶å¼€å§‹å®ç°çš„æ¨¡å‹æˆ–ç”±é«˜çº§ API æ„å»ºçš„æ¨¡å‹ã€‚<br>æˆ‘ä»¬åœ¨æ­¤è®¡ç®—äº†æ‰€æœ‰æ¨¡å‹å‚æ•°çš„æ¢¯åº¦çš„èŒƒæ•°ã€‚</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">def</span> <span class="token function">grad_clipping</span><span class="token punctuation">(</span>net<span class="token punctuation">,</span> theta<span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment">#@save</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token triple-quoted-string string">"""è£å‰ªæ¢¯åº¦"""</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>net<span class="token punctuation">,</span> nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        params <span class="token operator">=</span> <span class="token punctuation">[</span>p <span class="token keyword">for</span> p <span class="token keyword">in</span> net<span class="token punctuation">.</span>parameters<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">if</span> p<span class="token punctuation">.</span>requires_grad<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token keyword">else</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="6"></td><td><pre>        params <span class="token operator">=</span> net<span class="token punctuation">.</span>params</pre></td></tr><tr><td data-num="7"></td><td><pre>    norm <span class="token operator">=</span> torch<span class="token punctuation">.</span>sqrt<span class="token punctuation">(</span><span class="token builtin">sum</span><span class="token punctuation">(</span>torch<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span>grad <span class="token operator">**</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">for</span> p <span class="token keyword">in</span> params<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token keyword">if</span> norm <span class="token operator">></span> theta<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        <span class="token keyword">for</span> param <span class="token keyword">in</span> params<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="10"></td><td><pre>            param<span class="token punctuation">.</span>grad<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token operator">*=</span> theta <span class="token operator">/</span> norm</pre></td></tr></table></figure><h2 id="è®­ç»ƒ"><a class="anchor" href="#è®­ç»ƒ">#</a> è®­ç»ƒ</h2><p>åœ¨è®­ç»ƒæ¨¡å‹ä¹‹å‰ï¼Œè®©æˆ‘ä»¬ [<strong>å®šä¹‰ä¸€ä¸ªå‡½æ•°åœ¨ä¸€ä¸ªè¿­ä»£å‘¨æœŸå†…è®­ç»ƒæ¨¡å‹</strong>]ã€‚<br>å®ƒä¸æˆ‘ä»¬è®­ç»ƒ :numref: <code>sec_softmax_scratch</code> æ¨¡å‹çš„æ–¹å¼æœ‰ä¸‰ä¸ªä¸åŒä¹‹å¤„ã€‚</p><ol><li>åºåˆ—æ•°æ®çš„ä¸åŒé‡‡æ ·æ–¹æ³•ï¼ˆéšæœºé‡‡æ ·å’Œé¡ºåºåˆ†åŒºï¼‰å°†å¯¼è‡´éšçŠ¶æ€åˆå§‹åŒ–çš„å·®å¼‚ã€‚</li><li>æˆ‘ä»¬åœ¨æ›´æ–°æ¨¡å‹å‚æ•°ä¹‹å‰è£å‰ªæ¢¯åº¦ã€‚<br>è¿™æ ·çš„æ“ä½œçš„ç›®çš„æ˜¯ï¼Œå³ä½¿è®­ç»ƒè¿‡ç¨‹ä¸­æŸä¸ªç‚¹ä¸Šå‘ç”Ÿäº†æ¢¯åº¦çˆ†ç‚¸ï¼Œä¹Ÿèƒ½ä¿è¯æ¨¡å‹ä¸ä¼šå‘æ•£ã€‚</li><li>æˆ‘ä»¬ç”¨å›°æƒ‘åº¦æ¥è¯„ä»·æ¨¡å‹ã€‚å¦‚ :numref: <code>subsec_perplexity</code> æ‰€è¿°ï¼Œ<br>è¿™æ ·çš„åº¦é‡ç¡®ä¿äº†ä¸åŒé•¿åº¦çš„åºåˆ—å…·æœ‰å¯æ¯”æ€§ã€‚</li></ol><p>å…·ä½“æ¥è¯´ï¼Œå½“ä½¿ç”¨é¡ºåºåˆ†åŒºæ—¶ï¼Œ<br>æˆ‘ä»¬åªåœ¨æ¯ä¸ªè¿­ä»£å‘¨æœŸçš„å¼€å§‹ä½ç½®åˆå§‹åŒ–éšçŠ¶æ€ã€‚<br>ç”±äºä¸‹ä¸€ä¸ªå°æ‰¹é‡æ•°æ®ä¸­çš„ç¬¬<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.65952em;vertical-align:0"></span><span class="mord mathnormal">i</span></span></span></span> ä¸ªå­åºåˆ—æ ·æœ¬<br>ä¸å½“å‰ç¬¬<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.65952em;vertical-align:0"></span><span class="mord mathnormal">i</span></span></span></span> ä¸ªå­åºåˆ—æ ·æœ¬ç›¸é‚»ï¼Œ<br>å› æ­¤å½“å‰å°æ‰¹é‡æ•°æ®æœ€åä¸€ä¸ªæ ·æœ¬çš„éšçŠ¶æ€ï¼Œ<br>å°†ç”¨äºåˆå§‹åŒ–ä¸‹ä¸€ä¸ªå°æ‰¹é‡æ•°æ®ç¬¬ä¸€ä¸ªæ ·æœ¬çš„éšçŠ¶æ€ã€‚<br>è¿™æ ·ï¼Œå­˜å‚¨åœ¨éšçŠ¶æ€ä¸­çš„åºåˆ—çš„å†å²ä¿¡æ¯<br>å¯ä»¥åœ¨ä¸€ä¸ªè¿­ä»£å‘¨æœŸå†…æµç»ç›¸é‚»çš„å­åºåˆ—ã€‚<br>ç„¶è€Œï¼Œåœ¨ä»»ä½•ä¸€ç‚¹éšçŠ¶æ€çš„è®¡ç®—ï¼Œ<br>éƒ½ä¾èµ–äºåŒä¸€è¿­ä»£å‘¨æœŸä¸­å‰é¢æ‰€æœ‰çš„å°æ‰¹é‡æ•°æ®ï¼Œ<br>è¿™ä½¿å¾—æ¢¯åº¦è®¡ç®—å˜å¾—å¤æ‚ã€‚<br>ä¸ºäº†é™ä½è®¡ç®—é‡ï¼Œåœ¨å¤„ç†ä»»ä½•ä¸€ä¸ªå°æ‰¹é‡æ•°æ®ä¹‹å‰ï¼Œ<br>æˆ‘ä»¬å…ˆåˆ†ç¦»æ¢¯åº¦ï¼Œä½¿å¾—éšçŠ¶æ€çš„æ¢¯åº¦è®¡ç®—æ€»æ˜¯é™åˆ¶åœ¨ä¸€ä¸ªå°æ‰¹é‡æ•°æ®çš„æ—¶é—´æ­¥å†…ã€‚</p><p>å½“ä½¿ç”¨éšæœºæŠ½æ ·æ—¶ï¼Œå› ä¸ºæ¯ä¸ªæ ·æœ¬éƒ½æ˜¯åœ¨ä¸€ä¸ªéšæœºä½ç½®æŠ½æ ·çš„ï¼Œ<br>å› æ­¤éœ€è¦ä¸ºæ¯ä¸ªè¿­ä»£å‘¨æœŸé‡æ–°åˆå§‹åŒ–éšçŠ¶æ€ã€‚<br>ä¸ :numref: <code>sec_softmax_scratch</code> ä¸­çš„<br><code>train_epoch_ch3</code> å‡½æ•°ç›¸åŒï¼Œ<br><code>updater</code> æ˜¯æ›´æ–°æ¨¡å‹å‚æ•°çš„å¸¸ç”¨å‡½æ•°ã€‚<br>å®ƒæ—¢å¯ä»¥æ˜¯ä»å¤´å¼€å§‹å®ç°çš„ <code>d2l.sgd</code> å‡½æ•°ï¼Œ<br>ä¹Ÿå¯ä»¥æ˜¯æ·±åº¦å­¦ä¹ æ¡†æ¶ä¸­å†…ç½®çš„ä¼˜åŒ–å‡½æ•°ã€‚</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">#@save</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">def</span> <span class="token function">train_epoch_ch8</span><span class="token punctuation">(</span>net<span class="token punctuation">,</span> train_iter<span class="token punctuation">,</span> loss<span class="token punctuation">,</span> updater<span class="token punctuation">,</span> device<span class="token punctuation">,</span> use_random_iter<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token triple-quoted-string string">"""è®­ç»ƒç½‘ç»œä¸€ä¸ªè¿­ä»£å‘¨æœŸï¼ˆå®šä¹‰è§ç¬¬8ç« ï¼‰"""</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    state<span class="token punctuation">,</span> timer <span class="token operator">=</span> <span class="token boolean">None</span><span class="token punctuation">,</span> d2l<span class="token punctuation">.</span>Timer<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    metric <span class="token operator">=</span> d2l<span class="token punctuation">.</span>Accumulator<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>  <span class="token comment"># è®­ç»ƒæŸå¤±ä¹‹å’Œï¼Œè¯å…ƒæ•°é‡</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">for</span> X<span class="token punctuation">,</span> Y <span class="token keyword">in</span> train_iter<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        <span class="token keyword">if</span> state <span class="token keyword">is</span> <span class="token boolean">None</span> <span class="token keyword">or</span> use_random_iter<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="8"></td><td><pre>            <span class="token comment"># åœ¨ç¬¬ä¸€æ¬¡è¿­ä»£æˆ–ä½¿ç”¨éšæœºæŠ½æ ·æ—¶åˆå§‹åŒ– state</span></pre></td></tr><tr><td data-num="9"></td><td><pre>            state <span class="token operator">=</span> net<span class="token punctuation">.</span>begin_state<span class="token punctuation">(</span>batch_size<span class="token operator">=</span>X<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> device<span class="token operator">=</span>device<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre>        <span class="token keyword">else</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="11"></td><td><pre>            <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>net<span class="token punctuation">,</span> nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span> <span class="token keyword">and</span> <span class="token keyword">not</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>state<span class="token punctuation">,</span> <span class="token builtin">tuple</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="12"></td><td><pre>                <span class="token comment"># state å¯¹äº nn.GRU æ˜¯ä¸ªå¼ é‡</span></pre></td></tr><tr><td data-num="13"></td><td><pre>                state<span class="token punctuation">.</span>detach_<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="14"></td><td><pre>            <span class="token keyword">else</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="15"></td><td><pre>                <span class="token comment"># state å¯¹äº nn.LSTM æˆ–å¯¹äºæˆ‘ä»¬ä»é›¶å¼€å§‹å®ç°çš„æ¨¡å‹æ˜¯ä¸ªå¼ é‡</span></pre></td></tr><tr><td data-num="16"></td><td><pre>                <span class="token keyword">for</span> s <span class="token keyword">in</span> state<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="17"></td><td><pre>                    s<span class="token punctuation">.</span>detach_<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="18"></td><td><pre>        y <span class="token operator">=</span> Y<span class="token punctuation">.</span>T<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="19"></td><td><pre>        X<span class="token punctuation">,</span> y <span class="token operator">=</span> X<span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span><span class="token punctuation">,</span> y<span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="20"></td><td><pre>        y_hat<span class="token punctuation">,</span> state <span class="token operator">=</span> net<span class="token punctuation">(</span>X<span class="token punctuation">,</span> state<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="21"></td><td><pre>        l <span class="token operator">=</span> loss<span class="token punctuation">(</span>y_hat<span class="token punctuation">,</span> y<span class="token punctuation">.</span><span class="token builtin">long</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="22"></td><td><pre>        <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>updater<span class="token punctuation">,</span> torch<span class="token punctuation">.</span>optim<span class="token punctuation">.</span>Optimizer<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="23"></td><td><pre>            updater<span class="token punctuation">.</span>zero_grad<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="24"></td><td><pre>            l<span class="token punctuation">.</span>backward<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="25"></td><td><pre>            grad_clipping<span class="token punctuation">(</span>net<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="26"></td><td><pre>            updater<span class="token punctuation">.</span>step<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="27"></td><td><pre>        <span class="token keyword">else</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="28"></td><td><pre>            l<span class="token punctuation">.</span>backward<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="29"></td><td><pre>            grad_clipping<span class="token punctuation">(</span>net<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="30"></td><td><pre>            <span class="token comment"># å› ä¸ºå·²ç»è°ƒç”¨äº† mean å‡½æ•°</span></pre></td></tr><tr><td data-num="31"></td><td><pre>            updater<span class="token punctuation">(</span>batch_size<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="32"></td><td><pre>        metric<span class="token punctuation">.</span>add<span class="token punctuation">(</span>l <span class="token operator">*</span> y<span class="token punctuation">.</span>numel<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> y<span class="token punctuation">.</span>numel<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="33"></td><td><pre>    <span class="token keyword">return</span> math<span class="token punctuation">.</span>exp<span class="token punctuation">(</span>metric<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">/</span> metric<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> metric<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">/</span> timer<span class="token punctuation">.</span>stop<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>[<strong>å¾ªç¯ç¥ç»ç½‘ç»œæ¨¡å‹çš„è®­ç»ƒå‡½æ•°æ—¢æ”¯æŒä»é›¶å¼€å§‹å®ç°ï¼Œ<br>ä¹Ÿå¯ä»¥ä½¿ç”¨é«˜çº§ API æ¥å®ç°ã€‚</strong>]</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">#@save</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">def</span> <span class="token function">train_ch8</span><span class="token punctuation">(</span>net<span class="token punctuation">,</span> train_iter<span class="token punctuation">,</span> vocab<span class="token punctuation">,</span> lr<span class="token punctuation">,</span> num_epochs<span class="token punctuation">,</span> device<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="3"></td><td><pre>              use_random_iter<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token triple-quoted-string string">"""è®­ç»ƒæ¨¡å‹ï¼ˆå®šä¹‰è§ç¬¬8ç« ï¼‰"""</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    loss <span class="token operator">=</span> nn<span class="token punctuation">.</span>CrossEntropyLoss<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    animator <span class="token operator">=</span> d2l<span class="token punctuation">.</span>Animator<span class="token punctuation">(</span>xlabel<span class="token operator">=</span><span class="token string">'epoch'</span><span class="token punctuation">,</span> ylabel<span class="token operator">=</span><span class="token string">'perplexity'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="7"></td><td><pre>                            legend<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'train'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> xlim<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span> num_epochs<span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token comment"># åˆå§‹åŒ–</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>net<span class="token punctuation">,</span> nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="10"></td><td><pre>        updater <span class="token operator">=</span> torch<span class="token punctuation">.</span>optim<span class="token punctuation">.</span>SGD<span class="token punctuation">(</span>net<span class="token punctuation">.</span>parameters<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> lr<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token keyword">else</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="12"></td><td><pre>        updater <span class="token operator">=</span> <span class="token keyword">lambda</span> batch_size<span class="token punctuation">:</span> d2l<span class="token punctuation">.</span>sgd<span class="token punctuation">(</span>net<span class="token punctuation">.</span>params<span class="token punctuation">,</span> lr<span class="token punctuation">,</span> batch_size<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    predict <span class="token operator">=</span> <span class="token keyword">lambda</span> prefix<span class="token punctuation">:</span> predict_ch8<span class="token punctuation">(</span>prefix<span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> net<span class="token punctuation">,</span> vocab<span class="token punctuation">,</span> device<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token comment"># è®­ç»ƒå’Œé¢„æµ‹</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token keyword">for</span> epoch <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>num_epochs<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="16"></td><td><pre>        ppl<span class="token punctuation">,</span> speed <span class="token operator">=</span> train_epoch_ch8<span class="token punctuation">(</span></pre></td></tr><tr><td data-num="17"></td><td><pre>            net<span class="token punctuation">,</span> train_iter<span class="token punctuation">,</span> loss<span class="token punctuation">,</span> updater<span class="token punctuation">,</span> device<span class="token punctuation">,</span> use_random_iter<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="18"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span>epoch <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">10</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="19"></td><td><pre>            <span class="token keyword">print</span><span class="token punctuation">(</span>predict<span class="token punctuation">(</span><span class="token string">'time traveller'</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="20"></td><td><pre>            animator<span class="token punctuation">.</span>add<span class="token punctuation">(</span>epoch <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>ppl<span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="21"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'å›°æƒ‘åº¦ </span><span class="token interpolation"><span class="token punctuation">&#123;</span>ppl<span class="token punctuation">:</span><span class="token format-spec">.1f</span><span class="token punctuation">&#125;</span></span><span class="token string">, </span><span class="token interpolation"><span class="token punctuation">&#123;</span>speed<span class="token punctuation">:</span><span class="token format-spec">.1f</span><span class="token punctuation">&#125;</span></span><span class="token string"> è¯å…ƒ/ç§’ </span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">str</span><span class="token punctuation">(</span>device<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">'</span></span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="22"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span>predict<span class="token punctuation">(</span><span class="token string">'time traveller'</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="23"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span>predict<span class="token punctuation">(</span><span class="token string">'traveller'</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>[<strong>ç°åœ¨ï¼Œæˆ‘ä»¬è®­ç»ƒå¾ªç¯ç¥ç»ç½‘ç»œæ¨¡å‹ã€‚</strong>]<br>å› ä¸ºæˆ‘ä»¬åœ¨æ•°æ®é›†ä¸­åªä½¿ç”¨äº† 10000 ä¸ªè¯å…ƒï¼Œ<br>æ‰€ä»¥æ¨¡å‹éœ€è¦æ›´å¤šçš„è¿­ä»£å‘¨æœŸæ¥æ›´å¥½åœ°æ”¶æ•›ã€‚</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>num_epochs<span class="token punctuation">,</span> lr <span class="token operator">=</span> <span class="token number">500</span><span class="token punctuation">,</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="2"></td><td><pre>train_ch8<span class="token punctuation">(</span>net<span class="token punctuation">,</span> train_iter<span class="token punctuation">,</span> vocab<span class="token punctuation">,</span> lr<span class="token punctuation">,</span> num_epochs<span class="token punctuation">,</span> d2l<span class="token punctuation">.</span>try_gpu<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr></table></figure><pre><code>å›°æƒ‘åº¦ 1.0, 72303.8 è¯å…ƒ/ç§’ cuda:0
time travelleryou can show black is white by argument said filby
traveller with a slight accession ofcheerfulness really thi
</code></pre><p><img data-src="/rnn-scratch_files/rnn-scratch_28_1.svg" alt="svg"></p><p>[<strong>æœ€åï¼Œè®©æˆ‘ä»¬æ£€æŸ¥ä¸€ä¸‹ä½¿ç”¨éšæœºæŠ½æ ·æ–¹æ³•çš„ç»“æœã€‚</strong>]</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>net <span class="token operator">=</span> RNNModelScratch<span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>vocab<span class="token punctuation">)</span><span class="token punctuation">,</span> num_hiddens<span class="token punctuation">,</span> d2l<span class="token punctuation">.</span>try_gpu<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> get_params<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="2"></td><td><pre>                      init_rnn_state<span class="token punctuation">,</span> rnn<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre>train_ch8<span class="token punctuation">(</span>net<span class="token punctuation">,</span> train_iter<span class="token punctuation">,</span> vocab<span class="token punctuation">,</span> lr<span class="token punctuation">,</span> num_epochs<span class="token punctuation">,</span> d2l<span class="token punctuation">.</span>try_gpu<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="4"></td><td><pre>          use_random_iter<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span></pre></td></tr></table></figure><pre><code>å›°æƒ‘åº¦ 1.4, 70725.7 è¯å…ƒ/ç§’ cuda:0
time travellerit s against reason said filbywhan seane of the fi
travellerit s against reason said filbywhan seane of the fi
</code></pre><p><img data-src="/rnn-scratch_files/rnn-scratch_30_1.svg" alt="svg"></p><p>ä»é›¶å¼€å§‹å®ç°ä¸Šè¿°å¾ªç¯ç¥ç»ç½‘ç»œæ¨¡å‹ï¼Œ<br>è™½ç„¶æœ‰æŒ‡å¯¼æ„ä¹‰ï¼Œä½†æ˜¯å¹¶ä¸æ–¹ä¾¿ã€‚<br>åœ¨ä¸‹ä¸€èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†å­¦ä¹ å¦‚ä½•æ”¹è¿›å¾ªç¯ç¥ç»ç½‘ç»œæ¨¡å‹ã€‚<br>ä¾‹å¦‚ï¼Œå¦‚ä½•ä½¿å…¶å®ç°åœ°æ›´å®¹æ˜“ï¼Œä¸”è¿è¡Œé€Ÿåº¦æ›´å¿«ã€‚</p><h2 id="å°ç»“"><a class="anchor" href="#å°ç»“">#</a> å°ç»“</h2><ul><li>æˆ‘ä»¬å¯ä»¥è®­ç»ƒä¸€ä¸ªåŸºäºå¾ªç¯ç¥ç»ç½‘ç»œçš„å­—ç¬¦çº§è¯­è¨€æ¨¡å‹ï¼Œæ ¹æ®ç”¨æˆ·æä¾›çš„æ–‡æœ¬çš„å‰ç¼€ç”Ÿæˆåç»­æ–‡æœ¬ã€‚</li><li>ä¸€ä¸ªç®€å•çš„å¾ªç¯ç¥ç»ç½‘ç»œè¯­è¨€æ¨¡å‹åŒ…æ‹¬è¾“å…¥ç¼–ç ã€å¾ªç¯ç¥ç»ç½‘ç»œæ¨¡å‹å’Œè¾“å‡ºç”Ÿæˆã€‚</li><li>å¾ªç¯ç¥ç»ç½‘ç»œæ¨¡å‹åœ¨è®­ç»ƒä»¥å‰éœ€è¦åˆå§‹åŒ–çŠ¶æ€ï¼Œä¸è¿‡éšæœºæŠ½æ ·å’Œé¡ºåºåˆ’åˆ†ä½¿ç”¨åˆå§‹åŒ–æ–¹æ³•ä¸åŒã€‚</li><li>å½“ä½¿ç”¨é¡ºåºåˆ’åˆ†æ—¶ï¼Œæˆ‘ä»¬éœ€è¦åˆ†ç¦»æ¢¯åº¦ä»¥å‡å°‘è®¡ç®—é‡ã€‚</li><li>åœ¨è¿›è¡Œä»»ä½•é¢„æµ‹ä¹‹å‰ï¼Œæ¨¡å‹é€šè¿‡é¢„çƒ­æœŸè¿›è¡Œè‡ªæˆ‘æ›´æ–°ï¼ˆä¾‹å¦‚ï¼Œè·å¾—æ¯”åˆå§‹å€¼æ›´å¥½çš„éšçŠ¶æ€ï¼‰ã€‚</li><li>æ¢¯åº¦è£å‰ªå¯ä»¥é˜²æ­¢æ¢¯åº¦çˆ†ç‚¸ï¼Œä½†ä¸èƒ½åº”å¯¹æ¢¯åº¦æ¶ˆå¤±ã€‚</li></ul><h2 id="ç»ƒä¹ "><a class="anchor" href="#ç»ƒä¹ ">#</a> ç»ƒä¹ </h2><ol><li>å°è¯•è¯´æ˜ç‹¬çƒ­ç¼–ç ç­‰ä»·äºä¸ºæ¯ä¸ªå¯¹è±¡é€‰æ‹©ä¸åŒçš„åµŒå…¥è¡¨ç¤ºã€‚</li><li>é€šè¿‡è°ƒæ•´è¶…å‚æ•°ï¼ˆå¦‚è¿­ä»£å‘¨æœŸæ•°ã€éšè—å•å…ƒæ•°ã€å°æ‰¹é‡æ•°æ®çš„æ—¶é—´æ­¥æ•°ã€å­¦ä¹ ç‡ç­‰ï¼‰æ¥æ”¹å–„å›°æƒ‘åº¦ã€‚<ul><li>å›°æƒ‘åº¦å¯ä»¥é™åˆ°å¤šå°‘ï¼Ÿ</li><li>ç”¨å¯å­¦ä¹ çš„åµŒå…¥è¡¨ç¤ºæ›¿æ¢ç‹¬çƒ­ç¼–ç ï¼Œæ˜¯å¦ä¼šå¸¦æ¥æ›´å¥½çš„è¡¨ç°ï¼Ÿ</li><li>å¦‚æœç”¨ H.G.Wells çš„å…¶ä»–ä¹¦ä½œä¸ºæ•°æ®é›†æ—¶æ•ˆæœå¦‚ä½•ï¼Œ<br>ä¾‹å¦‚<a target="_blank" rel="noopener" href="http://www.gutenberg.org/ebooks/36"><em>ä¸–ç•Œå¤§æˆ˜</em></a>ï¼Ÿ</li></ul></li><li>ä¿®æ”¹é¢„æµ‹å‡½æ•°ï¼Œä¾‹å¦‚ä½¿ç”¨é‡‡æ ·ï¼Œè€Œä¸æ˜¯é€‰æ‹©æœ€æœ‰å¯èƒ½çš„ä¸‹ä¸€ä¸ªå­—ç¬¦ã€‚<ul><li>ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ</li><li>è°ƒæ•´æ¨¡å‹ä½¿ä¹‹åå‘æ›´å¯èƒ½çš„è¾“å‡ºï¼Œä¾‹å¦‚ï¼Œå½“<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Î±</mi><mo>&gt;</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">\alpha &gt; 1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.5782em;vertical-align:-.0391em"></span><span class="mord mathnormal" style="margin-right:.0037em">Î±</span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:.64444em;vertical-align:0"></span><span class="mord">1</span></span></span></span>ï¼Œä»<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>q</mi><mo stretchy="false">(</mo><msub><mi>x</mi><mi>t</mi></msub><mo>âˆ£</mo><msub><mi>x</mi><mrow><mi>t</mi><mo>âˆ’</mo><mn>1</mn></mrow></msub><mo separator="true">,</mo><mo>â€¦</mo><mo separator="true">,</mo><msub><mi>x</mi><mn>1</mn></msub><mo stretchy="false">)</mo><mo>âˆ</mo><mi>P</mi><mo stretchy="false">(</mo><msub><mi>x</mi><mi>t</mi></msub><mo>âˆ£</mo><msub><mi>x</mi><mrow><mi>t</mi><mo>âˆ’</mo><mn>1</mn></mrow></msub><mo separator="true">,</mo><mo>â€¦</mo><mo separator="true">,</mo><msub><mi>x</mi><mn>1</mn></msub><msup><mo stretchy="false">)</mo><mi>Î±</mi></msup></mrow><annotation encoding="application/x-tex">q(x_t \mid x_{t-1}, \ldots, x_1) \propto P(x_t \mid x_{t-1}, \ldots, x_1)^\alpha</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mord mathnormal" style="margin-right:.03588em">q</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.2805559999999999em"><span style="top:-2.5500000000000003em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mrel">âˆ£</span><span class="mspace" style="margin-right:.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.301108em"><span style="top:-2.5500000000000003em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">âˆ’</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:.208331em"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:.16666666666666666em"></span><span class="minner">â€¦</span><span class="mspace" style="margin-right:.16666666666666666em"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:.16666666666666666em"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.30110799999999993em"><span style="top:-2.5500000000000003em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mrel">âˆ</span><span class="mspace" style="margin-right:.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mord mathnormal" style="margin-right:.13889em">P</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.2805559999999999em"><span style="top:-2.5500000000000003em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mrel">âˆ£</span><span class="mspace" style="margin-right:.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.301108em"><span style="top:-2.5500000000000003em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">âˆ’</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:.208331em"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:.16666666666666666em"></span><span class="minner">â€¦</span><span class="mspace" style="margin-right:.16666666666666666em"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:.16666666666666666em"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.30110799999999993em"><span style="top:-2.5500000000000003em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:.664392em"><span style="top:-3.063em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:.0037em">Î±</span></span></span></span></span></span></span></span></span></span></span> ä¸­é‡‡æ ·ã€‚</li></ul></li><li>åœ¨ä¸è£å‰ªæ¢¯åº¦çš„æƒ…å†µä¸‹è¿è¡Œæœ¬èŠ‚ä¸­çš„ä»£ç ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ</li><li>æ›´æ”¹é¡ºåºåˆ’åˆ†ï¼Œä½¿å…¶ä¸ä¼šä»è®¡ç®—å›¾ä¸­åˆ†ç¦»éšçŠ¶æ€ã€‚è¿è¡Œæ—¶é—´ä¼šæœ‰å˜åŒ–å—ï¼Ÿå›°æƒ‘åº¦å‘¢ï¼Ÿ</li><li>ç”¨ ReLU æ›¿æ¢æœ¬èŠ‚ä¸­ä½¿ç”¨çš„æ¿€æ´»å‡½æ•°ï¼Œå¹¶é‡å¤æœ¬èŠ‚ä¸­çš„å®éªŒã€‚æˆ‘ä»¬è¿˜éœ€è¦æ¢¯åº¦è£å‰ªå—ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ</li></ol><p><span class="exturl" data-url="aHR0cHM6Ly9kaXNjdXNzLmQybC5haS90LzIxMDM=">Discussions</span></p><div class="tags"><a href="/tags/chapter-recurrent-neural-networks/" rel="tag"><i class="ic i-tag"></i> chapter_recurrent-neural-networks</a></div></div><footer><div class="meta"><span class="item"><span class="icon"><i class="ic i-calendar-check"></i> </span><span class="text">æ›´æ–°äº</span> <time title="ä¿®æ”¹æ—¶é—´ï¼š2023-03-04 13:38:25" itemprop="dateModified" datetime="2023-03-04T13:38:25+08:00">2023-03-04</time></span></div><div class="reward"><button><i class="ic i-heartbeat"></i> èµèµ</button><p>è¯·æˆ‘å–[èŒ¶]~(ï¿£â–½ï¿£)~*</p><div id="qr"><div><img data-src="/images/wechatpay.png" alt="yuan å¾®ä¿¡æ”¯ä»˜"><p>å¾®ä¿¡æ”¯ä»˜</p></div><div><img data-src="/images/alipay.png" alt="yuan æ”¯ä»˜å®"><p>æ”¯ä»˜å®</p></div><div><img data-src="/images/paypal.png" alt="yuan è´å®"><p>è´å®</p></div></div></div><div id="copyright"><ul><li class="author"><strong>æœ¬æ–‡ä½œè€…ï¼š </strong>yuan <i class="ic i-at"><em>@</em></i>yuan</li><li class="link"><strong>æœ¬æ–‡é“¾æ¥ï¼š</strong> <a href="https://jyuanhust.github.io/2023/02/15/ai/pytorch%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/chapter_recurrent-neural-networks/rnn-scratch/" title="rnn-scratch">https://jyuanhust.github.io/2023/02/15/ai/pytorchæ·±åº¦å­¦ä¹ /chapter_recurrent-neural-networks/rnn-scratch/</a></li><li class="license"><strong>ç‰ˆæƒå£°æ˜ï¼š </strong>æœ¬ç«™æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/2023/02/15/ai/pytorch%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/chapter_recurrent-neural-networks/rnn-concise/" itemprop="url" rel="prev" data-background-image="https:&#x2F;&#x2F;gitee.com&#x2F;zkz0&#x2F;image&#x2F;raw&#x2F;master&#x2F;img&#x2F;img(11).webp" title="rnn-concise"><span class="type">ä¸Šä¸€ç¯‡</span> <span class="category"><i class="ic i-flag"></i> chapter_recurrent-neural-networks</span><h3>rnn-concise</h3></a></div><div class="item right"><a href="/2023/02/15/ai/pytorch%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/chapter_recurrent-neural-networks/language-models-and-dataset/" itemprop="url" rel="next" data-background-image="https:&#x2F;&#x2F;gitee.com&#x2F;zkz0&#x2F;image&#x2F;raw&#x2F;master&#x2F;img&#x2F;img(61).webp" title="language-models-and-dataset"><span class="type">ä¸‹ä¸€ç¯‡</span> <span class="category"><i class="ic i-flag"></i> chapter_recurrent-neural-networks</span><h3>language-models-and-dataset</h3></a></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="æ–‡ç« ç›®å½•"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%BE%AA%E7%8E%AF%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C%E7%9A%84%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E5%AE%9E%E7%8E%B0"><span class="toc-number">1.</span> <span class="toc-text">å¾ªç¯ç¥ç»ç½‘ç»œçš„ä»é›¶å¼€å§‹å®ç°</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%8B%AC%E7%83%AD%E7%BC%96%E7%A0%81"><span class="toc-number">1.1.</span> <span class="toc-text">[ç‹¬çƒ­ç¼–ç ]</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9D%E5%A7%8B%E5%8C%96%E6%A8%A1%E5%9E%8B%E5%8F%82%E6%95%B0"><span class="toc-number">1.2.</span> <span class="toc-text">åˆå§‹åŒ–æ¨¡å‹å‚æ•°</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BE%AA%E7%8E%AF%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C%E6%A8%A1%E5%9E%8B"><span class="toc-number">1.3.</span> <span class="toc-text">å¾ªç¯ç¥ç»ç½‘ç»œæ¨¡å‹</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A2%84%E6%B5%8B"><span class="toc-number">1.4.</span> <span class="toc-text">é¢„æµ‹</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A2%AF%E5%BA%A6%E8%A3%81%E5%89%AA"><span class="toc-number">1.5.</span> <span class="toc-text">[æ¢¯åº¦è£å‰ª]</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%AD%E7%BB%83"><span class="toc-number">1.6.</span> <span class="toc-text">è®­ç»ƒ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B0%8F%E7%BB%93"><span class="toc-number">1.7.</span> <span class="toc-text">å°ç»“</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%83%E4%B9%A0"><span class="toc-number">1.8.</span> <span class="toc-text">ç»ƒä¹ </span></a></li></ol></li></ol></div><div class="related panel pjax" data-title="ç³»åˆ—æ–‡ç« "><ul><li><a href="/2023/02/15/ai/pytorch%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/chapter_recurrent-neural-networks/bptt/" rel="bookmark" title="bptt">bptt</a></li><li><a href="/2023/02/15/ai/pytorch%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/chapter_recurrent-neural-networks/index/" rel="bookmark" title="index">index</a></li><li><a href="/2023/02/15/ai/pytorch%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/chapter_recurrent-neural-networks/language-models-and-dataset/" rel="bookmark" title="language-models-and-dataset">language-models-and-dataset</a></li><li class="active"><a href="/2023/02/15/ai/pytorch%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/chapter_recurrent-neural-networks/rnn-scratch/" rel="bookmark" title="rnn-scratch">rnn-scratch</a></li><li><a href="/2023/02/15/ai/pytorch%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/chapter_recurrent-neural-networks/rnn-concise/" rel="bookmark" title="rnn-concise">rnn-concise</a></li><li><a href="/2023/02/15/ai/pytorch%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/chapter_recurrent-neural-networks/text-preprocessing/" rel="bookmark" title="text-preprocessing">text-preprocessing</a></li><li><a href="/2023/02/15/ai/pytorch%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/chapter_recurrent-neural-networks/sequence/" rel="bookmark" title="sequence">sequence</a></li><li><a href="/2023/02/15/ai/pytorch%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/chapter_recurrent-neural-networks/rnn/" rel="bookmark" title="rnn">rnn</a></li></ul></div><div class="overview panel" data-title="ç«™ç‚¹æ¦‚è§ˆ"><div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="image" itemprop="image" alt="yuan" data-src="/images/avatar.jpg"><p class="name" itemprop="name">yuan</p><div class="description" itemprop="description"></div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">429</span> <span class="name">æ–‡ç« </span></a></div><div class="item categories"><a href="/categories/"><span class="count">72</span> <span class="name">åˆ†ç±»</span></a></div><div class="item tags"><a href="/tags/"><span class="count">61</span> <span class="name">æ ‡ç­¾</span></a></div></nav><div class="social"><span class="exturl item email" data-url="bWFpbHRvOjIwODM2MzU1MjVAcXEuY29t" title="mailto:2083635525@qq.com"><i class="ic i-envelope"></i></span></div><ul class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>é¦–é¡µ</a></li><li class="item"><a href="/about/" rel="section"><i class="ic i-user"></i>å…³äº</a></li><li class="item dropdown"><a href="javascript:void(0);"><i class="ic i-feather"></i>æ–‡ç« </a><ul class="submenu"><li class="item"><a href="/archives/" rel="section"><i class="ic i-list-alt"></i>å½’æ¡£</a></li><li class="item"><a href="/categories/" rel="section"><i class="ic i-th"></i>åˆ†ç±»</a></li><li class="item"><a href="/tags/" rel="section"><i class="ic i-tags"></i>æ ‡ç­¾</a></li></ul></li><li class="item"><a href="/friends/" rel="section"><i class="ic i-heart"></i>å‹é”</a></li><li class="item"><a href="/links/" rel="section"><i class="ic i-magic"></i>é“¾æ¥</a></li></ul></div></div></div><ul id="quick"><li class="prev pjax"><a href="/2023/02/15/ai/pytorch%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/chapter_recurrent-neural-networks/rnn-concise/" rel="prev" title="ä¸Šä¸€ç¯‡"><i class="ic i-chevron-left"></i></a></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href="/2023/02/15/ai/pytorch%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/chapter_recurrent-neural-networks/language-models-and-dataset/" rel="next" title="ä¸‹ä¸€ç¯‡"><i class="ic i-chevron-right"></i></a></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>éšæœºæ–‡ç« </h2><ul><li class="item"><div class="breadcrumb"><a href="/categories/frontend/" title="åˆ†ç±»äº å‰ç«¯">å‰ç«¯</a></div><span><a href="/2022/09/08/frontend/CSS/CSS%E5%B8%83%E5%B1%80/" title="CSSå¸ƒå±€">CSSå¸ƒå±€</a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/2023/06/25/computer-science/base/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B3%BB%E7%BB%9F%E5%8E%9F%E7%90%86%E5%AE%9E%E8%B7%B5MySQL/note/" title="æœªå‘½å">æœªå‘½å</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/ai/" title="åˆ†ç±»äº ai">ai</a> <i class="ic i-angle-right"></i> <a href="/categories/ai/pytorch%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/" title="åˆ†ç±»äº pytorchæ·±åº¦å­¦ä¹ ">pytorchæ·±åº¦å­¦ä¹ </a> <i class="ic i-angle-right"></i> <a href="/categories/ai/pytorch%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/chapter-natural-language-processing-pretraining/" title="åˆ†ç±»äº chapter_natural-language-processing-pretraining">chapter_natural-language-processing-pretraining</a></div><span><a href="/2023/02/15/ai/pytorch%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/chapter_natural-language-processing-pretraining/bert-dataset/" title="bert-dataset">bert-dataset</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/ai/" title="åˆ†ç±»äº ai">ai</a> <i class="ic i-angle-right"></i> <a href="/categories/ai/nlp/" title="åˆ†ç±»äº nlp">nlp</a> <i class="ic i-angle-right"></i> <a href="/categories/ai/nlp/huggingface/" title="åˆ†ç±»äº huggingface">huggingface</a> <i class="ic i-angle-right"></i> <a href="/categories/ai/nlp/huggingface/%E5%BE%AE%E8%B0%83%E4%B8%80%E4%B8%AA%E9%A2%84%E8%AE%AD%E7%BB%83%E6%A8%A1%E5%9E%8B/" title="åˆ†ç±»äº å¾®è°ƒä¸€ä¸ªé¢„è®­ç»ƒæ¨¡å‹">å¾®è°ƒä¸€ä¸ªé¢„è®­ç»ƒæ¨¡å‹</a></div><span><a href="/2022/11/12/ai/nlp/huggingface/%E5%BE%AE%E8%B0%83%E4%B8%80%E4%B8%AA%E9%A2%84%E8%AE%AD%E7%BB%83%E6%A8%A1%E5%9E%8B/%E5%A4%84%E7%90%86%E6%95%B0%E6%8D%AE/" title="å¾®è°ƒä¸€ä¸ªé¢„è®­ç»ƒæ¨¡å‹-å¤„ç†æ•°æ®">å¾®è°ƒä¸€ä¸ªé¢„è®­ç»ƒæ¨¡å‹-å¤„ç†æ•°æ®</a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/2023/06/25/computer-science/%E6%AF%94%E8%B5%9B/%E9%AB%98%E7%BA%A7%E8%BD%AF%E8%80%83/%E9%80%89%E6%8B%A9%E9%A2%98/2020/" title="æœªå‘½å">æœªå‘½å</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/ai/" title="åˆ†ç±»äº ai">ai</a> <i class="ic i-angle-right"></i> <a href="/categories/ai/pytorch%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/" title="åˆ†ç±»äº pytorchæ·±åº¦å­¦ä¹ ">pytorchæ·±åº¦å­¦ä¹ </a> <i class="ic i-angle-right"></i> <a href="/categories/ai/pytorch%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/chapter-recurrent-modern/" title="åˆ†ç±»äº chapter_recurrent-modern">chapter_recurrent-modern</a></div><span><a href="/2023/02/15/ai/pytorch%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/chapter_recurrent-modern/beam-search/" title="beam-search">beam-search</a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/2022/08/25/ai/rl/%E5%BC%BA%E5%8C%96%E5%AD%A6%E4%B9%A0/" title="å¼ºåŒ–å­¦ä¹ ">å¼ºåŒ–å­¦ä¹ </a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/2023/06/25/computer-science/%E6%AF%94%E8%B5%9B/%E8%93%9D%E6%A1%A5%E6%9D%AF/%E8%93%9D%E6%A1%A5%E6%9D%AF%E7%AD%94%E6%A1%88%E4%BB%A3%E7%A0%81/" title="æœªå‘½å">æœªå‘½å</a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/2023/06/25/computer-science/%E6%AF%94%E8%B5%9B/%E5%A4%A7%E5%94%90%E6%9D%AF/%E4%BB%BB%E5%8A%A13-5G%E5%9F%BA%E7%AB%99%E5%BC%80%E9%80%9A%E4%B8%8E%E8%B0%83%E6%B5%8B/" title="æœªå‘½å">æœªå‘½å</a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/2023/03/03/ai/nlp/base/huggingface/" title="æœªå‘½å">æœªå‘½å</a></span></li></ul></div><div><h2>æœ€æ–°è¯„è®º</h2><ul class="leancloud-recent-comment"></ul></div></div><div class="status"><div class="copyright">&copy; 2010 â€“ <span itemprop="copyrightYear">2024</span> <span class="with-love"><i class="ic i-sakura rotate"></i> </span><span class="author" itemprop="copyrightHolder">yuan @ Mi Manchi</span></div><div class="count"><span class="post-meta-item-icon"><i class="ic i-chart-area"></i> </span><span title="ç«™ç‚¹æ€»å­—æ•°">2.9m å­—</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="ic i-coffee"></i> </span><span title="ç«™ç‚¹é˜…è¯»æ—¶é•¿">44:38</span></div><div class="powered-by">åŸºäº <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL={path:"2023/02/15/ai/pytorchæ·±åº¦å­¦ä¹ /chapter_recurrent-neural-networks/rnn-scratch/",favicon:{show:"ï¼ˆâ—Â´3ï½€â—ï¼‰ã‚„ã‚Œã‚„ã‚Œã ãœ",hide:"(Â´Ğ”ï½€)å¤§å¤‰ã ï¼"},search:{placeholder:"æ–‡ç« æœç´¢",empty:"å…³äº ã€Œ ${query} ã€ï¼Œä»€ä¹ˆä¹Ÿæ²¡æœåˆ°",stats:"${time} ms å†…æ‰¾åˆ° ${hits} æ¡ç»“æœ"},valine:!0,copy_tex:!0,katex:!0,fancybox:!0,copyright:'å¤åˆ¶æˆåŠŸï¼Œè½¬è½½è¯·éµå®ˆ <i class="ic i-creative-commons"></i>BY-NC-SA åè®®ã€‚',ignores:[function(e){return e.includes("#")},function(e){return new RegExp(LOCAL.path+"$").test(e)}]}</script><script src="https://cdn.polyfill.io/v2/polyfill.js"></script><script src="//cdn.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script><script src="/js/app.js?v=0.2.5"></script></body></html>