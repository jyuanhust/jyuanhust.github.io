<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#FFF"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"><link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="alternate" type="application/rss+xml" title="yuan" href="https://jyuanhust.github.io/rss.xml"><link rel="alternate" type="application/atom+xml" title="yuan" href="https://jyuanhust.github.io/atom.xml"><link rel="alternate" type="application/json" title="yuan" href="https://jyuanhust.github.io/feed.json"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/css/app.css?v=0.2.5"><meta name="keywords" content="数据库"><link rel="canonical" href="https://jyuanhust.github.io/2022/08/24/computer-science/base/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B3%BB%E7%BB%9F%E5%8E%9F%E7%90%86%E5%AE%9E%E8%B7%B5MySQL/%E5%AE%9E%E8%AE%AD7-%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B%E4%B8%8E%E4%BA%8B%E5%8A%A1/"><title>实训7-存储过程与事务 - 数据库系统原理实践MySQL - computer-science | Mi Manchi = yuan = Whatever is worth doing at all is worth doing well</title><meta name="generator" content="Hexo 6.2.0"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">实训7-存储过程与事务</h1><div class="meta"><span class="item" title="创建时间：2022-08-24 22:05:54"><span class="icon"><i class="ic i-calendar"></i> </span><span class="text">发表于</span> <time itemprop="dateCreated datePublished" datetime="2022-08-24T22:05:54+08:00">2022-08-24</time> </span><span class="item" title="本文字数"><span class="icon"><i class="ic i-pen"></i> </span><span class="text">本文字数</span> <span>9.5k</span> <span class="text">字</span> </span><span class="item" title="阅读时长"><span class="icon"><i class="ic i-clock"></i> </span><span class="text">阅读时长</span> <span>9 分钟</span></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="切换导航栏"><span class="line"></span> <span class="line"></span> <span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">Mi Manchi</a></li></ul><ul class="right"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div id="imgs" class="pjax"><ul><li class="item" data-background-image="https://gitee.com/zkz0/image/raw/master/img/img(48).webp"></li><li class="item" data-background-image="https://gitee.com/zkz0/image/raw/master/img/img(38).webp"></li><li class="item" data-background-image="https://gitee.com/zkz0/image/raw/master/img/img(9).webp"></li><li class="item" data-background-image="https://gitee.com/zkz0/image/raw/master/img/img(76).webp"></li><li class="item" data-background-image="https://gitee.com/zkz0/image/raw/master/img/img(56).webp"></li><li class="item" data-background-image="https://gitee.com/zkz0/image/raw/master/img/img(12).webp"></li></ul></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"/></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"/><use xlink:href="#gentle-wave" x="48" y="3"/><use xlink:href="#gentle-wave" x="48" y="5"/><use xlink:href="#gentle-wave" x="48" y="7"/></g></svg></div><main><div class="inner"><div id="main" class="pjax"><div class="article wrap"><div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i> <span><a href="/">首页</a></span><i class="ic i-angle-right"></i> <span itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/computer-science/" itemprop="item" rel="index" title="分类于 computer-science"><span itemprop="name">computer-science</span></a><meta itemprop="position" content="1"></span><i class="ic i-angle-right"></i> <span class="current" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/computer-science/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B3%BB%E7%BB%9F%E5%8E%9F%E7%90%86%E5%AE%9E%E8%B7%B5MySQL/" itemprop="item" rel="index" title="分类于 数据库系统原理实践MySQL"><span itemprop="name">数据库系统原理实践MySQL</span></a><meta itemprop="position" content="2"></span></div><article itemscope itemtype="http://schema.org/Article" class="post block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://jyuanhust.github.io/2022/08/24/computer-science/base/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B3%BB%E7%BB%9F%E5%8E%9F%E7%90%86%E5%AE%9E%E8%B7%B5MySQL/%E5%AE%9E%E8%AE%AD7-%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B%E4%B8%8E%E4%BA%8B%E5%8A%A1/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="yuan"><meta itemprop="description" content="Whatever is worth doing at all is worth doing well, "></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="yuan"></span><div class="body md" itemprop="articleBody"><h2 id="使用流程控制语句的存储过程"><a class="anchor" href="#使用流程控制语句的存储过程">#</a> 使用流程控制语句的存储过程</h2><h3 id="任务描述"><a class="anchor" href="#任务描述">#</a> 任务描述</h3><p>本关任务：创建一个存储过程，向表 fibonacci 插入斐波拉契数列的前 n 项。</p><h3 id="相关知识"><a class="anchor" href="#相关知识">#</a> 相关知识</h3><p>为了完成本关任务，你需要掌握：</p><ol><li>变量的定义与赋值；</li><li>复合语句与流程控制语句；</li><li>存储过程的定义；</li><li>存储过程的创建和调用；</li><li>存储过程的查询和删除。</li></ol><h3 id="变量的定义与赋值"><a class="anchor" href="#变量的定义与赋值">#</a> 变量的定义与赋值</h3><p>用 declare 语句定义变量，并赋予默认值或初始值，未赋默认值 则初始值为 null:</p><figure class="highlight sql"><figcaption data-lang="SQL"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">DECLARE</span> var_name <span class="token punctuation">[</span><span class="token punctuation">,</span> var_name<span class="token punctuation">]</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token keyword">type</span> <span class="token punctuation">[</span><span class="token keyword">DEFAULT</span> <span class="token keyword">value</span><span class="token punctuation">]</span></pre></td></tr></table></figure><p>上面的 type 是啥意思，如果同时有多个变量，那么 default 是不是同时设置这多个变量为同一个值</p><p>用 set 语句给变量赋值：</p><figure class="highlight sql"><figcaption data-lang="SQL"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">SET</span> variable <span class="token operator">=</span> expr <span class="token punctuation">[</span><span class="token punctuation">,</span> variable <span class="token operator">=</span> expr<span class="token punctuation">]</span></pre></td></tr></table></figure><p>set 语句还可以设置许多 MySQL 的配置参数。</p><p>还可以通过 select 语句给变量赋值：</p><figure class="highlight sql"><figcaption data-lang="SQL"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">select</span> col <span class="token keyword">into</span> var_name <span class="token keyword">from</span> <span class="token keyword">table</span><span class="token punctuation">;</span> <span class="token comment">#将 table 表中的 col 列值赋给变量</span></pre></td></tr></table></figure><p>上面的语句中，是将表中这一列的数据都一次性赋值给变量么？如果是多列数据呢</p><p>select 语句可以带复杂的 where，group by，having 等短语。</p><h4 id="补充"><a class="anchor" href="#补充">#</a> 补充</h4><p>mysql 中变量不用事前申明，在用的时候直接用 “ <code>@变量名</code> ” 使用就可以了。</p><p><span class="exturl" data-url="aHR0cHM6Ly93d3cuY25ibG9ncy5jb20vZnJhbnNvbi0yMDE2L3AvMTE2NDA0NTIuaHRtbCM6fjp0ZXh0PW15c3FsJUU0JUI4JUFEJUU1JThGJTk4JUU5JTg3JThGJUU0JUI4JThEJUU3JTk0JUE4JUU0JUJBJThCJUU1JTg5JThEJUU3JTk0JUIzJUU2JTk4JThFJUVGJUJDJThDJUU1JTlDJUE4JUU3JTk0JUE4JUU3JTlBJTg0JUU2JTk3JUI2JUU1JTgwJTk5JUU3JTlCJUI0JUU2JThFJUE1JUU3JTk0JUE4JUUyJTgwJTlDJTQwJUU1JThGJTk4JUU5JTg3JThGJUU1JTkwJThEJUUyJTgwJTlEJUU0JUJEJUJGJUU3JTk0JUE4JUU1JUIwJUIxJUU1JThGJUFGJUU0JUJCJUE1JUU0JUJBJTg2JUUzJTgwJTgyJTIwJUU3JUFDJUFDJUU0JUI4JTgwJUU3JUE3JThEJUU3JTk0JUE4JUU2JUIzJTk1JUVGJUJDJTlBc2V0JTIwJTQwbnVtJTNEMSUzQiUyMCVFNiU4OCU5NnNldCUyMCU0MG51bSUzQSUzRDElM0IlMjAlMkYlMkYlRTglQkYlOTklRTklODclOEMlRTglQTYlODElRTQlQkQlQkYlRTclOTQlQTglRTUlOEYlOTglRTklODclOEYlRTYlOUQlQTUlRTQlQkYlOUQlRTUlQUQlOTglRTYlOTUlQjAlRTYlOEQlQUUlRUYlQkMlOEMlRTclOUIlQjQlRTYlOEUlQTUlRTQlQkQlQkYlRTclOTQlQTglNDBudW0lRTUlOEYlOTglRTklODclOEYlMjAlRTclQUMlQUMlRTQlQkElOEMlRTclQTclOEQlRTclOTQlQTglRTYlQjMlOTUlRUYlQkMlOUFzZWxlY3QsJTQwbnVtJTNBJTNEMSUzQiUyMCVFNiU4OCU5NiUyMHNlbGVjdCUyMCU0MG51bSUzQSUzRCVFNSVBRCU5NyVFNiVBRSVCNSVFNSU5MCU4RCUyMGZyb20lMjAlRTglQTElQTglRTUlOTAlOEQlMjB3aGVyZSUyMCVFMiU4MCVBNiVFMiU4MCVBNg==">https://www.cnblogs.com/franson-2016/p/11640452.html#:~:text=mysql 中变量不用事前申明，在用的时候直接用 “%40 变量名” 使用就可以了。 第一种用法：set %40num%3D1%3B 或 set %40num%3A%3D1%3B %2F%2F 这里要使用变量来保存数据，直接使用 %40num 变量 第二种用法：select,%40num%3A%3D1%3B 或 select %40num%3A%3D 字段名 from 表名 where ……</span></p><p><span class="exturl" data-url="aHR0cHM6Ly93d3cuY25ibG9ncy5jb20vTWFyeWRvbjIwMTcwMzA3L3AvMTQxMTIwNTkuaHRtbA==">https://www.cnblogs.com/Marydon20170307/p/14112059.html</span></p><h3 id="复合语句与流程控制语句"><a class="anchor" href="#复合语句与流程控制语句">#</a> 复合语句与流程控制语句</h3><p>MySQL 常用的语句有：</p><h4 id="复合语句beginend"><a class="anchor" href="#复合语句beginend">#</a> 复合语句 <code>BEGIN...END</code></h4><figure class="highlight sql"><figcaption data-lang="SQL"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">BEGIN</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">[</span>statement_list<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">END</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h4 id="if语句"><a class="anchor" href="#if语句">#</a> if 语句</h4><figure class="highlight sql"><figcaption data-lang="SQL"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">IF</span> search_condition <span class="token keyword">THEN</span>  statement_list</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">[</span><span class="token keyword">ELSEIF</span> search_condition <span class="token keyword">THEN</span> statement_list<span class="token punctuation">]</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">[</span><span class="token keyword">ELSE</span> statement_list<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">END</span> <span class="token keyword">IF</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h4 id="while语句"><a class="anchor" href="#while语句">#</a> while 语句</h4><figure class="highlight sql"><figcaption data-lang="SQL"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">WHILE</span> search_condition <span class="token keyword">DO</span></pre></td></tr><tr><td data-num="2"></td><td><pre>   statement_list</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">END</span> <span class="token keyword">WHILE</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>程序的三种基本结构是顺序、选择、循环。上述语句可以用来构建复杂的程序。其实 MySQL 还有很多其它语句，这里不一一介绍 。更详细内容，请参考 MySQL 的手册。</p><h3 id="存储过程的定义"><a class="anchor" href="#存储过程的定义">#</a> 存储过程的定义</h3><p><strong>存储过程</strong>（Stored Procedure）是一种在数据库中存储复杂程序，以便外部程序调用的一种数据库对象。</p><p>存储过程是为了完成特定功能的 SQL 语句集，经编译创建并保存在数据库中，用户可通过指定存储过程的名字并给定参数（需要时）来调用执行。</p><p>存储过程思想上很简单，就是数据库 SQL 语言层面的代码封装与重用。</p><p>简单的说存储过程就是具有名字的一段代码，用来完成一个特定的功能。</p><h3 id="存储过程的创建和查询"><a class="anchor" href="#存储过程的创建和查询">#</a> 存储过程的创建和查询</h3><p>创建存储过程： <code>create procedure 存储过程名(参数)</code></p><h4 id="下面我们来创建第一个存储过程"><a class="anchor" href="#下面我们来创建第一个存储过程">#</a> 下面我们来创建第一个存储过程</h4><p>每个存储的程序都包含一个由 SQL 语句组成的主体。此语句可能是由以分号（ <code>;</code> ）字符分隔的多个语句组成的复合语句。例如：</p><figure class="highlight sql"><figcaption data-lang="SQL"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">CREATE</span> <span class="token keyword">PROCEDURE</span> proc1<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">BEGIN</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> <span class="token keyword">user</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">END</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>在命令行客户端中，如果有一行命令以分号结束，那么回车后，MySQL 将会执行该命令，但在创建存储过程中我们并不希望 MySQL 这么做。</p><p>MySQL 本身将分号识别为语句分隔符，因此必须临时重新定义分隔符以使 MySQL 将整个存储的程序定义传递给服务器。</p><p>要重新定义 MySQL 分隔符，请使用 <code>delimiter</code> 命令。使用 <code>delimiter</code> 首先将结束符定义为 //，完成创建存储过程后，使用 // 表示结束，然后将分隔符重新设置为分号（ <code>;</code> ）：</p><figure class="highlight sql"><figcaption data-lang="SQL"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">DELIMITER</span> <span class="token comment">//</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">CREATE</span> <span class="token keyword">PROCEDURE</span> proc1<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">BEGIN</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> <span class="token keyword">user</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">END</span> <span class="token comment">//</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">DELIMITER</span> <span class="token punctuation">;</span></pre></td></tr></table></figure><p>注意： <code>/</code> 也可以换成其他符号，例如 <code>$</code> ;</p><h4 id="执行存储过程call-存储过程名"><a class="anchor" href="#执行存储过程call-存储过程名">#</a> 执行存储过程： <code>call 存储过程名</code></h4><p><img data-src="/./images/%E5%AE%9E%E8%AE%AD7-%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B%E4%B8%8E%E4%BA%8B%E5%8A%A1/1668302715106.png" alt="1668302715106"></p><h4 id="创建带有参数的存储过程"><a class="anchor" href="#创建带有参数的存储过程">#</a> 创建带有参数的存储过程</h4><p>存储过程的参数有三种：</p><p>存储过程的参数有三种：</p><ul><li><p>IN：输入参数，也是默认模式，表示该参数的值必须在调用存储过程时指定，在存储过程中修改该参数的值不能被返回；</p></li><li><p>OUT：输出参数，该值可在存储过程内部被改变，并可返回；</p></li><li><p>INOUT：输入输出参数，调用时指定，并且可被改变和返回。</p></li></ul><p>IN 参数示例：</p><p><img data-src="/./images/%E5%AE%9E%E8%AE%AD7-%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B%E4%B8%8E%E4%BA%8B%E5%8A%A1/1668302854861.png" alt="1668302854861"></p><p>OUT 参数示例：</p><p><img data-src="/./images/%E5%AE%9E%E8%AE%AD7-%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B%E4%B8%8E%E4%BA%8B%E5%8A%A1/1668303179370.png" alt="1668303179370"></p><h3 id="存储过程的查询和删除"><a class="anchor" href="#存储过程的查询和删除">#</a> 存储过程的查询和删除</h3><figure class="highlight sql"><figcaption data-lang="SQL"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">SHOW</span> <span class="token keyword">PROCEDURE</span> <span class="token keyword">STATUS</span> <span class="token keyword">WHERE</span> db<span class="token operator">=</span><span class="token string">'数据库名'</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>查看存储过程的详细定义信息：</p><figure class="highlight sql"><figcaption data-lang="SQL"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">SHOW</span> <span class="token keyword">CREATE</span> <span class="token keyword">PROCEDURE</span> 数据库<span class="token punctuation">.</span>存储过程名<span class="token punctuation">;</span></pre></td></tr></table></figure><p><img data-src="/./images/%E5%AE%9E%E8%AE%AD7-%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B%E4%B8%8E%E4%BA%8B%E5%8A%A1/1668304065967.png" alt="1668304065967"></p><p>当我们不再需要某个存储过程时，我们可以使用：</p><figure class="highlight sql"><figcaption data-lang="SQL"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">DROP</span> <span class="token keyword">PROCEDURE</span> <span class="token punctuation">[</span><span class="token keyword">IF</span> <span class="token keyword">EXISTS</span><span class="token punctuation">]</span> 数据库名<span class="token punctuation">.</span>存储过程名<span class="token punctuation">;</span></pre></td></tr></table></figure><p><img data-src="/./images/%E5%AE%9E%E8%AE%AD7-%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B%E4%B8%8E%E4%BA%8B%E5%8A%A1/1668304126280.png" alt="1668304126280"></p><h3 id="编程要求"><a class="anchor" href="#编程要求">#</a> 编程要求</h3><p>数据库中有表 fibonacci，用来储存斐波拉契数列的前 n 项：</p><p><img data-src="/./images/%E5%AE%9E%E8%AE%AD7-%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B%E4%B8%8E%E4%BA%8B%E5%8A%A1/1668304172268.png" alt="1668304172268"></p><p>斐波拉契数列的前 5 项为:</p><p><img data-src="/./images/%E5%AE%9E%E8%AE%AD7-%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B%E4%B8%8E%E4%BA%8B%E5%8A%A1/1668304190049.png" alt="1668304190049"></p><p>推导公式为：fib (n) = fib (n-1) + fib (n-2)。</p><p>创建存储过程 sp_fibonacci (in m int)，向表 fibonacci 插入斐波拉契数列的前 m 项，及其对应的斐波拉契数。fibonacci 表初始值为一张空表。请保证你的存储过程可以多次运行而不出错。</p><figure class="highlight sql"><figcaption data-lang="SQL"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">use</span> fib<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment">-- 创建存储过程 `sp_fibonacci (in m int)`，向表 fibonacci 插入斐波拉契数列的前 m 项，及其对应的斐波拉契数。fibonacci 表初始值为一张空表。请保证你的存储过程可以多次运行而不出错。</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">drop</span> <span class="token keyword">procedure</span> <span class="token keyword">if</span> <span class="token keyword">exists</span> sp_fibonacci<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">delimiter</span> $$</pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">create</span> <span class="token keyword">procedure</span> sp_fibonacci<span class="token punctuation">(</span><span class="token operator">in</span> m <span class="token keyword">int</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">begin</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token keyword">set</span> m <span class="token operator">=</span> m <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token keyword">with</span> recursive cte <span class="token punctuation">(</span>id<span class="token punctuation">,</span> cur<span class="token punctuation">,</span> pre<span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token punctuation">(</span></pre></td></tr><tr><td data-num="11"></td><td><pre>        <span class="token keyword">select</span></pre></td></tr><tr><td data-num="12"></td><td><pre>            <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span></pre></td></tr><tr><td data-num="13"></td><td><pre>        <span class="token keyword">union</span> <span class="token keyword">all</span> </pre></td></tr><tr><td data-num="14"></td><td><pre>        <span class="token keyword">select</span> </pre></td></tr><tr><td data-num="15"></td><td><pre>            id <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="16"></td><td><pre>            <span class="token keyword">if</span> <span class="token punctuation">(</span>id <span class="token operator">&lt;</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> cur <span class="token operator">+</span> pre<span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="17"></td><td><pre>            cur </pre></td></tr><tr><td data-num="18"></td><td><pre>        <span class="token keyword">from</span> cte </pre></td></tr><tr><td data-num="19"></td><td><pre>        <span class="token keyword">where</span> id <span class="token operator">&lt;</span> m</pre></td></tr><tr><td data-num="20"></td><td><pre>    <span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="21"></td><td><pre>    <span class="token keyword">select</span> </pre></td></tr><tr><td data-num="22"></td><td><pre>        id n<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="23"></td><td><pre>        cur fibn</pre></td></tr><tr><td data-num="24"></td><td><pre>    <span class="token keyword">from</span> cte<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="25"></td><td><pre><span class="token keyword">end</span> $$</pre></td></tr><tr><td data-num="26"></td><td><pre></pre></td></tr><tr><td data-num="27"></td><td><pre><span class="token keyword">delimiter</span> <span class="token punctuation">;</span></pre></td></tr></table></figure><p>上面的思想是将当前值和上一个值在递归过程中进行传递。</p><p>在 <code>With Recursive as</code> 的后面不加分号，这是为什么？因为它不属于一个完整的语句吧，应该只是用来创建临时表的</p><p>With Recursive as：</p><p><span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L1dIWWJlSEVSRS9hcnRpY2xlL2RldGFpbHMvMTI1NDQwODU2">https://blog.csdn.net/WHYbeHERE/article/details/125440856</span></p><p>指明递归的字段和 select 后面的字段应该是一一对应的</p><h2 id="使用游标的存储过程"><a class="anchor" href="#使用游标的存储过程">#</a> 使用游标的存储过程</h2><h3 id="游标cursor"><a class="anchor" href="#游标cursor">#</a> 游标 (CURSOR)</h3><h4 id="游标的特点"><a class="anchor" href="#游标的特点">#</a> 游标的特点</h4><p>SQL 操作都是面向集合的，即操作的对象以及运算的结果均为集合，但有时候，我们需要一行一行地处理数据，这就需要用到游标 (CURSOR)，它相当于一个存储于内存的带有指针的表，每次可以存取指针指向的一行数据，并将指针向前推进一行。游标的数据通常是一条查询语句的结果。对游标的操作一般要用循环语句，遍历游标的每一行数据，并将该行数据读至变量，再根据变量的值进行所需要的其它操作。</p><p>游标有以下持点：</p><ul><li>不可滚动。即只能从前往后遍历游标数据 (即从第 1 行到最后一行)，不能反向遍历，不能跳跃遍历，不能直接访问中间的某一行。</li><li>只读。游标里的数据只能读取，不能修改。</li></ul><h4 id="游标的定义与使用"><a class="anchor" href="#游标的定义与使用">#</a> 游标的定义与使用</h4><p>创建并使用 MySQL 游标，至少会用到 DECLARE, OPEN, FETCH, 和 CLOSE 语句。</p><h5 id="declare语句"><a class="anchor" href="#declare语句">#</a> DECLARE 语句</h5><p>用 DECLARE 语句定义游标、变量以及特情处理程序。<br>在一个 <code>BEGIN...END</code> 语句块内，DECLARE 定义的顺序要求如下：</p><ol><li>变量</li><li>游标</li><li>特情处理</li></ol><p>即变量定义在游标之前，特情处理程序定义在游标之后。<br>变量用来存储从游标读取的数据，根据编程逻辑的需要，可能还要定义其它变量；游标用来存储 SELECT 语句读取的数据集；当某些特定情形出现时，会自动触发对应的特情处理程序。在游标的使用中，你至少需要定义当遍历至游标数据结束 (抛出 NOT FOUND 异常) 时该怎么办 (当然是结束循环)。</p><p>定义变量：</p><figure class="highlight sql"><figcaption data-lang="SQL"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">DECLARE</span> var_name <span class="token punctuation">[</span><span class="token punctuation">,</span> var_name<span class="token punctuation">]</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token keyword">type</span> <span class="token punctuation">[</span><span class="token keyword">DEFAULT</span> <span class="token keyword">value</span><span class="token punctuation">]</span></pre></td></tr></table></figure><p>定义游标：</p><figure class="highlight sql"><figcaption data-lang="SQL"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">DECLARE</span> cursor_name <span class="token keyword">CURSOR</span> <span class="token keyword">FOR</span> select_statement</pre></td></tr></table></figure><p>任何合法的 select 语句 (不能带 INTO 短语)，都可以定义成游标。此后可用 FETCH 语句读取这个 select 语句查询到的数据集中的一行数据。</p><p>注意游标必须定义在变量之后，特情处理程序之前。<br>一个存储过程可义定义多个游标，但不能同名。</p><p>定义特情处理例程：</p><figure class="highlight sql"><figcaption data-lang="SQL"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">DECLARE</span> handler_action <span class="token keyword">HANDLER</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">FOR</span> condition_value <span class="token punctuation">[</span><span class="token punctuation">,</span> condition_value<span class="token punctuation">]</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></pre></td></tr><tr><td data-num="3"></td><td><pre>statement</pre></td></tr><tr><td data-num="4"></td><td><pre>handler_action: &#123;</pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">CONTINUE</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token operator">|</span> <span class="token keyword">EXIT</span></pre></td></tr><tr><td data-num="7"></td><td><pre>&#125;</pre></td></tr><tr><td data-num="8"></td><td><pre>condition_value: &#123;</pre></td></tr><tr><td data-num="9"></td><td><pre>mysql_error_code</pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token operator">|</span> SQLSTATE <span class="token punctuation">[</span><span class="token keyword">VALUE</span><span class="token punctuation">]</span> sqlstate_value</pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token operator">|</span> condition_name</pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token operator">|</span> SQLWARNING</pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token operator">|</span> <span class="token operator">NOT</span> FOUND</pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token operator">|</span> SQLEXCEPTION</pre></td></tr><tr><td data-num="15"></td><td><pre>&#125;</pre></td></tr></table></figure><p>游标应用中至少需要定义一个 NOT FOUND 的 HANDLER (处理例程)：</p><figure class="highlight sql"><figcaption data-lang="SQL"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">DECLARE</span> <span class="token keyword">CONTINUE</span> <span class="token keyword">HANDLER</span> <span class="token keyword">FOR</span> <span class="token operator">NOT</span> FOUND <span class="token keyword">SET</span> finished <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>其含义是当抛出 NOT FOUND 异常时，置变量 finished 的值为 1, 程序继续运行。当然，在此之前，应当先定义变量 finished，并初始化为 0 (也可在循环语句之前初始化为 0），finished 作为循环的控制变量，仅当 finished 变成 1 时，循环结束。</p><p>如果特情处理例程由多条语句组成，可以用 BEGIN...END 组成复合语句。</p><p>当一个存储过程中存在多个游标时，对任何一个游标的读取 (FETCH) 都可能会触发特情处理。比如一个游标的数据被遍历完毕，再试图 FETCH 下一行时，会触发 NOT FOUND HANDLER, 并进而改变某个变量的值，但另一个游标中可能还有未处理完的数据。编程者应当自己想办法区分是哪个游标的数据处理完毕。</p><h5 id="open语句"><a class="anchor" href="#open语句">#</a> OPEN 语句</h5><figure class="highlight sql"><figcaption data-lang="SQL"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">OPEN</span> cursor_name</pre></td></tr></table></figure><p>该语句打开之前定义的游标，并初始化指向数据行的指针 (接下来的第一条 FETCH 语句将试图读取游标的第 1 行数据)。</p><h5 id="fetch语句"><a class="anchor" href="#fetch语句">#</a> FETCH 语句</h5><figure class="highlight sql"><figcaption data-lang="SQL"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">FETCH</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token keyword">NEXT</span><span class="token punctuation">]</span> <span class="token keyword">FROM</span><span class="token punctuation">]</span> cursor_name <span class="token keyword">INTO</span> var_name <span class="token punctuation">[</span><span class="token punctuation">,</span> var_name<span class="token punctuation">]</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></pre></td></tr></table></figure><p>FETCH 语句读取游标的一行数据到变量列表，并推进游标的指针。关键词 NEXT, FROM 都可省略 (或仅省略 NEXT)。注意 INTO 后的变量列表应当与游标定义中的 SELECT 列表一一对应 (变量个数与 SELECT 列表个数完全相同，数据类型完全一致，每个变量的取值按 SELECT 列表顺序一一对应)。</p><p>FETCH 一个未打开的游标会出错。</p><h5 id="close语句"><a class="anchor" href="#close语句">#</a> CLOSE 语句</h5><figure class="highlight sql"><figcaption data-lang="SQL"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">CLOSE</span> cursor_name</pre></td></tr></table></figure><p>Close 语句关闭先前打开的游标，试图关闭一个未曾打开 (OPEN) 的游标会出错。</p><p>没有 CLOSE 的游标，在其定义的 BEGIN...END 语句块结束时，将自动 CLOSE。</p><h4 id="游标应用举例"><a class="anchor" href="#游标应用举例">#</a> 游标应用举例</h4><p>设有表 epl (英超足球比赛记录) 结构如下：</p><p><img data-src="/./images/%E5%AE%9E%E8%AE%AD7-%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B%E4%B8%8E%E4%BA%8B%E5%8A%A1/1668309658327.png" alt="1668309658327"></p><p>使用游标编写存储过程 sp_cursor_demo 计算 Liverpool 足球队在主场获胜的比赛中，上半场的平均进球数，结果通过参数传递。示例程序如下：</p><figure class="highlight sql"><figcaption data-lang="SQL"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">DELIMITER</span> $$ </pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">CREATE</span> <span class="token keyword">PROCEDURE</span> sp_cursor_demo<span class="token punctuation">(</span><span class="token keyword">INOUT</span> average_goals <span class="token keyword">FLOAT</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">BEGIN</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">DECLARE</span> done <span class="token keyword">INT</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">FALSE</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token keyword">DECLARE</span> matches <span class="token keyword">int</span> <span class="token keyword">DEFAULT</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">DECLARE</span> goals <span class="token keyword">int</span> <span class="token keyword">DEFAULT</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token keyword">DECLARE</span> half_time_goals <span class="token keyword">INT</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token keyword">DECLARE</span> team_cursor <span class="token keyword">CURSOR</span> <span class="token keyword">FOR</span> <span class="token keyword">SELECT</span> HTHG <span class="token keyword">FROM</span> epl <span class="token keyword">WHERE</span> <span class="token punctuation">(</span>home_team <span class="token operator">=</span> <span class="token string">'Liverpool'</span><span class="token punctuation">)</span> <span class="token operator">and</span> <span class="token punctuation">(</span>ftr <span class="token operator">=</span> <span class="token string">'H'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token keyword">DECLARE</span> <span class="token keyword">CONTINUE</span> <span class="token keyword">HANDLER</span> <span class="token keyword">FOR</span> <span class="token operator">NOT</span> FOUND <span class="token keyword">SET</span> done <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token keyword">OPEN</span> team_cursor<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token keyword">FETCH</span> team_cursor <span class="token keyword">INTO</span> half_time_goals<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token keyword">WHILE</span> <span class="token operator">NOT</span> DONE <span class="token keyword">DO</span></pre></td></tr><tr><td data-num="13"></td><td><pre>      <span class="token keyword">SET</span>  goals <span class="token operator">=</span> goals <span class="token operator">+</span> half_time_goals<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>      <span class="token keyword">SET</span>  matches <span class="token operator">=</span> matches <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>         <span class="token keyword">FETCH</span> team_cursor <span class="token keyword">INTO</span> half_time_goals<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token keyword">END</span> <span class="token keyword">while</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="17"></td><td><pre>    <span class="token keyword">SET</span>  average_goals <span class="token operator">=</span> goals <span class="token operator">/</span> matches<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>    <span class="token keyword">CLOSE</span> team_cursor<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token keyword">END</span> $$ </pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token keyword">DELIMITER</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>存储过程定义后，可通过以下语句定义参数，调用过程，再从返回参数中获取结果:</p><figure class="highlight sql"><figcaption data-lang="SQL"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">SET</span> <span class="token variable">@average_goals</span> <span class="token operator">=</span> <span class="token number">0.0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">CALL</span> sp_cursor_demo<span class="token punctuation">(</span><span class="token variable">@average_goals</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">SELECT</span> <span class="token variable">@average_goals</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>上述带前缀 @的变量属于 MySQL 的用户自定义变量，只在该用户的会话期内有效，对别的用户 (客户端) 不可见。@前缀变量不用申明变量类型，初始化时，由其值决定其类型。</p><p>上述存储过程仅用来演示游标的用法，事实上，下面的这条查询语句，即可获得相同的结果，且效率更高：</p><figure class="highlight sql"><figcaption data-lang="SQL"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">select</span> <span class="token function">avg</span><span class="token punctuation">(</span>hthg<span class="token punctuation">)</span> <span class="token keyword">from</span> epl <span class="token keyword">where</span> home_team <span class="token operator">=</span> <span class="token string">'Liverpool'</span> <span class="token operator">and</span> ftr <span class="token operator">=</span> <span class="token string">'H'</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>一般来説，仅当你需要遍历一个数据集，且一次只能处理其中的一行数据时 (比如对每一行，要作不同的业务处理)，你才需要使用游标。当游标的数据集较大时，会造成较大的网络时延。使用游标时，应尽可能缩小数据规模 (去掉不必要的行和列)。</p><h3 id="编程要求-2"><a class="anchor" href="#编程要求-2">#</a> 编程要求</h3><p>医院的某科室有科室主任 1 名 (亦为医生)，医生若干 (至少 2 名，不含主任)，护士若干 (至少 4 人)，现在需要编写一存储过程，自动安排某个连续期间的大夜班 (即每天 00:00-8:00 时间段) 的值班表，排班规则为：</p><ol><li>每个夜班安排 1 名医生，2 名护士；</li><li>值班顺序依工号顺序循环轮流安排 (即排至最后 1 名后再从第 1 名接着排)；</li><li>科室主任参与轮值夜班，但不安排周末 (星期六和星期天) 的夜班，当周末轮至科主任时，主任的夜班调至周一，由排在主任后面的医生依次递补值周末的夜班。</li></ol><p>存储过程的名字为 sp_night_shift_arrange, 它带两个输入参数：start_date, end_date，分别指排班的起始时间和结束时间。排班结果直接写入表 night_shift_schedule，其结构如下：</p><p>表 night_shift_schedule (夜班值班安排表)</p><p><img data-src="/./images/%E5%AE%9E%E8%AE%AD7-%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B%E4%B8%8E%E4%BA%8B%E5%8A%A1/1668312035177.png" alt="1668312035177"></p><p>假定该科室没有同名的医生和同名的护士。<br>科室参与值班的医护人员存储在表 employee 中，其结构为：</p><p>表 employee (医护人员表)</p><p><img data-src="/./images/%E5%AE%9E%E8%AE%AD7-%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B%E4%B8%8E%E4%BA%8B%E5%8A%A1/1668312055413.png" alt="1668312055413"></p><p>不用考虑其它信息 (比如科室之类的)，在生产环境中，只需在 where 短语中施加条件限制即可明确选出所需科室的医护人员。这里，且把表中全部人员视为该科室人员。</p><figure class="highlight sql"><figcaption data-lang="SQL"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">-- 编写一存储过程，自动安排某个连续期间的大夜班的值班表:</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">delimiter</span> $$</pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">create</span> <span class="token keyword">procedure</span> sp_night_shift_arrange<span class="token punctuation">(</span><span class="token operator">in</span> start_date <span class="token keyword">date</span><span class="token punctuation">,</span> <span class="token operator">in</span> end_date <span class="token keyword">date</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">begin</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token keyword">declare</span> done<span class="token punctuation">,</span> tp<span class="token punctuation">,</span> wk <span class="token keyword">int</span> <span class="token keyword">default</span> <span class="token boolean">false</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token keyword">declare</span> doc<span class="token punctuation">,</span> nur1<span class="token punctuation">,</span> nur2<span class="token punctuation">,</span> head <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token keyword">declare</span> cur1 <span class="token keyword">cursor</span> <span class="token keyword">for</span> <span class="token keyword">select</span> e_name <span class="token keyword">from</span> employee <span class="token keyword">where</span> e_type <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token keyword">declare</span> cur2 <span class="token keyword">cursor</span> <span class="token keyword">for</span> <span class="token keyword">select</span> e_type<span class="token punctuation">,</span> e_name <span class="token keyword">from</span> employee <span class="token keyword">where</span> e_type <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token keyword">declare</span> <span class="token keyword">continue</span> <span class="token keyword">handler</span> <span class="token keyword">for</span> <span class="token operator">not</span> found <span class="token keyword">set</span> done <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token keyword">open</span> cur1<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token keyword">open</span> cur2<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token keyword">while</span> start_date <span class="token operator">&lt;=</span> end_date <span class="token keyword">do</span></pre></td></tr><tr><td data-num="15"></td><td><pre></pre></td></tr><tr><td data-num="16"></td><td><pre>        <span class="token comment">-- 选择第一位护士</span></pre></td></tr><tr><td data-num="17"></td><td><pre>        <span class="token keyword">fetch</span> cur1 <span class="token keyword">into</span> nur1<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>        <span class="token keyword">if</span> done <span class="token keyword">then</span></pre></td></tr><tr><td data-num="19"></td><td><pre>            <span class="token keyword">close</span> cur1<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>            <span class="token keyword">open</span> cur1<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>            <span class="token keyword">set</span> done <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>            <span class="token keyword">fetch</span> cur1 <span class="token keyword">into</span> nur1<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>        <span class="token keyword">end</span> <span class="token keyword">if</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="24"></td><td><pre></pre></td></tr><tr><td data-num="25"></td><td><pre>        <span class="token comment">-- 选择第二位护士</span></pre></td></tr><tr><td data-num="26"></td><td><pre>        <span class="token keyword">fetch</span> cur1 <span class="token keyword">into</span> nur2<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="27"></td><td><pre>        <span class="token keyword">if</span> done <span class="token keyword">then</span></pre></td></tr><tr><td data-num="28"></td><td><pre>            <span class="token keyword">close</span> cur1<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="29"></td><td><pre>            <span class="token keyword">open</span> cur1<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="30"></td><td><pre>            <span class="token keyword">set</span> done <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="31"></td><td><pre>            <span class="token keyword">fetch</span> cur1 <span class="token keyword">into</span> nur2<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="32"></td><td><pre>        <span class="token keyword">end</span> <span class="token keyword">if</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="33"></td><td><pre></pre></td></tr><tr><td data-num="34"></td><td><pre>        <span class="token comment">-- 选择医生</span></pre></td></tr><tr><td data-num="35"></td><td><pre>        <span class="token keyword">set</span> wk <span class="token operator">=</span> weekday<span class="token punctuation">(</span>start_date<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="36"></td><td><pre>        <span class="token keyword">if</span> wk <span class="token operator">=</span> <span class="token number">0</span> <span class="token operator">and</span> head <span class="token operator">is</span> <span class="token operator">not</span> <span class="token boolean">null</span> <span class="token keyword">then</span></pre></td></tr><tr><td data-num="37"></td><td><pre>            <span class="token comment">-- wk=0 表示星期一，head 保存因周末而没领班的主任的名称</span></pre></td></tr><tr><td data-num="38"></td><td><pre>            <span class="token keyword">set</span> doc <span class="token operator">=</span> head<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="39"></td><td><pre>            <span class="token keyword">set</span> head <span class="token operator">=</span> <span class="token boolean">null</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="40"></td><td><pre>        <span class="token keyword">else</span></pre></td></tr><tr><td data-num="41"></td><td><pre>            <span class="token keyword">fetch</span> cur2 <span class="token keyword">into</span> tp<span class="token punctuation">,</span> doc<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="42"></td><td><pre>            <span class="token keyword">if</span> done <span class="token keyword">then</span></pre></td></tr><tr><td data-num="43"></td><td><pre>                <span class="token keyword">close</span> cur2<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="44"></td><td><pre>                <span class="token keyword">open</span> cur2<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="45"></td><td><pre>                <span class="token keyword">set</span> done <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="46"></td><td><pre>                <span class="token keyword">fetch</span> cur2 <span class="token keyword">into</span> tp<span class="token punctuation">,</span> doc<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="47"></td><td><pre>            <span class="token keyword">end</span> <span class="token keyword">if</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="48"></td><td><pre></pre></td></tr><tr><td data-num="49"></td><td><pre>            <span class="token keyword">if</span> wk <span class="token operator">></span> <span class="token number">4</span> <span class="token operator">and</span> tp <span class="token operator">=</span> <span class="token number">1</span> <span class="token keyword">then</span></pre></td></tr><tr><td data-num="50"></td><td><pre>                <span class="token comment">-- 如果是周末，且取到的是主任</span></pre></td></tr><tr><td data-num="51"></td><td><pre></pre></td></tr><tr><td data-num="52"></td><td><pre>                <span class="token comment">-- 保存主任名称，再重新取</span></pre></td></tr><tr><td data-num="53"></td><td><pre>                <span class="token comment">-- 根据要求，科室中只有一名主任，再重新取的肯定是医生了</span></pre></td></tr><tr><td data-num="54"></td><td><pre>                <span class="token keyword">set</span> head <span class="token operator">=</span> doc<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="55"></td><td><pre>                <span class="token keyword">fetch</span> cur2 <span class="token keyword">into</span> tp<span class="token punctuation">,</span> doc<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="56"></td><td><pre>                <span class="token keyword">if</span> done <span class="token keyword">then</span></pre></td></tr><tr><td data-num="57"></td><td><pre>                    <span class="token keyword">close</span> cur2<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="58"></td><td><pre>                    <span class="token keyword">open</span> cur2<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="59"></td><td><pre>                    <span class="token keyword">set</span> done <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="60"></td><td><pre>                    <span class="token keyword">fetch</span> cur2 <span class="token keyword">into</span> tp<span class="token punctuation">,</span> doc<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="61"></td><td><pre>                <span class="token keyword">end</span> <span class="token keyword">if</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="62"></td><td><pre>            <span class="token keyword">end</span> <span class="token keyword">if</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="63"></td><td><pre>        <span class="token keyword">end</span> <span class="token keyword">if</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="64"></td><td><pre>        <span class="token keyword">insert</span> <span class="token keyword">into</span> night_shift_schedule <span class="token keyword">values</span> <span class="token punctuation">(</span>start_date<span class="token punctuation">,</span> doc<span class="token punctuation">,</span> nur1<span class="token punctuation">,</span> nur2<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="65"></td><td><pre>        <span class="token keyword">set</span> start_date <span class="token operator">=</span> date_add<span class="token punctuation">(</span>start_date<span class="token punctuation">,</span> <span class="token keyword">interval</span> <span class="token number">1</span> <span class="token keyword">day</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="66"></td><td><pre>    <span class="token keyword">end</span> <span class="token keyword">while</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="67"></td><td><pre></pre></td></tr><tr><td data-num="68"></td><td><pre><span class="token keyword">end</span>$$</pre></td></tr><tr><td data-num="69"></td><td><pre></pre></td></tr><tr><td data-num="70"></td><td><pre><span class="token keyword">delimiter</span> <span class="token punctuation">;</span></pre></td></tr><tr><td data-num="71"></td><td><pre></pre></td></tr><tr><td data-num="72"></td><td><pre><span class="token comment">/*  end  of  your code  */</span></pre></td></tr></table></figure><p>思路：先将护士和医生（包括主任）分别提取到两个游标中</p><p>每次 fetch 一行数据都要检查 done 是否为 true</p><p>当这一次 fetch 的时候已经是最后一条数据，下一次 fetch 的时候就会引起异常，没有取到数据，这时只要关闭游标后再重新打开，执行 fetch 时就可以从头开始取数据了。</p><p>cur1 保存护士名称，每次直接取即可</p><p>cur2 保存 e_type (主任还是普通医生) 和 e_name（名称）</p><p>如果两天的周末，取到的两位都是主任，head 会不会被覆盖</p><p>weekday 函数：<span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L21vYWt1bi9hcnRpY2xlL2RldGFpbHMvODI1Mjg4MTY=">https://blog.csdn.net/moakun/article/details/82528816</span></p><p>date_add：<br><span class="exturl" data-url="aHR0cHM6Ly93d3cudzNzY2hvb2wuY29tLmNuL3NxbC9mdW5jX2RhdGVfYWRkLmFzcA==">https://www.w3school.com.cn/sql/func_date_add.asp</span></p><h2 id="使用事务的存储过程"><a class="anchor" href="#使用事务的存储过程">#</a> 使用事务的存储过程</h2><h3 id="相关知识-2"><a class="anchor" href="#相关知识-2">#</a> 相关知识</h3><p>为了完成本关任务，你需要掌握：</p><ol><li>事务的定义和应用；</li><li>存储过程的定义和应用。</li></ol><h3 id="事务的定义和应用"><a class="anchor" href="#事务的定义和应用">#</a> 事务的定义和应用</h3><p>开启事务：</p><ul><li>START TRANSACTION 或 BEGIN (前者兼容性更好)</li></ul><p>事务提交：</p><ul><li>COMMIT</li></ul><p>事务回滚：</p><ul><li>ROLLBACK</li></ul><p>开启或关闭当前会话的自动事务模式</p><ul><li>SET autocommit = ON|OFF<br>也可用 1|0,true|false 代替 ON|OFF。</li></ul><p>缺省情况下，autocommit 模式被设置为 ON，即你在命令行提交的每一条语句会自动封装成一个事务，即使下一条语句发生错误，前一条语句产生的结果也不可撤销。</p><p><strong>注意</strong>，事务内部不允许嵌套另一个事务，尽量不要在事务内部使用 DDL 语句，因为即使事务回滚，DDL 语句对数据库的修改也不会撤销。</p><h3 id="编程要求-3"><a class="anchor" href="#编程要求-3">#</a> 编程要求</h3><p>在金融应用场景数据库中，编程实现一个转账操作的存储过程 sp_transfer，实现从一个帐户向另一个帐户转账。该过程有 5 个输入参数：</p><ul><li>applicant_id 付款人编号</li><li>source_card_id 付款卡号</li><li>receiver_card_id 收款人编号</li><li>dest_card_id 收款卡号</li><li>amount 转账金额<br>还有 1 个整型输出参数：</li><li>return_code 1：正常转账；0: 转账不成功</li></ul><p>转账操作涉及对表 bank_card 的操作 (在生产环境中，至少还要记录转账操作本身相关的信息至转账表，在实验环境中没有设计这样的表，从略；另外，生产环境中，当银行卡被冻结，或被卡主挂失后，都不能进行转账，在实验环境中，没有设计相应的字段 ，故也从略)。</p><p>注意事项：</p><ul><li>仅当转款人是转出卡的持有人时，才可转出；</li><li>仅当收款人是收款卡的持有人时，才可转入；</li><li>储蓄卡之间可以相互转账；</li><li>允许储蓄卡向信用卡转账，称为信用卡还款 (允许替它人还款)，还款可以超过信用卡余额，此时，信用卡余额为负数；</li><li>信用卡不能向储蓄卡转账；</li><li>转账金额不能超过储蓄卡余额；</li></ul><p>当从储蓄卡中转出的金额大于余额时也转账失败</p><p><img data-src="/./images/%E5%AE%9E%E8%AE%AD7-%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B%E4%B8%8E%E4%BA%8B%E5%8A%A1/1668324493350.png" alt="1668324493350"></p><figure class="highlight sql"><figcaption data-lang="SQL"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">use</span> finance1<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment">-- 在金融应用场景数据库中，编程实现一个转账操作的存储过程 sp_transfer_balance，实现从一个帐户向另一个帐户转账。</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment">-- 请补充代码完成该过程：</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">delimiter</span> $$</pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">create</span> <span class="token keyword">procedure</span> sp_transfer<span class="token punctuation">(</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token operator">IN</span> applicant_id <span class="token keyword">int</span><span class="token punctuation">,</span>      </pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token operator">IN</span> source_card_id <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token operator">IN</span> receiver_id <span class="token keyword">int</span><span class="token punctuation">,</span> </pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token operator">IN</span> dest_card_id <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token operator">IN</span> amount <span class="token keyword">numeric</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token keyword">OUT</span> return_code <span class="token keyword">int</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="14"></td><td><pre></pre></td></tr><tr><td data-num="15"></td><td><pre>pro:</pre></td></tr><tr><td data-num="16"></td><td><pre></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token keyword">BEGIN</span></pre></td></tr><tr><td data-num="18"></td><td><pre>    <span class="token keyword">declare</span> s_id<span class="token punctuation">,</span> r_id <span class="token keyword">int</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>    <span class="token keyword">declare</span> s_type<span class="token punctuation">,</span> r_type <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>    <span class="token keyword">declare</span> s_b<span class="token punctuation">,</span> rcv_amount <span class="token keyword">numeric</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token keyword">default</span> amount<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>    </pre></td></tr><tr><td data-num="22"></td><td><pre>    <span class="token comment">-- 根据转款人的银行卡号获得其所属的客户编号，余额和银行卡类型</span></pre></td></tr><tr><td data-num="23"></td><td><pre>    <span class="token keyword">select</span></pre></td></tr><tr><td data-num="24"></td><td><pre>        b_c_id<span class="token punctuation">,</span> b_balance<span class="token punctuation">,</span> b_type</pre></td></tr><tr><td data-num="25"></td><td><pre>    <span class="token keyword">into</span> </pre></td></tr><tr><td data-num="26"></td><td><pre>        s_id<span class="token punctuation">,</span> s_b<span class="token punctuation">,</span> s_type</pre></td></tr><tr><td data-num="27"></td><td><pre>    <span class="token keyword">from</span> bank_card</pre></td></tr><tr><td data-num="28"></td><td><pre>    <span class="token keyword">where</span> b_number <span class="token operator">=</span> source_card_id<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="29"></td><td><pre>    </pre></td></tr><tr><td data-num="30"></td><td><pre>    <span class="token comment">-- 根据收款人的银行卡号获得其所属的客户编号和银行卡类型</span></pre></td></tr><tr><td data-num="31"></td><td><pre>    <span class="token keyword">select</span></pre></td></tr><tr><td data-num="32"></td><td><pre>        b_c_id<span class="token punctuation">,</span> b_type</pre></td></tr><tr><td data-num="33"></td><td><pre>    <span class="token keyword">into</span></pre></td></tr><tr><td data-num="34"></td><td><pre>        r_id<span class="token punctuation">,</span> r_type</pre></td></tr><tr><td data-num="35"></td><td><pre>    <span class="token keyword">from</span> bank_card</pre></td></tr><tr><td data-num="36"></td><td><pre>    <span class="token keyword">where</span> b_number <span class="token operator">=</span> dest_card_id<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="37"></td><td><pre>    </pre></td></tr><tr><td data-num="38"></td><td><pre>    <span class="token keyword">if</span> s_id <span class="token operator">!=</span> applicant_id <span class="token operator">or</span> r_id <span class="token operator">!=</span> receiver_id  <span class="token operator">or</span> <span class="token punctuation">(</span>s_type <span class="token operator">=</span> <span class="token string">"信用卡"</span> <span class="token operator">and</span> r_type <span class="token operator">=</span> <span class="token string">"储蓄卡"</span><span class="token punctuation">)</span> <span class="token operator">or</span> <span class="token punctuation">(</span>s_type <span class="token operator">=</span> <span class="token string">"储蓄卡"</span> <span class="token operator">and</span> s_b <span class="token operator">&lt;</span> amount<span class="token punctuation">)</span> <span class="token keyword">then</span></pre></td></tr><tr><td data-num="39"></td><td><pre>        <span class="token keyword">set</span> return_code <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="40"></td><td><pre>        <span class="token keyword">leave</span> pro<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="41"></td><td><pre>    <span class="token keyword">end</span> <span class="token keyword">if</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="42"></td><td><pre></pre></td></tr><tr><td data-num="43"></td><td><pre>    <span class="token keyword">if</span> s_type <span class="token operator">=</span> <span class="token string">"信用卡"</span> <span class="token keyword">then</span></pre></td></tr><tr><td data-num="44"></td><td><pre>        <span class="token keyword">set</span> amount <span class="token operator">=</span> <span class="token operator">-</span>amount<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="45"></td><td><pre>    <span class="token keyword">end</span> <span class="token keyword">if</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="46"></td><td><pre>    <span class="token keyword">if</span> r_type <span class="token operator">=</span> <span class="token string">"信用卡"</span> <span class="token keyword">then</span></pre></td></tr><tr><td data-num="47"></td><td><pre>        <span class="token keyword">set</span> rcv_amount <span class="token operator">=</span> <span class="token operator">-</span>rcv_amount<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="48"></td><td><pre>    <span class="token keyword">end</span> <span class="token keyword">if</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="49"></td><td><pre></pre></td></tr><tr><td data-num="50"></td><td><pre>    <span class="token keyword">update</span> bank_card <span class="token keyword">set</span> b_balance <span class="token operator">=</span> b_balance <span class="token operator">-</span> amount <span class="token keyword">where</span> b_number <span class="token operator">=</span> source_card_id<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="51"></td><td><pre></pre></td></tr><tr><td data-num="52"></td><td><pre>    <span class="token keyword">update</span> bank_card <span class="token keyword">set</span> b_balance <span class="token operator">=</span> b_balance <span class="token operator">+</span> rcv_amount <span class="token keyword">where</span> b_number <span class="token operator">=</span> dest_card_id<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="53"></td><td><pre>    </pre></td></tr><tr><td data-num="54"></td><td><pre>    <span class="token keyword">set</span> return_code <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="55"></td><td><pre><span class="token keyword">END</span>$$</pre></td></tr><tr><td data-num="56"></td><td><pre></pre></td></tr><tr><td data-num="57"></td><td><pre><span class="token keyword">delimiter</span> <span class="token punctuation">;</span></pre></td></tr></table></figure><p>在 <code>begin...end</code> 前写上一个标号 <code>pro</code> ，在 <code>begin...end</code> 中使用 <code>leave pro;</code> 来终止语句的执行</p><p>注：信用卡转出去是加，转进来是减</p><div class="tags"><a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/" rel="tag"><i class="ic i-tag"></i> 数据库</a></div></div><footer><div class="meta"><span class="item"><span class="icon"><i class="ic i-calendar-check"></i> </span><span class="text">更新于</span> <time title="修改时间：2022-11-17 11:13:40" itemprop="dateModified" datetime="2022-11-17T11:13:40+08:00">2022-11-17</time></span></div><div class="reward"><button><i class="ic i-heartbeat"></i> 赞赏</button><p>请我喝[茶]~(￣▽￣)~*</p><div id="qr"><div><img data-src="/images/wechatpay.png" alt="yuan 微信支付"><p>微信支付</p></div><div><img data-src="/images/alipay.png" alt="yuan 支付宝"><p>支付宝</p></div><div><img data-src="/images/paypal.png" alt="yuan 贝宝"><p>贝宝</p></div></div></div><div id="copyright"><ul><li class="author"><strong>本文作者： </strong>yuan <i class="ic i-at"><em>@</em></i>yuan</li><li class="link"><strong>本文链接：</strong> <a href="https://jyuanhust.github.io/2022/08/24/computer-science/base/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B3%BB%E7%BB%9F%E5%8E%9F%E7%90%86%E5%AE%9E%E8%B7%B5MySQL/%E5%AE%9E%E8%AE%AD7-%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B%E4%B8%8E%E4%BA%8B%E5%8A%A1/" title="实训7-存储过程与事务">https://jyuanhust.github.io/2022/08/24/computer-science/base/数据库系统原理实践MySQL/实训7-存储过程与事务/</a></li><li class="license"><strong>版权声明： </strong>本站所有文章除特别声明外，均采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> 许可协议。转载请注明出处！</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/2022/08/24/computer-science/base/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E5%AD%98%E5%82%A8%E7%B3%BB%E7%BB%9F/" itemprop="url" rel="prev" data-background-image="https:&#x2F;&#x2F;gitee.com&#x2F;zkz0&#x2F;image&#x2F;raw&#x2F;master&#x2F;img&#x2F;img(1).webp" title="存储系统"><span class="type">上一篇</span> <span class="category"><i class="ic i-flag"></i> 计算机组成原理</span><h3>存储系统</h3></a></div><div class="item right"><a href="/2022/08/24/computer-science/base/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B3%BB%E7%BB%9F%E5%8E%9F%E7%90%86%E5%AE%9E%E8%B7%B5MySQL/%E5%AE%9E%E8%AE%AD5-%E6%95%B0%E6%8D%AE%E7%9A%84%E6%8F%92%E5%85%A5%E4%BF%AE%E6%94%B9%E4%B8%8E%E5%88%A0%E9%99%A4/" itemprop="url" rel="next" data-background-image="https:&#x2F;&#x2F;gitee.com&#x2F;zkz0&#x2F;image&#x2F;raw&#x2F;master&#x2F;img&#x2F;img(85).webp" title="实训5-数据的插入修改与删除"><span class="type">下一篇</span> <span class="category"><i class="ic i-flag"></i> 数据库系统原理实践MySQL</span><h3>实训5-数据的插入修改与删除</h3></a></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="文章目录"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6%E8%AF%AD%E5%8F%A5%E7%9A%84%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B"><span class="toc-number">1.</span> <span class="toc-text">使用流程控制语句的存储过程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%BB%E5%8A%A1%E6%8F%8F%E8%BF%B0"><span class="toc-number">1.1.</span> <span class="toc-text">任务描述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86"><span class="toc-number">1.2.</span> <span class="toc-text">相关知识</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%98%E9%87%8F%E7%9A%84%E5%AE%9A%E4%B9%89%E4%B8%8E%E8%B5%8B%E5%80%BC"><span class="toc-number">1.3.</span> <span class="toc-text">变量的定义与赋值</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A1%A5%E5%85%85"><span class="toc-number">1.3.1.</span> <span class="toc-text">补充</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%8D%E5%90%88%E8%AF%AD%E5%8F%A5%E4%B8%8E%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6%E8%AF%AD%E5%8F%A5"><span class="toc-number">1.4.</span> <span class="toc-text">复合语句与流程控制语句</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%8D%E5%90%88%E8%AF%AD%E5%8F%A5beginend"><span class="toc-number">1.4.1.</span> <span class="toc-text">复合语句 BEGIN...END</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#if%E8%AF%AD%E5%8F%A5"><span class="toc-number">1.4.2.</span> <span class="toc-text">if 语句</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#while%E8%AF%AD%E5%8F%A5"><span class="toc-number">1.4.3.</span> <span class="toc-text">while 语句</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B%E7%9A%84%E5%AE%9A%E4%B9%89"><span class="toc-number">1.5.</span> <span class="toc-text">存储过程的定义</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B%E7%9A%84%E5%88%9B%E5%BB%BA%E5%92%8C%E6%9F%A5%E8%AF%A2"><span class="toc-number">1.6.</span> <span class="toc-text">存储过程的创建和查询</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%8B%E9%9D%A2%E6%88%91%E4%BB%AC%E6%9D%A5%E5%88%9B%E5%BB%BA%E7%AC%AC%E4%B8%80%E4%B8%AA%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B"><span class="toc-number">1.6.1.</span> <span class="toc-text">下面我们来创建第一个存储过程</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%89%A7%E8%A1%8C%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8Bcall-%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B%E5%90%8D"><span class="toc-number">1.6.2.</span> <span class="toc-text">执行存储过程： call 存储过程名</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%B8%A6%E6%9C%89%E5%8F%82%E6%95%B0%E7%9A%84%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B"><span class="toc-number">1.6.3.</span> <span class="toc-text">创建带有参数的存储过程</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B%E7%9A%84%E6%9F%A5%E8%AF%A2%E5%92%8C%E5%88%A0%E9%99%A4"><span class="toc-number">1.7.</span> <span class="toc-text">存储过程的查询和删除</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%96%E7%A8%8B%E8%A6%81%E6%B1%82"><span class="toc-number">1.8.</span> <span class="toc-text">编程要求</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E6%B8%B8%E6%A0%87%E7%9A%84%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B"><span class="toc-number">2.</span> <span class="toc-text">使用游标的存储过程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B8%B8%E6%A0%87cursor"><span class="toc-number">2.1.</span> <span class="toc-text">游标 (CURSOR)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B8%B8%E6%A0%87%E7%9A%84%E7%89%B9%E7%82%B9"><span class="toc-number">2.1.1.</span> <span class="toc-text">游标的特点</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B8%B8%E6%A0%87%E7%9A%84%E5%AE%9A%E4%B9%89%E4%B8%8E%E4%BD%BF%E7%94%A8"><span class="toc-number">2.1.2.</span> <span class="toc-text">游标的定义与使用</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#declare%E8%AF%AD%E5%8F%A5"><span class="toc-number">2.1.2.1.</span> <span class="toc-text">DECLARE 语句</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#open%E8%AF%AD%E5%8F%A5"><span class="toc-number">2.1.2.2.</span> <span class="toc-text">OPEN 语句</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#fetch%E8%AF%AD%E5%8F%A5"><span class="toc-number">2.1.2.3.</span> <span class="toc-text">FETCH 语句</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#close%E8%AF%AD%E5%8F%A5"><span class="toc-number">2.1.2.4.</span> <span class="toc-text">CLOSE 语句</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B8%B8%E6%A0%87%E5%BA%94%E7%94%A8%E4%B8%BE%E4%BE%8B"><span class="toc-number">2.1.3.</span> <span class="toc-text">游标应用举例</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%96%E7%A8%8B%E8%A6%81%E6%B1%82-2"><span class="toc-number">2.2.</span> <span class="toc-text">编程要求</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E4%BA%8B%E5%8A%A1%E7%9A%84%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B"><span class="toc-number">3.</span> <span class="toc-text">使用事务的存储过程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86-2"><span class="toc-number">3.1.</span> <span class="toc-text">相关知识</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8B%E5%8A%A1%E7%9A%84%E5%AE%9A%E4%B9%89%E5%92%8C%E5%BA%94%E7%94%A8"><span class="toc-number">3.2.</span> <span class="toc-text">事务的定义和应用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%96%E7%A8%8B%E8%A6%81%E6%B1%82-3"><span class="toc-number">3.3.</span> <span class="toc-text">编程要求</span></a></li></ol></li></ol></div><div class="related panel pjax" data-title="系列文章"><ul><li><a href="/2022/08/24/computer-science/base/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B3%BB%E7%BB%9F%E5%8E%9F%E7%90%86%E5%AE%9E%E8%B7%B5MySQL/%E5%AE%9E%E8%AE%AD1-%E6%95%B0%E6%8D%AE%E5%BA%93%E5%92%8C%E8%A1%A8%E4%B8%8E%E5%AE%8C%E6%95%B4%E6%80%A7%E7%BA%A6%E6%9D%9F%E7%9A%84%E5%AE%9A%E4%B9%89Create/" rel="bookmark" title="实训1-数据库和表与完整性约束的定义Create">实训1-数据库和表与完整性约束的定义Create</a></li><li><a href="/2022/08/24/computer-science/base/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B3%BB%E7%BB%9F%E5%8E%9F%E7%90%86%E5%AE%9E%E8%B7%B5MySQL/%E5%AE%9E%E8%AE%AD11-%E5%B9%B6%E5%8F%91%E6%8E%A7%E5%88%B6%E4%B8%8E%E4%BA%8B%E5%8A%A1%E7%9A%84%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB/" rel="bookmark" title="实训11-并发控制与事务的隔离级别">实训11-并发控制与事务的隔离级别</a></li><li><a href="/2022/08/24/computer-science/base/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B3%BB%E7%BB%9F%E5%8E%9F%E7%90%86%E5%AE%9E%E8%B7%B5MySQL/%E5%AE%9E%E8%AE%AD12-%E5%A4%87%E4%BB%BD%E6%97%A5%E5%BF%97-%E4%BB%8B%E8%B4%A8%E6%95%85%E9%9A%9C%E4%B8%8E%E6%95%B0%E6%8D%AE%E5%BA%93%E6%81%A2%E5%A4%8D/" rel="bookmark" title="实训12-备份日志-介质故障与数据库恢复">实训12-备份日志-介质故障与数据库恢复</a></li><li><a href="/2022/08/24/computer-science/base/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B3%BB%E7%BB%9F%E5%8E%9F%E7%90%86%E5%AE%9E%E8%B7%B5MySQL/%E5%AE%9E%E8%AE%AD10-%E5%AE%89%E5%85%A8%E6%80%A7%E6%8E%A7%E5%88%B6/" rel="bookmark" title="实训10-安全性控制">实训10-安全性控制</a></li><li><a href="/2022/08/24/computer-science/base/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B3%BB%E7%BB%9F%E5%8E%9F%E7%90%86%E5%AE%9E%E8%B7%B5MySQL/%E5%AE%9E%E8%AE%AD3-%E6%95%B0%E6%8D%AE%E6%9F%A5%E8%AF%A2Select%E4%B9%8B%E4%B8%80/" rel="bookmark" title="实训3-数据查询Select之一">实训3-数据查询Select之一</a></li><li><a href="/2022/08/24/computer-science/base/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B3%BB%E7%BB%9F%E5%8E%9F%E7%90%86%E5%AE%9E%E8%B7%B5MySQL/%E5%AE%9E%E8%AE%AD2-%E8%A1%A8%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AE%8C%E6%95%B4%E6%80%A7%E7%BA%A6%E6%9D%9F%E7%9A%84%E4%BF%AE%E6%94%B9ALTER/" rel="bookmark" title="实训2-表结构与完整性约束的修改ALTER">实训2-表结构与完整性约束的修改ALTER</a></li><li><a href="/2022/08/24/computer-science/base/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B3%BB%E7%BB%9F%E5%8E%9F%E7%90%86%E5%AE%9E%E8%B7%B5MySQL/%E5%AE%9E%E8%AE%AD8-%E8%A7%A6%E5%8F%91%E5%99%A8/" rel="bookmark" title="实训8-触发器">实训8-触发器</a></li><li><a href="/2022/08/24/computer-science/base/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B3%BB%E7%BB%9F%E5%8E%9F%E7%90%86%E5%AE%9E%E8%B7%B5MySQL/%E5%AE%9E%E8%AE%AD6-%E8%A7%86%E5%9B%BE/" rel="bookmark" title="实训6-视图">实训6-视图</a></li><li><a href="/2022/08/24/computer-science/base/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B3%BB%E7%BB%9F%E5%8E%9F%E7%90%86%E5%AE%9E%E8%B7%B5MySQL/%E5%AE%9E%E8%AE%AD9-%E7%94%A8%E6%88%B7%E8%87%AA%E5%AE%9A%E4%B9%89%E5%87%BD%E6%95%B0/" rel="bookmark" title="实训9-用户自定义函数">实训9-用户自定义函数</a></li><li><a href="/2022/08/24/computer-science/base/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B3%BB%E7%BB%9F%E5%8E%9F%E7%90%86%E5%AE%9E%E8%B7%B5MySQL/%E5%AE%9E%E8%AE%AD5-%E6%95%B0%E6%8D%AE%E7%9A%84%E6%8F%92%E5%85%A5%E4%BF%AE%E6%94%B9%E4%B8%8E%E5%88%A0%E9%99%A4/" rel="bookmark" title="实训5-数据的插入修改与删除">实训5-数据的插入修改与删除</a></li><li class="active"><a href="/2022/08/24/computer-science/base/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B3%BB%E7%BB%9F%E5%8E%9F%E7%90%86%E5%AE%9E%E8%B7%B5MySQL/%E5%AE%9E%E8%AE%AD7-%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B%E4%B8%8E%E4%BA%8B%E5%8A%A1/" rel="bookmark" title="实训7-存储过程与事务">实训7-存储过程与事务</a></li></ul></div><div class="overview panel" data-title="站点概览"><div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="image" itemprop="image" alt="yuan" data-src="/images/avatar.jpg"><p class="name" itemprop="name">yuan</p><div class="description" itemprop="description"></div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">429</span> <span class="name">文章</span></a></div><div class="item categories"><a href="/categories/"><span class="count">72</span> <span class="name">分类</span></a></div><div class="item tags"><a href="/tags/"><span class="count">61</span> <span class="name">标签</span></a></div></nav><div class="social"><span class="exturl item email" data-url="bWFpbHRvOjIwODM2MzU1MjVAcXEuY29t" title="mailto:2083635525@qq.com"><i class="ic i-envelope"></i></span></div><ul class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>首页</a></li><li class="item"><a href="/about/" rel="section"><i class="ic i-user"></i>关于</a></li><li class="item dropdown"><a href="javascript:void(0);"><i class="ic i-feather"></i>文章</a><ul class="submenu"><li class="item"><a href="/archives/" rel="section"><i class="ic i-list-alt"></i>归档</a></li><li class="item"><a href="/categories/" rel="section"><i class="ic i-th"></i>分类</a></li><li class="item"><a href="/tags/" rel="section"><i class="ic i-tags"></i>标签</a></li></ul></li><li class="item"><a href="/friends/" rel="section"><i class="ic i-heart"></i>友達</a></li><li class="item"><a href="/links/" rel="section"><i class="ic i-magic"></i>链接</a></li></ul></div></div></div><ul id="quick"><li class="prev pjax"><a href="/2022/08/24/computer-science/base/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E5%AD%98%E5%82%A8%E7%B3%BB%E7%BB%9F/" rel="prev" title="上一篇"><i class="ic i-chevron-left"></i></a></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href="/2022/08/24/computer-science/base/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B3%BB%E7%BB%9F%E5%8E%9F%E7%90%86%E5%AE%9E%E8%B7%B5MySQL/%E5%AE%9E%E8%AE%AD5-%E6%95%B0%E6%8D%AE%E7%9A%84%E6%8F%92%E5%85%A5%E4%BF%AE%E6%94%B9%E4%B8%8E%E5%88%A0%E9%99%A4/" rel="next" title="下一篇"><i class="ic i-chevron-right"></i></a></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>随机文章</h2><ul><li class="item"><div class="breadcrumb"><a href="/categories/tools/" title="分类于 tools">tools</a></div><span><a href="/2024/05/28/operation/%E5%BF%AB%E9%80%9F%E5%88%A0%E9%99%A4%E5%A4%A7%E9%87%8F%E6%96%87%E4%BB%B6/" title="快速删除大量文件">快速删除大量文件</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/computer-science/" title="分类于 computer-science">computer-science</a></div><span><a href="/2023/03/03/frontend/blog/%E6%88%91%E7%9A%84%E5%8D%9A%E5%AE%A2%E4%BF%AE%E6%94%B9%E8%AE%B0%E5%BD%95/" title="我的博客修改记录">我的博客修改记录</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/ai/" title="分类于 ai">ai</a> <i class="ic i-angle-right"></i> <a href="/categories/ai/pytorch%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/" title="分类于 pytorch深度学习">pytorch深度学习</a> <i class="ic i-angle-right"></i> <a href="/categories/ai/pytorch%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/chapter-natural-language-processing-pretraining/" title="分类于 chapter_natural-language-processing-pretraining">chapter_natural-language-processing-pretraining</a></div><span><a href="/2023/02/15/ai/pytorch%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/chapter_natural-language-processing-pretraining/word2vec-pretraining/" title="word2vec-pretraining">word2vec-pretraining</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Python/" title="分类于 Python">Python</a></div><span><a href="/2022/08/24/language/python/Python%E6%A8%A1%E5%9D%97-shutil%E6%A8%A1%E5%9D%97%E8%AF%A6%E8%A7%A3/" title="shutil模块详解-Python模块">shutil模块详解-Python模块</a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/2023/06/25/computer-science/%E6%AF%94%E8%B5%9B/%E4%BB%A3%E7%A0%81%E8%AF%84%E6%B3%A8/%E6%AF%94%E8%B5%9B%E5%87%86%E5%A4%87/" title="未命名">未命名</a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/2023/06/25/computer-science/%E6%AF%94%E8%B5%9B/%E8%93%9D%E6%A1%A5%E6%9D%AF/%E7%9F%A5%E8%AF%86%E7%82%B9%E6%B1%87%E6%80%BB/%E8%A1%A5%E5%85%85/%E5%9F%BA%E6%9C%AC%E7%9F%A5%E8%AF%86%E7%82%B91/" title="未命名">未命名</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/ai/" title="分类于 ai">ai</a> <i class="ic i-angle-right"></i> <a href="/categories/ai/pytorch%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/" title="分类于 pytorch深度学习">pytorch深度学习</a> <i class="ic i-angle-right"></i> <a href="/categories/ai/pytorch%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/chapter-notation/" title="分类于 chapter_notation">chapter_notation</a></div><span><a href="/2023/02/15/ai/pytorch%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/chapter_notation/index/" title="index">index</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/ai/" title="分类于 ai">ai</a> <i class="ic i-angle-right"></i> <a href="/categories/ai/nlp/" title="分类于 nlp">nlp</a></div><span><a href="/2022/08/25/ai/nlp/base/nlp%E7%9A%84%E6%95%B0%E6%8D%AE%E9%9B%86/" title="nlp的数据集">nlp的数据集</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/frontend/" title="分类于 前端">前端</a> <i class="ic i-angle-right"></i> <a href="/categories/frontend/vue/" title="分类于 vue">vue</a></div><span><a href="/2022/08/26/frontend/vue/vue3%E6%96%B0%E7%89%B9%E6%80%A7/" title="VUE3新特性">VUE3新特性</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/ai/" title="分类于 ai">ai</a> <i class="ic i-angle-right"></i> <a href="/categories/ai/pytorch/" title="分类于 pytorch">pytorch</a></div><span><a href="/2022/08/24/ai/pytorch/torchvision-datasets-ImageFolder/" title="torchvision.datasets.ImageFolder">torchvision.datasets.ImageFolder</a></span></li></ul></div><div><h2>最新评论</h2><ul class="leancloud-recent-comment"></ul></div></div><div class="status"><div class="copyright">&copy; 2010 – <span itemprop="copyrightYear">2024</span> <span class="with-love"><i class="ic i-sakura rotate"></i> </span><span class="author" itemprop="copyrightHolder">yuan @ Mi Manchi</span></div><div class="count"><span class="post-meta-item-icon"><i class="ic i-chart-area"></i> </span><span title="站点总字数">2.9m 字</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="ic i-coffee"></i> </span><span title="站点阅读时长">44:38</span></div><div class="powered-by">基于 <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL={path:"2022/08/24/computer-science/base/数据库系统原理实践MySQL/实训7-存储过程与事务/",favicon:{show:"（●´3｀●）やれやれだぜ",hide:"(´Д｀)大変だ！"},search:{placeholder:"文章搜索",empty:"关于 「 ${query} 」，什么也没搜到",stats:"${time} ms 内找到 ${hits} 条结果"},valine:!0,fancybox:!0,copyright:'复制成功，转载请遵守 <i class="ic i-creative-commons"></i>BY-NC-SA 协议。',ignores:[function(e){return e.includes("#")},function(e){return new RegExp(LOCAL.path+"$").test(e)}]}</script><script src="https://cdn.polyfill.io/v2/polyfill.js"></script><script src="//cdn.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script><script src="/js/app.js?v=0.2.5"></script></body></html>