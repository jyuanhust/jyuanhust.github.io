<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#FFF"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"><link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="alternate" type="application/rss+xml" title="yuan" href="https://jyuanhust.github.io/rss.xml"><link rel="alternate" type="application/atom+xml" title="yuan" href="https://jyuanhust.github.io/atom.xml"><link rel="alternate" type="application/json" title="yuan" href="https://jyuanhust.github.io/feed.json"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/css/app.css?v=0.2.5"><meta name="keywords" content="自然语言处理"><link rel="canonical" href="https://jyuanhust.github.io/2022/08/05/ai/nlp/base/Summarization-huggingface/"><title>Summarization - huggingface - nlp - ai | Mi Manchi = yuan = Whatever is worth doing at all is worth doing well</title><meta name="generator" content="Hexo 6.2.0"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">Summarization - huggingface</h1><div class="meta"><span class="item" title="创建时间：2022-08-05 18:52:49"><span class="icon"><i class="ic i-calendar"></i> </span><span class="text">发表于</span> <time itemprop="dateCreated datePublished" datetime="2022-08-05T18:52:49+08:00">2022-08-05</time> </span><span class="item" title="本文字数"><span class="icon"><i class="ic i-pen"></i> </span><span class="text">本文字数</span> <span>10k</span> <span class="text">字</span> </span><span class="item" title="阅读时长"><span class="icon"><i class="ic i-clock"></i> </span><span class="text">阅读时长</span> <span>9 分钟</span></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="切换导航栏"><span class="line"></span> <span class="line"></span> <span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">Mi Manchi</a></li></ul><ul class="right"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div id="imgs" class="pjax"><ul><li class="item" data-background-image="https://gitee.com/zkz0/image/raw/master/img/img(46).webp"></li><li class="item" data-background-image="https://gitee.com/zkz0/image/raw/master/img/img(36).webp"></li><li class="item" data-background-image="https://gitee.com/zkz0/image/raw/master/img/img(73).webp"></li><li class="item" data-background-image="https://gitee.com/zkz0/image/raw/master/img/img(83).webp"></li><li class="item" data-background-image="https://gitee.com/zkz0/image/raw/master/img/img(81).webp"></li><li class="item" data-background-image="https://gitee.com/zkz0/image/raw/master/img/img(26).webp"></li></ul></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"/></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"/><use xlink:href="#gentle-wave" x="48" y="3"/><use xlink:href="#gentle-wave" x="48" y="5"/><use xlink:href="#gentle-wave" x="48" y="7"/></g></svg></div><main><div class="inner"><div id="main" class="pjax"><div class="article wrap"><div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i> <span><a href="/">首页</a></span><i class="ic i-angle-right"></i> <span itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/ai/" itemprop="item" rel="index" title="分类于 ai"><span itemprop="name">ai</span></a><meta itemprop="position" content="1"></span><i class="ic i-angle-right"></i> <span class="current" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/ai/nlp/" itemprop="item" rel="index" title="分类于 nlp"><span itemprop="name">nlp</span></a><meta itemprop="position" content="2"></span></div><article itemscope itemtype="http://schema.org/Article" class="post block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://jyuanhust.github.io/2022/08/05/ai/nlp/base/Summarization-huggingface/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="yuan"><meta itemprop="description" content="Whatever is worth doing at all is worth doing well, "></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="yuan"></span><div class="body md" itemprop="articleBody"><p>我们将训练英语和西班牙语的双语模型。在本节结束时，您将拥有一个可以总结客户评论的模型，如下所示：</p><h2 id="preparing-a-multilingual-corpus-准备多语言语料库"><a class="anchor" href="#preparing-a-multilingual-corpus-准备多语言语料库">#</a> Preparing a multilingual corpus 准备多语言语料库</h2><p>我们将使用 <span class="exturl" data-url="aHR0cHM6Ly9odWdnaW5nZmFjZS5jby9kYXRhc2V0cy9hbWF6b25fcmV2aWV3c19tdWx0aQ==">Multilingual Amazon Reviews Corpus</span> 来创建我们的双语摘要生成器。此语料库由六种语言的 Amazon 产品评论组成，通常用于对多语言分类器进行基准测试。但是，由于每个评论都附有简短的标题，因此我们可以将这些标题用作模型学习的目标摘要！首先，让我们从拥抱面部中心下载英语和西班牙语子集：</p><pre><code>from datasets import load_dataset

spanish_dataset = load_dataset(&quot;amazon_reviews_multi&quot;, &quot;es&quot;)
english_dataset = load_dataset(&quot;amazon_reviews_multi&quot;, &quot;en&quot;)
english_dataset
</code></pre><pre><code>DatasetDict(&#123;
    train: Dataset(&#123;
        features: ['review_id', 'product_id', 'reviewer_id', 'stars', 'review_body', 'review_title', 'language', 'product_category'],
        num_rows: 200000
    &#125;)
    validation: Dataset(&#123;
        features: ['review_id', 'product_id', 'reviewer_id', 'stars', 'review_body', 'review_title', 'language', 'product_category'],
        num_rows: 5000
    &#125;)
    test: Dataset(&#123;
        features: ['review_id', 'product_id', 'reviewer_id', 'stars', 'review_body', 'review_title', 'language', 'product_category'],
        num_rows: 5000
    &#125;)
&#125;)
</code></pre><p>如您所见，对于每种语言，train 有 200，000 条评论，每种语言 validation 和 test 拆分都有 5，000 条评论。我们感兴趣的评论信息包含在 review_body 和 review_title 列中。让我们看一些例子，创建一个简单的函数，训练集中随机抽取样本：</p><pre><code>def show_samples(dataset, num_samples=3, seed=42):
    sample = dataset[&quot;train&quot;].shuffle(seed=seed).select(range(num_samples))
    for example in sample:
        print(f&quot;\n'&gt;&gt; Title: &#123;example['review_title']&#125;'&quot;)
        print(f&quot;'&gt;&gt; Review: &#123;example['review_body']&#125;'&quot;)


show_samples(english_dataset)
</code></pre><pre><code>'&gt;&gt; Title: Worked in front position, not rear'
'&gt;&gt; Review: 3 stars because these are not rear brakes as stated in the item description. At least the mount adapter only worked on the front fork of the bike that I got it for.'

'&gt;&gt; Title: meh'
'&gt;&gt; Review: Does it’s job and it’s gorgeous but mine is falling apart, I had to basically put it together again with hot glue'

'&gt;&gt; Title: Can\'t beat these for the money'
'&gt;&gt; Review: Bought this for handling miscellaneous aircraft parts and hanger &quot;stuff&quot; that I needed to organize; it really fit the bill. The unit arrived quickly, was well packaged and arrived intact (always a good sign). There are five wall mounts-- three on the top and two on the bottom. I wanted to mount it on the wall, so all I had to do was to remove the top two layers of plastic drawers, as well as the bottom corner drawers, place it when I wanted and mark it; I then used some of the new plastic screw in wall anchors (the 50 pound variety) and it easily mounted to the wall. Some have remarked that they wanted dividers for the drawers, and that they made those. Good idea. My application was that I needed something that I can see the contents at about eye level, so I wanted the fuller-sized drawers. I also like that these are the new plastic that doesn\'t get brittle and split like my older plastic drawers did. I like the all-plastic construction. It\'s heavy duty enough to hold metal parts, but being made of plastic it\'s not as heavy as a metal frame, so you can easily mount it to the wall and still load it up with heavy stuff, or light stuff. No problem there. For the money, you can\'t beat it. Best one of these I\'ve bought to date-- and I\'ve been using some version of these for over forty years.'
</code></pre><p>我们将专注于为单个产品域生成摘要。为了了解我们可以选择哪些域名，让我们转换 english_dataset 为 pandas 并计算每个产品类别的评论数量</p><p><code>english_dataset.set_format(&quot;pandas&quot;)</code> 改变了数据集中表的组织方式，其他的没变。原先表是用字典的形式存放的，现在变成了 <code>pandas.core.frame.DataFrame</code> ，</p><p><img data-src="/./images/Summarization-huggingface/1662593301032.png" alt="1662593301032"></p><p><img data-src="/./images/Summarization-huggingface/1662593446948.png" alt="1662593446948"></p><pre><code>english_dataset.set_format(&quot;pandas&quot;)
english_df = english_dataset[&quot;train&quot;][:]
# Show counts for top 20 products
english_df[&quot;product_category&quot;].value_counts()[:20]
</code></pre><pre><code>home                      17679
apparel                   15951
wireless                  15717
other                     13418
beauty                    12091
drugstore                 11730
kitchen                   10382
toy                        8745
sports                     8277
automotive                 7506
lawn_and_garden            7327
home_improvement           7136
pet_products               7082
digital_ebook_purchase     6749
pc                         6401
electronics                6186
office_product             5521
shoes                      5197
grocery                    4730
book                       3756
Name: product_category, dtype: int64
</code></pre><p>仅使用 book 和 digital_ebook_purchase 部分数据集，使用 Dataset.filter () 函数。</p><pre><code>def filter_books(example):
    return (
        example[&quot;product_category&quot;] == &quot;book&quot;
        or example[&quot;product_category&quot;] == &quot;digital_ebook_purchase&quot;
    )
</code></pre><p>现在，当我们将此函数应用于 english_dataset 和 spanish_dataset 时，结果将仅包含涉及书籍类别的那些行。在应用过滤器之前，让我们将 english_dataset 的格式从 pandas 切换回 arrow</p><pre><code>english_dataset.reset_format()
</code></pre><p>然后，我们可以应用过滤器功能，作为健全性检查，让我们检查一个评论样本，看看它们是否确实是关于书籍的</p><pre><code>spanish_books = spanish_dataset.filter(filter_books)
english_books = english_dataset.filter(filter_books)
show_samples(english_books)

</code></pre><pre><code>'&gt;&gt; Title: I\'m dissapointed.'
'&gt;&gt; Review: I guess I had higher expectations for this book from the reviews. I really thought I\'d at least like it. The plot idea was great. I loved Ash but, it just didnt go anywhere. Most of the book was about their radio show and talking to callers. I wanted the author to dig deeper so we could really get to know the characters. All we know about Grace is that she is attractive looking, Latino and is kind of a brat. I\'m dissapointed.'

'&gt;&gt; Title: Good art, good price, poor design'
'&gt;&gt; Review: I had gotten the DC Vintage calendar the past two years, but it was on backorder forever this year and I saw they had shrunk the dimensions for no good reason. This one has good art choices but the design has the fold going through the picture, so it\'s less aesthetically pleasing, especially if you want to keep a picture to hang. For the price, a good calendar'

'&gt;&gt; Title: Helpful'
'&gt;&gt; Review: Nearly all the tips useful and. I consider myself an intermediate to advanced user of OneNote. I would highly recommend.'
</code></pre><p>好的，我们可以看到评论并不严格地与书籍有关，并且可能涉及日历和电子应用程序（如 OneNote）之类的内容。尽管如此，该领域似乎可以训练一个总结模型。在我们查看适合此任务的各种模型之前，我们还有最后一点数据准备工作要做：将英语和西班牙语评论合并为一个 DatasetDict 对象。 Datasets 提供了一个方便的 concatenate_datasets () 函数（顾名思义）将两个 Dataset 对象堆叠在一起。因此，要创建我们的双语数据集，我们将遍历每个拆分，连接该拆分的数据集，然后随机处理结果以确保我们的模型不会过度拟合到一种语言</p><pre><code>english_books.keys()

dict_keys(['train', 'validation', 'test'])
</code></pre><p><img data-src="/./images/Summarization-huggingface/1662594871928.png" alt="1662594871928"></p><p>观察上面的行数，可知 <code>concatenate_datasets()</code> 是将两个表的行合并在一起。</p><pre><code>from datasets import concatenate_datasets, DatasetDict

books_dataset = DatasetDict()

for split in english_books.keys():
    books_dataset[split] = concatenate_datasets(
        [english_books[split], spanish_books[split]]
    )
    books_dataset[split] = books_dataset[split].shuffle(seed=42)

# Peek at a few examples
show_samples(books_dataset)
</code></pre><pre><code>'&gt;&gt; Title: 小说故事'
'&gt;&gt; Review: 内容是网络小说的那种感觉，整本书的质感还是不错的。 还附赠了一个小本，类似奏折的那种。'

'&gt;&gt; Title: 佳品'
'&gt;&gt; Review: 王叔晖的作品，内容没得说。这本彩色连环画印刷清晰，装帧精美 ，适于欣赏和收藏。但相比起来，个人觉得原稿尺寸系列的西厢记（上、下 册）更优：1.内容多出很多；2.黑白的，线条细腻；3.画幅更大，更能体会原作的震撼。'

'&gt;&gt; Title: What A Beautiful Story!'
'&gt;&gt; Review: I simply loved A PERFECTLY SCANDALOUS PROPOSAL! Poignant, passionate, witty, and wonderful, this book touched my heart with its sweetness! I adored our Heroine, Maggie, and admired her for her determination and spunk. She is so easy to love, and our leading man, Gabriel, is simply perfect for our sweet Heroine. I loved the plot, and it flowed smoothly along. A beautiful ten star read!'
</code></pre><p>这当然看起来像是英语和西班牙语评论的混合体！现在我们有一个训练语料库，最后要检查的一件事是评论及其标题中单词的分布。这对于汇总任务尤其重要，在摘要任务中，数据中的简短引用摘要可能会使模型偏向于在生成的摘要中仅输出一个或两个单词。下面的图显示了单词分布，我们可以看到标题严重偏向于仅 1-2 个单词：</p><p><img data-src="/./images/Summarization-huggingface/1662595336000.png" alt="1662595336000"></p><p>为了解决这个问题，我们将过滤掉标题非常短的示例，以便我们的模型可以生成更有趣的摘要。由于我们正在处理英语和西班牙语文本，因此我们可以使用粗略的启发式方法在空白处拆分标题，然后使用我们的 Dataset.filter () 方法，如下所示：</p><pre><code>books_dataset = books_dataset.filter(lambda x: len(x[&quot;review_title&quot;].split()) &gt; 2)
</code></pre><h2 id="models-for-text-summarization"><a class="anchor" href="#models-for-text-summarization">#</a> Models for text summarization</h2><p>从此表中可以看出，大多数用于汇总的 Transformer 模型（以及大多数 NLP 任务）都是单语的。如果您的任务是使用英语或德语等 “高资源” 语言，那就太好了，但对于世界各地使用的数千种其他语言则不那么重要。幸运的是，有一类多语言变形金刚型号，如 mT5 和 mBART，可以挽救。这些模型是使用语言建模进行预训练的，但有一个转折：它们不是在一种语言的语料库上进行训练，而是同时在 50 多种语言的文本上进行联合训练！</p><p>我们将重点介绍 mT5，这是一种基于 T5 的有趣架构，在文本到文本框架中进行了预训练。在 T5 中，每个 NLP 任务都是根据提示前缀如来制定的，例如 summarize，模型根据提示调整生成的文本的条件。如下图所示，这使得 T5 非常通用，因为您可以使用单个模型解决许多任务！</p><p><img data-src="/./images/Summarization-huggingface/1662596272436.png" alt="1662596272436"></p><p>mT5 不使用前缀，但具有 T5 的大部分多功能性，并具有多语言的优势。现在我们已经选择了一个模型，让我们来看看如何准备用于训练的数据。</p><h2 id="preprocessing-the-data"><a class="anchor" href="#preprocessing-the-data">#</a> Preprocessing the data</h2><p>我们的下一个任务是标记和编码我们的评论及其标题。像往常一样，我们首先加载与预训练的模型检查点关联的分词器。我们将 使用 mt5-small 作为检查点，以便在合理的时间内微调模型：</p><p>在 NLP 项目的早期阶段，一个好的做法是在一小部分数据样本上训练一类 “小” 模型。这使您可以更快地调试和迭代端到端工作流。一旦您对结果有信心，您始终可以通过简单地更改模型检查点来扩展模型！</p><p>让我们在一个小例子中测试 mT5 分词器</p><pre><code>inputs = tokenizer(&quot;I loved reading the Hunger Games!&quot;)
inputs

&#123;'input_ids': [336, 259, 28387, 11807, 287, 62893, 295, 12507, 1], 'attention_mask': [1, 1, 1, 1, 1, 1, 1, 1, 1]&#125;
</code></pre><p>让我们使用分词器的 convert_ids_to_tokens () 函数对这些输入 ID 进行解码，看看我们正在处理哪种分词器：</p><pre><code>tokenizer.convert_ids_to_tokens(inputs.input_ids)

['▁I', '▁', 'loved', '▁reading', '▁the', '▁Hung', 'er', '▁Games', '&lt;/s&gt;']
</code></pre><p>特殊的 Unicode 字符 <code>▁</code> 和序列结束标记 <code>&lt;/s&gt;</code> 表示我们正在处理 SentencePiece tokenizer,，它基于第 6 章中讨论的 Unigram 分割算法。Unigram 对于多语言语料库特别有用，因为它允许 SentencePiece 对重音，标点符号以及许多语言（如日语）没有空格字符的事实不可知。</p><h2 id="metrics-for-text-summarization"><a class="anchor" href="#metrics-for-text-summarization">#</a> Metrics for text summarization</h2><p>与本课程中介绍的大多数其他任务相比，衡量摘要或翻译等文本生成任务的性能并不那么简单。例如，给定 “I loved reading the Hunger Games” 之类的评论，有多个有效的摘要，例如 “I loved the Hunger Games” 或 “Hunger Games is a great read”。显然，在生成的摘要和标签之间应用某种完全匹配并不是一个好的解决方案 —— 即使是人类在这样的指标下也会表现不佳，因为我们都有自己的写作风格。</p><p>总而言之，最常用的指标之一是 <span class="exturl" data-url="aHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvUk9VR0VfKG1ldHJpYyk=">ROUGE 分数</span>（用于指导评估的面向召回的学习 Recall-Oriented Understudy for Gisting Evaluation 的缩写）。此指标背后的基本思想是将生成的摘要与通常由人类创建的一组参考摘要进行比较。为了使这更精确，假设我们要比较以下两个摘要：</p><pre><code>generated_summary = &quot;I absolutely loved reading the Hunger Games&quot;
reference_summary = &quot;I loved reading the Hunger Games&quot;
</code></pre><p>比较它们的一种方法是计算重叠单词的数量，在本例中为 6。但是，这有点粗糙，因此 ROUGE 基于计算重叠的精度 precision 和召回 recall 率分数</p><p><span class="exturl" data-url="aHR0cHM6Ly9zY2lraXQtbGVhcm4ub3JnL3N0YWJsZS9hdXRvX2V4YW1wbGVzL21vZGVsX3NlbGVjdGlvbi9wbG90X3ByZWNpc2lvbl9yZWNhbGwuaHRtbA==">scikit-learn 中的参考</span></p><p>对于 ROUGE，召回率衡量生成的参考摘要捕获了多少参考摘要。如果我们只是比较单词，recall 可以根据以下公式计算</p><p><img data-src="/./images/Summarization-huggingface/1662598167924.png" alt="1662598167924"></p><p><img data-src="/./images/Summarization-huggingface/1662598174936.png" alt="1662598174936"></p><p>对于我们上面的简单示例，此公式给出了 6/6 = 1 的完美 recall; 即，参考摘要中的所有单词都是由模型生成的。这听起来可能很棒，但想象一下，如果我们生成的摘要是 ““I really really loved reading the Hunger Games all night”。这也将具有完美 recall，但可以说是一个更糟糕的总结，因为它是冗长的。为了处理这些场景，我们还计算精度，在 ROUGE 上下文中，精度测量生成的摘要中有多少是相关的：</p><p><img data-src="/./images/Summarization-huggingface/1662598304620.png" alt="1662598304620"></p><p><img data-src="/./images/Summarization-huggingface/1662598313457.png" alt="1662598313457"></p><p>将此应用于我们的详细摘要会得到 6/10 = 0.6 的精度，这比我们较短的摘要获得的 6/7 = 0.86 的精度差得多。在实践中，通常同时计算精度和召回率，然后报告 F1-score（精度和召回率的谐波平均值）。我们可以通过首先安装软件包 rouge_score 在 Datasets 轻松完成此操作</p><pre><code>!pip install rouge_score
</code></pre><p>，然后按如下方式加载 ROUGE 指标</p><pre><code>import evaluate

rouge_score = evaluate.load(&quot;rouge&quot;)
</code></pre><p>然后，我们可以使用 rouge_score.compute () 函数一次计算所有指标</p><pre><code>scores = rouge_score.compute(
    predictions=[generated_summary], references=[reference_summary]
)
scores

</code></pre><pre><code>&#123;'rouge1': AggregateScore(low=Score(precision=0.86, recall=1.0, fmeasure=0.92), mid=Score(precision=0.86, recall=1.0, fmeasure=0.92), high=Score(precision=0.86, recall=1.0, fmeasure=0.92)),
 'rouge2': AggregateScore(low=Score(precision=0.67, recall=0.8, fmeasure=0.73), mid=Score(precision=0.67, recall=0.8, fmeasure=0.73), high=Score(precision=0.67, recall=0.8, fmeasure=0.73)),
 'rougeL': AggregateScore(low=Score(precision=0.86, recall=1.0, fmeasure=0.92), mid=Score(precision=0.86, recall=1.0, fmeasure=0.92), high=Score(precision=0.86, recall=1.0, fmeasure=0.92)),
 'rougeLsum': AggregateScore(low=Score(precision=0.86, recall=1.0, fmeasure=0.92), mid=Score(precision=0.86, recall=1.0, fmeasure=0.92), high=Score(precision=0.86, recall=1.0, fmeasure=0.92))&#125;
</code></pre><p>哇，输出中有很多信息 —— 这一切意味着什么？首先，🤗数据集实际上计算精度，召回率和 F1 分数的置信区间；这些是您可以在此处看到的 low、mid 和 high 属性。此外，数据集在比较生成的摘要和参考摘要时，🤗会根据不同类型的文本粒度计算各种 ROUGE 分数。rouge1 是 unigrams 的重叠 - 这只是一种说单词重叠的方式，正是我们上面讨论的指标。为了验证这一点，让我们提取分数的 mid 值</p><pre><code>scores[&quot;rouge1&quot;].mid

Score(precision=0.86, recall=1.0, fmeasure=0.92)
</code></pre><p>太好了，精度和召回率数字匹配！那么其他的 ROUGE 分数呢？ rouge2 测量双字母之间的重叠（想想单词对的重叠），rougeL rougeLsum 同时通过在生成和参考摘要中查找最长的常用子字符串来测量最长的单词匹配序列。rougeLsum 中的 “sum” 是指此指标是在整个摘要中计算的，而 rougeL 作为单个句子的平均值计算的。</p><p>Creating a strong baseline</p><p>文本摘要的常见基线是简单地取文章的前三句话，通常称为 lead-3 基线。我们可以使用句号来跟踪句子边界，但这在 “U.S.” 或 “U.N.” 等首字母缩略词上会失败 - 所以我们将使用库 nltk，其中包括更好的算法来处理这些情况。您可以使用如下方式安装软件包</p><div class="tags"><a href="/tags/%E8%87%AA%E7%84%B6%E8%AF%AD%E8%A8%80%E5%A4%84%E7%90%86/" rel="tag"><i class="ic i-tag"></i> 自然语言处理</a></div></div><footer><div class="meta"><span class="item"><span class="icon"><i class="ic i-calendar-check"></i> </span><span class="text">更新于</span> <time title="修改时间：2022-09-08 09:08:20" itemprop="dateModified" datetime="2022-09-08T09:08:20+08:00">2022-09-08</time></span></div><div class="reward"><button><i class="ic i-heartbeat"></i> 赞赏</button><p>请我喝[茶]~(￣▽￣)~*</p><div id="qr"><div><img data-src="/images/wechatpay.png" alt="yuan 微信支付"><p>微信支付</p></div><div><img data-src="/images/alipay.png" alt="yuan 支付宝"><p>支付宝</p></div><div><img data-src="/images/paypal.png" alt="yuan 贝宝"><p>贝宝</p></div></div></div><div id="copyright"><ul><li class="author"><strong>本文作者： </strong>yuan <i class="ic i-at"><em>@</em></i>yuan</li><li class="link"><strong>本文链接：</strong> <a href="https://jyuanhust.github.io/2022/08/05/ai/nlp/base/Summarization-huggingface/" title="Summarization - huggingface">https://jyuanhust.github.io/2022/08/05/ai/nlp/base/Summarization-huggingface/</a></li><li class="license"><strong>版权声明： </strong>本站所有文章除特别声明外，均采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> 许可协议。转载请注明出处！</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/2022/08/05/ai/nlp/base/%E6%96%87%E6%9C%AC%E6%83%85%E6%84%9F%E5%88%86%E7%B1%BB/" itemprop="url" rel="prev" data-background-image="https:&#x2F;&#x2F;gitee.com&#x2F;zkz0&#x2F;image&#x2F;raw&#x2F;master&#x2F;img&#x2F;img(38).webp" title="文本情感分类"><span class="type">上一篇</span> <span class="category"><i class="ic i-flag"></i> base</span><h3>文本情感分类</h3></a></div><div class="item right"><a href="/2022/08/09/frontend/base/TypeScript/" itemprop="url" rel="next" data-background-image="https:&#x2F;&#x2F;gitee.com&#x2F;zkz0&#x2F;image&#x2F;raw&#x2F;master&#x2F;img&#x2F;img(54).webp" title="TypeScript"><span class="type">下一篇</span> <span class="category"><i class="ic i-flag"></i> 前端</span><h3>TypeScript</h3></a></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="文章目录"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#preparing-a-multilingual-corpus-%E5%87%86%E5%A4%87%E5%A4%9A%E8%AF%AD%E8%A8%80%E8%AF%AD%E6%96%99%E5%BA%93"><span class="toc-number">1.</span> <span class="toc-text">Preparing a multilingual corpus 准备多语言语料库</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#models-for-text-summarization"><span class="toc-number">2.</span> <span class="toc-text">Models for text summarization</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#preprocessing-the-data"><span class="toc-number">3.</span> <span class="toc-text">Preprocessing the data</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#metrics-for-text-summarization"><span class="toc-number">4.</span> <span class="toc-text">Metrics for text summarization</span></a></li></ol></div><div class="related panel pjax" data-title="系列文章"><ul><li><a href="/2022/07/25/ai/nlp/base/%E5%BE%AA%E7%8E%AF%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/" rel="bookmark" title="循环神经网络基础">循环神经网络基础</a></li><li class="active"><a href="/2022/08/05/ai/nlp/base/Summarization-huggingface/" rel="bookmark" title="Summarization - huggingface">Summarization - huggingface</a></li><li><a href="/2022/08/05/ai/nlp/base/%E6%96%87%E6%9C%AC%E6%83%85%E6%84%9F%E5%88%86%E7%B1%BB/" rel="bookmark" title="文本情感分类">文本情感分类</a></li><li><a href="/2022/08/24/ai/nlp/base/PyTorch-%E4%B8%AD-LSTM-%E7%9A%84-output%E3%80%81h-n-%E5%92%8C-c-n-%E4%B9%8B%E9%97%B4%E7%9A%84%E5%85%B3%E7%B3%BB/" rel="bookmark" title="PyTorch_中_LSTM_的_output、h_n_和_c_n_之间的关系">PyTorch_中_LSTM_的_output、h_n_和_c_n_之间的关系</a></li><li><a href="/2022/08/24/ai/nlp/base/pytorch%E4%B8%ADLSTM%E7%9A%84output%E5%92%8Chidden%E5%85%B3%E7%B3%BB/" rel="bookmark" title="pytorch中LSTM的output和hidden关系">pytorch中LSTM的output和hidden关系</a></li><li><a href="/2022/08/25/ai/nlp/base/nlp%E7%9A%84%E6%95%B0%E6%8D%AE%E9%9B%86/" rel="bookmark" title="nlp的数据集">nlp的数据集</a></li><li><a href="/2022/08/25/ai/nlp/base/transformer/" rel="bookmark" title="transformer">transformer</a></li><li><a href="/2022/09/21/ai/nlp/base/nlp-transformer%E6%A6%82%E8%BF%B0/" rel="bookmark" title="NLP和transformer大类概述">NLP和transformer大类概述</a></li><li><a href="/2022/09/21/ai/nlp/huggingface/DATASETS%E5%BA%93/%E5%88%87%E7%89%87/" rel="bookmark" title="datasets 切片">datasets 切片</a></li><li><a href="/2022/09/22/ai/nlp/base/Subword%E7%AE%97%E6%B3%95/" rel="bookmark" title="Subword算法">Subword算法</a></li><li><a href="/2022/11/12/ai/nlp/huggingface/%E5%BE%AE%E8%B0%83%E4%B8%80%E4%B8%AA%E9%A2%84%E8%AE%AD%E7%BB%83%E6%A8%A1%E5%9E%8B/%E5%A4%84%E7%90%86%E6%95%B0%E6%8D%AE/" rel="bookmark" title="微调一个预训练模型-处理数据">微调一个预训练模型-处理数据</a></li><li><a href="/2022/11/12/ai/nlp/huggingface/Tokenizers%E5%BA%93/NormalizationAndPre-tokenization/" rel="bookmark" title="Normalization and pre-tokenization">Normalization and pre-tokenization</a></li><li><a href="/2022/11/12/ai/nlp/huggingface/%E4%B8%BB%E8%A6%81%E7%9A%84%20NLP%20%E4%BB%BB%E5%8A%A1/%E5%BE%AE%E8%B0%83%E4%B8%80%E4%B8%AA%E6%8E%A9%E7%A0%81%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B/" rel="bookmark" title="微调一个掩码语言模型">微调一个掩码语言模型</a></li><li><a href="/2022/11/12/ai/nlp/huggingface/%E4%B8%BB%E8%A6%81%E7%9A%84%20NLP%20%E4%BB%BB%E5%8A%A1/%E6%96%87%E6%9C%AC%E6%91%98%E8%A6%81Summarization/" rel="bookmark" title="文本摘要 summarize">文本摘要 summarize</a></li><li><a href="/2022/11/12/ai/nlp/huggingface/Tokenizers%E5%BA%93/Unigram%E6%A0%87%E8%AE%B0%E5%8C%96/" rel="bookmark" title="Unigram">Unigram</a></li><li><a href="/2022/11/12/ai/nlp/huggingface/%E4%B8%BB%E8%A6%81%E7%9A%84%20NLP%20%E4%BB%BB%E5%8A%A1/%E9%97%AE%E7%AD%94/" rel="bookmark" title="问答 question answer">问答 question answer</a></li><li><a href="/2022/11/12/ai/nlp/huggingface/Tokenizers%E5%BA%93/BPE/" rel="bookmark" title="Byte-Pair Encoding tokenization">Byte-Pair Encoding tokenization</a></li><li><a href="/2022/11/12/ai/nlp/huggingface/Tokenizers%E5%BA%93/%E6%A0%B9%E6%8D%AE%E5%B7%B2%E6%9C%89%E7%9A%84tokenizer%E8%AE%AD%E7%BB%83%E6%96%B0%E7%9A%84tokenizer/" rel="bookmark" title="根据已有的tokenizer训练新的tokenizer">根据已有的tokenizer训练新的tokenizer</a></li><li><a href="/2022/11/12/ai/nlp/huggingface/Tokenizers%E5%BA%93/WordPiece/" rel="bookmark" title="WordPiece">WordPiece</a></li></ul></div><div class="overview panel" data-title="站点概览"><div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="image" itemprop="image" alt="yuan" data-src="/images/avatar.jpg"><p class="name" itemprop="name">yuan</p><div class="description" itemprop="description"></div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">429</span> <span class="name">文章</span></a></div><div class="item categories"><a href="/categories/"><span class="count">72</span> <span class="name">分类</span></a></div><div class="item tags"><a href="/tags/"><span class="count">61</span> <span class="name">标签</span></a></div></nav><div class="social"><span class="exturl item email" data-url="bWFpbHRvOjIwODM2MzU1MjVAcXEuY29t" title="mailto:2083635525@qq.com"><i class="ic i-envelope"></i></span></div><ul class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>首页</a></li><li class="item"><a href="/about/" rel="section"><i class="ic i-user"></i>关于</a></li><li class="item dropdown"><a href="javascript:void(0);"><i class="ic i-feather"></i>文章</a><ul class="submenu"><li class="item"><a href="/archives/" rel="section"><i class="ic i-list-alt"></i>归档</a></li><li class="item"><a href="/categories/" rel="section"><i class="ic i-th"></i>分类</a></li><li class="item"><a href="/tags/" rel="section"><i class="ic i-tags"></i>标签</a></li></ul></li><li class="item"><a href="/friends/" rel="section"><i class="ic i-heart"></i>友達</a></li><li class="item"><a href="/links/" rel="section"><i class="ic i-magic"></i>链接</a></li></ul></div></div></div><ul id="quick"><li class="prev pjax"><a href="/2022/08/05/ai/nlp/base/%E6%96%87%E6%9C%AC%E6%83%85%E6%84%9F%E5%88%86%E7%B1%BB/" rel="prev" title="上一篇"><i class="ic i-chevron-left"></i></a></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href="/2022/08/09/frontend/base/TypeScript/" rel="next" title="下一篇"><i class="ic i-chevron-right"></i></a></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>随机文章</h2><ul><li class="item"><div class="breadcrumb"><a href="/categories/ai/" title="分类于 ai">ai</a> <i class="ic i-angle-right"></i> <a href="/categories/ai/pytorch%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/" title="分类于 pytorch深度学习">pytorch深度学习</a> <i class="ic i-angle-right"></i> <a href="/categories/ai/pytorch%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/chapter-attention-mechanisms/" title="分类于 chapter_attention-mechanisms">chapter_attention-mechanisms</a></div><span><a href="/2023/02/15/ai/pytorch%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/chapter_attention-mechanisms/self-attention-and-positional-encoding/" title="self-attention-and-positional-encoding">self-attention-and-positional-encoding</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/ai/" title="分类于 ai">ai</a> <i class="ic i-angle-right"></i> <a href="/categories/ai/pytorch%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/" title="分类于 pytorch深度学习">pytorch深度学习</a> <i class="ic i-angle-right"></i> <a href="/categories/ai/pytorch%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/chapter-multilayer-perceptrons/" title="分类于 chapter_multilayer-perceptrons">chapter_multilayer-perceptrons</a></div><span><a href="/2023/02/15/ai/pytorch%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/chapter_multilayer-perceptrons/dropout/" title="dropout">dropout</a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/2023/06/25/computer-science/base/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E8%AE%A1%E7%BD%91%E6%80%BB%E5%A4%8D%E4%B9%A0-%E6%9C%B1%E4%BD%AC/" title="未命名">未命名</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/ai/" title="分类于 ai">ai</a> <i class="ic i-angle-right"></i> <a href="/categories/ai/pytorch%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/" title="分类于 pytorch深度学习">pytorch深度学习</a> <i class="ic i-angle-right"></i> <a href="/categories/ai/pytorch%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/chapter-optimization/" title="分类于 chapter_optimization">chapter_optimization</a></div><span><a href="/2023/02/15/ai/pytorch%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/chapter_optimization/adadelta/" title="adadelta">adadelta</a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/2022/07/24/computer-science/base/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%AE%9E%E9%AA%8C/828/lab1-Xv6andUnixutilities/" title="Xv6 and Unix utilities">Xv6 and Unix utilities</a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/2023/08/24/computer-science/algorithm/%E5%9B%BE%E8%A7%A3%E7%AE%97%E6%B3%95%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E5%8F%8C%E6%8C%87%E9%92%88/" title="未命名">未命名</a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/2023/06/25/computer-science/%E6%AF%94%E8%B5%9B/%E8%93%9D%E6%A1%A5%E6%9D%AF/%E7%9F%A5%E8%AF%86%E7%82%B9%E6%B1%87%E6%80%BB/ECharts/%E5%9F%BA%E6%9C%AC%E7%9F%A5%E8%AF%86%E7%82%B92/" title="未命名">未命名</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/ai/" title="分类于 ai">ai</a> <i class="ic i-angle-right"></i> <a href="/categories/ai/pytorch%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/" title="分类于 pytorch深度学习">pytorch深度学习</a> <i class="ic i-angle-right"></i> <a href="/categories/ai/pytorch%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/chapter-optimization/" title="分类于 chapter_optimization">chapter_optimization</a></div><span><a href="/2023/02/15/ai/pytorch%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/chapter_optimization/momentum/" title="momentum">momentum</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/frontend/" title="分类于 前端">前端</a> <i class="ic i-angle-right"></i> <a href="/categories/frontend/Node-js/" title="分类于 Node.js">Node.js</a></div><span><a href="/2022/09/08/frontend/Node/Express/" title="Express">Express</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/ai/" title="分类于 ai">ai</a> <i class="ic i-angle-right"></i> <a href="/categories/ai/pytorch%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/" title="分类于 pytorch深度学习">pytorch深度学习</a> <i class="ic i-angle-right"></i> <a href="/categories/ai/pytorch%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/chapter-natural-language-processing-pretraining/" title="分类于 chapter_natural-language-processing-pretraining">chapter_natural-language-processing-pretraining</a></div><span><a href="/2023/02/15/ai/pytorch%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/chapter_natural-language-processing-pretraining/word2vec/" title="word2vec">word2vec</a></span></li></ul></div><div><h2>最新评论</h2><ul class="leancloud-recent-comment"></ul></div></div><div class="status"><div class="copyright">&copy; 2010 – <span itemprop="copyrightYear">2024</span> <span class="with-love"><i class="ic i-sakura rotate"></i> </span><span class="author" itemprop="copyrightHolder">yuan @ Mi Manchi</span></div><div class="count"><span class="post-meta-item-icon"><i class="ic i-chart-area"></i> </span><span title="站点总字数">2.9m 字</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="ic i-coffee"></i> </span><span title="站点阅读时长">44:38</span></div><div class="powered-by">基于 <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL={path:"2022/08/05/ai/nlp/base/Summarization-huggingface/",favicon:{show:"（●´3｀●）やれやれだぜ",hide:"(´Д｀)大変だ！"},search:{placeholder:"文章搜索",empty:"关于 「 ${query} 」，什么也没搜到",stats:"${time} ms 内找到 ${hits} 条结果"},valine:!0,fancybox:!0,copyright:'复制成功，转载请遵守 <i class="ic i-creative-commons"></i>BY-NC-SA 协议。',ignores:[function(e){return e.includes("#")},function(e){return new RegExp(LOCAL.path+"$").test(e)}]}</script><script src="https://cdn.polyfill.io/v2/polyfill.js"></script><script src="//cdn.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script><script src="/js/app.js?v=0.2.5"></script></body></html>