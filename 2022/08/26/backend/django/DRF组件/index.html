<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#FFF"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"><link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="alternate" type="application/rss+xml" title="yuan" href="https://jyuanhust.github.io/rss.xml"><link rel="alternate" type="application/atom+xml" title="yuan" href="https://jyuanhust.github.io/atom.xml"><link rel="alternate" type="application/json" title="yuan" href="https://jyuanhust.github.io/feed.json"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/css/app.css?v=0.2.5"><meta name="keywords" content="django"><link rel="canonical" href="https://jyuanhust.github.io/2022/08/26/backend/django/DRF%E7%BB%84%E4%BB%B6/"><title>DRF组件 - django - 后端 | Mi Manchi = yuan = Whatever is worth doing at all is worth doing well</title><meta name="generator" content="Hexo 6.2.0"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">DRF组件</h1><div class="meta"><span class="item" title="创建时间：2022-08-26 22:42:40"><span class="icon"><i class="ic i-calendar"></i> </span><span class="text">发表于</span> <time itemprop="dateCreated datePublished" datetime="2022-08-26T22:42:40+08:00">2022-08-26</time> </span><span class="item" title="本文字数"><span class="icon"><i class="ic i-pen"></i> </span><span class="text">本文字数</span> <span>59k</span> <span class="text">字</span> </span><span class="item" title="阅读时长"><span class="icon"><i class="ic i-clock"></i> </span><span class="text">阅读时长</span> <span>54 分钟</span></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="切换导航栏"><span class="line"></span> <span class="line"></span> <span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">Mi Manchi</a></li></ul><ul class="right"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div id="imgs" class="pjax"><ul><li class="item" data-background-image="https://gitee.com/zkz0/image/raw/master/img/img(22).webp"></li><li class="item" data-background-image="https://gitee.com/zkz0/image/raw/master/img/img(67).webp"></li><li class="item" data-background-image="https://gitee.com/zkz0/image/raw/master/img/img(76).webp"></li><li class="item" data-background-image="https://gitee.com/zkz0/image/raw/master/img/img(92).webp"></li><li class="item" data-background-image="https://gitee.com/zkz0/image/raw/master/img/img(41).webp"></li><li class="item" data-background-image="https://gitee.com/zkz0/image/raw/master/img/img(66).webp"></li></ul></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"/></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"/><use xlink:href="#gentle-wave" x="48" y="3"/><use xlink:href="#gentle-wave" x="48" y="5"/><use xlink:href="#gentle-wave" x="48" y="7"/></g></svg></div><main><div class="inner"><div id="main" class="pjax"><div class="article wrap"><div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i> <span><a href="/">首页</a></span><i class="ic i-angle-right"></i> <span itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/backend/" itemprop="item" rel="index" title="分类于 后端"><span itemprop="name">后端</span></a><meta itemprop="position" content="1"></span><i class="ic i-angle-right"></i> <span class="current" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/backend/django/" itemprop="item" rel="index" title="分类于 django"><span itemprop="name">django</span></a><meta itemprop="position" content="2"></span></div><article itemscope itemtype="http://schema.org/Article" class="post block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://jyuanhust.github.io/2022/08/26/backend/django/DRF%E7%BB%84%E4%BB%B6/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="yuan"><meta itemprop="description" content="Whatever is worth doing at all is worth doing well, "></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="yuan"></span><div class="body md" itemprop="articleBody"><h1 id="drf"><a class="anchor" href="#drf">#</a> DRF</h1><h1 id="web应用模式"><a class="anchor" href="#web应用模式">#</a> Web 应用模式</h1><p>在开发 Web 应用中，有两种应用模式：</p><ol><li>前后端不分离 [客户端看到的内容和所有界面效果都是由服务端提供出来的。]</li></ol><p><img data-src="/./images/DRF/depended_frontend_backend.png" alt="前后端不分离"></p><ol start="2"><li><p>前后端分离【把前端的界面效果 (html，css，js 分离到另一个服务端，python 服务端只需要返回数据即可)】</p><p>前端形成一个独立的网站，服务端构成一个独立的网站</p></li></ol><p><img data-src="/./images/DRF/indepent_frontend_backend-16318493319127.png" alt="前后端分离"></p><h1 id="api接口"><a class="anchor" href="#api接口">#</a> api 接口</h1><p>应用程序编程接口（Application Programming Interface，API 接口），就是应用程序对外提供了一个操作数据的入口，这个入口可以是一个函数或类方法，也可以是一个 url 地址或者一个网络地址。当客户端调用这个入口，应用程序则会执行对应代码操作，给客户端完成相对应的功能。</p><p>当然，api 接口在工作中是比较常见的开发内容，有时候，我们会调用其他人编写的 api 接口，有时候，我们也需要提供 api 接口给其他人操作。由此就会带来一个问题，api 接口往往都是一个函数、类方法、或者 url 或其他网络地址，不断是哪一种，当 api 接口编写过程中，我们都要考虑一个问题就是这个接口应该怎么编写？接口怎么写的更加容易维护和清晰，这就需要大家在调用或者编写 api 接口的时候要有一个明确的编写规范！！！</p><p>为了在团队内部形成共识、防止个人习惯差异引起的混乱，我们都需要找到一种大家都觉得很好的接口实现规范，而且这种规范能够让后端写的接口，用途一目了然，减少客户端和服务端双方之间的合作成本。</p><p>目前市面上大部分公司开发人员使用的接口实现规范主要有：restful、RPC。</p><p>RPC（ Remote Procedure Call ）: 翻译成中文：远程过程调用 [远程服务调用]. 从字面上理解就是访问 / 调用远程服务端提供的 api 接口。这种接口一般以服务或者过程式代码提供。</p><ul><li><p>服务端提供一个<strong>唯一的访问入口地址</strong>：<span class="exturl" data-url="aHR0cDovL2FwaS54eHguY29tLw==">http://api.xxx.com/</span> 或 <span class="exturl" data-url="aHR0cDovL3d3dy54eHguY29tL2FwaQ==">http://www.xxx.com/api</span> 或者基于其他协议的地址</p></li><li><p>客户端请求服务端的时候，所有的操作都理解为动作 (action)，一般 web 开发时，对应的就是 HTTP 请求的 post 请求</p></li><li><p>通过<strong>请求体</strong>参数，指定要调用的接口名称和接口所需的参数</p><blockquote><p>action=get_all_student&amp;class=301&amp;sex=1</p><p>m=get_all_student&amp;sex=1&amp;age=22</p><p>command=100&amp;sex=1&amp;age=22</p></blockquote></li></ul><p>rpc 接口多了，对应函数名和参数就多了，前端在请求 api 接口时难找。对于年代久远的 rpc 服务端的代码也容易出现重复的接口</p><p>restful: 翻译成中文: <strong>资源状态转换</strong>.(表征性状态转移)</p><ul><li><p>把服务端提供的所有的数据 / 文件都看成资源， 那么通过 api 接口请求数据的操作，本质上来说就是对资源的操作了.</p><p>因此，restful 中要求，我们把当前接口对外提供哪种资源进行操作，就把<strong>资源的名称写在 url 地址</strong>。</p></li><li><p>web 开发中操作资源，最常见的最通用的无非就是增删查改，所以 restful 要求在地址栏中声明要操作的资源是什么。然后通过<strong> http 请求动词</strong>来说明对该资源进行哪一种操作. l ,,</p><blockquote><p>POST <span class="exturl" data-url="aHR0cDovL3d3dy54eHguY29tL2FwaS9zdHVkZW50cy8=">http://www.xxx.com/api/students/</span> 添加学生数据</p><p>GET <span class="exturl" data-url="aHR0cDovL3d3dy54eHguY29tL2FwaS9zdHVkZW50cy8=">http://www.xxx.com/api/students/</span> 获取所有学生</p><p>GET <span class="exturl" data-url="aHR0cDovL3d3dy54eHguY29tL2FwaS9zdHVkZW50cy8=">http://www.xxx.com/api/students/</span> <code>&lt;pk&gt;</code> / 获取 id=pk 的学生</p><p>DELETE <span class="exturl" data-url="aHR0cDovL3d3dy54eHguY29tL2FwaS9zdHVkZW50cy8=">http://www.xxx.com/api/students/</span> <code>&lt;pk&gt;</code> / 删除 id=pk 的一个学生</p><p>PUT <span class="exturl" data-url="aHR0cDovL3d3dy54eHguY29tL2FwaS9zdHVkZW50cy8=">http://www.xxx.com/api/students/</span> <code>&lt;pk&gt;</code> / 修改一个学生的全部信息 [id,name,sex,age,]</p><p>PATCH <span class="exturl" data-url="aHR0cDovL3d3dy54eHguY29tL2FwaS9zdHVkZW50cy8=">http://www.xxx.com/api/students/</span> <code>&lt;pk&gt;</code> / 修改一个学生的部分信息 [age]</p></blockquote></li></ul><p>也就是说，我们仅需要通过 url 地址上的资源名称结合 HTTP 请求动作，就可以说明当前 api 接口的功能是什么了。restful 是以资源为主的 api 接口规范，体现在地址上就是资源就是以名词表达。</p><h1 id="restful-api规范"><a class="anchor" href="#restful-api规范">#</a> RESTful API 规范</h1><p><img data-src="/./images/DRF/restful.gif" alt="restful"></p><p>REST 全称是 Representational State Transfer，中文意思是表述（编者注：通常译为表征）性状态转移。 它首次出现在 2000 年 Roy Fielding 的博士论文中。</p><p>RESTful 是一种专门为 Web 开发而定义 API 接口的设计风格，尤其适用于前后端分离的应用模式中。</p><p>这种风格的理念认为后端开发任务就是提供数据的，对外提供的是数据资源的访问接口，所以在定义接口时，客户端访问的 URL 路径就表示这种要操作的数据资源。</p><p>而对于数据资源分别使用 POST、DELETE、GET、UPDATE 等请求动作来表达对数据的增删查改。</p><table><thead><tr><th>GET</th><th>/students</th><th>获取所有学生</th></tr></thead><tbody><tr><td>请求方法</td><td>请求地址</td><td>后端操作</td></tr><tr><td>POST</td><td>/students</td><td>增加学生</td></tr><tr><td>GET</td><td>/students/ <code>&lt;pk&gt;</code></td><td>获取编号为 pk 的学生</td></tr><tr><td>PUT</td><td>/students/ <code>&lt;pk&gt;</code></td><td>修改编号为 pk 的学生</td></tr><tr><td>DELETE</td><td>/students/ <code>&lt;pk&gt;</code></td><td>删除编号为 pk 的学生</td></tr></tbody></table><p>restful 规范是一种通用的规范，不限制语言和开发框架的使用。事实上，我们可以使用任何一门语言，任何一个框架都可以实现符合 restful 规范的 API 接口。</p><p>参考文档：<span class="exturl" data-url="aHR0cDovL3d3dy5ydW5vb2IuY29tL3czY25vdGUvcmVzdGZ1bC1hcmNoaXRlY3R1cmUuaHRtbA==">http://www.runoob.com/w3cnote/restful-architecture.html</span></p><h2 id="幂等性"><a class="anchor" href="#幂等性">#</a> 幂等性</h2><p>接口实现过程中，会存在<strong>幂等性</strong>。所谓幂等性是指代<strong>客户端发起多次同样请求时，是否对于服务端里面的资源产生不同结果</strong>。如果<strong>多次请求</strong>，服务端<strong>结果</strong>还是<strong>一样</strong>，则属于<strong>幂等接口</strong>，如果多次请求，服务端产生结果是不一样的，则属于<strong>非幂等接口</strong>。</p><table><thead><tr><th>请求方式</th><th>是否幂等</th><th>是否安全</th></tr></thead><tbody><tr><td>GET</td><td>幂等</td><td>安全</td></tr><tr><td>POST</td><td>不幂等</td><td>不安全</td></tr><tr><td>PUT/PATCH</td><td>幂等</td><td>不安全</td></tr><tr><td>DELETE</td><td>幂等</td><td>不安全</td></tr></tbody></table><h1 id="序列化"><a class="anchor" href="#序列化">#</a> 序列化</h1><p>api 接口开发，最核心最常见的一个代码编写过程就是序列化，所谓序列化就是把<strong>数据转换格式</strong>。常见的序列化方式：</p><p>json，pickle，base64，….</p><p>序列化可以分两个阶段：</p><p><strong>序列化</strong>： 把我们识别的数据转换成指定的格式提供给别人。</p><p>例如：我们在 django 中获取到的数据默认是模型对象，但是模型对象数据无法直接提供给前端或别的平台使用，所以我们需要把数据进行序列化，变成字符串或者 json 数据，提供给别人。</p><p><strong>反序列化</strong>：把别人提供的数据转换 / 还原成我们需要的格式。</p><p>例如：前端 js 提供过来的 json 数据，对于 python 而言 json 就是字符串，我们需要进行反序列化换成字典，然后接着字典再进行转换成模型对象，这样我们才能把数据保存到数据库中。</p><p><img data-src="/./images/DRF/image-20210826145519130-16318493451108.png" alt="image-20210826145519130"></p><h1 id="django_rest_framework"><a class="anchor" href="#django_rest_framework">#</a> Django_Rest_Framework</h1><p>核心思想：大量缩减编写 api 接口的代码</p><p>Django REST framework 是一个建立在 Django 基础之上的 Web 应用开发框架，可以快速的开发 REST API 接口应用。在 REST framework 中，提供了序列化器 Serialzier 的定义，可以帮助我们简化序列化与反序列化的过程，不仅如此，还提供丰富的类视图、扩展类、视图集来简化视图的编写工作。REST framework 还提供了认证、权限、限流、过滤、分页、接口文档等功能支持。REST framework 提供了一个 API 的 Web 可视化界面来方便查看测试接口。</p><p><img data-src="/./images/DRF/drf_logo-16318493501509.png" alt="drf_logo"></p><p>中文文档：<span class="exturl" data-url="aHR0cHM6Ly9xMW1pLmdpdGh1Yi5pby9EamFuZ28tUkVTVC1mcmFtZXdvcmstZG9jdW1lbnRhdGlvbi8jZGphbmdvLXJlc3QtZnJhbWV3b3Jr">https://q1mi.github.io/Django-REST-framework-documentation/#django-rest-framework</span></p><p>github: <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2VuY29kZS9kamFuZ28tcmVzdC1mcmFtZXdvcmsvdHJlZS9tYXN0ZXI=">https://github.com/encode/django-rest-framework/tree/master</span></p><p>特点</p><blockquote><ul><li>提供了定义序列化器 Serializer 的方法，可以快速根据 Django ORM 或者其它库自动序列化 / 反序列化；</li><li>提供了丰富的类视图、Mixin 扩展类，简化视图的编写；</li><li>丰富的定制层级：函数视图、类视图、视图集合到自动生成 API，满足各种需要；</li><li>多种身份认证和权限认证方式的支持；[jwt]</li><li>内置了限流系统；</li><li>直观的 API web 界面；【方便我们调试开发 api 接口】</li><li>可扩展性，插件丰富</li></ul></blockquote><h1 id="环境安装与配置"><a class="anchor" href="#环境安装与配置">#</a> 环境安装与配置</h1><p>DRF 需要以下依赖：</p><ul><li>Python (3.5 以上)</li><li>Django (2.2 以上)</li></ul><p><strong>DRF 是以 Django 子应用的方式提供的，所以我们可以直接利用已有的 Django 环境而无需从新创建。（若没有 Django 环境，需要先创建环境安装 Django）</strong></p><h2 id="安装drf"><a class="anchor" href="#安装drf">#</a> 安装 DRF</h2><p>前提是已经安装了 django，建议安装在虚拟环境</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># conda create -n drfdemo python=3.8</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment"># pip install django==3.2.4  -i https://pypi.douban.com/simple</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre>pip install djangorestframework <span class="token operator">-</span>i https<span class="token punctuation">:</span><span class="token operator">//</span>pypi<span class="token punctuation">.</span>douban<span class="token punctuation">.</span>com<span class="token operator">/</span>simple</pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token comment"># 因为我们需要接下来，需要开发 api 接口肯定要操作数据，所以安装 pymysql，这是为了操作 mysql 数据库的，可以直接使用内置的 sqlite，因此此步可以省略</span></pre></td></tr><tr><td data-num="7"></td><td><pre>pip install pymysql <span class="token operator">-</span>i https<span class="token punctuation">:</span><span class="token operator">//</span>pypi<span class="token punctuation">.</span>douban<span class="token punctuation">.</span>com<span class="token operator">/</span>simple</pre></td></tr></table></figure><p>linux 复制 shift+insert</p><h3 id="创建django项目"><a class="anchor" href="#创建django项目">#</a> 创建 django 项目</h3><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token builtin class-name">cd</span> ~/Desktop</pre></td></tr><tr><td data-num="2"></td><td><pre>django-admin startproject drfdemo</pre></td></tr></table></figure><p><img data-src="/./images/DRF/1557022536078-163184935984610.png" alt="1557022536078"></p><p>使用 pycharm 打开项目，设置虚拟环境的解析器，并修改 manage.py 中的后缀参数。</p><h2 id="添加rest_framework应用"><a class="anchor" href="#添加rest_framework应用">#</a> 添加 rest_framework 应用</h2><p>在<strong><span class="exturl" data-url="aHR0cDovL3NldHRpbmdzLnB5"> settings.py</span></strong> 的<strong> INSTALLED_APPS</strong> 中添加 'rest_framework'。</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>INSTALLED_APPS <span class="token operator">=</span> <span class="token punctuation">[</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token string">'rest_framework'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">]</span></pre></td></tr></table></figure><p>接下来就可以使用 DRF 提供的功能进行 api 接口开发了。在项目中如果使用 rest_framework 框架实现 API 接口，主要有以下三个步骤：</p><ul><li>将请求的数据（如 JSON 格式）转换为模型类对象</li><li>操作数据库</li><li>将模型类对象转换为响应的数据（如 JSON 格式）</li></ul><p>上面的第一点中，如果请求是向数据库中插入数据，则可以转换为模型类对象；如果是类似于请求某个 id 的行数据，则不是转换为模型类对象，而是根据条件去过滤数据。</p><h2 id="快速体验"><a class="anchor" href="#快速体验">#</a> 快速体验</h2><h3 id="创建子应用"><a class="anchor" href="#创建子应用">#</a> 创建子应用</h3><p>例如，在 django 项目中创建学生子应用。</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>python manage<span class="token punctuation">.</span>py startapp students</pre></td></tr></table></figure><h3 id="创建模型操作类"><a class="anchor" href="#创建模型操作类">#</a> 创建模型操作类</h3><p>在 students 文件夹下的 <code>model.py</code> 模块中</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">from</span> django<span class="token punctuation">.</span>db <span class="token keyword">import</span> models</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">Student</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token comment"># 模型字段</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    name <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">,</span>verbose_name<span class="token operator">=</span><span class="token string">"姓名"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    sex <span class="token operator">=</span> models<span class="token punctuation">.</span>BooleanField<span class="token punctuation">(</span>default<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>verbose_name<span class="token operator">=</span><span class="token string">"性别"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    age <span class="token operator">=</span> models<span class="token punctuation">.</span>IntegerField<span class="token punctuation">(</span>verbose_name<span class="token operator">=</span><span class="token string">"年龄"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    class_null <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span>verbose_name<span class="token operator">=</span><span class="token string">"班级编号"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    description <span class="token operator">=</span> models<span class="token punctuation">.</span>TextField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">,</span>verbose_name<span class="token operator">=</span><span class="token string">"个性签名"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token keyword">class</span> <span class="token class-name">Meta</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="12"></td><td><pre>        db_table<span class="token operator">=</span><span class="token string">"tb_student"</span>  <span class="token comment"># 表的名字，在数据库中表以此名字存在</span></pre></td></tr><tr><td data-num="13"></td><td><pre>        verbose_name <span class="token operator">=</span> <span class="token string">"学生"</span></pre></td></tr><tr><td data-num="14"></td><td><pre>        verbose_name_plural <span class="token operator">=</span> verbose_name</pre></td></tr></table></figure><p>下面的创建 mysql 数据库部分可以省略，此时使用 django 自带的 sqlite</p><p>为了方便测试，所以我们可以先创建一个数据库。</p><pre><code>create database students charset=utf8;
</code></pre><p><img data-src="/./images/DRF/1557023744365-163184936486911.png" alt="1557023744365"></p><h4 id="执行数据迁移"><a class="anchor" href="#执行数据迁移">#</a> 执行数据迁移</h4><p>把 students 子应用添加到 INSTALL_APPS 中</p><p><img data-src="/./images/DRF/1557023819604-163184936832712.png" alt="1557023819604"></p><p>初始化数据库连接</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># 安装 pymysql</span></pre></td></tr><tr><td data-num="2"></td><td><pre>pip install pymysql</pre></td></tr></table></figure><p>主引用中 <code>__init__.py</code> 设置使用 pymysql 作为数据库驱动</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> pymysql</pre></td></tr><tr><td data-num="2"></td><td><pre>pymysql<span class="token punctuation">.</span>install_as_MySQLdb<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>settings.py 配置文件中设置 mysql 的账号密码</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>DATABASES <span class="token operator">=</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token comment"># 'default': &#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token comment">#     'ENGINE': 'django.db.backends.sqlite3',</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token comment">#     'NAME': os.path.join(BASE_DIR, 'db.sqlite3'),</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token comment"># &#125;,</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token string">'default'</span><span class="token punctuation">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        <span class="token string">'ENGINE'</span><span class="token punctuation">:</span> <span class="token string">'django.db.backends.mysql'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        <span class="token string">'NAME'</span><span class="token punctuation">:</span> <span class="token string">"students"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        <span class="token string">"HOST"</span><span class="token punctuation">:</span> <span class="token string">"127.0.0.1"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="10"></td><td><pre>        <span class="token string">"PORT"</span><span class="token punctuation">:</span> <span class="token number">3306</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="11"></td><td><pre>        <span class="token string">"USER"</span><span class="token punctuation">:</span> <span class="token string">"root"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="12"></td><td><pre>        <span class="token string">"PASSWORD"</span><span class="token punctuation">:</span><span class="token string">"123"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>终端下，执行数据迁移。</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>python manage.py makemigrations</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre>python manage.py migrate</pre></td></tr></table></figure><h3 id="创建序列化器"><a class="anchor" href="#创建序列化器">#</a> 创建序列化器</h3><p>在 students 应用目录中新建 serializers.py 用于保存该应用的序列化器。</p><p>创建一个 StudentModelSerializer 用于序列化与反序列化。</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">from</span> rest_framework <span class="token keyword">import</span> serializers</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">from</span> <span class="token punctuation">.</span>models <span class="token keyword">import</span> Student</pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment"># 创建序列化器类，回头会在试图中被调用</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">StudentModelSerializer</span><span class="token punctuation">(</span>serializers<span class="token punctuation">.</span>ModelSerializer<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">class</span> <span class="token class-name">Meta</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        model <span class="token operator">=</span> Student</pre></td></tr><tr><td data-num="8"></td><td><pre>        fields <span class="token operator">=</span> <span class="token string">"__all__"</span></pre></td></tr></table></figure><blockquote><ul><li><strong>model</strong> 指明该序列化器处理的数据字段从模型类 Student 参考生成</li><li><strong>fields</strong> 指明该序列化器包含模型类中的哪些字段，'<strong>all</strong>' 指明包含所有字段</li></ul></blockquote><h3 id="编写视图"><a class="anchor" href="#编写视图">#</a> 编写视图</h3><p>在 students 应用的 views.py 中创建视图 StudentViewSet，这是一个视图集合。</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>viewsets <span class="token keyword">import</span> ModelViewSet</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">from</span> <span class="token punctuation">.</span>models <span class="token keyword">import</span> Student</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">from</span> <span class="token punctuation">.</span>serializers <span class="token keyword">import</span> StudentModelSerializer</pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment"># Create your views here.</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">StudentViewSet</span><span class="token punctuation">(</span>ModelViewSet<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    queryset <span class="token operator">=</span> Student<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    serializer_class <span class="token operator">=</span> StudentModelSerializer</pre></td></tr></table></figure><ul><li><strong>queryset</strong> 指明该视图集在查询数据时使用的查询集</li><li><strong>serializer_class</strong> 指明该视图在进行序列化或反序列化时使用的序列化器</li></ul><h3 id="定义路由"><a class="anchor" href="#定义路由">#</a> 定义路由</h3><p>在 students 应用的 urls.py 中定义路由信息。</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">from</span> <span class="token punctuation">.</span> <span class="token keyword">import</span> views</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>routers <span class="token keyword">import</span> DefaultRouter</pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment"># 路由列表</span></pre></td></tr><tr><td data-num="5"></td><td><pre>urlpatterns <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="6"></td><td><pre>router <span class="token operator">=</span> DefaultRouter<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 可以处理视图的路由器</span></pre></td></tr><tr><td data-num="7"></td><td><pre>router<span class="token punctuation">.</span>register<span class="token punctuation">(</span><span class="token string">'students'</span><span class="token punctuation">,</span> views<span class="token punctuation">.</span>StudentViewSet<span class="token punctuation">)</span>  <span class="token comment"># 向路由器中注册视图集</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre>urlpatterns <span class="token operator">+=</span> router<span class="token punctuation">.</span>urls  <span class="token comment"># 将路由器中的所以路由信息追到到 django 的路由列表中</span></pre></td></tr></table></figure><p>最后把 students 子应用中的路由文件加载到总路由文件中.</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">from</span> django<span class="token punctuation">.</span>contrib <span class="token keyword">import</span> admin</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">from</span> django<span class="token punctuation">.</span>urls <span class="token keyword">import</span> path<span class="token punctuation">,</span>include</pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre>urlpatterns <span class="token operator">=</span> <span class="token punctuation">[</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    path<span class="token punctuation">(</span><span class="token string">'admin/'</span><span class="token punctuation">,</span> admin<span class="token punctuation">.</span>site<span class="token punctuation">.</span>urls<span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    path<span class="token punctuation">(</span><span class="token string">"stu/"</span><span class="token punctuation">,</span>include<span class="token punctuation">(</span><span class="token string">"students.urls"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">]</span></pre></td></tr></table></figure><h3 id="运行测试"><a class="anchor" href="#运行测试">#</a> 运行测试</h3><p>运行当前程序（与运行 Django 一样）</p><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre>python manage.py runserver</pre></td></tr></table></figure><p>在浏览器中输入网址 127.0.0.1:8000，可以看到 DRF 提供的 API Web 浏览页面：</p><p><img data-src="/./images/DRF/1557027948031-163184937325813.png" alt="1557027948031"></p><p>1）点击链接 127.0.0.1:8000/stu/students 可以访问<strong>获取所有数据的接口</strong>，呈现如下页面：</p><p><img data-src="/./images/DRF/1557027878963-163184937853714.png" alt="1557027878963"></p><p>2）在页面底下表单部分填写学生信息，可以访问<strong>添加新学生的接口</strong>，保存学生信息：</p><p><img data-src="/./images/DRF/1557027999506-163184938085015.png" alt="1557027999506"></p><p>点击 POST 后，返回如下页面信息：</p><p><img data-src="/./images/DRF/1557028072470-163184938322216.png" alt="1557028072470"></p><p>3）在浏览器中输入网址 127.0.0.1:8000/stu/students/5/，可以访问<strong>获取单一学生信息的接口</strong>（id 为 5 的学生），呈现如下页面：</p><p><img data-src="/./images/DRF/1557028115925-163184938549417.png" alt="1557028115925"></p><p>4）在页面底部表单中填写学生信息，可以访问<strong>修改学生的接口</strong>：</p><p><img data-src="/./images/DRF/1557028168350-163184938834618.png" alt="1557028168350"></p><p>点击 PUT，返回如下页面信息：</p><p><img data-src="/./images/DRF/1557028208243-163184939093019.png" alt="1557028208243"></p><p>5）点击 DELETE 按钮，可以访问<strong>删除学生的接口</strong>：</p><p><img data-src="/./images/DRF/1557028242637-163184939350020.png" alt="1557028242637"></p><p>返回，如下页面：</p><p><img data-src="/./images/DRF/1557028266190-163184939566321.png" alt="1557028266190"></p><h1 id="apiview视图"><a class="anchor" href="#apiview视图">#</a> APIView 视图</h1><pre><code>rest_framework.views.APIView
</code></pre><p><code>APIView</code> 是 REST framework 提供的所有视图的基类，继承自 Django 的 <code>View</code> 父类。</p><p><code>APIView</code> 与 <code>View</code> 的不同之处在于：</p><blockquote><ul><li>传入到视图方法中的是 REST framework 的 <code>Request</code> 对象，而不是 Django 的 <code>HttpRequeset</code> 对象（此指 get、post 等方法的第二个 request 参数）；</li><li>视图方法可以返回 REST framework 的 <code>Response</code> 对象，视图会为响应数据设置（render）符合前端期望要求的格式；</li><li>任何 <code>APIException</code> 异常都会被捕获到，并且处理成合适格式的响应信息返回给客户端；</li><li>重新声明了一个新的 <code>as_views</code> 方法并在 <code>dispatch()</code> 进行路由分发前，会对请求的客户端进行身份认证、权限检查、流量控制。</li></ul></blockquote><p>APIView 新增了类属性</p><blockquote><ul><li><strong><code>authentication_classes</code> </strong>列表或元组，身份认证类</li><li><strong><code>permissoin_classes</code> </strong>列表或元组，权限检查类</li><li><strong><code>throttle_classes</code> </strong>列表或元祖，流量控制类</li></ul></blockquote><p>在 <code>APIView</code> 中仍以常规的类视图定义方法来实现 <code>get()</code> 、 <code>post()</code> 或者其他请求方式的方法。</p><blockquote><p>掌握 APIView 的请求流程！！！</p></blockquote><p>DRF 在 django 原有的基础上，新增了一个 request 对象继承到了 APIVIew 视图类，并在 django 原有的 HttpResponse 响应类的基础上实现了一个子类 <code>rest_framework.response.Response</code> 响应类。这两个类，都是基于<strong>内容协商</strong>来完成数据的格式转换的。</p><blockquote><p>request-&gt;parser-&gt; 识别客户端请求头中的 Content-Type 来完成数据转换成 -&gt; 类字典 (QueryDict，字典的子类)</p><p>response-&gt;renderer-&gt; 识别客户端请求头的 &quot;Accept&quot; 来提取客户单期望的返回数据格式，-&gt; 转换成客户端的期望格式数据</p></blockquote><h2 id="请求"><a class="anchor" href="#请求">#</a> 请求</h2><p>REST framework 传入视图的 request 对象不再是 Django 默认的 HttpRequest 对象（ <code>from django.http.request import HttpRequest</code> ），而是 REST framework 提供的扩展了 HttpRequest 类的<strong> Request</strong> 类的对象。</p><p>REST framework 提供了<strong> Parser</strong> 解析器，在接收到请求后会自动根据 Content-Type 指明的请求数据类型（如 JSON、表单等）将请求数据进行 parse 解析，解析为类字典 [QueryDict] 对象保存到<strong> Request</strong> 对象中。</p><p><strong>Request 对象的数据是自动根据前端发送数据的格式进行解析之后的结果。</strong></p><p>无论前端发送的哪种格式的数据，我们都可以以统一的方式读取数据。</p><h3 id="常用属性"><a class="anchor" href="#常用属性">#</a> 常用属性</h3><h4 id="data"><a class="anchor" href="#data">#</a> <code>.data</code></h4><p><code>request.data</code> 返回解析之后的请求体数据。类似于 Django 中标准的 <code>request.POST</code> 和 <code>request.FILES</code> 属性，但提供如下特性：</p><ul><li>包含了解析之后的文件和非文件数据</li><li>包含了对 POST、PUT、PATCH 请求方式解析后的数据</li><li>利用了 REST framework 的 parsers 解析器，不仅支持表单类型数据，也支持 JSON 数据</li></ul><h4 id="query_params"><a class="anchor" href="#query_params">#</a> <code>.query_params</code></h4><p><code>request.query_params</code> 与 Django 标准的 <code>request.GET</code> 相同，只是更换了更正确的名称而已。</p><h4 id="request_request"><a class="anchor" href="#request_request">#</a> <code>request._request</code></h4><p>获取 django 封装的 Request 对象</p><h3 id="基本使用"><a class="anchor" href="#基本使用">#</a> 基本使用</h3><p>视图代码：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">from</span> django<span class="token punctuation">.</span>views <span class="token keyword">import</span> View</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">from</span> django<span class="token punctuation">.</span>http<span class="token punctuation">.</span>response <span class="token keyword">import</span> HttpResponse</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">from</span> django<span class="token punctuation">.</span>http<span class="token punctuation">.</span>request <span class="token keyword">import</span> HttpRequest</pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">from</span> django<span class="token punctuation">.</span>core<span class="token punctuation">.</span>handlers<span class="token punctuation">.</span>wsgi <span class="token keyword">import</span> WSGIRequest</pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">ReqView</span><span class="token punctuation">(</span>View<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">get</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        <span class="token keyword">print</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        <span class="token keyword">return</span> HttpResponse<span class="token punctuation">(</span><span class="token string">"ok"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token triple-quoted-string string">"""</span></pre></td></tr><tr><td data-num="11"></td><td><pre>默认情况下, 编写视图类时，如果继承的是django内置的django.view.View视图基类，</pre></td></tr><tr><td data-num="12"></td><td><pre>则视图方法中得到的request对象，是django默认提供的django.core.handlers.wsgi.WSGIRequest</pre></td></tr><tr><td data-num="13"></td><td><pre>WSGIRequest这个请求处理对象，无法直接提供的关于json数据的数据处理。</pre></td></tr><tr><td data-num="14"></td><td><pre>在编写api接口时很不方便，所以drf为了简写这块内容，在原来的HttpRequest的基础上面，新增了一个Request类</pre></td></tr><tr><td data-num="15"></td><td><pre>这个Request类是单独声明的和原来django的HttpRequest不是父子关系。</pre></td></tr><tr><td data-num="16"></td><td><pre>同时注意：</pre></td></tr><tr><td data-num="17"></td><td><pre>   要使用drf提供的Request请求处理对象，必须在编写视图类时继承drf提供的视图基类</pre></td></tr><tr><td data-num="18"></td><td><pre>   from rest_framework.views import APIView</pre></td></tr><tr><td data-num="19"></td><td><pre>   </pre></td></tr><tr><td data-num="20"></td><td><pre>   如果使用drf提供的视图基类APIView编写类视图，则必须使用来自drf提供的Request请求对象和Response响应对象</pre></td></tr><tr><td data-num="21"></td><td><pre>"""</pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>views <span class="token keyword">import</span> APIView</pre></td></tr><tr><td data-num="23"></td><td><pre><span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>response <span class="token keyword">import</span> Response</pre></td></tr><tr><td data-num="24"></td><td><pre><span class="token keyword">from</span> rest_framework <span class="token keyword">import</span> status</pre></td></tr><tr><td data-num="25"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">ReqAPIView</span><span class="token punctuation">(</span>APIView<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="26"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">get</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="27"></td><td><pre>        <span class="token comment"># rest_framework.request.Request 对象</span></pre></td></tr><tr><td data-num="28"></td><td><pre>        <span class="token keyword">print</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span> <span class="token comment"># &lt;rest_framework.request.Request: GET '/req/req2?name=xiaoming&amp;age=17&amp;lve=swim&amp;lve=code'></span></pre></td></tr><tr><td data-num="29"></td><td><pre>        <span class="token comment"># 获取查询字符串</span></pre></td></tr><tr><td data-num="30"></td><td><pre>        <span class="token keyword">print</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>query_params<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="31"></td><td><pre>        <span class="token comment"># 没有参数情况下： &lt;QueryDict: &#123;&#125;></span></pre></td></tr><tr><td data-num="32"></td><td><pre>        <span class="token comment"># 有参数的情况下： &lt;QueryDict: &#123;'name': ['xiaoming'], 'age': ['17'], 'lve': ['swim', 'code']&#125;></span></pre></td></tr><tr><td data-num="33"></td><td><pre>        <span class="token comment"># 所以，request.query_params 的返回值操作和原来在 django 里面是一模一样的</span></pre></td></tr><tr><td data-num="34"></td><td><pre>        <span class="token keyword">print</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>query_params<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># xiaoming</span></pre></td></tr><tr><td data-num="35"></td><td><pre>        <span class="token keyword">print</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>query_params<span class="token punctuation">.</span>getlist<span class="token punctuation">(</span><span class="token string">"lve"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># ['swim', 'code']</span></pre></td></tr><tr><td data-num="36"></td><td><pre></pre></td></tr><tr><td data-num="37"></td><td><pre>        <span class="token keyword">return</span> Response<span class="token punctuation">(</span><span class="token string">"ok"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="38"></td><td><pre></pre></td></tr><tr><td data-num="39"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">post</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="40"></td><td><pre>        <span class="token comment"># 获取请求体</span></pre></td></tr><tr><td data-num="41"></td><td><pre>        <span class="token keyword">print</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>data<span class="token punctuation">)</span> <span class="token comment"># &#123;'name': 'xiaoming', 'age': 16, 'lve': ['swim', 'code']&#125;</span></pre></td></tr><tr><td data-num="42"></td><td><pre>        <span class="token triple-quoted-string string">"""直接从请求体中提取数据转</span></pre></td></tr><tr><td data-num="43"></td><td><pre>        # 客户端如果上传了json数据，直接返回字典</pre></td></tr><tr><td data-num="44"></td><td><pre>        &#123;'name': '灰太狼', 'age': 20, 'sex': 1, 'classmate': '301', 'description': '我还会再回来的~'&#125;</pre></td></tr><tr><td data-num="45"></td><td><pre>        # 客户端如果上传了表单数据，直接返回QueryDict</pre></td></tr><tr><td data-num="46"></td><td><pre>        &lt;QueryDict: &#123;'name': ['xiaohui'], 'age': ['18']&#125;></pre></td></tr><tr><td data-num="47"></td><td><pre>        """</pre></td></tr><tr><td data-num="48"></td><td><pre>        <span class="token keyword">print</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>FILES<span class="token punctuation">)</span> <span class="token comment"># 获取上传文件列表</span></pre></td></tr><tr><td data-num="49"></td><td><pre>  </pre></td></tr><tr><td data-num="50"></td><td><pre>        <span class="token comment"># 要获取 django 原生提供的 HttpRequest 对象，可以通过 request._request 来获取到</span></pre></td></tr><tr><td data-num="51"></td><td><pre>        <span class="token keyword">print</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>_request<span class="token punctuation">.</span>META<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"Accept"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># 当值为 None 时，drf 默认在响应数据时按 json 格式返回</span></pre></td></tr><tr><td data-num="52"></td><td><pre>        <span class="token comment"># response = Response(data="not ok", status=204, headers=&#123;"Company":"Oldboy"&#125;)</span></pre></td></tr><tr><td data-num="53"></td><td><pre>        response <span class="token operator">=</span> Response<span class="token punctuation">(</span>data<span class="token operator">=</span><span class="token string">"not ok"</span><span class="token punctuation">,</span> status<span class="token operator">=</span>status<span class="token punctuation">.</span>HTTP_400_BAD_REQUEST<span class="token punctuation">,</span> headers<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token string">"Company"</span><span class="token punctuation">:</span><span class="token string">"Oldboy"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="54"></td><td><pre>        <span class="token keyword">return</span> response</pre></td></tr></table></figure><h2 id="响应"><a class="anchor" href="#响应">#</a> 响应</h2><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>rest_framework<span class="token punctuation">.</span>response<span class="token punctuation">.</span>Response</pre></td></tr></table></figure><p>REST framework 提供了一个响应类 <code>Response</code> ，使用该类构造响应对象时，响应的具体数据内容会被转换（render 渲染器）成符合前端需求的类型。</p><p>REST framework 提供了 <code>Renderer</code> 渲染器，用来根据请求头中的 <code>Accept</code> （接收数据类型声明）来自动转换响应数据到对应格式。如果前端请求中未进行 Accept 声明，则会采用 Content-Type 方式处理响应数据，我们可以通过配置来修改默认响应格式。</p><p>可以在<strong> rest_framework.settings</strong> 查找所有的 drf 默认配置项</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>REST_FRAMEWORK <span class="token operator">=</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token string">'DEFAULT_RENDERER_CLASSES'</span><span class="token punctuation">:</span> <span class="token punctuation">(</span>  <span class="token comment"># 默认响应渲染类</span></pre></td></tr><tr><td data-num="3"></td><td><pre>        <span class="token string">'rest_framework.renderers.JSONRenderer'</span><span class="token punctuation">,</span>  <span class="token comment"># json 渲染器，返回 json 数据</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        <span class="token string">'rest_framework.renderers.BrowsableAPIRenderer'</span><span class="token punctuation">,</span>  <span class="token comment"># 浏览器 API 渲染器，返回调试界面</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h4 id="构造方式"><a class="anchor" href="#构造方式">#</a> 构造方式</h4><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>Response<span class="token punctuation">(</span>data<span class="token punctuation">,</span> status<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> template_name<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> headers<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> content_type<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>drf 的响应处理类和请求处理类不一样，Response 就是 django 的 HttpResponse 响应处理类的子类。</p><p><code>data</code> 数据不要是 render 处理之后的数据，只需传递 python 的内建类型数据即可，REST framework 会使用 <code>renderer</code> 渲染器处理 <code>data</code> 。</p><p><code>data</code> 不能是复杂结构的数据，如 Django 的模型类对象，对于这样的数据我们可以使用 <code>Serializer</code> 序列化器序列化处理后（转为了 Python 字典类型）再传递给 <code>data</code> 参数。</p><p>参数说明：</p><blockquote><ul><li><code>data</code> : 为响应准备的序列化处理后的数据；</li><li><code>status</code> : 状态码，默认 200；</li><li><code>template_name</code> : 模板名称，如果使用 <code>HTMLRenderer</code> 时需指明；</li><li><code>headers</code> : 用于存放响应头信息的字典；</li><li><code>content_type</code> : 响应数据的 Content-Type，通常此参数无需传递，REST framework 会根据前端所需类型数据来设置该参数</li></ul></blockquote><h4 id="response对象的属性"><a class="anchor" href="#response对象的属性">#</a> response 对象的属性</h4><blockquote><p>.data：传给 response 对象的序列化后，但尚未 render 处理的数据</p><p>.status_code：状态码的数字</p><p>.content：经过 render 处理后的响应数据</p></blockquote><h4 id="状态码"><a class="anchor" href="#状态码">#</a> 状态码</h4><p>为了方便设置状态码，REST framewrok 在 <code>rest_framework.status</code> 模块中提供了常用 http 状态码的常量。</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># 1）信息告知 - 1xx</span></pre></td></tr><tr><td data-num="2"></td><td><pre>HTTP_100_CONTINUE</pre></td></tr><tr><td data-num="3"></td><td><pre>HTTP_101_SWITCHING_PROTOCOLS</pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment"># 2）成功 - 2xx</span></pre></td></tr><tr><td data-num="6"></td><td><pre>HTTP_200_OK</pre></td></tr><tr><td data-num="7"></td><td><pre>HTTP_201_CREATED</pre></td></tr><tr><td data-num="8"></td><td><pre>HTTP_202_ACCEPTED</pre></td></tr><tr><td data-num="9"></td><td><pre>HTTP_203_NON_AUTHORITATIVE_INFORMATION</pre></td></tr><tr><td data-num="10"></td><td><pre>HTTP_204_NO_CONTENT</pre></td></tr><tr><td data-num="11"></td><td><pre>HTTP_205_RESET_CONTENT</pre></td></tr><tr><td data-num="12"></td><td><pre>HTTP_206_PARTIAL_CONTENT</pre></td></tr><tr><td data-num="13"></td><td><pre>HTTP_207_MULTI_STATUS</pre></td></tr><tr><td data-num="14"></td><td><pre></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token comment"># 3）重定向 - 3xx</span></pre></td></tr><tr><td data-num="16"></td><td><pre>HTTP_300_MULTIPLE_CHOICES</pre></td></tr><tr><td data-num="17"></td><td><pre>HTTP_301_MOVED_PERMANENTLY</pre></td></tr><tr><td data-num="18"></td><td><pre>HTTP_302_FOUND</pre></td></tr><tr><td data-num="19"></td><td><pre>HTTP_303_SEE_OTHER</pre></td></tr><tr><td data-num="20"></td><td><pre>HTTP_304_NOT_MODIFIED</pre></td></tr><tr><td data-num="21"></td><td><pre>HTTP_305_USE_PROXY</pre></td></tr><tr><td data-num="22"></td><td><pre>HTTP_306_RESERVED</pre></td></tr><tr><td data-num="23"></td><td><pre>HTTP_307_TEMPORARY_REDIRECT</pre></td></tr><tr><td data-num="24"></td><td><pre></pre></td></tr><tr><td data-num="25"></td><td><pre><span class="token comment"># 4）客户端错误 - 4xx</span></pre></td></tr><tr><td data-num="26"></td><td><pre>HTTP_400_BAD_REQUEST</pre></td></tr><tr><td data-num="27"></td><td><pre>HTTP_401_UNAUTHORIZED</pre></td></tr><tr><td data-num="28"></td><td><pre>HTTP_402_PAYMENT_REQUIRED</pre></td></tr><tr><td data-num="29"></td><td><pre>HTTP_403_FORBIDDEN</pre></td></tr><tr><td data-num="30"></td><td><pre>HTTP_404_NOT_FOUND</pre></td></tr><tr><td data-num="31"></td><td><pre>HTTP_405_METHOD_NOT_ALLOWED</pre></td></tr><tr><td data-num="32"></td><td><pre>HTTP_406_NOT_ACCEPTABLE</pre></td></tr><tr><td data-num="33"></td><td><pre>HTTP_407_PROXY_AUTHENTICATION_REQUIRED</pre></td></tr><tr><td data-num="34"></td><td><pre>HTTP_408_REQUEST_TIMEOUT</pre></td></tr><tr><td data-num="35"></td><td><pre>HTTP_409_CONFLICT</pre></td></tr><tr><td data-num="36"></td><td><pre>HTTP_410_GONE</pre></td></tr><tr><td data-num="37"></td><td><pre>HTTP_411_LENGTH_REQUIRED</pre></td></tr><tr><td data-num="38"></td><td><pre>HTTP_412_PRECONDITION_FAILED</pre></td></tr><tr><td data-num="39"></td><td><pre>HTTP_413_REQUEST_ENTITY_TOO_LARGE</pre></td></tr><tr><td data-num="40"></td><td><pre>HTTP_414_REQUEST_URI_TOO_LONG</pre></td></tr><tr><td data-num="41"></td><td><pre>HTTP_415_UNSUPPORTED_MEDIA_TYPE</pre></td></tr><tr><td data-num="42"></td><td><pre>HTTP_416_REQUESTED_RANGE_NOT_SATISFIABLE</pre></td></tr><tr><td data-num="43"></td><td><pre>HTTP_417_EXPECTATION_FAILED</pre></td></tr><tr><td data-num="44"></td><td><pre>HTTP_422_UNPROCESSABLE_ENTITY</pre></td></tr><tr><td data-num="45"></td><td><pre>HTTP_423_LOCKED</pre></td></tr><tr><td data-num="46"></td><td><pre>HTTP_424_FAILED_DEPENDENCY</pre></td></tr><tr><td data-num="47"></td><td><pre>HTTP_428_PRECONDITION_REQUIRED</pre></td></tr><tr><td data-num="48"></td><td><pre>HTTP_429_TOO_MANY_REQUESTS</pre></td></tr><tr><td data-num="49"></td><td><pre>HTTP_431_REQUEST_HEADER_FIELDS_TOO_LARGE</pre></td></tr><tr><td data-num="50"></td><td><pre>HTTP_451_UNAVAILABLE_FOR_LEGAL_REASONS</pre></td></tr><tr><td data-num="51"></td><td><pre></pre></td></tr><tr><td data-num="52"></td><td><pre><span class="token comment"># 5）服务器错误 - 5xx</span></pre></td></tr><tr><td data-num="53"></td><td><pre>HTTP_500_INTERNAL_SERVER_ERROR</pre></td></tr><tr><td data-num="54"></td><td><pre>HTTP_501_NOT_IMPLEMENTED</pre></td></tr><tr><td data-num="55"></td><td><pre>HTTP_502_BAD_GATEWAY</pre></td></tr><tr><td data-num="56"></td><td><pre>HTTP_503_SERVICE_UNAVAILABLE</pre></td></tr><tr><td data-num="57"></td><td><pre>HTTP_504_GATEWAY_TIMEOUT</pre></td></tr><tr><td data-num="58"></td><td><pre>HTTP_505_HTTP_VERSION_NOT_SUPPORTED</pre></td></tr><tr><td data-num="59"></td><td><pre>HTTP_507_INSUFFICIENT_STORAGE</pre></td></tr><tr><td data-num="60"></td><td><pre>HTTP_511_NETWORK_AUTHENTICATION_REQUIRED</pre></td></tr></table></figure><h1 id="序列化器-serializer"><a class="anchor" href="#序列化器-serializer">#</a> 序列化器 - Serializer</h1><p>作用：</p><pre><code>1. 序列化,序列化器会把模型对象转换成字典,经过response以后变成json字符串
2. 反序列化,把客户端发送过来的数据,经过request以后变成字典,序列化器可以把字典转成模型
3. 反序列化,完成数据校验功能
</code></pre><p>综上，序列化器的主要作用是模型对象和字典之间的转换</p><h2 id="定义序列化器"><a class="anchor" href="#定义序列化器">#</a> 定义序列化器</h2><p>Django REST framework 中的 Serializer 使用类来定义，须继承自 <code>rest_framework.serializers.Serializer</code> 。</p><p>接下来，为了方便演示序列化器的使用，我们先创建一个新的子应用 sers</p><pre><code>python manage.py startapp sers
</code></pre><p>我们创建几个图书相关模型</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">from</span> django<span class="token punctuation">.</span>db <span class="token keyword">import</span> models</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment"># Create your models here.</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">Book</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    title <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">,</span>verbose_name<span class="token operator">=</span><span class="token string">"书籍名称"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    price <span class="token operator">=</span> models<span class="token punctuation">.</span>IntegerField<span class="token punctuation">(</span>verbose_name<span class="token operator">=</span><span class="token string">"价格"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    pub_date <span class="token operator">=</span> models<span class="token punctuation">.</span>DateField<span class="token punctuation">(</span>verbose_name<span class="token operator">=</span><span class="token string">"出版日期"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre>  </pre></td></tr><tr><td data-num="12"></td><td><pre>    bread <span class="token operator">=</span> models<span class="token punctuation">.</span>IntegerField<span class="token punctuation">(</span>verbose_name<span class="token operator">=</span><span class="token string">"阅读量"</span><span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="13"></td><td><pre>    bcomment <span class="token operator">=</span> models<span class="token punctuation">.</span>IntegerField<span class="token punctuation">(</span>verbose_name<span class="token operator">=</span><span class="token string">"评论量"</span><span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="14"></td><td><pre>  </pre></td></tr><tr><td data-num="15"></td><td><pre>    publish <span class="token operator">=</span> models<span class="token punctuation">.</span>ForeignKey<span class="token punctuation">(</span><span class="token string">"Publish"</span><span class="token punctuation">,</span>on_delete<span class="token operator">=</span>models<span class="token punctuation">.</span>CASCADE<span class="token punctuation">,</span>verbose_name<span class="token operator">=</span><span class="token string">"出版社"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token comment"># authors = models.ManyToManyField ("Author",verbose_name="作者")</span></pre></td></tr><tr><td data-num="17"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">__str__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="18"></td><td><pre>        <span class="token keyword">return</span> self<span class="token punctuation">.</span>title</pre></td></tr><tr><td data-num="19"></td><td><pre></pre></td></tr><tr><td data-num="20"></td><td><pre></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">Publish</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="22"></td><td><pre>    name <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">,</span>verbose_name<span class="token operator">=</span><span class="token string">"出版社名称"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="23"></td><td><pre>    email <span class="token operator">=</span> models<span class="token punctuation">.</span>EmailField<span class="token punctuation">(</span>verbose_name<span class="token operator">=</span><span class="token string">"出版社邮箱"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="24"></td><td><pre></pre></td></tr><tr><td data-num="25"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">__str__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="26"></td><td><pre>        <span class="token keyword">return</span> self<span class="token punctuation">.</span>name</pre></td></tr><tr><td data-num="27"></td><td><pre></pre></td></tr><tr><td data-num="28"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">Author</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="29"></td><td><pre>    name <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">,</span>verbose_name<span class="token operator">=</span><span class="token string">"作者"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="30"></td><td><pre>    age <span class="token operator">=</span> models<span class="token punctuation">.</span>IntegerField<span class="token punctuation">(</span>verbose_name<span class="token operator">=</span><span class="token string">"年龄"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="31"></td><td><pre></pre></td></tr><tr><td data-num="32"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">__str__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="33"></td><td><pre>        <span class="token keyword">return</span> self<span class="token punctuation">.</span>name</pre></td></tr></table></figure><p>在创建数据模型之后要执行命令</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>python  manage.py  makemigrations</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre>python   manage.py  migrate</pre></td></tr></table></figure><p>之后数据库中才会出现相应的表。</p><p><img data-src="/./images/DRF%E7%BB%84%E4%BB%B6/1661572652898.png" alt="1661572652898"></p><p>默认补充一个 <code>id</code> 字段作为主键。插入数据时 <code>id</code> 自增，如果删除了 <code>id</code> 值处在中间的行，之后插入的数据的 id 不会使用该 <code>id</code> 值，一样自增的。</p><p>我们想为 Book 模型类提供一个序列化器，可以定义如下：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">from</span> rest_framework <span class="token keyword">import</span> serializers</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">BookSerializer</span><span class="token punctuation">(</span>serializers<span class="token punctuation">.</span>Serializer<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="4"></td><td><pre> </pre></td></tr><tr><td data-num="5"></td><td><pre>    title <span class="token operator">=</span> serializers<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 变量名称和数据模型中的字段名称相同，如果不同就要指定 source 参数</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    price <span class="token operator">=</span> serializers<span class="token punctuation">.</span>IntegerField<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    pub_date <span class="token operator">=</span> serializers<span class="token punctuation">.</span>DateField<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    publish_id <span class="token operator">=</span> serializers<span class="token punctuation">.</span>IntegerField<span class="token punctuation">(</span>write_only<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    publish_name <span class="token operator">=</span> serializers<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>source<span class="token operator">=</span><span class="token string">"publish.name"</span><span class="token punctuation">,</span> read_only<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>  <span class="token comment"># 外键，需要指定 source 参数</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    publish_email <span class="token operator">=</span> serializers<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>source<span class="token operator">=</span><span class="token string">"publish.email"</span><span class="token punctuation">,</span> read_only<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>**<strong> 注意：serializer 不是只能为数据库模型类定义，也可以为非数据库模型类的数据定义</strong>。**serializer 是独立于数据库之外的存在。</p><p><strong>常用字段类型</strong>：</p><table><thead><tr><th>字段</th><th>字段构造方式</th></tr></thead><tbody><tr><td><strong>BooleanField</strong></td><td>BooleanField()</td></tr><tr><td><strong>NullBooleanField</strong></td><td>NullBooleanField()</td></tr><tr><td><strong>CharField</strong></td><td>CharField(max_length=None, min_length=None, allow_blank=False, trim_whitespace=True)</td></tr><tr><td><strong>EmailField</strong></td><td>EmailField(max_length=None, min_length=None, allow_blank=False)</td></tr><tr><td><strong>RegexField</strong></td><td>RegexField(regex, max_length=None, min_length=None, allow_blank=False)</td></tr><tr><td><strong>SlugField</strong></td><td>SlugField(max<em>length=50, min_length=None, allow_blank=False) 正则字段，验证正则模式 [a-zA-Z0-9</em>-]+</td></tr><tr><td><strong>URLField</strong></td><td>URLField(max_length=200, min_length=None, allow_blank=False)</td></tr><tr><td><strong>UUIDField</strong></td><td>UUIDField(format='hex_verbose') format: 1) <code>'hex_verbose'</code> 如 <code>&quot;5ce0e9a5-5ffa-654b-cee0-1238041fb31a&quot;</code> 2） <code>'hex'</code> 如 <code>&quot;5ce0e9a55ffa654bcee01238041fb31a&quot;</code> 3） <code>'int'</code> - 如: <code>&quot;123456789012312313134124512351145145114&quot;</code> 4） <code>'urn'</code> 如: <code>&quot;urn:uuid:5ce0e9a5-5ffa-654b-cee0-1238041fb31a&quot;</code></td></tr><tr><td><strong>IPAddressField</strong></td><td>IPAddressField(protocol='both', unpack_ipv4=False, **options)</td></tr><tr><td><strong>IntegerField</strong></td><td>IntegerField(max_value=None, min_value=None)</td></tr><tr><td><strong>FloatField</strong></td><td>FloatField(max_value=None, min_value=None)</td></tr><tr><td><strong>DecimalField</strong></td><td>DecimalField (max_digits, decimal_places, coerce_to_string=None, max_value=None, min_value=None) max_digits: 最多位数 decimal_palces: 小数点位置</td></tr><tr><td><strong>DateTimeField</strong></td><td>DateTimeField(format=api_settings.DATETIME_FORMAT, input_formats=None)</td></tr><tr><td><strong>DateField</strong></td><td>DateField(format=api_settings.DATE_FORMAT, input_formats=None)</td></tr><tr><td><strong>TimeField</strong></td><td>TimeField(format=api_settings.TIME_FORMAT, input_formats=None)</td></tr><tr><td><strong>DurationField</strong></td><td>DurationField()</td></tr><tr><td><strong>ChoiceField</strong></td><td>ChoiceField (choices) choices 与 Django 的用法相同</td></tr><tr><td><strong>MultipleChoiceField</strong></td><td>MultipleChoiceField(choices)</td></tr><tr><td><strong>FileField</strong></td><td>FileField(max_length=None, allow_empty_file=False, use_url=UPLOADED_FILES_USE_URL)</td></tr><tr><td><strong>ImageField</strong></td><td>ImageField(max_length=None, allow_empty_file=False, use_url=UPLOADED_FILES_USE_URL)</td></tr><tr><td><strong>ListField</strong></td><td>ListField(child=, min_length=None, max_length=None)</td></tr><tr><td><strong>DictField</strong></td><td>DictField(child=)</td></tr></tbody></table><p><strong>选项参数：</strong></p><table><thead><tr><th>参数名称</th><th>作用</th></tr></thead><tbody><tr><td><strong>max_length</strong></td><td>最大长度</td></tr><tr><td><strong>min_lenght</strong></td><td>最小长度</td></tr><tr><td><strong>allow_blank</strong></td><td>是否允许为空</td></tr><tr><td><strong>trim_whitespace</strong></td><td>是否截断空白字符</td></tr><tr><td><strong>max_value</strong></td><td>最小值</td></tr><tr><td><strong>min_value</strong></td><td>最大值</td></tr></tbody></table><p>通用参数：</p><table><thead><tr><th>参数名称</th><th>说明</th></tr></thead><tbody><tr><td><strong>read_only</strong></td><td>表明该字段仅用于序列化输出，默认 False</td></tr><tr><td><strong>write_only</strong></td><td>表明该字段仅用于反序列化输入，默认 False</td></tr><tr><td><strong>required</strong></td><td>表明该字段在反序列化时必须输入，默认 True</td></tr><tr><td><strong>default</strong></td><td>反序列化时使用的默认值</td></tr><tr><td><strong>allow_null</strong></td><td>表明该字段是否允许传入 None，默认 False</td></tr><tr><td><strong>validators</strong></td><td>该字段使用的验证器</td></tr><tr><td><strong>error_messages</strong></td><td>包含错误编号与错误信息的字典</td></tr><tr><td><strong>label</strong></td><td>用于 HTML 展示 API 页面时，显示的字段名称</td></tr><tr><td><strong>help_text</strong></td><td>用于 HTML 展示 API 页面时，显示的字段帮助提示信息</td></tr></tbody></table><h2 id="创建serializer对象"><a class="anchor" href="#创建serializer对象">#</a> 创建 Serializer 对象</h2><p>定义好 Serializer 类后，就可以创建 Serializer 对象了。</p><p>Serializer 的构造方法为：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>Serializer<span class="token punctuation">(</span>instance<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> data<span class="token operator">=</span>empty<span class="token punctuation">,</span> <span class="token operator">**</span>kwarg<span class="token punctuation">)</span></pre></td></tr></table></figure><p>说明：</p><p>1）用于序列化时，将模型类对象传入<strong> instance</strong> 参数</p><p>2）用于反序列化时，将要被反序列化的数据传入<strong> data</strong> 参数</p><p>3）除了 instance 和 data 参数外，在构造 Serializer 对象时，还可通过<strong> context</strong> 参数额外添加数据，如</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>serializer <span class="token operator">=</span> AccountSerializer<span class="token punctuation">(</span>account<span class="token punctuation">,</span> context<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token string">'request'</span><span class="token punctuation">:</span> request<span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p><strong>通过 context 参数附加的数据，可以通过 Serializer 对象的 context 属性获取。</strong></p><blockquote><ol><li>使用序列化器的时候一定要注意，序列化器声明了以后，不会自动执行，需要我们在视图中进行调用才可以。</li><li>序列化器无法直接接收数据，需要我们在视图中创建序列化器对象时把使用的数据传递过来。</li><li>序列化器的字段声明类似于我们前面使用过的表单系统。</li><li>开发 restful api 时，序列化器会帮我们把模型数据转换成字典.</li><li>drf 提供的视图会帮我们把字典转换成 json, 或者把客户端发送过来的数据转换字典.</li></ol></blockquote><h2 id="序列化器的使用"><a class="anchor" href="#序列化器的使用">#</a> 序列化器的使用</h2><p>序列化器的使用分两个阶段：</p><ol><li>处理客户端请求时，使用序列化器可以完成对数据的反序列化。</li><li>处理服务器响应时，使用序列化器可以完成对数据的序列化。</li></ol><h3 id="序列化-2"><a class="anchor" href="#序列化-2">#</a> 序列化</h3><h4 id="基本序列化"><a class="anchor" href="#基本序列化">#</a> 基本序列化</h4><p>《1》 先查询出一个学生对象</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">from</span> sers<span class="token punctuation">.</span>models <span class="token keyword">import</span> Book</pre></td></tr><tr><td data-num="2"></td><td><pre>book <span class="token operator">=</span> Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>get<span class="token punctuation">(</span>pk<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>《2》 构造序列化器对象</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">from</span> <span class="token punctuation">.</span>serializers <span class="token keyword">import</span> BookSerializer</pre></td></tr><tr><td data-num="2"></td><td><pre>bookSer <span class="token operator">=</span> BookSerializer<span class="token punctuation">(</span>instance<span class="token operator">=</span>book<span class="token punctuation">)</span></pre></td></tr></table></figure><p>《3》获取序列化数据</p><p>通过 data 属性可以获取序列化后的数据</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>bookSer<span class="token punctuation">.</span>data </pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment"># &#123;'title': ' 乱世佳人 ', 'price': 335, 'pub_date': '2012-12-12', 'publish_name': ' 苹果出版社 ', 'publish_email': '123@qq.com'&#125;</span></pre></td></tr></table></figure><p><img data-src="/./images/DRF%E7%BB%84%E4%BB%B6/1661574138969.png" alt="1661574138969"></p><p><img data-src="/./images/DRF%E7%BB%84%E4%BB%B6/1661573932843.png" alt="1661573932843"></p><p>现在使用 <code>.data</code> 返回的数据类型是 <code>OrderedDict</code> 。</p><p>通过数据库查找返回的数据类型是有两种，如果只是返回一个对象，其类型是模型类，如 <code>&lt;class 'sers.models.Author'&gt;</code> ，经序列化后的 <code>.data</code> 的类型为 <code>dict</code> ；如果查询数据库返回的多个对象，则</p><p>路由视图代码：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># urls.py</span></pre></td></tr><tr><td data-num="2"></td><td><pre>path<span class="token punctuation">(</span><span class="token string">"sers/"</span><span class="token punctuation">,</span> include<span class="token punctuation">(</span><span class="token string">"sers.urls"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment"># sers.urls</span></pre></td></tr><tr><td data-num="4"></td><td><pre>path<span class="token punctuation">(</span><span class="token string">'books/'</span><span class="token punctuation">,</span> BookView<span class="token punctuation">.</span>as_view<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr></table></figure><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>response <span class="token keyword">import</span> Response</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>views <span class="token keyword">import</span> APIView</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">from</span> <span class="token punctuation">.</span>models <span class="token keyword">import</span> Book</pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">from</span> <span class="token punctuation">.</span>sers <span class="token keyword">import</span> BookSerializer</pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">BookView</span><span class="token punctuation">(</span>APIView<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">get</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        book <span class="token operator">=</span> Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>get<span class="token punctuation">(</span>pk<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre>        bs <span class="token operator">=</span> BookSerializer<span class="token punctuation">(</span>instance<span class="token operator">=</span>book<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre>        <span class="token keyword">return</span> Response<span class="token punctuation">(</span>bs<span class="token punctuation">.</span>data<span class="token punctuation">)</span></pre></td></tr></table></figure><p>上面使用的 bs.data 是什么类型</p><p><img data-src="/./images/DRF/image-20210915135858287-163184940245122.png" alt="image-20210915135858287"></p><p>《5》如果要被序列化的是包含多条数据的查询集 QuerySet，可以通过添加<strong> many=True</strong> 参数补充说明</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">BookView</span><span class="token punctuation">(</span>APIView<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">get</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        <span class="token comment"># book = Book.objects.get(pk=1)</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        books <span class="token operator">=</span> Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre>        bs <span class="token operator">=</span> BookSerializer<span class="token punctuation">(</span>instance<span class="token operator">=</span>books<span class="token punctuation">,</span> many<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        <span class="token keyword">return</span> Response<span class="token punctuation">(</span>bs<span class="token punctuation">.</span>data<span class="token punctuation">)</span></pre></td></tr></table></figure><p>上面使用的 bs.data 是什么类型</p><h4 id="关联字段序列化"><a class="anchor" href="#关联字段序列化">#</a> 关联字段序列化</h4><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">from</span> rest_framework <span class="token keyword">import</span> serializers</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">from</span> <span class="token punctuation">.</span>models <span class="token keyword">import</span> Book<span class="token punctuation">,</span> Publish<span class="token punctuation">,</span> Author</pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">BookRelatedPublish</span><span class="token punctuation">(</span>serializers<span class="token punctuation">.</span>RelatedField<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">to_representation</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        <span class="token keyword">return</span> <span class="token string">"pub-%s"</span> <span class="token operator">%</span> value<span class="token punctuation">.</span>name</pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">BookRelatedAuthor</span><span class="token punctuation">(</span>serializers<span class="token punctuation">.</span>RelatedField<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">to_representation</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="14"></td><td><pre>        <span class="token keyword">return</span> <span class="token string">"author-%s"</span> <span class="token operator">%</span> value<span class="token punctuation">.</span>name</pre></td></tr><tr><td data-num="15"></td><td><pre></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">BookSerializer</span><span class="token punctuation">(</span>serializers<span class="token punctuation">.</span>Serializer<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="17"></td><td><pre>    title <span class="token operator">=</span> serializers<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="18"></td><td><pre>    price <span class="token operator">=</span> serializers<span class="token punctuation">.</span>IntegerField<span class="token punctuation">(</span>required<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="19"></td><td><pre>    pub_date <span class="token operator">=</span> serializers<span class="token punctuation">.</span>DateField<span class="token punctuation">(</span>required<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="20"></td><td><pre>    <span class="token comment"># 序列化关联对象的主键，read_only=True 限制只能做序列化</span></pre></td></tr><tr><td data-num="21"></td><td><pre>    <span class="token comment"># publish = serializers.PrimaryKeyRelatedField(read_only=True) </span></pre></td></tr><tr><td data-num="22"></td><td><pre>    <span class="token comment"># 序列化关联对象的主键，queryset 设置可以反序列化做校验</span></pre></td></tr><tr><td data-num="23"></td><td><pre>    <span class="token comment"># authors = serializers.PrimaryKeyRelatedField(queryset=Author.objects.all(),many=True) </span></pre></td></tr><tr><td data-num="24"></td><td><pre>    <span class="token comment"># publish = serializers.StringRelatedField (read_only=True) # 序列化关联对象的字符串表示形式 即__str__</span></pre></td></tr><tr><td data-num="25"></td><td><pre>    <span class="token comment"># publish = serializers.SlugRelatedField (read_only=True,slug_field="email") # 序列化关联对象的指定字段</span></pre></td></tr><tr><td data-num="26"></td><td><pre>    authors <span class="token operator">=</span> BookRelatedAuthor<span class="token punctuation">(</span>read_only<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>many<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="27"></td><td><pre>    publish <span class="token operator">=</span> BookRelatedPublish<span class="token punctuation">(</span>read_only<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>综上可见，对于外键的序列化有两种方式，</p><h3 id="反序列化"><a class="anchor" href="#反序列化">#</a> 反序列化</h3><h4 id="数据验证"><a class="anchor" href="#数据验证">#</a> 数据验证</h4><p>使用序列化器进行反序列化时，需要对数据进行验证后，才能获取验证成功的数据或保存成模型类对象。</p><p>在获取反序列化的数据前，必须调用 <strong><code>is_valid()</code> </strong>方法进行验证，验证成功返回 True，否则返回 False。</p><p>验证失败，可以通过序列化器对象的<strong> errors</strong> 属性获取错误信息，返回字典，包含了字段和字段的错误。如果是非字段错误，可以通过修改 REST framework 配置中的<strong> NON_FIELD_ERRORS_KEY</strong> 来控制错误字典中的键名。</p><p>验证成功，可以通过序列化器对象的<strong> validated_data</strong> 属性获取数据。</p><p>在定义序列化器时，指明每个字段的序列化类型和选项参数，本身就是一种验证行为。</p><p>通过构造序列化器对象，并将要反序列化的数据传递给 data 构造参数，进而进行验证</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">from</span> sers<span class="token punctuation">.</span>sers <span class="token keyword">import</span> BookSerializer</pre></td></tr><tr><td data-num="2"></td><td><pre>bs <span class="token operator">=</span> BookSerializer<span class="token punctuation">(</span>data<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token string">"title"</span><span class="token punctuation">:</span><span class="token string">"小王子"</span><span class="token punctuation">,</span><span class="token string">"price"</span><span class="token punctuation">:</span><span class="token number">100</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre>bs<span class="token punctuation">.</span>is_valid<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 必须先要 is_valid, 才会有 bs.validated_data 和 bs.errors</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token boolean">False</span></pre></td></tr><tr><td data-num="5"></td><td><pre>bs<span class="token punctuation">.</span>validated_data</pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>bs<span class="token punctuation">.</span>errors</pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token punctuation">&#123;</span><span class="token string">'pub_date'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>ErrorDetail<span class="token punctuation">(</span>string<span class="token operator">=</span><span class="token string">'This field is required.'</span><span class="token punctuation">,</span> code<span class="token operator">=</span><span class="token string">'required'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'publish_id'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>ErrorDetail<span class="token punctuation">(</span>string<span class="token operator">=</span><span class="token string">'This field is required.'</span><span class="token punctuation">,</span> code<span class="token operator">=</span><span class="token string">'required'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p><img data-src="/./images/DRF%E7%BB%84%E4%BB%B6/1661568703186.png" alt="1661568703186"></p><p>从上面的小例子中可以看出， <code>validated_data</code> 的数据类型是 <code>OrderedDict</code></p><blockquote><p>可以设置 required=False 让校验字段可以为空！</p></blockquote><p><code>is_valid()</code> 方法还可以在验证失败时抛出异常 serializers.ValidationError，可以通过传递<strong> raise_exception=True</strong> 参数开启，REST framework 接收到此异常，会向前端返回 HTTP 400 Bad Request 响应。</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># Return a 400 response if the data was invalid.serializer.is_valid(raise_exception=True)</span></pre></td></tr></table></figure><p>如果觉得这些还不够，需要再补充定义验证行为，可以使用以下三种方法：</p><h5 id="validate_字段名"><a class="anchor" href="#validate_字段名">#</a> validate_字段名</h5><p>对 <code>&lt;field_name&gt;</code> 字段进行验证，如</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">BookSerializer</span><span class="token punctuation">(</span>serializers<span class="token punctuation">.</span>Serializer<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    title <span class="token operator">=</span> serializers<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    price <span class="token operator">=</span> serializers<span class="token punctuation">.</span>IntegerField<span class="token punctuation">(</span>required<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    pub_date <span class="token operator">=</span> serializers<span class="token punctuation">.</span>DateField<span class="token punctuation">(</span>required<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">validate_title</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        <span class="token keyword">if</span> <span class="token string">'django'</span> <span class="token keyword">not</span> <span class="token keyword">in</span> value<span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="8"></td><td><pre>            <span class="token keyword">raise</span> serializers<span class="token punctuation">.</span>ValidationError<span class="token punctuation">(</span><span class="token string">"图书不是关于Django的"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        <span class="token keyword">return</span> value</pre></td></tr></table></figure><p>测试</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">from</span> sers<span class="token punctuation">.</span>sers <span class="token keyword">import</span> BookSerializer</pre></td></tr><tr><td data-num="2"></td><td><pre>bs <span class="token operator">=</span> BookSerializer<span class="token punctuation">(</span>data<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token string">"title"</span><span class="token punctuation">:</span><span class="token string">"小王子"</span><span class="token punctuation">,</span><span class="token string">"price"</span><span class="token punctuation">:</span><span class="token number">100</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre>bs<span class="token punctuation">.</span>is_valid<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token boolean">False</span></pre></td></tr><tr><td data-num="5"></td><td><pre>bs<span class="token punctuation">.</span>errors</pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">&#123;</span><span class="token string">'title'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>ErrorDetail<span class="token punctuation">(</span>string<span class="token operator">=</span><span class="token string">'图书不是关于Django的'</span><span class="token punctuation">,</span> code<span class="token operator">=</span><span class="token string">'invalid'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'pub_date'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>ErrorDetail<span class="token punctuation">(</span>string<span class="token operator">=</span><span class="token string">'This field is required.'</span><span class="token punctuation">,</span> code<span class="token operator">=</span><span class="token string">'required'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>还有一种写法：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">def</span> <span class="token function">title_django</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">if</span> <span class="token string">'django'</span> <span class="token keyword">not</span> <span class="token keyword">in</span> value<span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="3"></td><td><pre>        <span class="token keyword">raise</span> serializers<span class="token punctuation">.</span>ValidationError<span class="token punctuation">(</span><span class="token string">"图书不是关于Django的"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">return</span> value</pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">BookSerializer</span><span class="token punctuation">(</span>serializers<span class="token punctuation">.</span>Serializer<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    title <span class="token operator">=</span> serializers<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">,</span>validators<span class="token operator">=</span><span class="token punctuation">[</span>title_django<span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></pre></td></tr></table></figure><h5 id="validate"><a class="anchor" href="#validate">#</a> validate</h5><p>在序列化器中需要同时对多个字段进行比较验证时，可以定义 validate 方法来验证，如</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">BookSerializer</span><span class="token punctuation">(</span>serializers<span class="token punctuation">.</span>Serializer<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    title <span class="token operator">=</span> serializers<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    price <span class="token operator">=</span> serializers<span class="token punctuation">.</span>IntegerField<span class="token punctuation">(</span>required<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    pub_date <span class="token operator">=</span> serializers<span class="token punctuation">.</span>DateField<span class="token punctuation">(</span>required<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre>    bread <span class="token operator">=</span> serializers<span class="token punctuation">.</span>IntegerField<span class="token punctuation">(</span>label<span class="token operator">=</span><span class="token string">'阅读量'</span><span class="token punctuation">,</span> max_value<span class="token operator">=</span><span class="token number">2147483647</span><span class="token punctuation">,</span> min_value<span class="token operator">=</span><span class="token operator">-</span><span class="token number">2147483648</span><span class="token punctuation">,</span> required<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    bcomment <span class="token operator">=</span> serializers<span class="token punctuation">.</span>IntegerField<span class="token punctuation">(</span>label<span class="token operator">=</span><span class="token string">'评论量'</span><span class="token punctuation">,</span> max_value<span class="token operator">=</span><span class="token number">2147483647</span><span class="token punctuation">,</span> min_value<span class="token operator">=</span><span class="token operator">-</span><span class="token number">2147483648</span><span class="token punctuation">,</span> required<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">validate_title</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="11"></td><td><pre>        <span class="token keyword">if</span> <span class="token string">'django'</span> <span class="token keyword">not</span> <span class="token keyword">in</span> value<span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="12"></td><td><pre>            <span class="token keyword">raise</span> serializers<span class="token punctuation">.</span>ValidationError<span class="token punctuation">(</span><span class="token string">"图书不是关于Django的"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="13"></td><td><pre>        <span class="token keyword">return</span> value</pre></td></tr><tr><td data-num="14"></td><td><pre></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">validate</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="16"></td><td><pre>        bread <span class="token operator">=</span> data<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"bread"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="17"></td><td><pre>        bcomment <span class="token operator">=</span> data<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"bcomment"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="18"></td><td><pre>        <span class="token keyword">if</span> bread <span class="token operator">&lt;</span> bcomment<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="19"></td><td><pre>            <span class="token keyword">raise</span> serializers<span class="token punctuation">.</span>ValidationError<span class="token punctuation">(</span><span class="token string">'阅读量小于评论量'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="20"></td><td><pre>        <span class="token keyword">return</span> data</pre></td></tr></table></figure><p>测试</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>bs <span class="token operator">=</span> BookSerializer<span class="token punctuation">(</span>data<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token string">"title"</span><span class="token punctuation">:</span><span class="token string">"Django深入浅出"</span><span class="token punctuation">,</span><span class="token string">"bread"</span><span class="token punctuation">:</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token string">"bcomment"</span><span class="token punctuation">:</span><span class="token number">200</span><span class="token punctuation">,</span><span class="token string">"publish_id"</span><span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre>bs<span class="token punctuation">.</span>is_valid<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token boolean">False</span></pre></td></tr><tr><td data-num="4"></td><td><pre>bs<span class="token punctuation">.</span>errors</pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">&#123;</span><span class="token string">'non_field_errors'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>ErrorDetail<span class="token punctuation">(</span>string<span class="token operator">=</span><span class="token string">'阅读量小于评论量'</span><span class="token punctuation">,</span> code<span class="token operator">=</span><span class="token string">'invalid'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h4 id="反序列化-保存数据"><a class="anchor" href="#反序列化-保存数据">#</a> 反序列化 - 保存数据</h4><p>前面的验证数据成功后，我们可以使用序列化器来完成数据反序列化的过程。这个过程可以把数据转成模型类对象.</p><p>可以通过实现 <code>create()</code> 和 <code>update()</code> 两个方法来实现。</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">BookSerializer</span><span class="token punctuation">(</span>serializers<span class="token punctuation">.</span>Serializer<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token triple-quoted-string string">"""图书数据序列化器"""</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">create</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> validated_data<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="6"></td><td><pre>        <span class="token triple-quoted-string string">"""新建"""</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        <span class="token keyword">return</span> instance</pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">update</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> instance<span class="token punctuation">,</span> validated_data<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="10"></td><td><pre>  </pre></td></tr><tr><td data-num="11"></td><td><pre>        <span class="token keyword">return</span> instance</pre></td></tr></table></figure><p>实现了上述两个方法后，在反序列化数据的时候，就可以通过 <code>save()</code> 方法返回一个数据对象实例了</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>book <span class="token operator">=</span> serializer<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr></table></figure><blockquote><p>1、如果创建序列化器对象的时候，没有传递 instance 实例，则调用 save () 方法的时候，create () 被调用</p><p>2、相反，如果传递了 instance 实例，则调用 save () 方法的时候，update () 被调用。</p></blockquote><p>问题：如果是传递了 instance 实例，那还能传入 data 么？两个都传入的话，序列化器的功能是做什么呢？</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># 路由</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">from</span> django<span class="token punctuation">.</span>urls <span class="token keyword">import</span> path<span class="token punctuation">,</span>re_path <span class="token punctuation">,</span>include</pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">from</span> sers<span class="token punctuation">.</span>views <span class="token keyword">import</span> BookView<span class="token punctuation">,</span>BookDetailView</pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre>urlpatterns <span class="token operator">=</span> <span class="token punctuation">[</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    path<span class="token punctuation">(</span><span class="token string">'books/'</span><span class="token punctuation">,</span> BookView<span class="token punctuation">.</span>as_view<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    re_path<span class="token punctuation">(</span><span class="token string">'books/(?P&lt;pk>\d+)/'</span><span class="token punctuation">,</span> BookDetailView<span class="token punctuation">.</span>as_view<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token punctuation">]</span></pre></td></tr></table></figure><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># 序列化器</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment"># 声明序列化器，所有的序列化器都要直接或者间接继承于 Serializer</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment"># 其中，ModelSerializer 是 Serializer 的子类，ModelSerializer 在 Serializer 的基础上进行了代码简化</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">from</span> rest_framework <span class="token keyword">import</span> serializers</pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">from</span> <span class="token punctuation">.</span>models <span class="token keyword">import</span> Book<span class="token punctuation">,</span> Publish<span class="token punctuation">,</span> Author</pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">BookRelatedPublish</span><span class="token punctuation">(</span>serializers<span class="token punctuation">.</span>RelatedField<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">to_representation</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="12"></td><td><pre>        <span class="token keyword">return</span> <span class="token string">"pub-%s"</span> <span class="token operator">%</span> value<span class="token punctuation">.</span>name</pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">BookRelatedAuthor</span><span class="token punctuation">(</span>serializers<span class="token punctuation">.</span>RelatedField<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="16"></td><td><pre></pre></td></tr><tr><td data-num="17"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">to_representation</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="18"></td><td><pre>        <span class="token keyword">return</span> <span class="token string">"author-%s"</span> <span class="token operator">%</span> value<span class="token punctuation">.</span>name</pre></td></tr><tr><td data-num="19"></td><td><pre></pre></td></tr><tr><td data-num="20"></td><td><pre></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">BookSerializer</span><span class="token punctuation">(</span>serializers<span class="token punctuation">.</span>Serializer<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="22"></td><td><pre>    title <span class="token operator">=</span> serializers<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="23"></td><td><pre>    price <span class="token operator">=</span> serializers<span class="token punctuation">.</span>IntegerField<span class="token punctuation">(</span>required<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="24"></td><td><pre>    pub_date <span class="token operator">=</span> serializers<span class="token punctuation">.</span>DateField<span class="token punctuation">(</span>required<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="25"></td><td><pre>  </pre></td></tr><tr><td data-num="26"></td><td><pre>     <span class="token comment"># 包含 queryset 参数时，将被用作反序列化时参数校验使用</span></pre></td></tr><tr><td data-num="27"></td><td><pre>     <span class="token comment"># queryset 将关联模型的所有数据传递给这个属性就可以</span></pre></td></tr><tr><td data-num="28"></td><td><pre>    publish <span class="token operator">=</span> serializers<span class="token punctuation">.</span>PrimaryKeyRelatedField<span class="token punctuation">(</span>queryset<span class="token operator">=</span>Publish<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># queryset 用于反序列化做校验</span></pre></td></tr><tr><td data-num="29"></td><td><pre>    authors <span class="token operator">=</span> serializers<span class="token punctuation">.</span>PrimaryKeyRelatedField<span class="token punctuation">(</span>queryset<span class="token operator">=</span>Author<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> many<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="30"></td><td><pre></pre></td></tr><tr><td data-num="31"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">create</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> validated_data<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="32"></td><td><pre>        <span class="token triple-quoted-string string">"""新建"""</span></pre></td></tr><tr><td data-num="33"></td><td><pre>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"validated_data:"</span><span class="token punctuation">,</span> validated_data<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="34"></td><td><pre>        authors <span class="token operator">=</span> validated_data<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token string">"authors"</span><span class="token punctuation">)</span>  <span class="token comment"># pop 中传入键的名称，结果是删除该键值对，并返回该键对应的值</span></pre></td></tr><tr><td data-num="35"></td><td><pre></pre></td></tr><tr><td data-num="36"></td><td><pre>        book <span class="token operator">=</span> Book<span class="token punctuation">(</span><span class="token operator">**</span>validated_data<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="37"></td><td><pre>        book<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="38"></td><td><pre>        book<span class="token punctuation">.</span>authors<span class="token punctuation">.</span><span class="token builtin">set</span><span class="token punctuation">(</span>authors<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="39"></td><td><pre>        <span class="token keyword">return</span> book</pre></td></tr><tr><td data-num="40"></td><td><pre></pre></td></tr><tr><td data-num="41"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">update</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> instance<span class="token punctuation">,</span> validated_data<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="42"></td><td><pre>        <span class="token triple-quoted-string string">"""更新，instance为要更新的对象实例"""</span></pre></td></tr><tr><td data-num="43"></td><td><pre>        authors <span class="token operator">=</span> validated_data<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token string">"authors"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="44"></td><td><pre>        <span class="token keyword">for</span> attr<span class="token punctuation">,</span> value <span class="token keyword">in</span> validated_data<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="45"></td><td><pre>            <span class="token builtin">setattr</span><span class="token punctuation">(</span>instance<span class="token punctuation">,</span> attr<span class="token punctuation">,</span> value<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="46"></td><td><pre>        instance<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="47"></td><td><pre></pre></td></tr><tr><td data-num="48"></td><td><pre>        instance<span class="token punctuation">.</span>authors<span class="token punctuation">.</span><span class="token builtin">set</span><span class="token punctuation">(</span>authors<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="49"></td><td><pre></pre></td></tr><tr><td data-num="50"></td><td><pre>        <span class="token keyword">return</span> instance</pre></td></tr></table></figure><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># 视图函数</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment"># Create your views here.</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>response <span class="token keyword">import</span> Response</pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>views <span class="token keyword">import</span> APIView</pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">from</span> <span class="token punctuation">.</span>models <span class="token keyword">import</span> Book</pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token keyword">from</span> <span class="token punctuation">.</span>sers <span class="token keyword">import</span> BookSerializer</pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">BookView</span><span class="token punctuation">(</span>APIView<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">get</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="15"></td><td><pre>        <span class="token comment"># book = Book.objects.get(pk=1)</span></pre></td></tr><tr><td data-num="16"></td><td><pre>        books <span class="token operator">=</span> Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="17"></td><td><pre>        bs <span class="token operator">=</span> BookSerializer<span class="token punctuation">(</span>instance<span class="token operator">=</span>books<span class="token punctuation">,</span> many<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="18"></td><td><pre>        <span class="token keyword">return</span> Response<span class="token punctuation">(</span>bs<span class="token punctuation">.</span>data<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="19"></td><td><pre></pre></td></tr><tr><td data-num="20"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">post</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="21"></td><td><pre>        bs <span class="token operator">=</span> BookSerializer<span class="token punctuation">(</span>data<span class="token operator">=</span>request<span class="token punctuation">.</span>data<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="22"></td><td><pre>        <span class="token keyword">if</span> bs<span class="token punctuation">.</span>is_valid<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="23"></td><td><pre>            bs<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="24"></td><td><pre>            <span class="token keyword">return</span> Response<span class="token punctuation">(</span>bs<span class="token punctuation">.</span>data<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="25"></td><td><pre>        <span class="token keyword">else</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="26"></td><td><pre>            <span class="token keyword">return</span> Response<span class="token punctuation">(</span>bs<span class="token punctuation">.</span>errors<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="27"></td><td><pre></pre></td></tr><tr><td data-num="28"></td><td><pre></pre></td></tr><tr><td data-num="29"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">BookDetailView</span><span class="token punctuation">(</span>APIView<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="30"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">get</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> pk<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="31"></td><td><pre>        book <span class="token operator">=</span> Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>get<span class="token punctuation">(</span>pk<span class="token operator">=</span>pk<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="32"></td><td><pre>        bs <span class="token operator">=</span> BookSerializer<span class="token punctuation">(</span>instance<span class="token operator">=</span>book<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="33"></td><td><pre>        <span class="token keyword">return</span> Response<span class="token punctuation">(</span>bs<span class="token punctuation">.</span>data<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="34"></td><td><pre></pre></td></tr><tr><td data-num="35"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">put</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> pk<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="36"></td><td><pre>        instance <span class="token operator">=</span> Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>get<span class="token punctuation">(</span>pk<span class="token operator">=</span>pk<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="37"></td><td><pre>        bs <span class="token operator">=</span> BookSerializer<span class="token punctuation">(</span>instance<span class="token operator">=</span>instance<span class="token punctuation">,</span> data<span class="token operator">=</span>request<span class="token punctuation">.</span>data<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="38"></td><td><pre>        <span class="token keyword">if</span> bs<span class="token punctuation">.</span>is_valid<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="39"></td><td><pre>            bs<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="40"></td><td><pre>            <span class="token keyword">return</span> Response<span class="token punctuation">(</span>bs<span class="token punctuation">.</span>data<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="41"></td><td><pre>        <span class="token keyword">else</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="42"></td><td><pre>            <span class="token keyword">return</span> Response<span class="token punctuation">(</span>bs<span class="token punctuation">.</span>errors<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="43"></td><td><pre></pre></td></tr><tr><td data-num="44"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">delete</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> pk<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="45"></td><td><pre>        instance <span class="token operator">=</span> Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>get<span class="token punctuation">(</span>pk<span class="token operator">=</span>pk<span class="token punctuation">)</span><span class="token punctuation">.</span>delete<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="46"></td><td><pre>        <span class="token keyword">return</span> Response<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p><img data-src="/./images/DRF/image-20210915170712772-163184941178623.png" alt="image-20210915170712772"></p><h4 id="附加说明"><a class="anchor" href="#附加说明">#</a> 附加说明</h4><p>1） 在对序列化器进行 <code>save()</code> 保存时，可以额外传递数据，这些数据可以在 <code>create()</code> 和 <code>update()</code> 中的 <code>validated_data</code> 参数获取到</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># request.user 是 django 中记录当前登录用户的模型对象 serializer.save (owner=request.user)</span></pre></td></tr></table></figure><p>2）默认序列化器必须传递所有 required 的字段，否则会抛出验证异常。但是我们可以使用 partial 参数来允许部分字段更新</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># Update `comment` with partial dataserializer = CommentSerializer(comment, data=&#123;'content': u'foo bar'&#125;, partial=True)</span></pre></td></tr></table></figure><h3 id="模型类序列化器"><a class="anchor" href="#模型类序列化器">#</a> 模型类序列化器</h3><p>如果我们想要使用序列化器对应的是 Django 的模型类，DRF 为我们提供了 ModelSerializer 模型类序列化器来帮助我们快速创建一个 Serializer 类。</p><p>ModelSerializer 与常规的 Serializer 相同，但提供了：</p><ul><li>基于模型类自动生成一系列字段</li><li>基于模型类自动为 Serializer 生成 validators，比如 unique_together</li><li>包含默认的 create () 和 update () 的实现</li></ul><h4 id="定义"><a class="anchor" href="#定义">#</a> 定义</h4><p>比如我们创建一个 BookInfoSerializer</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">BookSerializer</span><span class="token punctuation">(</span>serializers<span class="token punctuation">.</span>ModelSerializer<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token triple-quoted-string string">"""图书数据序列化器"""</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">class</span> <span class="token class-name">Meta</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        model <span class="token operator">=</span> Book</pre></td></tr><tr><td data-num="5"></td><td><pre>        fields <span class="token operator">=</span> <span class="token string">'__all__'</span></pre></td></tr></table></figure><ul><li>model 指明参照哪个模型类</li><li>fields 指明为模型类的哪些字段生成</li></ul><p>我们可以在 python <span class="exturl" data-url="aHR0cDovL21hbmFnZS5weQ==">manage.py</span> shell 中查看自动生成的 BookSerializer 的具体实现</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">from</span> sers<span class="token punctuation">.</span>sers <span class="token keyword">import</span> BookSerializer</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> serializer <span class="token operator">=</span> BookSerializer<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> serializer</pre></td></tr><tr><td data-num="4"></td><td><pre>BookSerializer<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token builtin">id</span> <span class="token operator">=</span> IntegerField<span class="token punctuation">(</span>label<span class="token operator">=</span><span class="token string">'ID'</span><span class="token punctuation">,</span> read_only<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    title <span class="token operator">=</span> CharField<span class="token punctuation">(</span>label<span class="token operator">=</span><span class="token string">'书籍名称'</span><span class="token punctuation">,</span> max_length<span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    price <span class="token operator">=</span> IntegerField<span class="token punctuation">(</span>label<span class="token operator">=</span><span class="token string">'价格'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    pub_date <span class="token operator">=</span> DateField<span class="token punctuation">(</span>label<span class="token operator">=</span><span class="token string">'出版日期'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    bread <span class="token operator">=</span> IntegerField<span class="token punctuation">(</span>required<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    bcomment <span class="token operator">=</span> IntegerField<span class="token punctuation">(</span>required<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    publish <span class="token operator">=</span> PrimaryKeyRelatedField<span class="token punctuation">(</span>label<span class="token operator">=</span><span class="token string">'出版社'</span><span class="token punctuation">,</span> queryset<span class="token operator">=</span>Publish<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    authors <span class="token operator">=</span> PrimaryKeyRelatedField<span class="token punctuation">(</span>allow_empty<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">'作者'</span><span class="token punctuation">,</span> many<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> queryset<span class="token operator">=</span>Author<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token operator">>></span><span class="token operator">></span></pre></td></tr></table></figure><p><img data-src="/./images/DRF/image-20210915154133161-163184941520724.png" alt="image-20210915154133161"></p><h4 id="指定字段"><a class="anchor" href="#指定字段">#</a> 指定字段</h4><ol><li>使用<strong> fields</strong> 来明确字段， <code>__all__</code> 表名包含所有字段，也可以写明具体哪些字段，如</li></ol><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">BookSerializer</span><span class="token punctuation">(</span>serializers<span class="token punctuation">.</span>ModelSerializer<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token triple-quoted-string string">"""图书数据序列化器"""</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">class</span> <span class="token class-name">Meta</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        model <span class="token operator">=</span> BookInfo</pre></td></tr><tr><td data-num="5"></td><td><pre>        fields <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">'id'</span><span class="token punctuation">,</span> <span class="token string">'title'</span><span class="token punctuation">,</span> <span class="token string">'pub_date'</span><span class="token punctuation">)</span></pre></td></tr></table></figure><ol start="2"><li>使用<strong> exclude</strong> 可以明确排除掉哪些字段</li></ol><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">BookSerializer</span><span class="token punctuation">(</span>serializers<span class="token punctuation">.</span>ModelSerializer<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token triple-quoted-string string">"""图书数据序列化器"""</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">class</span> <span class="token class-name">Meta</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        model <span class="token operator">=</span> Book</pre></td></tr><tr><td data-num="5"></td><td><pre>        exclude <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">'pub_date'</span><span class="token punctuation">,</span><span class="token punctuation">)</span></pre></td></tr></table></figure><ol start="3"><li>指明只读字段</li></ol><p>可以通过<strong> read_only_fields</strong> 指明只读字段，即仅用于序列化输出的字段</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">BookSerializer</span><span class="token punctuation">(</span>serializers<span class="token punctuation">.</span>ModelSerializer<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token triple-quoted-string string">"""图书数据序列化器"""</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">class</span> <span class="token class-name">Meta</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        model <span class="token operator">=</span> Book</pre></td></tr><tr><td data-num="5"></td><td><pre>        fields <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">'id'</span><span class="token punctuation">,</span> <span class="token string">'title'</span><span class="token punctuation">,</span> <span class="token string">'pub_date'</span>， <span class="token string">'bread'</span><span class="token punctuation">,</span> <span class="token string">'bcomment'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre>        read_only_fields <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">'id'</span><span class="token punctuation">,</span> <span class="token string">'bread'</span><span class="token punctuation">,</span> <span class="token string">'bcomment'</span><span class="token punctuation">)</span></pre></td></tr></table></figure><h4 id="添加额外参数"><a class="anchor" href="#添加额外参数">#</a> 添加额外参数</h4><p>我们可以使用<strong> extra_kwargs</strong> 参数为 ModelSerializer 添加或修改原有的选项参数</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">BookSerializer</span><span class="token punctuation">(</span>serializers<span class="token punctuation">.</span>ModelSerializer<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token triple-quoted-string string">"""图书数据序列化器"""</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">class</span> <span class="token class-name">Meta</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        model <span class="token operator">=</span> Book</pre></td></tr><tr><td data-num="5"></td><td><pre>        fields <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">'id'</span><span class="token punctuation">,</span> <span class="token string">'title'</span><span class="token punctuation">,</span> <span class="token string">'pub_date'</span><span class="token punctuation">,</span> <span class="token string">'bread'</span><span class="token punctuation">,</span> <span class="token string">'bcomment'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre>        extra_kwargs <span class="token operator">=</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>            <span class="token string">'bread'</span><span class="token punctuation">:</span> <span class="token punctuation">&#123;</span><span class="token string">'min_value'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">'required'</span><span class="token punctuation">:</span> <span class="token boolean">True</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="8"></td><td><pre>            <span class="token string">'bcomment'</span><span class="token punctuation">:</span> <span class="token punctuation">&#123;</span><span class="token string">'min_value'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">'required'</span><span class="token punctuation">:</span> <span class="token boolean">True</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token triple-quoted-string string">'''</span></pre></td></tr><tr><td data-num="11"></td><td><pre>BookSerializer():</pre></td></tr><tr><td data-num="12"></td><td><pre>    id = IntegerField(label='ID', read_only=True)</pre></td></tr><tr><td data-num="13"></td><td><pre>    title = CharField(label='书籍名称', max_length=32)</pre></td></tr><tr><td data-num="14"></td><td><pre>    pub_date = DateField(label='出版日期')</pre></td></tr><tr><td data-num="15"></td><td><pre>    bread = IntegerField(min_value=0, required=True)</pre></td></tr><tr><td data-num="16"></td><td><pre>    bcomment = IntegerField(min_value=0, required=True)</pre></td></tr><tr><td data-num="17"></td><td><pre></pre></td></tr><tr><td data-num="18"></td><td><pre>'''</pre></td></tr></table></figure><p><span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3F5Zl9fMTIzL2FydGljbGUvZGV0YWlscy84NDk5MjcyMQ==">参考文章</span></p><h1 id="视图"><a class="anchor" href="#视图">#</a> 视图</h1><p>Django REST framwork 提供的视图的主要作用：</p><ul><li>控制序列化器的执行（检验、保存、转换数据）</li><li>控制数据库模型的操作</li></ul><p>REST framework 提供了众多的通用视图基类与扩展类，以简化视图的编写。</p><h2 id="两个视图基类"><a class="anchor" href="#两个视图基类">#</a> 两个视图基类</h2><h3 id="apiview基本视图类"><a class="anchor" href="#apiview基本视图类">#</a> APIView [基本视图类]</h3><h3 id="genericapiview通用视图类"><a class="anchor" href="#genericapiview通用视图类">#</a> GenericAPIView [通用视图类]</h3><p>通用视图类主要作用就是把视图中的独特的代码抽取出来，让视图方法中的代码更加通用，方便把通用代码进行简写。</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>rest_framework<span class="token punctuation">.</span>generics<span class="token punctuation">.</span>GenericAPIView</pre></td></tr></table></figure><p>继承自 <code>APIView</code> ，<strong>主要增加了操作序列化器和数据库查询的方法，作用是为下面 Mixin 扩展类的执行提供方法支持。通常在使用时，可搭配一个或多个 Mixin 扩展类。</strong></p><p><strong>提供的关于序列化器使用的属性与方法</strong></p><h4 id="get_serializer_classself"><a class="anchor" href="#get_serializer_classself">#</a> get_serializer_class(self)</h4><p>当出现一个视图类中调用多个序列化器时，那么可以通过条件判断在 get_serializer_class 方法中通过返回不同的序列化器类名就可以让视图方法执行不同的序列化器对象了。</p><p>返回序列化器类，默认返回 <code>serializer_class</code> ，可以重写</p><h4 id="get_serializerself-args-kwargs"><a class="anchor" href="#get_serializerself-args-kwargs">#</a> get_serializer(self, *args, **kwargs)</h4><p>返回序列化器对象，主要用来提供给 Mixin 扩展类使用，如果我们在视图中想要获取序列化器对象，也可以直接调用此方法。</p><p><strong>注意，该方法在提供序列化器对象的时候，会向序列化器对象的 context 属性补充三个数据：request、format、view，这三个数据对象可以在定义序列化器时使用。</strong></p><ul><li><strong>request</strong> 当前视图的请求对象</li><li><strong>view</strong> 当前请求的类视图对象</li><li><strong>format</strong> 当前请求期望返回的数据格式</li></ul><h4 id="get_querysetself"><a class="anchor" href="#get_querysetself">#</a> get_queryset(self)</h4><p>返回视图使用的查询集，主要用来提供给 Mixin 扩展类使用，是列表视图与详情视图获取数据的基础，默认返回 <code>queryset</code> 属性，可以重写，例如：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">def</span> <span class="token function">get_queryset</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    user <span class="token operator">=</span> self<span class="token punctuation">.</span>request<span class="token punctuation">.</span>user</pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">return</span> user<span class="token punctuation">.</span>accounts<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr></table></figure><h4 id="get_objectself"><a class="anchor" href="#get_objectself">#</a> get_object(self)</h4><p>返回详情视图所需的模型类数据对象，主要用来提供给 Mixin 扩展类使用。</p><p>在试图中可以调用该方法获取详情信息的模型类对象。</p><p><strong>若详情访问的模型类对象不存在，会返回 404。</strong></p><p>该方法会默认使用 APIView 提供的 check_object_permissions 方法检查当前对象是否有权限被访问。</p><p>举例：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># url(r'^books/(?P&lt;pk>\d+)/$', views.BookDetailView.as_view()),</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">BookDetailView</span><span class="token punctuation">(</span>GenericAPIView<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    queryset <span class="token operator">=</span> BookInfo<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    serializer_class <span class="token operator">=</span> BookInfoSerializer</pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">get</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> pk<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        book <span class="token operator">=</span> self<span class="token punctuation">.</span>get_object<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># get_object () 方法根据 pk 参数查找 queryset 中的数据对象</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        serializer <span class="token operator">=</span> self<span class="token punctuation">.</span>get_serializer<span class="token punctuation">(</span>book<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        <span class="token keyword">return</span> Response<span class="token punctuation">(</span>serializer<span class="token punctuation">.</span>data<span class="token punctuation">)</span></pre></td></tr></table></figure><p>其他可以设置的属性</p><ul><li><strong>pagination_class</strong> 指明分页控制类</li><li><strong>filter_backends</strong> 指明过滤控制后端</li></ul><p><strong>通用视图类的应用</strong></p><p>为了方便学习上面的 GenericAPIView 通用视图类，我们新建一个子应用。</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>python manage<span class="token punctuation">.</span>py startapp gen</pre></td></tr></table></figure><p>路由和视图代码分别为：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># 路由</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">from</span> django<span class="token punctuation">.</span>contrib <span class="token keyword">import</span> admin</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">from</span> django<span class="token punctuation">.</span>urls <span class="token keyword">import</span> path<span class="token punctuation">,</span> include</pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre>urlpatterns <span class="token operator">=</span> <span class="token punctuation">[</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    path<span class="token punctuation">(</span><span class="token string">'admin/'</span><span class="token punctuation">,</span> admin<span class="token punctuation">.</span>site<span class="token punctuation">.</span>urls<span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    path<span class="token punctuation">(</span><span class="token string">"gen/"</span><span class="token punctuation">,</span> include<span class="token punctuation">(</span><span class="token string">"gen.urls"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token comment"># 子路由</span></pre></td></tr></table></figure><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">from</span> rest_framework <span class="token keyword">import</span> status</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>generics <span class="token keyword">import</span> GenericAPIView</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>response <span class="token keyword">import</span> Response</pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">from</span> sers<span class="token punctuation">.</span>models <span class="token keyword">import</span> Book</pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">from</span> <span class="token punctuation">.</span>sers <span class="token keyword">import</span> BookSerializer</pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">BookView</span><span class="token punctuation">(</span>GenericAPIView<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    queryset <span class="token operator">=</span> Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    serializer_class <span class="token operator">=</span> BookSerializer</pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">get</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="14"></td><td><pre>        bs <span class="token operator">=</span> BookSerializer<span class="token punctuation">(</span>instance<span class="token operator">=</span>self<span class="token punctuation">.</span>get_queryset<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> many<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="15"></td><td><pre>        <span class="token keyword">return</span> Response<span class="token punctuation">(</span>bs<span class="token punctuation">.</span>data<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="16"></td><td><pre></pre></td></tr><tr><td data-num="17"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">post</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="18"></td><td><pre>        serializer <span class="token operator">=</span> self<span class="token punctuation">.</span>get_serializer<span class="token punctuation">(</span>data<span class="token operator">=</span>request<span class="token punctuation">.</span>data<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="19"></td><td><pre>        serializer<span class="token punctuation">.</span>is_valid<span class="token punctuation">(</span>raise_exception<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="20"></td><td><pre>        serializer<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="21"></td><td><pre>        <span class="token keyword">return</span> Response<span class="token punctuation">(</span>serializer<span class="token punctuation">.</span>data<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="22"></td><td><pre></pre></td></tr><tr><td data-num="23"></td><td><pre></pre></td></tr><tr><td data-num="24"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">BookDetailView</span><span class="token punctuation">(</span>GenericAPIView<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="25"></td><td><pre>    queryset <span class="token operator">=</span> Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="26"></td><td><pre>    serializer_class <span class="token operator">=</span> BookSerializer</pre></td></tr><tr><td data-num="27"></td><td><pre></pre></td></tr><tr><td data-num="28"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">get</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> pk<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="29"></td><td><pre>        bs <span class="token operator">=</span> BookSerializer<span class="token punctuation">(</span>instance<span class="token operator">=</span>self<span class="token punctuation">.</span>get_object<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="30"></td><td><pre>        <span class="token keyword">return</span> Response<span class="token punctuation">(</span>bs<span class="token punctuation">.</span>data<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="31"></td><td><pre></pre></td></tr><tr><td data-num="32"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">put</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> pk<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="33"></td><td><pre>        serializer <span class="token operator">=</span> BookSerializer<span class="token punctuation">(</span>instance<span class="token operator">=</span>self<span class="token punctuation">.</span>get_object<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> data<span class="token operator">=</span>request<span class="token punctuation">.</span>data<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="34"></td><td><pre>        serializer<span class="token punctuation">.</span>is_valid<span class="token punctuation">(</span>raise_exception<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="35"></td><td><pre>        serializer<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="36"></td><td><pre>        <span class="token keyword">return</span> Response<span class="token punctuation">(</span>serializer<span class="token punctuation">.</span>data<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="37"></td><td><pre></pre></td></tr><tr><td data-num="38"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">delete</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> pk<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="39"></td><td><pre>        self<span class="token punctuation">.</span>get_object<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>delete<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="40"></td><td><pre>        <span class="token keyword">return</span> Response<span class="token punctuation">(</span>status<span class="token operator">=</span>status<span class="token punctuation">.</span>HTTP_204_NO_CONTENT<span class="token punctuation">)</span></pre></td></tr></table></figure><h2 id="5个视图扩展类"><a class="anchor" href="#5个视图扩展类">#</a> 5 个视图扩展类</h2><p>也叫混入类（Mixin）。</p><p>作用：</p><p>提供了几种后端视图（对数据资源进行增删改查）处理流程的实现，如果需要编写的视图属于这五种，则视图可以通过继承相应的扩展类来复用代码，减少自己编写的代码量。</p><p>这五个扩展类需要搭配 GenericAPIView 通用视图基类，因为五个扩展类的实现需要调用 GenericAPIView 提供的序列化器与数据库查询的方法。</p><h4 id="listmodelmixin"><a class="anchor" href="#listmodelmixin">#</a> ListModelMixin</h4><p>列表视图扩展类，提供 <code>list(request, *args, **kwargs)</code> 方法快速实现列表视图，返回 200 状态码。</p><p>该 Mixin 的 list 方法会对数据进行过滤和分页。</p><p>源代码：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">ListModelMixin</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token triple-quoted-string string">"""</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    List a queryset.</pre></td></tr><tr><td data-num="4"></td><td><pre>    """</pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">list</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="6"></td><td><pre>        queryset <span class="token operator">=</span> self<span class="token punctuation">.</span>filter_queryset<span class="token punctuation">(</span>self<span class="token punctuation">.</span>get_queryset<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre>        page <span class="token operator">=</span> self<span class="token punctuation">.</span>paginate_queryset<span class="token punctuation">(</span>queryset<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        <span class="token keyword">if</span> page <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="10"></td><td><pre>            serializer <span class="token operator">=</span> self<span class="token punctuation">.</span>get_serializer<span class="token punctuation">(</span>page<span class="token punctuation">,</span> many<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre>            <span class="token keyword">return</span> self<span class="token punctuation">.</span>get_paginated_response<span class="token punctuation">(</span>serializer<span class="token punctuation">.</span>data<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre>        serializer <span class="token operator">=</span> self<span class="token punctuation">.</span>get_serializer<span class="token punctuation">(</span>queryset<span class="token punctuation">,</span> many<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="14"></td><td><pre>        <span class="token keyword">return</span> Response<span class="token punctuation">(</span>serializer<span class="token punctuation">.</span>data<span class="token punctuation">)</span></pre></td></tr></table></figure><p>基于扩展类实现 BookView：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">from</span> rest_framework <span class="token keyword">import</span> status</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>generics <span class="token keyword">import</span> GenericAPIView</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>response <span class="token keyword">import</span> Response</pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">from</span> sers<span class="token punctuation">.</span>models <span class="token keyword">import</span> Book</pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">from</span> <span class="token punctuation">.</span>sers <span class="token keyword">import</span> BookSerializer</pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>mixins <span class="token keyword">import</span> ListModelMixin</pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">BookView</span><span class="token punctuation">(</span>GenericAPIView<span class="token punctuation">,</span>ListModelMixin<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    queryset <span class="token operator">=</span> Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    serializer_class <span class="token operator">=</span> BookSerializer</pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">get</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="15"></td><td><pre>        <span class="token keyword">return</span> self<span class="token punctuation">.</span><span class="token builtin">list</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span></pre></td></tr></table></figure><h4 id="createmodelmixin"><a class="anchor" href="#createmodelmixin">#</a> CreateModelMixin</h4><p>创建视图扩展类，提供 <code>create(request, *args, **kwargs)</code> 方法快速实现创建资源的视图，成功返回 201 状态码。</p><p>如果序列化器对前端发送的数据验证失败，返回 400 错误。</p><p>源代码：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">CreateModelMixin</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token triple-quoted-string string">"""</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    Create a model instance.</pre></td></tr><tr><td data-num="4"></td><td><pre>    """</pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">create</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="6"></td><td><pre>        serializer <span class="token operator">=</span> self<span class="token punctuation">.</span>get_serializer<span class="token punctuation">(</span>data<span class="token operator">=</span>request<span class="token punctuation">.</span>data<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        serializer<span class="token punctuation">.</span>is_valid<span class="token punctuation">(</span>raise_exception<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        self<span class="token punctuation">.</span>perform_create<span class="token punctuation">(</span>serializer<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        headers <span class="token operator">=</span> self<span class="token punctuation">.</span>get_success_headers<span class="token punctuation">(</span>serializer<span class="token punctuation">.</span>data<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre>        <span class="token keyword">return</span> Response<span class="token punctuation">(</span>serializer<span class="token punctuation">.</span>data<span class="token punctuation">,</span> status<span class="token operator">=</span>status<span class="token punctuation">.</span>HTTP_201_CREATED<span class="token punctuation">,</span> headers<span class="token operator">=</span>headers<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">perform_create</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> serializer<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="13"></td><td><pre>        serializer<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="14"></td><td><pre></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">get_success_headers</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="16"></td><td><pre>        <span class="token keyword">try</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="17"></td><td><pre>            <span class="token keyword">return</span> <span class="token punctuation">&#123;</span><span class="token string">'Location'</span><span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">(</span>data<span class="token punctuation">[</span>api_settings<span class="token punctuation">.</span>URL_FIELD_NAME<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>        <span class="token keyword">except</span> <span class="token punctuation">(</span>TypeError<span class="token punctuation">,</span> KeyError<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="19"></td><td><pre>            <span class="token keyword">return</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>基于扩展类实现 BookView：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">BookView</span><span class="token punctuation">(</span>GenericAPIView<span class="token punctuation">,</span> ListModelMixin<span class="token punctuation">,</span> CreateModelMixin<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    queryset <span class="token operator">=</span> Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    serializer_class <span class="token operator">=</span> BookSerializer</pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">get</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="6"></td><td><pre>        <span class="token keyword">return</span> self<span class="token punctuation">.</span><span class="token builtin">list</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">post</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        <span class="token keyword">return</span> self<span class="token punctuation">.</span>create<span class="token punctuation">(</span>request<span class="token punctuation">)</span></pre></td></tr></table></figure><h4 id="retrievemodelmixin"><a class="anchor" href="#retrievemodelmixin">#</a> RetrieveModelMixin</h4><p>详情视图扩展类，提供 <code>retrieve(request, *args, **kwargs)</code> 方法，可以快速实现返回一个存在的数据对象。</p><p>如果存在，返回 200， 否则返回 404。</p><p>源代码：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">RetrieveModelMixin</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token triple-quoted-string string">"""</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    Retrieve a model instance.</pre></td></tr><tr><td data-num="4"></td><td><pre>    """</pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">retrieve</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="6"></td><td><pre>        instance <span class="token operator">=</span> self<span class="token punctuation">.</span>get_object<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        serializer <span class="token operator">=</span> self<span class="token punctuation">.</span>get_serializer<span class="token punctuation">(</span>instance<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        <span class="token keyword">return</span> Response<span class="token punctuation">(</span>serializer<span class="token punctuation">.</span>data<span class="token punctuation">)</span></pre></td></tr></table></figure><p>基于扩展类实现 BookDetailView：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">BookDetailView</span><span class="token punctuation">(</span>GenericAPIView<span class="token punctuation">,</span>RetrieveModelMixin<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    queryset <span class="token operator">=</span> Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    serializer_class <span class="token operator">=</span> BookSerializer</pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">get</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> pk<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="6"></td><td><pre>        <span class="token keyword">return</span> self<span class="token punctuation">.</span>retrieve<span class="token punctuation">(</span>request<span class="token punctuation">,</span> pk<span class="token punctuation">)</span></pre></td></tr></table></figure><h4 id="updatemodelmixin"><a class="anchor" href="#updatemodelmixin">#</a> UpdateModelMixin</h4><p>更新视图扩展类，提供 <code>update(request, *args, **kwargs)</code> 方法，可以快速实现更新一个存在的数据对象。</p><p>同时也提供 <code>partial_update(request, *args, **kwargs)</code> 方法，可以实现局部更新。</p><p>成功返回 200，序列化器校验数据失败时，返回 400 错误。</p><p>源代码：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">UpdateModelMixin</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token triple-quoted-string string">"""</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    Update a model instance.</pre></td></tr><tr><td data-num="4"></td><td><pre>    """</pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">update</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="6"></td><td><pre>        partial <span class="token operator">=</span> kwargs<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token string">'partial'</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        instance <span class="token operator">=</span> self<span class="token punctuation">.</span>get_object<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        serializer <span class="token operator">=</span> self<span class="token punctuation">.</span>get_serializer<span class="token punctuation">(</span>instance<span class="token punctuation">,</span> data<span class="token operator">=</span>request<span class="token punctuation">.</span>data<span class="token punctuation">,</span> partial<span class="token operator">=</span>partial<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        serializer<span class="token punctuation">.</span>is_valid<span class="token punctuation">(</span>raise_exception<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre>        self<span class="token punctuation">.</span>perform_update<span class="token punctuation">(</span>serializer<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre></pre></td></tr><tr><td data-num="12"></td><td><pre>        <span class="token keyword">if</span> <span class="token builtin">getattr</span><span class="token punctuation">(</span>instance<span class="token punctuation">,</span> <span class="token string">'_prefetched_objects_cache'</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="13"></td><td><pre>            <span class="token comment"># If 'prefetch_related' has been applied to a queryset, we need to</span></pre></td></tr><tr><td data-num="14"></td><td><pre>            <span class="token comment"># forcibly invalidate the prefetch cache on the instance.</span></pre></td></tr><tr><td data-num="15"></td><td><pre>            instance<span class="token punctuation">.</span>_prefetched_objects_cache <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="16"></td><td><pre></pre></td></tr><tr><td data-num="17"></td><td><pre>        <span class="token keyword">return</span> Response<span class="token punctuation">(</span>serializer<span class="token punctuation">.</span>data<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="18"></td><td><pre></pre></td></tr><tr><td data-num="19"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">perform_update</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> serializer<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="20"></td><td><pre>        serializer<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="21"></td><td><pre></pre></td></tr><tr><td data-num="22"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">partial_update</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="23"></td><td><pre>        kwargs<span class="token punctuation">[</span><span class="token string">'partial'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">True</span></pre></td></tr><tr><td data-num="24"></td><td><pre>        <span class="token keyword">return</span> self<span class="token punctuation">.</span>update<span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span></pre></td></tr></table></figure><p>基于扩展类实现 BookDetailView：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">BookDetailView</span><span class="token punctuation">(</span>GenericAPIView<span class="token punctuation">,</span> RetrieveModelMixin<span class="token punctuation">,</span> UpdateModelMixin<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    queryset <span class="token operator">=</span> Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    serializer_class <span class="token operator">=</span> BookSerializer</pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">get</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> pk<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="6"></td><td><pre>        <span class="token keyword">return</span> self<span class="token punctuation">.</span>retrieve<span class="token punctuation">(</span>request<span class="token punctuation">,</span> pk<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">put</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> pk<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        <span class="token keyword">return</span> self<span class="token punctuation">.</span>update<span class="token punctuation">(</span>request<span class="token punctuation">,</span> pk<span class="token punctuation">)</span></pre></td></tr></table></figure><h4 id="destroymodelmixin"><a class="anchor" href="#destroymodelmixin">#</a> DestroyModelMixin</h4><p>删除视图扩展类，提供 <code>destroy(request, *args, **kwargs)</code> 方法，可以快速实现删除一个存在的数据对象。</p><p>成功返回 204，不存在返回 404。</p><p>源代码：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">DestroyModelMixin</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token triple-quoted-string string">"""</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    Destroy a model instance.</pre></td></tr><tr><td data-num="4"></td><td><pre>    """</pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">destroy</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="6"></td><td><pre>        instance <span class="token operator">=</span> self<span class="token punctuation">.</span>get_object<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        self<span class="token punctuation">.</span>perform_destroy<span class="token punctuation">(</span>instance<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        <span class="token keyword">return</span> Response<span class="token punctuation">(</span>status<span class="token operator">=</span>status<span class="token punctuation">.</span>HTTP_204_NO_CONTENT<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">perform_destroy</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> instance<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="11"></td><td><pre>        instance<span class="token punctuation">.</span>delete<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>基于扩展类实现 BookDetailView：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">BookDetailView</span><span class="token punctuation">(</span>GenericAPIView<span class="token punctuation">,</span> RetrieveModelMixin<span class="token punctuation">,</span> UpdateModelMixin<span class="token punctuation">,</span> DestroyModelMixin<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    queryset <span class="token operator">=</span> Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    serializer_class <span class="token operator">=</span> BookSerializer</pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">get</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> pk<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="6"></td><td><pre>        <span class="token keyword">return</span> self<span class="token punctuation">.</span>retrieve<span class="token punctuation">(</span>request<span class="token punctuation">,</span> pk<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">put</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> pk<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        <span class="token keyword">return</span> self<span class="token punctuation">.</span>update<span class="token punctuation">(</span>request<span class="token punctuation">,</span> pk<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">delete</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> pk<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="12"></td><td><pre>        <span class="token keyword">return</span> self<span class="token punctuation">.</span>destroy<span class="token punctuation">(</span>request<span class="token punctuation">,</span> pk<span class="token punctuation">)</span></pre></td></tr></table></figure><p>整体代码，使用 GenericAPIView 结合视图扩展类，实现 5 个基本 api 接口，视图代码：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># Create your views here.</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token triple-quoted-string string">"""</span></pre></td></tr><tr><td data-num="3"></td><td><pre>基于GenericAPIView结合5个视图扩展类完成基本的5个API接口</pre></td></tr><tr><td data-num="4"></td><td><pre>ListModelMixin     提供了list方法，获取多条数据</pre></td></tr><tr><td data-num="5"></td><td><pre>CreateModelMixin   提供了create方法，添加一条数据</pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre>RetrieveModelMixin 提供了retrieve方法，获取一条数据</pre></td></tr><tr><td data-num="8"></td><td><pre>UpdateModelMixin   提供了update方法，更新一条数据</pre></td></tr><tr><td data-num="9"></td><td><pre>DestroyModelMixin   提供了destroy方法，删除一条数据</pre></td></tr><tr><td data-num="10"></td><td><pre>"""</pre></td></tr><tr><td data-num="11"></td><td><pre></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>generics <span class="token keyword">import</span> GenericAPIView</pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>mixins <span class="token keyword">import</span> ListModelMixin<span class="token punctuation">,</span> CreateModelMixin<span class="token punctuation">,</span> RetrieveModelMixin<span class="token punctuation">,</span> UpdateModelMixin<span class="token punctuation">,</span> \</pre></td></tr><tr><td data-num="14"></td><td><pre>    DestroyModelMixin</pre></td></tr><tr><td data-num="15"></td><td><pre></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token keyword">from</span> sers<span class="token punctuation">.</span>models <span class="token keyword">import</span> Book</pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token keyword">from</span> <span class="token punctuation">.</span>sers <span class="token keyword">import</span> BookSerializer</pre></td></tr><tr><td data-num="18"></td><td><pre></pre></td></tr><tr><td data-num="19"></td><td><pre></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">BookView</span><span class="token punctuation">(</span>GenericAPIView<span class="token punctuation">,</span> ListModelMixin<span class="token punctuation">,</span> CreateModelMixin<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="21"></td><td><pre>    queryset <span class="token operator">=</span> Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="22"></td><td><pre>    serializer_class <span class="token operator">=</span> BookSerializer</pre></td></tr><tr><td data-num="23"></td><td><pre></pre></td></tr><tr><td data-num="24"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">get</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="25"></td><td><pre>        <span class="token keyword">return</span> self<span class="token punctuation">.</span><span class="token builtin">list</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="26"></td><td><pre></pre></td></tr><tr><td data-num="27"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">post</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="28"></td><td><pre>        <span class="token keyword">return</span> self<span class="token punctuation">.</span>create<span class="token punctuation">(</span>request<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="29"></td><td><pre></pre></td></tr><tr><td data-num="30"></td><td><pre></pre></td></tr><tr><td data-num="31"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">BookDetailView</span><span class="token punctuation">(</span>GenericAPIView<span class="token punctuation">,</span> RetrieveModelMixin<span class="token punctuation">,</span> UpdateModelMixin<span class="token punctuation">,</span> DestroyModelMixin<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="32"></td><td><pre>    queryset <span class="token operator">=</span> Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="33"></td><td><pre>    serializer_class <span class="token operator">=</span> BookSerializer</pre></td></tr><tr><td data-num="34"></td><td><pre></pre></td></tr><tr><td data-num="35"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">get</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> pk<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="36"></td><td><pre>        <span class="token keyword">return</span> self<span class="token punctuation">.</span>retrieve<span class="token punctuation">(</span>request<span class="token punctuation">,</span> pk<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="37"></td><td><pre></pre></td></tr><tr><td data-num="38"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">put</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> pk<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="39"></td><td><pre>        <span class="token keyword">return</span> self<span class="token punctuation">.</span>update<span class="token punctuation">(</span>request<span class="token punctuation">,</span> pk<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="40"></td><td><pre></pre></td></tr><tr><td data-num="41"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">delete</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> pk<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="42"></td><td><pre>        <span class="token keyword">return</span> self<span class="token punctuation">.</span>destroy<span class="token punctuation">(</span>request<span class="token punctuation">,</span> pk<span class="token punctuation">)</span></pre></td></tr></table></figure><p>序列化组件：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">BookSerializer</span><span class="token punctuation">(</span>serializers<span class="token punctuation">.</span>ModelSerializer<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">class</span> <span class="token class-name">Meta</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="3"></td><td><pre>        model <span class="token operator">=</span> Book</pre></td></tr><tr><td data-num="4"></td><td><pre>        fields <span class="token operator">=</span> <span class="token string">"__all__"</span></pre></td></tr></table></figure><p>路由：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>urlpatterns <span class="token operator">=</span> <span class="token punctuation">[</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    path<span class="token punctuation">(</span><span class="token string">'books/'</span><span class="token punctuation">,</span> BookView<span class="token punctuation">.</span>as_view<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    re_path<span class="token punctuation">(</span><span class="token string">'books/(?P&lt;pk>\d+)/'</span><span class="token punctuation">,</span> BookDetailView<span class="token punctuation">.</span>as_view<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">]</span></pre></td></tr></table></figure><h2 id="genericapiview的视图子类"><a class="anchor" href="#genericapiview的视图子类">#</a> GenericAPIView 的视图子类</h2><h4 id="createapiview"><a class="anchor" href="#createapiview">#</a> CreateAPIView</h4><p>提供了 post 方法，内部调用了 create 方法</p><p>继承自： GenericAPIView、CreateModelMixin</p><h4 id="listapiview"><a class="anchor" href="#listapiview">#</a> ListAPIView</h4><p>提供了 get 方法，内部调用了 list 方法</p><p>继承自：GenericAPIView、ListModelMixin</p><h4 id="retrieveapiview"><a class="anchor" href="#retrieveapiview">#</a> RetrieveAPIView</h4><p>提供了 get 方法，内部调用了 retrieve 方法</p><p>继承自: GenericAPIView、RetrieveModelMixin</p><h4 id="destoryapiview"><a class="anchor" href="#destoryapiview">#</a> DestoryAPIView</h4><p>提供了 delete 方法，内部调用了 destory 方法</p><p>继承自：GenericAPIView、DestoryModelMixin</p><h4 id="updateapiview"><a class="anchor" href="#updateapiview">#</a> UpdateAPIView</h4><p>提供了 put 和 patch 方法，内部调用了 update 和 partial_update 方法</p><p>继承自：GenericAPIView、UpdateModelMixin</p><h4 id="listcreateapiview"><a class="anchor" href="#listcreateapiview">#</a> ListCreateAPIView</h4><p>提供了 get 和 post 方法，内部调用了 list 和 create 方法</p><p>继承自：GenericAPIView、ListModelMixin、CreateModelMixin</p><h4 id="retrieveupdateapiview"><a class="anchor" href="#retrieveupdateapiview">#</a> RetrieveUpdateAPIView</h4><p>提供 get、put、patch 方法</p><p>继承自： GenericAPIView、RetrieveModelMixin、UpdateModelMixin</p><h4 id="retrievedestoryapiview"><a class="anchor" href="#retrievedestoryapiview">#</a> RetrieveDestoryAPIView</h4><p>提供 get、delete 方法</p><p>继承自：GenericAPIView、RetrieveModelMixin、DestoryModelMixin</p><h4 id="retrieveupdatedestoryapiview"><a class="anchor" href="#retrieveupdatedestoryapiview">#</a> RetrieveUpdateDestoryAPIView</h4><p>提供 get、put、patch、delete 方法</p><p>继承自：GenericAPIView、RetrieveModelMixin、UpdateModelMixin、DestoryModelMixin</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">from</span> rest_framework <span class="token keyword">import</span> generics</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">BookView</span><span class="token punctuation">(</span>generics<span class="token punctuation">.</span>ListCreateAPIView<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    queryset <span class="token operator">=</span> Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    serializer_class <span class="token operator">=</span> BookSerializer</pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">BookDetailView</span><span class="token punctuation">(</span>generics<span class="token punctuation">.</span>RetrieveUpdateDestroyAPIView<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    queryset <span class="token operator">=</span> Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    serializer_class <span class="token operator">=</span> BookSerializer</pre></td></tr></table></figure><h2 id="视图集"><a class="anchor" href="#视图集">#</a> 视图集</h2><h3 id="viewset"><a class="anchor" href="#viewset">#</a> ViewSet</h3><p>继承自 <code>APIView</code> 与 <code>ViewSetMixin</code> ，作用也与 APIView 基本类似，提供了身份认证、权限校验、流量管理等。</p><p><strong>ViewSet 主要通过继承 ViewSetMixin 来实现在调用 as_view () 时传入字典 {“http 请求”：“视图方法”} 的映射处理工作，如 {'get':'list'}，</strong></p><p>在 ViewSet 中，没有提供任何动作 action 方法，需要我们自己实现 action 方法。</p><p>使用视图集 ViewSet，可以将一系列视图相关的代码逻辑和相关的 http 请求动作封装到一个类中：</p><ul><li>list () 提供一组数据</li><li>retrieve () 提供单个数据</li><li>create () 创建数据</li><li>update () 保存数据</li><li>destory () 删除数据</li></ul><p>ViewSet 视图集类不再限制视图方法名只允许 get ()、post () 等这种情况了，而是实现允许开发者根据自己的需要定义自定义方法名，例如 list () 、create () 等，然后经过路由中使用 http 和这些视图方法名进行绑定调用。</p><p>为了方便演示视图集的使用，我们新建一个子应用，</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>python manage.py startapp vset</pre></td></tr></table></figure><p>视图集只在使用 as_view () 方法的时候，才会将<strong> action</strong> 动作与具体请求方式对应上。如：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">from</span> django<span class="token punctuation">.</span>urls <span class="token keyword">import</span> path<span class="token punctuation">,</span> re_path</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">from</span> vset<span class="token punctuation">.</span>views <span class="token keyword">import</span> BookView</pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre>urlpatterns <span class="token operator">=</span> <span class="token punctuation">[</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token comment"># path ("set", views.BookView.as_view (&#123;"http 请求":"视图方法"&#125;)),</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    path<span class="token punctuation">(</span><span class="token string">"books/"</span><span class="token punctuation">,</span> BookView<span class="token punctuation">.</span>as_view<span class="token punctuation">(</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        <span class="token string">"get"</span><span class="token punctuation">:</span> <span class="token string">"get_all_book"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        <span class="token string">"post"</span><span class="token punctuation">:</span> <span class="token string">"add_book"</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    re_path<span class="token punctuation">(</span><span class="token string">"^books/(?P&lt;pk>\d+)$"</span><span class="token punctuation">,</span> BookView<span class="token punctuation">.</span>as_view<span class="token punctuation">(</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>        <span class="token string">"get"</span><span class="token punctuation">:</span> <span class="token string">"get_one_book"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="13"></td><td><pre>        <span class="token string">"put"</span><span class="token punctuation">:</span> <span class="token string">"edit_book"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="14"></td><td><pre>        <span class="token string">"delete"</span><span class="token punctuation">:</span> <span class="token string">"delete"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token punctuation">]</span></pre></td></tr></table></figure><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">from</span> rest_framework <span class="token keyword">import</span> serializers</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">from</span> rest_framework <span class="token keyword">import</span> status</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>response <span class="token keyword">import</span> Response</pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>viewsets <span class="token keyword">import</span> ViewSet</pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">from</span> sers<span class="token punctuation">.</span>models <span class="token keyword">import</span> Book</pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">BookSerializer</span><span class="token punctuation">(</span>serializers<span class="token punctuation">.</span>ModelSerializer<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token keyword">class</span> <span class="token class-name">Meta</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="11"></td><td><pre>        model <span class="token operator">=</span> Book</pre></td></tr><tr><td data-num="12"></td><td><pre>        fields <span class="token operator">=</span> <span class="token string">"__all__"</span></pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">BookView</span><span class="token punctuation">(</span>ViewSet<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="16"></td><td><pre></pre></td></tr><tr><td data-num="17"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">get_all_book</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="18"></td><td><pre></pre></td></tr><tr><td data-num="19"></td><td><pre>        books <span class="token operator">=</span> Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="20"></td><td><pre>        bs <span class="token operator">=</span> BookSerializer<span class="token punctuation">(</span>instance<span class="token operator">=</span>books<span class="token punctuation">,</span> many<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="21"></td><td><pre>        <span class="token keyword">return</span> Response<span class="token punctuation">(</span>bs<span class="token punctuation">.</span>data<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="22"></td><td><pre></pre></td></tr><tr><td data-num="23"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">add_book</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="24"></td><td><pre>        bs <span class="token operator">=</span> BookSerializer<span class="token punctuation">(</span>data<span class="token operator">=</span>request<span class="token punctuation">.</span>data<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="25"></td><td><pre>        <span class="token keyword">if</span> bs<span class="token punctuation">.</span>is_valid<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="26"></td><td><pre>            bs<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="27"></td><td><pre>            <span class="token keyword">return</span> Response<span class="token punctuation">(</span>bs<span class="token punctuation">.</span>data<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="28"></td><td><pre>        <span class="token keyword">else</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="29"></td><td><pre>            <span class="token keyword">return</span> Response<span class="token punctuation">(</span>bs<span class="token punctuation">.</span>errors<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="30"></td><td><pre></pre></td></tr><tr><td data-num="31"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">get_one_book</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> pk<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="32"></td><td><pre>        book <span class="token operator">=</span> Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>get<span class="token punctuation">(</span>pk<span class="token operator">=</span>pk<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="33"></td><td><pre>        bs <span class="token operator">=</span> BookSerializer<span class="token punctuation">(</span>instance<span class="token operator">=</span>book<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="34"></td><td><pre>        <span class="token keyword">return</span> Response<span class="token punctuation">(</span>bs<span class="token punctuation">.</span>data<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="35"></td><td><pre></pre></td></tr><tr><td data-num="36"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">edit_book</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> pk<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="37"></td><td><pre>        instance <span class="token operator">=</span> Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>get<span class="token punctuation">(</span>pk<span class="token operator">=</span>pk<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="38"></td><td><pre>        bs <span class="token operator">=</span> BookSerializer<span class="token punctuation">(</span>instance<span class="token operator">=</span>instance<span class="token punctuation">,</span> data<span class="token operator">=</span>request<span class="token punctuation">.</span>data<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="39"></td><td><pre>        <span class="token keyword">if</span> bs<span class="token punctuation">.</span>is_valid<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="40"></td><td><pre>            bs<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="41"></td><td><pre>            <span class="token keyword">return</span> Response<span class="token punctuation">(</span>bs<span class="token punctuation">.</span>data<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="42"></td><td><pre>        <span class="token keyword">else</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="43"></td><td><pre>            <span class="token keyword">return</span> Response<span class="token punctuation">(</span>bs<span class="token punctuation">.</span>errors<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="44"></td><td><pre></pre></td></tr><tr><td data-num="45"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">delete</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> pk<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="46"></td><td><pre>        Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>get<span class="token punctuation">(</span>pk<span class="token operator">=</span>pk<span class="token punctuation">)</span><span class="token punctuation">.</span>delete<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="47"></td><td><pre>        <span class="token keyword">return</span> Response<span class="token punctuation">(</span>status<span class="token operator">=</span>status<span class="token punctuation">.</span>HTTP_204_NO_CONTENT<span class="token punctuation">)</span></pre></td></tr></table></figure><h3 id="genericviewset"><a class="anchor" href="#genericviewset">#</a> GenericViewSet</h3><p>继承自 GenericAPIView 和 ViewSetMixin，作用让视图集的视图代码变得更加通用，抽离独特代码作为视图类的属性。</p><p>使用 ViewSet 通常并不方便，因为 list、retrieve、create、update、destory 等方法都需要自己编写，而这些方法与前面讲过的 Mixin 扩展类提供的方法同名，所以我们可以通过继承 Mixin 扩展类来复用这些方法而无需自己编写。但是 Mixin 扩展类依赖与 <code>GenericAPIView</code> ，所以还需要继承 <code>GenericAPIView</code> 。</p><p><strong>GenericViewSet</strong> 就帮助我们完成了这样的继承工作，继承自 <code>GenericAPIView</code> 与 <code>ViewSetMixin</code> ，在实现了调用 as_view () 时传入字典（如 <code>&#123;'get':'list'&#125;</code> ）的映射处理工作的同时，还提供了 <code>GenericAPIView</code> 提供的基础方法，可以直接搭配 Mixin 扩展类使用。</p><p>视图代码：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>viewsets <span class="token keyword">import</span> GenericViewSet</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">BookView</span><span class="token punctuation">(</span>GenericViewSet<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">list</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre>        books <span class="token operator">=</span> Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        bs <span class="token operator">=</span> BookSerializer<span class="token punctuation">(</span>instance<span class="token operator">=</span>books<span class="token punctuation">,</span> many<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        <span class="token keyword">return</span> Response<span class="token punctuation">(</span>bs<span class="token punctuation">.</span>data<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">create</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="12"></td><td><pre>        bs <span class="token operator">=</span> BookSerializer<span class="token punctuation">(</span>data<span class="token operator">=</span>request<span class="token punctuation">.</span>data<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="13"></td><td><pre>        <span class="token keyword">if</span> bs<span class="token punctuation">.</span>is_valid<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="14"></td><td><pre>            bs<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="15"></td><td><pre>            <span class="token keyword">return</span> Response<span class="token punctuation">(</span>bs<span class="token punctuation">.</span>data<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="16"></td><td><pre>        <span class="token keyword">else</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="17"></td><td><pre>            <span class="token keyword">return</span> Response<span class="token punctuation">(</span>bs<span class="token punctuation">.</span>errors<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="18"></td><td><pre></pre></td></tr><tr><td data-num="19"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">retrieve</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> pk<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="20"></td><td><pre>        book <span class="token operator">=</span> Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>get<span class="token punctuation">(</span>pk<span class="token operator">=</span>pk<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="21"></td><td><pre>        bs <span class="token operator">=</span> BookSerializer<span class="token punctuation">(</span>instance<span class="token operator">=</span>book<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="22"></td><td><pre>        <span class="token keyword">return</span> Response<span class="token punctuation">(</span>bs<span class="token punctuation">.</span>data<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="23"></td><td><pre></pre></td></tr><tr><td data-num="24"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">update</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> pk<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="25"></td><td><pre>        instance <span class="token operator">=</span> Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>get<span class="token punctuation">(</span>pk<span class="token operator">=</span>pk<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="26"></td><td><pre>        bs <span class="token operator">=</span> BookSerializer<span class="token punctuation">(</span>instance<span class="token operator">=</span>instance<span class="token punctuation">,</span> data<span class="token operator">=</span>request<span class="token punctuation">.</span>data<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="27"></td><td><pre>        <span class="token keyword">if</span> bs<span class="token punctuation">.</span>is_valid<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="28"></td><td><pre>            bs<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="29"></td><td><pre>            <span class="token keyword">return</span> Response<span class="token punctuation">(</span>bs<span class="token punctuation">.</span>data<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="30"></td><td><pre>        <span class="token keyword">else</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="31"></td><td><pre>            <span class="token keyword">return</span> Response<span class="token punctuation">(</span>bs<span class="token punctuation">.</span>errors<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="32"></td><td><pre></pre></td></tr><tr><td data-num="33"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">delete</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> pk<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="34"></td><td><pre>        Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>get<span class="token punctuation">(</span>pk<span class="token operator">=</span>pk<span class="token punctuation">)</span><span class="token punctuation">.</span>delete<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="35"></td><td><pre>        <span class="token keyword">return</span> Response<span class="token punctuation">(</span>status<span class="token operator">=</span>status<span class="token punctuation">.</span>HTTP_204_NO_CONTENT<span class="token punctuation">)</span></pre></td></tr></table></figure><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">from</span> django<span class="token punctuation">.</span>urls <span class="token keyword">import</span> path<span class="token punctuation">,</span> re_path</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">from</span> vset<span class="token punctuation">.</span>views <span class="token keyword">import</span> BookView</pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre>urlpatterns <span class="token operator">=</span> <span class="token punctuation">[</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token comment"># path ("set", views.BookView.as_view (&#123;"http 请求":"视图方法"&#125;)),</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    path<span class="token punctuation">(</span><span class="token string">"books/"</span><span class="token punctuation">,</span> BookView<span class="token punctuation">.</span>as_view<span class="token punctuation">(</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        <span class="token string">"get"</span><span class="token punctuation">:</span> <span class="token string">"list"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        <span class="token string">"post"</span><span class="token punctuation">:</span> <span class="token string">"create"</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    re_path<span class="token punctuation">(</span><span class="token string">"^books/(?P&lt;pk>\d+)$"</span><span class="token punctuation">,</span> BookView<span class="token punctuation">.</span>as_view<span class="token punctuation">(</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>        <span class="token string">"get"</span><span class="token punctuation">:</span> <span class="token string">"retrieve"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="13"></td><td><pre>        <span class="token string">"put"</span><span class="token punctuation">:</span> <span class="token string">"update"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="14"></td><td><pre>        <span class="token string">"delete"</span><span class="token punctuation">:</span> <span class="token string">"delete"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token punctuation">]</span></pre></td></tr></table></figure><p>集合我们上面学习的模型扩展类，实现简写操作，视图，代码：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>viewsets <span class="token keyword">import</span> GenericViewSet</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>mixins <span class="token keyword">import</span> ListModelMixin<span class="token punctuation">,</span> CreateModelMixin<span class="token punctuation">,</span> RetrieveModelMixin<span class="token punctuation">,</span> UpdateModelMixin<span class="token punctuation">,</span> \</pre></td></tr><tr><td data-num="3"></td><td><pre>    DestroyModelMixin</pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">BookView</span><span class="token punctuation">(</span>GenericViewSet<span class="token punctuation">,</span> ListModelMixin<span class="token punctuation">,</span> CreateModelMixin<span class="token punctuation">,</span> RetrieveModelMixin<span class="token punctuation">,</span> UpdateModelMixin<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="7"></td><td><pre>                          DestroyModelMixin<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    queryset <span class="token operator">=</span> Book<span class="token punctuation">.</span>objects</pre></td></tr><tr><td data-num="9"></td><td><pre>    serializer_class <span class="token operator">=</span> BookSerializer</pre></td></tr></table></figure><h3 id="modelviewset和readonlymodelviewset"><a class="anchor" href="#modelviewset和readonlymodelviewset">#</a> ModelViewSet 和 ReadOnlyModelViewSet</h3><p>ModelViewSet 继承自 <code>GenericViewSet</code> ，同时包括了 ListModelMixin、RetrieveModelMixin、CreateModelMixin、UpdateModelMixin、DestoryModelMixin。</p><p>ReadOnlyModelViewSet 承自 <code>GenericViewSet</code> ，同时包括了 ListModelMixin、RetrieveModelMixin。</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>viewsets <span class="token keyword">import</span> ModelViewSet</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">BookView</span><span class="token punctuation">(</span>ModelViewSet<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    queryset <span class="token operator">=</span> Book<span class="token punctuation">.</span>objects</pre></td></tr><tr><td data-num="5"></td><td><pre>    serializer_class <span class="token operator">=</span> BookSerializer</pre></td></tr></table></figure><h1 id="路由routers"><a class="anchor" href="#路由routers">#</a> 路由 Routers</h1><p>对于视图集 ViewSet，我们除了可以自己手动指明请求方式与动作 action 之间的对应关系外，还可以使用 Routers 来帮助我们快速实现路由信息。</p><p>REST framework 提供了两个 router</p><ul><li><strong>SimpleRouter</strong></li><li><strong>DefaultRouter</strong></li></ul><h2 id="使用方法"><a class="anchor" href="#使用方法">#</a> 使用方法</h2><p>1） 创建 router 对象，并注册视图集，例如</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">from</span> rest_framework <span class="token keyword">import</span> routers</pre></td></tr><tr><td data-num="2"></td><td><pre>router <span class="token operator">=</span> routers<span class="token punctuation">.</span>DefaultRouter<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre>router<span class="token punctuation">.</span>register<span class="token punctuation">(</span><span class="token string">'book'</span><span class="token punctuation">,</span> BookView<span class="token punctuation">,</span> base_name<span class="token operator">=</span><span class="token string">'book'</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>register(prefix, viewset, base_name)</p><blockquote><ul><li>prefix 该视图集的路由前缀</li><li>viewset 视图集</li><li>base_name 路由别名的前缀</li></ul></blockquote><p>如上述代码会形成的路由如下：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">^</span>book<span class="token operator">/</span>$    name<span class="token punctuation">:</span> book<span class="token operator">-</span><span class="token builtin">list</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token operator">^</span>book<span class="token operator">/</span><span class="token punctuation">&#123;</span>pk<span class="token punctuation">&#125;</span><span class="token operator">/</span>$   name<span class="token punctuation">:</span> book<span class="token operator">-</span>detail</pre></td></tr></table></figure><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">from</span> django<span class="token punctuation">.</span>test <span class="token keyword">import</span> TestCase</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">import</span> os</pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">import</span> django</pre></td></tr><tr><td data-num="5"></td><td><pre>os<span class="token punctuation">.</span>environ<span class="token punctuation">.</span>setdefault<span class="token punctuation">(</span><span class="token string">'DJANGO_SETTINGS_MODULE'</span><span class="token punctuation">,</span> <span class="token string">'drfdemo.settings'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre>django<span class="token punctuation">.</span>setup<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token keyword">from</span> lyb<span class="token punctuation">.</span>views <span class="token keyword">import</span> LybViewSet</pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token keyword">from</span> rest_framework <span class="token keyword">import</span> routers</pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token keyword">from</span> drfdemo <span class="token keyword">import</span> urls</pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token keyword">from</span> lyb<span class="token punctuation">.</span>models <span class="token keyword">import</span> Lyb</pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    router <span class="token operator">=</span> routers<span class="token punctuation">.</span>SimpleRouter<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="17"></td><td><pre>    router<span class="token punctuation">.</span>register<span class="token punctuation">(</span><span class="token string">r'users'</span><span class="token punctuation">,</span> LybViewSet<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="18"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">(</span>router<span class="token punctuation">.</span>urls<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># &lt;class 'list'></span></pre></td></tr><tr><td data-num="19"></td><td><pre></pre></td></tr><tr><td data-num="20"></td><td><pre>    <span class="token comment"># [&lt;URLPattern '^users/$' [name='lyb-list']>, &lt;URLPattern '^users/(?P&lt;pk>[^/.]+)/$' [name='lyb-detail']>]</span></pre></td></tr><tr><td data-num="21"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span>router<span class="token punctuation">.</span>urls<span class="token punctuation">)</span></pre></td></tr></table></figure><p><img data-src="/./images/DRF%E7%BB%84%E4%BB%B6/1663059930983.png" alt="1663059930983"></p><p><img data-src="/./images/DRF%E7%BB%84%E4%BB%B6/1663059950402.png" alt="1663059950402"></p><p>2）添加路由数据</p><p>可以有两种方式：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>urlpatterns <span class="token operator">=</span> <span class="token punctuation">[</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="4"></td><td><pre>urlpatterns <span class="token operator">+=</span> router<span class="token punctuation">.</span>urls</pre></td></tr></table></figure><p>或</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>urlpatterns <span class="token operator">=</span> <span class="token punctuation">[</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    path<span class="token punctuation">(</span><span class="token string">'^'</span><span class="token punctuation">,</span> include<span class="token punctuation">(</span>router<span class="token punctuation">.</span>urls<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">]</span></pre></td></tr></table></figure><p>路由代码：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">from</span> django<span class="token punctuation">.</span>urls <span class="token keyword">import</span> path<span class="token punctuation">,</span> re_path</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">from</span> <span class="token punctuation">.</span> <span class="token keyword">import</span> views</pre></td></tr><tr><td data-num="3"></td><td><pre>urlpatterns <span class="token operator">=</span> <span class="token punctuation">[</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token triple-quoted-string string">"""使用drf提供路由类router给视图集生成路由列表"""</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token comment"># 实例化路由类</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token comment"># drf 提供一共提供了两个路由类给我们使用，他们用法一致，功能几乎一样</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>routers <span class="token keyword">import</span> DefaultRouter</pre></td></tr><tr><td data-num="11"></td><td><pre>router <span class="token operator">=</span> DefaultRouter<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token comment"># 注册视图集</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token comment"># router.register ("路由前缀", 视图集类)</span></pre></td></tr><tr><td data-num="15"></td><td><pre>router<span class="token punctuation">.</span>register<span class="token punctuation">(</span><span class="token string">"book"</span><span class="token punctuation">,</span>views<span class="token punctuation">.</span>BookView<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="16"></td><td><pre></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token comment"># 把生成的路由列表追加到 urlpatterns</span></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span> router<span class="token punctuation">.</span>urls <span class="token punctuation">)</span></pre></td></tr><tr><td data-num="19"></td><td><pre>urlpatterns <span class="token operator">+=</span> router<span class="token punctuation">.</span>urls</pre></td></tr></table></figure><p>上面的代码就成功生成了路由地址 [增 / 删 / 改 / 查一条 / 查多条的功能]，但是不会自动我们在视图集自定义方法的路由。</p><p>所以我们如果也要给自定义方法生成路由，则需要进行 action 动作的声明。</p><h2 id="视图集中附加action的声明"><a class="anchor" href="#视图集中附加action的声明">#</a> 视图集中附加 action 的声明</h2><p>在视图集中，如果想要让 Router 自动帮助我们为自定义的动作生成路由信息，需要使用 <code>rest_framework.decorators.action</code> 装饰器。</p><p>以 action 装饰器装饰的方法名会作为 action 动作名，与 list、retrieve 等同。</p><p>action 装饰器可以接收两个参数：</p><ul><li><p><strong>methods</strong>: 声明该 action 对应的请求方式，列表传递</p></li><li><p><strong>detail</strong>: 声明该 action 的路径是否与单一资源对应</p><pre><code>路由前缀/&lt;pk&gt;/action方法名/
</code></pre><ul><li>True 表示路径格式是 <code>xxx/&lt;pk&gt;/action方法名/</code></li><li>False 表示路径格式是 <code>xxx/action方法名/</code></li></ul></li><li><p>url_path：声明该 action 的路由尾缀。</p></li></ul><p>举例：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>viewsets <span class="token keyword">import</span> ModelViewSet</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>decorators <span class="token keyword">import</span> action</pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">BookView</span><span class="token punctuation">(</span>ModelViewSet<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    queryset <span class="token operator">=</span> Book<span class="token punctuation">.</span>objects</pre></td></tr><tr><td data-num="6"></td><td><pre>    serializer_class <span class="token operator">=</span> BookSerializer</pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token triple-quoted-string string">"""</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    action装饰器的作用：告诉路由类给视图集的自定义方法生成路由信息</pre></td></tr><tr><td data-num="9"></td><td><pre>    methods, 列表，允许哪些http请求能访问当前视图方法</pre></td></tr><tr><td data-num="10"></td><td><pre>    detail，布尔，生成路由时是否拼接pk参数</pre></td></tr><tr><td data-num="11"></td><td><pre>            detail为True，表示路径名格式应该为 book/&#123;pk&#125;/login/</pre></td></tr><tr><td data-num="12"></td><td><pre>    url_path，字符串，生成路由时末尾路由路径，如果没有声明，则自动以当前方法名作为路由尾缀</pre></td></tr><tr><td data-num="13"></td><td><pre>  </pre></td></tr><tr><td data-num="14"></td><td><pre>    """</pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token decorator annotation punctuation">@action</span><span class="token punctuation">(</span>methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'get'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> detail<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>url_path<span class="token operator">=</span><span class="token string">"login"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">login</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span>pk<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="17"></td><td><pre>        <span class="token triple-quoted-string string">"""登录"""</span></pre></td></tr><tr><td data-num="18"></td><td><pre>        <span class="token keyword">return</span> Response<span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">"msg"</span><span class="token punctuation">:</span>request<span class="token punctuation">.</span>method<span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="19"></td><td><pre></pre></td></tr><tr><td data-num="20"></td><td><pre>    <span class="token comment"># detail 为 False 表示路径名格式应该为 book/get_new_5/</span></pre></td></tr><tr><td data-num="21"></td><td><pre>    <span class="token decorator annotation punctuation">@action</span><span class="token punctuation">(</span>methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'get'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> detail<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="22"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">get_new_5</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="23"></td><td><pre>        <span class="token triple-quoted-string string">"""获取最新添加的5本书"""</span></pre></td></tr><tr><td data-num="24"></td><td><pre>        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></pre></td></tr></table></figure><p>由路由器自动为此视图集自定义 action 方法形成的路由会是如下内容：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">^</span>book<span class="token operator">/</span>get_new_5<span class="token operator">/</span>$    name<span class="token punctuation">:</span> book<span class="token operator">-</span>get_new_5</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token operator">^</span>book<span class="token operator">/</span><span class="token punctuation">&#123;</span>pk<span class="token punctuation">&#125;</span><span class="token operator">/</span>login<span class="token operator">/</span>$   name<span class="token punctuation">:</span> book<span class="token operator">-</span>login</pre></td></tr></table></figure><h2 id="路由router形成url的方式"><a class="anchor" href="#路由router形成url的方式">#</a> 路由 router 形成 URL 的方式</h2><p>1） SimpleRouter（prefix=“路由前缀”，viewset = 视图集类，basename=“路由别名”）</p><p><img data-src="/./images/DRF/SimpleRouter-16318481562175.png" alt="SimpleRouter"></p><p>2）DefaultRouter</p><p><img data-src="/./images/DRF/DefaultRouter-16318481562186.png" alt="DefaultRouter"></p><p>DefaultRouter 与 SimpleRouter 的区别是，DefaultRouter 会多附带一个默认的 API 根视图，返回一个包含所有列表视图的超链接响应数据。</p><h1 id="其它功能组件"><a class="anchor" href="#其它功能组件">#</a> 其它功能组件</h1><p>为了方便接下来的学习，我们创建一个新的子应用 opt</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>python manage<span class="token punctuation">.</span>py startapp opt</pre></td></tr></table></figure><p>注册子应用</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>INSTALLED_APPS <span class="token operator">=</span> <span class="token punctuation">[</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token string">'opt'</span><span class="token punctuation">,</span>     <span class="token comment"># drf 提供的组件使用</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">]</span></pre></td></tr></table></figure><p>总路由，代码：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">from</span> django<span class="token punctuation">.</span>contrib <span class="token keyword">import</span> admin</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">from</span> django<span class="token punctuation">.</span>urls <span class="token keyword">import</span> path<span class="token punctuation">,</span> include</pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre>urlpatterns <span class="token operator">=</span> <span class="token punctuation">[</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    path<span class="token punctuation">(</span><span class="token string">'admin/'</span><span class="token punctuation">,</span> admin<span class="token punctuation">.</span>site<span class="token punctuation">.</span>urls<span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    path<span class="token punctuation">(</span><span class="token string">'students/'</span><span class="token punctuation">,</span> include<span class="token punctuation">(</span><span class="token string">"students.urls"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    path<span class="token punctuation">(</span><span class="token string">'sers/'</span><span class="token punctuation">,</span> include<span class="token punctuation">(</span><span class="token string">"sers.urls"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    path<span class="token punctuation">(</span><span class="token string">'school/'</span><span class="token punctuation">,</span> include<span class="token punctuation">(</span><span class="token string">"school.urls"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    path<span class="token punctuation">(</span><span class="token string">"req/"</span><span class="token punctuation">,</span> include<span class="token punctuation">(</span><span class="token string">"req.urls"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    path<span class="token punctuation">(</span><span class="token string">"demo/"</span><span class="token punctuation">,</span> include<span class="token punctuation">(</span><span class="token string">"demo.urls"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    path<span class="token punctuation">(</span><span class="token string">"opt/"</span><span class="token punctuation">,</span> include<span class="token punctuation">(</span><span class="token string">"opt.urls"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token punctuation">]</span></pre></td></tr></table></figure><p>子路由，代码：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">from</span> django<span class="token punctuation">.</span>urls <span class="token keyword">import</span> path</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">from</span> <span class="token punctuation">.</span> <span class="token keyword">import</span> views</pre></td></tr><tr><td data-num="3"></td><td><pre>urlpatterns <span class="token operator">=</span> <span class="token punctuation">[</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">]</span></pre></td></tr></table></figure><p>因为接下来的认证组件中需要使用到登陆功能，所以我们使用 django 内置 admin 站点并创建一个管理员.</p><p>admin 运营站点的访问地址：<span class="exturl" data-url="aHR0cDovLzEyNy4wLjAuMTo4MDAwL2FkbWlu">http://127.0.0.1:8000/admin</span></p><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre>python manage.py createsuperuser</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment"># 如果之前有账号，但是忘了，可以通过终端下的命令修改指定用户的密码，这里的密码必须 8 位长度以上的</span></pre></td></tr><tr><td data-num="3"></td><td><pre>python manage.py changepassword 用户名</pre></td></tr></table></figure><p>创建管理员以后，访问 admin 站点，先修改站点的语言配置</p><p><span class="exturl" data-url="aHR0cDovL3NldHRpbmdzLnB5">settings.py</span></p><pre><code>LANGUAGE_CODE = 'zh-hans'

TIME_ZONE = 'Asia/Shanghai'
</code></pre><h2 id="认证authentication"><a class="anchor" href="#认证authentication">#</a> 认证 Authentication</h2><p>可以在配置文件中配置全局默认的认证方案</p><p>常见的认证方式：cookie、session、token</p><p>/home/moluo/.virtualenvs/drfdemo/lib/python3.6/site-packages/rest_framework/settings.py 默认配置文件</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>REST_FRAMEWORK <span class="token operator">=</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token comment"># 配置认证方式的选项</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token string">'DEFAULT_AUTHENTICATION_CLASSES'</span><span class="token punctuation">:</span> <span class="token punctuation">(</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        <span class="token string">'rest_framework.authentication.SessionAuthentication'</span><span class="token punctuation">,</span> <span class="token comment"># session 认证</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        <span class="token string">'rest_framework.authentication.BasicAuthentication'</span><span class="token punctuation">,</span>   <span class="token comment"># 基本认证</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>也可以在具体的视图类中通过设置 authentication_classess 类属性来设置单独的不同的认证方式</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>authentication <span class="token keyword">import</span> SessionAuthentication<span class="token punctuation">,</span> BasicAuthentication</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>views <span class="token keyword">import</span> APIView</pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">ExampleView</span><span class="token punctuation">(</span>APIView<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token comment"># 类属性</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    authentication_classes <span class="token operator">=</span> <span class="token punctuation">[</span>SessionAuthentication<span class="token punctuation">,</span> BasicAuthentication<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">get</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        <span class="token keyword">pass</span></pre></td></tr></table></figure><p>认证失败会有两种可能的返回值，这个需要我们配合权限组件来使用：</p><ul><li>401 Unauthorized 未认证</li><li>403 Permission Denied 权限被禁止</li></ul><p>自定义认证， <code>drfdemo.authentication</code> 代码：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>authentication <span class="token keyword">import</span> BaseAuthentication</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>exceptions <span class="token keyword">import</span> APIException</pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">CustomAuthentication</span><span class="token punctuation">(</span>BaseAuthentication<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token triple-quoted-string string">"""</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    自定义认证方式</pre></td></tr><tr><td data-num="8"></td><td><pre>    """</pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">authenticate</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="11"></td><td><pre>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">":::"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="12"></td><td><pre>        <span class="token triple-quoted-string string">"""</span></pre></td></tr><tr><td data-num="13"></td><td><pre>        认证方法</pre></td></tr><tr><td data-num="14"></td><td><pre>        request: 本次客户端发送过来的http请求对象</pre></td></tr><tr><td data-num="15"></td><td><pre>        """</pre></td></tr><tr><td data-num="16"></td><td><pre></pre></td></tr><tr><td data-num="17"></td><td><pre>        <span class="token comment"># token = request.query_params.get("token")</span></pre></td></tr><tr><td data-num="18"></td><td><pre>        token <span class="token operator">=</span> request<span class="token punctuation">.</span>_request<span class="token punctuation">.</span>META<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"HTTP_TOKEN"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="19"></td><td><pre>        <span class="token keyword">if</span> token <span class="token operator">!=</span> <span class="token string">"123456789"</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="20"></td><td><pre>            <span class="token keyword">raise</span> APIException<span class="token punctuation">(</span><span class="token string">"认证失败"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="21"></td><td><pre>        user <span class="token operator">=</span> <span class="token string">"root"</span></pre></td></tr><tr><td data-num="22"></td><td><pre>        <span class="token keyword">return</span> <span class="token punctuation">(</span>user<span class="token punctuation">,</span>token<span class="token punctuation">)</span>  <span class="token comment"># 按照固定的返回格式填写 （用户模型对象，None）</span></pre></td></tr></table></figure><p>视图调用自定义认证，视图代码：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">from</span> django<span class="token punctuation">.</span>contrib<span class="token punctuation">.</span>auth<span class="token punctuation">.</span>models <span class="token keyword">import</span> AnonymousUser</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">from</span> django<span class="token punctuation">.</span>shortcuts <span class="token keyword">import</span> render</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>views <span class="token keyword">import</span> APIView</pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>response <span class="token keyword">import</span> Response</pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>authentication <span class="token keyword">import</span> SessionAuthentication</pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">from</span> drfdemo<span class="token punctuation">.</span>authentication <span class="token keyword">import</span> CustomAuthentication</pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token comment"># Create your views here.</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">HomeAPIView</span><span class="token punctuation">(</span>APIView<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token comment"># authentication_classes = [CustomAuthentication, ]</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">get</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="11"></td><td><pre>        <span class="token triple-quoted-string string">"""单独设置认证方式"""</span></pre></td></tr><tr><td data-num="12"></td><td><pre>        <span class="token keyword">print</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>user<span class="token punctuation">)</span> <span class="token comment"># 在中间件 AuthenticationMiddleware 中完成用户身份识别的，如果没有登录 request.user 值为 AnonymousUser</span></pre></td></tr><tr><td data-num="13"></td><td><pre>        <span class="token keyword">if</span> request<span class="token punctuation">.</span>user<span class="token punctuation">.</span><span class="token builtin">id</span> <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="14"></td><td><pre>            <span class="token keyword">return</span> Response<span class="token punctuation">(</span><span class="token string">"未登录用户：游客"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="15"></td><td><pre>        <span class="token keyword">else</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="16"></td><td><pre>            <span class="token keyword">return</span> Response<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"已登录用户：</span><span class="token interpolation"><span class="token punctuation">&#123;</span>request<span class="token punctuation">.</span>user<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>当然，也可以注释掉上面视图中的配置，改成全局配置。<span class="exturl" data-url="aHR0cDovL3NldHRpbmdzLnB5">settings.py</span>，代码：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token triple-quoted-string string">"""drf配置信息必须全部写在REST_FRAMEWORK配置项中"""</span></pre></td></tr><tr><td data-num="2"></td><td><pre>REST_FRAMEWORK <span class="token operator">=</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token comment"># 配置认证方式的选项【drf 的认证是内部循环遍历每一个注册的认证类，一旦认证通过识别到用户身份，则不会继续循环】</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token string">'DEFAULT_AUTHENTICATION_CLASSES'</span><span class="token punctuation">:</span> <span class="token punctuation">(</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        <span class="token string">'drfdemo.authentication.CustomAuthentication'</span><span class="token punctuation">,</span>          <span class="token comment"># 自定义认证</span></pre></td></tr><tr><td data-num="6"></td><td><pre>        <span class="token string">'rest_framework.authentication.SessionAuthentication'</span><span class="token punctuation">,</span>  <span class="token comment"># session 认证</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        <span class="token string">'rest_framework.authentication.BasicAuthentication'</span><span class="token punctuation">,</span>    <span class="token comment"># 基本认证</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h2 id="权限permissions"><a class="anchor" href="#权限permissions">#</a> 权限 Permissions</h2><p>权限控制可以限制用户对于视图的访问和对于具有模型对象的访问。</p><ul><li>在执行视图的 as_view () 方法的 dispatch () 方法前，会先进行视图访问权限的判断</li><li>在通过 get_object () 获取具体模型对象时，会进行模型对象访问权限的判断</li></ul><h3 id="使用"><a class="anchor" href="#使用">#</a> 使用</h3><p>可以在配置文件中<strong>全局设置</strong>默认的权限管理类，如</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>REST_FRAMEWORK <span class="token operator">=</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  </pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token string">'DEFAULT_PERMISSION_CLASSES'</span><span class="token punctuation">:</span> <span class="token punctuation">(</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        <span class="token string">'rest_framework.permissions.IsAuthenticated'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>如果未指明，则采用如下默认配置</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token string">'DEFAULT_PERMISSION_CLASSES'</span><span class="token punctuation">:</span> <span class="token punctuation">(</span></pre></td></tr><tr><td data-num="2"></td><td><pre>   <span class="token string">'rest_framework.permissions.AllowAny'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">)</span></pre></td></tr></table></figure><p>也可以在具体的视图中通过 permission_classes 属性来进行局部设置，如</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>permissions <span class="token keyword">import</span> IsAuthenticated</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>views <span class="token keyword">import</span> APIView</pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">ExampleView</span><span class="token punctuation">(</span>APIView<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    permission_classes <span class="token operator">=</span> <span class="token punctuation">(</span>IsAuthenticated<span class="token punctuation">,</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></pre></td></tr></table></figure><h3 id="提供的权限"><a class="anchor" href="#提供的权限">#</a> 提供的权限</h3><ul><li>AllowAny 允许所有用户，默认权限</li><li>IsAuthenticated 仅通过登录认证的用户</li><li>IsAdminUser 仅管理员用户</li><li>IsAuthenticatedOrReadOnly 已经登陆认证的用户可以对数据进行增删改操作，没有登陆认证的只能查看数据。</li></ul><h3 id="举例"><a class="anchor" href="#举例">#</a> 举例</h3><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>authentication <span class="token keyword">import</span> SessionAuthentication</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>permissions <span class="token keyword">import</span> IsAuthenticated</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>generics <span class="token keyword">import</span> RetrieveAPIView</pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">StudentAPIView</span><span class="token punctuation">(</span>RetrieveAPIView<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    queryset <span class="token operator">=</span> Student<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    serializer_class <span class="token operator">=</span> StudentSerializer</pre></td></tr><tr><td data-num="8"></td><td><pre>    authentication_classes <span class="token operator">=</span> <span class="token punctuation">[</span>SessionAuthentication<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    permission_classes <span class="token operator">=</span> <span class="token punctuation">[</span>IsAuthenticated<span class="token punctuation">]</span></pre></td></tr></table></figure><h3 id="自定义权限"><a class="anchor" href="#自定义权限">#</a> 自定义权限</h3><p>如需自定义权限，需继承 rest_framework.permissions.BasePermission 父类，并实现以下两个任何一个方法或全部</p><ul><li><p><code>.has_permission(self, request, view)</code></p><p>是否可以访问视图， view 表示当前视图对象</p></li><li><p><code>.has_object_permission(self, request, view, obj)</code></p><p>是否可以访问模型对象， view 表示当前视图， obj 为模型数据对象</p></li></ul><p>例如：</p><p>在当前子应用下，创建一个权限文件 drfdemo.permissions.py 中声明自定义权限类:</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>permissions <span class="token keyword">import</span> BasePermission</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">IsXiaoMingPermission</span><span class="token punctuation">(</span>BasePermission<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token triple-quoted-string string">"""</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    自定义权限，可用于全局配置，也可以用于局部</pre></td></tr><tr><td data-num="5"></td><td><pre>    """</pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">has_permission</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> view<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        <span class="token triple-quoted-string string">"""</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        视图权限</pre></td></tr><tr><td data-num="9"></td><td><pre>        返回结果未True则表示允许访问视图类</pre></td></tr><tr><td data-num="10"></td><td><pre>        request: 本次客户端提交的请求对象</pre></td></tr><tr><td data-num="11"></td><td><pre>        view: 本次客户端访问的视图类</pre></td></tr><tr><td data-num="12"></td><td><pre>        """</pre></td></tr><tr><td data-num="13"></td><td><pre>        role <span class="token operator">=</span> request<span class="token punctuation">.</span>query_params<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"role"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="14"></td><td><pre>        <span class="token keyword">return</span> role <span class="token operator">==</span> <span class="token string">"xiaoming"</span></pre></td></tr><tr><td data-num="15"></td><td><pre></pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">has_object_permission</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> view<span class="token punctuation">,</span> obj<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="17"></td><td><pre>        <span class="token triple-quoted-string string">"""</span></pre></td></tr><tr><td data-num="18"></td><td><pre>        模型权限</pre></td></tr><tr><td data-num="19"></td><td><pre>        返回结果为True则表示允许操作模型对象</pre></td></tr><tr><td data-num="20"></td><td><pre>        """</pre></td></tr><tr><td data-num="21"></td><td><pre>        <span class="token keyword">return</span> <span class="token boolean">True</span></pre></td></tr></table></figure><p>视图代码：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">from</span> <span class="token punctuation">.</span>permissions <span class="token keyword">import</span> IsXiaoMingPermission</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">StudentViewSet</span><span class="token punctuation">(</span>ModelViewSet<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    queryset <span class="token operator">=</span> Student<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    serializer_class <span class="token operator">=</span> StudentSerializer</pre></td></tr><tr><td data-num="5"></td><td><pre>    permission_classes <span class="token operator">=</span> <span class="token punctuation">[</span>IsXiaoMingPermission<span class="token punctuation">]</span> <span class="token comment"># 自定义权限</span></pre></td></tr></table></figure><p>认证和权限的举例代码：</p><p><span class="exturl" data-url="aHR0cDovL3NldHRpbmdzLnB5">settings.py</span>，全局配置，代码：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># 关于 REST_FRAMEWORK 的所有配置项都是填写在 django 的 settings 配置文件中的。</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment"># 所有的 REST_FRAMEWORK 都要填写在 REST_FRAMEWORK 的配置项，而且配置只能大写！！</span></pre></td></tr><tr><td data-num="3"></td><td><pre>REST_FRAMEWORK <span class="token operator">=</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token comment"># # 认证全局配置</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token comment"># 'DEFAULT_AUTHENTICATION_CLASSES':[</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token comment">#     # 默认由 drf 提供的认证方式</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token comment">#     'rest_framework.authentication.SessionAuthentication',  # session 认证</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token comment">#     'rest_framework.authentication.BasicAuthentication',   # 基本认证</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token comment">#     # 将来开发中，我们还可以自己实现属于自己项目的认证方式</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token comment">#     'drfdemo.authentications.CustomAuthentication',</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token comment"># ],</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token comment"># # 权限全局配置</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token comment"># 'DEFAULT_PERMISSION_CLASSES': [</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token comment">#     # 设置所有视图只能被已经登录认证过的用户访问</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token comment">#     'rest_framework.permissions.IsAuthenticated',</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token comment"># ]</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>视图代码：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>viewsets <span class="token keyword">import</span> ModelViewSet</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">from</span> student<span class="token punctuation">.</span>models <span class="token keyword">import</span> Student</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">from</span> student<span class="token punctuation">.</span>serializers <span class="token keyword">import</span> StudentModelSerializer</pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">from</span> drfdemo<span class="token punctuation">.</span>authentications <span class="token keyword">import</span> CustomAuthentication</pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>authentication <span class="token keyword">import</span> SessionAuthentication</pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>permissions <span class="token keyword">import</span> IsAuthenticated<span class="token punctuation">,</span>IsAdminUser<span class="token punctuation">,</span>IsAuthenticatedOrReadOnly</pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">from</span> drfdemo<span class="token punctuation">.</span>permissions <span class="token keyword">import</span> IsXiaoMingPermission</pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">Student1ModelViewSet</span><span class="token punctuation">(</span>ModelViewSet<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    queryset <span class="token operator">=</span> Student<span class="token punctuation">.</span>objects</pre></td></tr><tr><td data-num="10"></td><td><pre>    serializer_class <span class="token operator">=</span> StudentModelSerializer</pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token comment"># 局部认证配置方式</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    authentication_classes <span class="token operator">=</span> <span class="token punctuation">[</span>SessionAuthentication<span class="token punctuation">,</span>CustomAuthentication<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token comment"># 局部权限配置方式</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token comment"># permission_classes = [IsAuthenticated] # 只要经过认证登录就可以访问</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token comment"># permission_classes = [IsAdminUser] # 只要是站点管理员就可以访问</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token comment"># permission_classes = [IsAuthenticatedOrReadOnly] # 登录用户可以访问视图的增删查改页面，未登录的游客只能查看数据。不能修改！</span></pre></td></tr><tr><td data-num="17"></td><td><pre>    <span class="token comment"># permission_classes = [] # 取消权限判断识别</span></pre></td></tr><tr><td data-num="18"></td><td><pre>    permission_classes <span class="token operator">=</span> <span class="token punctuation">[</span>IsXiaoMingPermission<span class="token punctuation">]</span> <span class="token comment"># 自定义权限</span></pre></td></tr></table></figure><p>自定义认证类， <code>drfdemo.authentications</code> ，代码：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>authentication <span class="token keyword">import</span> SessionAuthentication<span class="token punctuation">,</span>BaseAuthentication</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">from</span> django<span class="token punctuation">.</span>contrib<span class="token punctuation">.</span>auth<span class="token punctuation">.</span>models <span class="token keyword">import</span> User</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">CustomAuthentication</span><span class="token punctuation">(</span>BaseAuthentication<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token triple-quoted-string string">"""</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    自定义认证</pre></td></tr><tr><td data-num="6"></td><td><pre>    """</pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">authenticate</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        <span class="token triple-quoted-string string">"""</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        认证方法</pre></td></tr><tr><td data-num="10"></td><td><pre>        request: 本次客户端发送过来的http请求对象</pre></td></tr><tr><td data-num="11"></td><td><pre>        """</pre></td></tr><tr><td data-num="12"></td><td><pre>        role <span class="token operator">=</span> request<span class="token punctuation">.</span>query_params<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"role"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="13"></td><td><pre>        root <span class="token operator">=</span> <span class="token boolean">None</span></pre></td></tr><tr><td data-num="14"></td><td><pre>        <span class="token keyword">if</span> role <span class="token operator">==</span> <span class="token string">"root"</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="15"></td><td><pre>            root <span class="token operator">=</span> User<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>get<span class="token punctuation">(</span>pk<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="16"></td><td><pre>            <span class="token keyword">return</span> <span class="token punctuation">(</span>root<span class="token punctuation">,</span><span class="token boolean">None</span><span class="token punctuation">)</span> <span class="token comment"># 按照固定的返回格式填写 （用户模型对象，None）</span></pre></td></tr><tr><td data-num="17"></td><td><pre>        <span class="token keyword">else</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="18"></td><td><pre>            <span class="token keyword">return</span> <span class="token boolean">None</span></pre></td></tr></table></figure><p>自定义权限类， <code>defdemo.permissions</code> ，代码：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>permissions <span class="token keyword">import</span> BasePermission</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">IsXiaoMingPermission</span><span class="token punctuation">(</span>BasePermission<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token triple-quoted-string string">"""</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    自定义权限，可用于全局配置，也可以用于局部</pre></td></tr><tr><td data-num="5"></td><td><pre>    """</pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">has_permission</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> view<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        <span class="token triple-quoted-string string">"""</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        视图权限</pre></td></tr><tr><td data-num="9"></td><td><pre>        返回结果未True则表示允许访问视图类</pre></td></tr><tr><td data-num="10"></td><td><pre>        request: 本次客户端提交的请求对象</pre></td></tr><tr><td data-num="11"></td><td><pre>        view: 本次客户端访问的视图类</pre></td></tr><tr><td data-num="12"></td><td><pre>        """</pre></td></tr><tr><td data-num="13"></td><td><pre>        role <span class="token operator">=</span> request<span class="token punctuation">.</span>query_params<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"role"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="14"></td><td><pre>        <span class="token keyword">return</span> role <span class="token operator">==</span> <span class="token string">"xiaoming"</span> <span class="token comment"># 认证的结果必须返回 True 或者 False，表示是否有权限</span></pre></td></tr><tr><td data-num="15"></td><td><pre></pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">has_object_permission</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> view<span class="token punctuation">,</span> obj<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="17"></td><td><pre>        <span class="token triple-quoted-string string">"""</span></pre></td></tr><tr><td data-num="18"></td><td><pre>        模型权限</pre></td></tr><tr><td data-num="19"></td><td><pre>        返回结果未True则表示允许操作模型对象</pre></td></tr><tr><td data-num="20"></td><td><pre>        """</pre></td></tr><tr><td data-num="21"></td><td><pre>        <span class="token keyword">return</span> <span class="token boolean">True</span></pre></td></tr></table></figure><p>urls，路由代码：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">from</span> django<span class="token punctuation">.</span>urls <span class="token keyword">import</span> path<span class="token punctuation">,</span>include</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">from</span> <span class="token punctuation">.</span> <span class="token keyword">import</span> views</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment"># 视图集的路由</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>routers <span class="token keyword">import</span> SimpleRouter</pre></td></tr><tr><td data-num="5"></td><td><pre>router <span class="token operator">=</span> SimpleRouter<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre>router<span class="token punctuation">.</span>register<span class="token punctuation">(</span><span class="token string">"stu1"</span><span class="token punctuation">,</span> views<span class="token punctuation">.</span>Student1ModelViewSet<span class="token punctuation">,</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre>urlpatterns <span class="token operator">=</span> <span class="token punctuation">[</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    path<span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">,</span> include<span class="token punctuation">(</span>router<span class="token punctuation">.</span>urls<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token punctuation">]</span></pre></td></tr></table></figure><h2 id="限流throttling"><a class="anchor" href="#限流throttling">#</a> 限流 Throttling</h2><p>可以对接口访问的频次进行限制，以减轻服务器压力，或者实现特定的业务。</p><p>一般用于付费购买次数，投票等场景使用.</p><h3 id="基本使用-2"><a class="anchor" href="#基本使用-2">#</a> 基本使用</h3><p>可以在配置文件中，使用 <code>DEFAULT_THROTTLE_CLASSES</code> 和 <code>DEFAULT_THROTTLE_RATES</code> 进行全局配置，</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>REST_FRAMEWORK <span class="token operator">=</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token comment"># 限流全局配置</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token comment"># 'DEFAULT_THROTTLE_CLASSES':[ # 限流配置类</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token comment">#     'rest_framework.throttling.AnonRateThrottle', # 未认证用户 [未登录用户]</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token comment">#     'rest_framework.throttling.UserRateThrottle', # 已认证用户 [已登录用户]</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token comment"># ],</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token string">'DEFAULT_THROTTLE_RATES'</span><span class="token punctuation">:</span><span class="token punctuation">&#123;</span> <span class="token comment"># 频率配置</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        <span class="token string">'anon'</span><span class="token punctuation">:</span> <span class="token string">'2/day'</span><span class="token punctuation">,</span>  <span class="token comment"># 针对游客的访问频率进行限制，实际上，drf 只是识别首字母，但是为了提高代码的维护性，建议写完整单词</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        <span class="token string">'user'</span><span class="token punctuation">:</span> <span class="token string">'5/day'</span><span class="token punctuation">,</span> <span class="token comment"># 针对会员的访问频率进行限制，</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p><code>DEFAULT_THROTTLE_RATES</code> 可以使用 <code>second</code> , <code>minute</code> , <code>hour</code> 或 <code>day</code> 来指明周期。</p><p>也可以在具体视图中通过 throttle_classess 属性来配置，如</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>throttling <span class="token keyword">import</span> UserRateThrottle</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">Student2ModelViewSet</span><span class="token punctuation">(</span>ModelViewSet<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    queryset <span class="token operator">=</span> Student<span class="token punctuation">.</span>objects</pre></td></tr><tr><td data-num="4"></td><td><pre>    serializer_class <span class="token operator">=</span> StudentModelSerializer</pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token comment"># 限流局部配置 [这里需要配合在全局配置中的 DEFAULT_THROTTLE_RATES 来设置频率]</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    throttle_classes <span class="token operator">=</span> <span class="token punctuation">[</span>UserRateThrottle<span class="token punctuation">]</span></pre></td></tr></table></figure><h3 id="可选限流类"><a class="anchor" href="#可选限流类">#</a> 可选限流类</h3><p>1） AnonRateThrottle</p><p>限制所有匿名未认证用户，使用 IP 区分用户。【很多公司这样的，IP 结合设备信息来判断，当然比 IP 要靠谱一点点而已】</p><p>使用 <code>DEFAULT_THROTTLE_RATES['anon']</code> 来设置频次</p><p>2）UserRateThrottle</p><p>限制认证用户，使用 User 模型的 id 主键 来区分。</p><p>使用 <code>DEFAULT_THROTTLE_RATES['user']</code> 来设置频次</p><p>3）ScopedRateThrottle</p><p>限制用户对于每个视图的访问频次，使用 ip 或 user id。</p><p><span class="exturl" data-url="aHR0cDovL3NldHRpbmdzLnB5">settings.py</span>，代码：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>REST_FRAMEWORK <span class="token operator">=</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token comment"># 限流全局配置</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token string">'DEFAULT_THROTTLE_CLASSES'</span><span class="token punctuation">:</span><span class="token punctuation">[</span> <span class="token comment"># 限流配置类</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token comment">#     'rest_framework.throttling.AnonRateThrottle', # 未认证用户 [未登录用户]</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token comment">#     'rest_framework.throttling.UserRateThrottle', # 已认证用户 [已登录用户]</span></pre></td></tr><tr><td data-num="6"></td><td><pre>        <span class="token string">'rest_framework.throttling.ScopedRateThrottle'</span><span class="token punctuation">,</span> <span class="token comment"># 自定义限流</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token punctuation">]</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token string">'DEFAULT_THROTTLE_RATES'</span><span class="token punctuation">:</span><span class="token punctuation">&#123;</span> <span class="token comment"># 频率配置</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        <span class="token string">'anon'</span><span class="token punctuation">:</span> <span class="token string">'2/day'</span><span class="token punctuation">,</span>  <span class="token comment"># 针对游客的访问频率进行限制，实际上，drf 只是识别首字母，但是为了提高代码的维护性，建议写完整单词</span></pre></td></tr><tr><td data-num="10"></td><td><pre>        <span class="token string">'user'</span><span class="token punctuation">:</span> <span class="token string">'5/day'</span><span class="token punctuation">,</span> <span class="token comment"># 针对会员的访问频率进行限制，</span></pre></td></tr><tr><td data-num="11"></td><td><pre>        <span class="token string">'vip'</span><span class="token punctuation">:</span> <span class="token string">'10/day'</span><span class="token punctuation">,</span> <span class="token comment"># 针对会员的访问频率进行限制，</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>视图代码：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>throttling <span class="token keyword">import</span> UserRateThrottle</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">Student2ModelViewSet</span><span class="token punctuation">(</span>ModelViewSet<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    queryset <span class="token operator">=</span> Student<span class="token punctuation">.</span>objects</pre></td></tr><tr><td data-num="4"></td><td><pre>    serializer_class <span class="token operator">=</span> StudentModelSerializer</pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token comment"># 限流局部配置 [这里需要配合在全局配置中的 DEFAULT_THROTTLE_RATES 来设置频率]</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token comment"># throttle_classes = [UserRateThrottle] # 使用 drf 限流类来配置频率</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    throttle_scope <span class="token operator">=</span> <span class="token string">"vip"</span> <span class="token comment"># 自定义频率</span></pre></td></tr></table></figure><h2 id="过滤filtering"><a class="anchor" href="#过滤filtering">#</a> 过滤 Filtering</h2><p>对于列表数据可能需要根据字段进行过滤，我们可以通过添加 django-fitlter 扩展来增强支持。</p><pre><code class="language-shel">pip install django-filter
</code></pre><p>在配置文件中增加过滤后端的设置：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>INSTALLED_APPS <span class="token operator">=</span> <span class="token punctuation">[</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token string">'django_filters'</span><span class="token punctuation">,</span>  <span class="token comment"># 需要注册应用，</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre>REST_FRAMEWORK <span class="token operator">=</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token string">'DEFAULT_FILTER_BACKENDS'</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token string">'django_filters.rest_framework.DjangoFilterBackend'</span><span class="token punctuation">,</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>在视图类中添加类属性 filter_fields，指定可以过滤的字段</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">StudentListView</span><span class="token punctuation">(</span>ListAPIView<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    queryset <span class="token operator">=</span> Student<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    serializer_class <span class="token operator">=</span> StudentSerializer</pre></td></tr><tr><td data-num="4"></td><td><pre>    filter_fields <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'age'</span><span class="token punctuation">,</span> <span class="token string">'sex'</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token comment"># 127.0.0.1:8000/four/students/?sex=1</span></pre></td></tr></table></figure><h2 id="排序ordering"><a class="anchor" href="#排序ordering">#</a> 排序 Ordering</h2><p>对于列表数据，REST framework 提供了<strong> OrderingFilter</strong> 过滤器来帮助我们快速指明数据按照指定字段进行排序。</p><p>使用方法：</p><p>在类视图中设置 filter_backends，使用 <code>rest_framework.filters.OrderingFilter</code> 过滤器，REST framework 会在请求的查询字符串参数中检查是否包含了 ordering 参数，如果包含了 ordering 参数，则按照 ordering 参数指明的排序字段对数据集进行排序。</p><p>前端可以传递的 ordering 参数的可选字段值需要在 ordering_fields 中指明。</p><p>示例：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">StudentListView</span><span class="token punctuation">(</span>ListAPIView<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    queryset <span class="token operator">=</span> Student<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    serializer_class <span class="token operator">=</span> StudentModelSerializer</pre></td></tr><tr><td data-num="4"></td><td><pre>    filter_backends <span class="token operator">=</span> <span class="token punctuation">[</span>OrderingFilter<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    ordering_fields <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">,</span> <span class="token string">'age'</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token comment"># 127.0.0.1:8000/books/?ordering=-age</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token comment"># -id 表示针对 id 字段进行倒序排序</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token comment"># id  表示针对 id 字段进行升序排序</span></pre></td></tr></table></figure><p>如果需要在过滤以后再次进行排序，则需要两者结合！</p><p>全局配置下的过滤组件不能和排序组件一起使用，只支持局部配置的过滤组件和排序组件一起使用。</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>generics <span class="token keyword">import</span> ListAPIView</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">from</span> students<span class="token punctuation">.</span>models <span class="token keyword">import</span> Student</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">from</span> <span class="token punctuation">.</span>serializers <span class="token keyword">import</span> StudentModelSerializer</pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">from</span> django_filters<span class="token punctuation">.</span>rest_framework <span class="token keyword">import</span> DjangoFilterBackend</pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">Student3ListView</span><span class="token punctuation">(</span>ListAPIView<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    queryset <span class="token operator">=</span> Student<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    serializer_class <span class="token operator">=</span> StudentModelSerializer</pre></td></tr><tr><td data-num="8"></td><td><pre>    filter_fields <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'age'</span><span class="token punctuation">,</span> <span class="token string">'sex'</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token comment"># 因为局部配置会覆盖全局配置，所以需要重新把过滤组件核心类再次声明，</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token comment"># 否则过滤功能会失效</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    filter_backends <span class="token operator">=</span> <span class="token punctuation">[</span>OrderingFilter<span class="token punctuation">,</span>DjangoFilterBackend<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    ordering_fields <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">,</span> <span class="token string">'age'</span><span class="token punctuation">]</span></pre></td></tr></table></figure><h2 id="分页pagination"><a class="anchor" href="#分页pagination">#</a> 分页 Pagination</h2><p>因为 django 默认提供的分页器主要使用于前后端不分离的业务场景，所以 REST framework 也提供了分页的支持。</p><p>我们可以在配置文件中设置全局的分页方式，如：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>REST_FRAMEWORK <span class="token operator">=</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token string">'DEFAULT_PAGINATION_CLASS'</span><span class="token punctuation">:</span>  <span class="token string">'rest_framework.pagination.PageNumberPagination'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token string">'PAGE_SIZE'</span><span class="token punctuation">:</span> <span class="token number">100</span>  <span class="token comment"># 每页数目</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># 如果在配置 settings.py 文件中， 设置了全局分页，那么在 drf 中凡是调用了 ListModelMixin 的 list ()，都会自动分页。如果项目中出现大量需要分页的数据，只有少数部分的分页，则可以在少部分的视图类中关闭分页功能。</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment"># 另外，视图类在使用过分页以后，务必在编写 queryset 属性时，模型.objects 后面调用结果。例如：</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment"># Student.objects.all()</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">Student3ModelViewSet</span><span class="token punctuation">(</span>ListAPIView<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="5"></td><td><pre>	pagination_class <span class="token operator">=</span> <span class="token boolean">None</span></pre></td></tr></table></figure><p>也可通过自定义 Pagination 类，来为视图添加不同分页行为。在视图中通过 <code>pagination_clas</code> 属性来指明。</p><p>可选分页器：</p><p>1） <strong>PageNumberPagination</strong></p><p>前端访问网址形式：</p><figure class="highlight http"><figcaption data-lang="HTTP"></figcaption><table><tr><td data-num="1"></td><td><pre>GET  http://127.0.0.1:8000/students/?page=4</pre></td></tr></table></figure><p>可以在子类中定义的属性：</p><ul><li>page_size 每页数目</li><li>page_query_param 前端发送的页数关键字名，默认为 &quot;page&quot;</li><li>page_size_query_param 前端发送的每页数目关键字名，默认为 None</li><li>max_page_size 前端最多能设置的每页数量</li></ul><p>分页器类， <code>paginations</code> ，代码：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">from</span>  rest_framework<span class="token punctuation">.</span>pagination <span class="token keyword">import</span> PageNumberPagination<span class="token punctuation">,</span>LimitOffsetPagination</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment"># PageNumberPagination，以页码作为分页条件</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment"># page=1&amp;size=10      第 1 页</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment"># page=2&amp;size=10      第 2 页</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment"># ...</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token comment"># LimitOffsetPagination，以数据库查询的 limit 和 offset 数值作为分页条件</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token comment"># limit=10&amp;offset=0   第 1 页</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token comment"># limit=10&amp;offset=10  第 2 页</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token comment"># ...</span></pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token comment"># PageNumberPagination</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">StudentPageNumberPagination</span><span class="token punctuation">(</span>PageNumberPagination<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    page_query_param <span class="token operator">=</span> <span class="token string">"page"</span> <span class="token comment"># 查询字符串中代表页码的变量名</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    page_size_query_param <span class="token operator">=</span> <span class="token string">"size"</span> <span class="token comment"># 查询字符串中代表每一页数据的变量名</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    page_size <span class="token operator">=</span> <span class="token number">2</span> <span class="token comment"># 每一页的数据量</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    max_page_size <span class="token operator">=</span> <span class="token number">4</span> <span class="token comment"># 允许客户端通过查询字符串调整的最大单页数据量</span></pre></td></tr></table></figure><p>视图， <code>views</code> ，代码：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">from</span> <span class="token punctuation">.</span>paginations <span class="token keyword">import</span> StudentPageNumberPagination<span class="token punctuation">,</span>StudentLimitOffsetPagination</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">Student3ModelViewSet</span><span class="token punctuation">(</span>ModelViewSet<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    queryset <span class="token operator">=</span> Student<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    serializer_class <span class="token operator">=</span> StudentModelSerializer</pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token comment"># 取消当前视图类的分页效果</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token comment"># pagination_class = None</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token comment"># 局部分页</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    pagination_class <span class="token operator">=</span> StudentPageNumberPagination</pre></td></tr></table></figure><p>2）<strong>LimitOffsetPagination</strong></p><p>前端访问网址形式：</p><figure class="highlight http"><figcaption data-lang="HTTP"></figcaption><table><tr><td data-num="1"></td><td><pre>GET http://127.0.0.1/four/students/?limit=100&amp;offset=100</pre></td></tr></table></figure><p>可以在子类中定义的属性：</p><ul><li>default_limit 默认限制，默认值与 <code>PAGE_SIZE</code> 设置一直</li><li>limit_query_param limit 参数名，默认 'limit'</li><li>offset_query_param offset 参数名，默认 'offset'</li><li>max_limit 最大 limit 限制，默认 None</li></ul><p>分页类，代码：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">from</span>  rest_framework<span class="token punctuation">.</span>pagination <span class="token keyword">import</span> PageNumberPagination<span class="token punctuation">,</span>LimitOffsetPagination</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment"># PageNumberPagination，以页码作为分页条件</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment"># page=1&amp;size=10      第 1 页</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment"># page=2&amp;size=10      第 2 页</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment"># LimitOffsetPagination，以数据库查询的 limit 和 offset 数值作为分页条件</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token comment"># limit=10&amp;offset=0   第 1 页</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token comment"># limit=10&amp;offset=10  第 2 页</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token comment"># LimitOffsetPagination</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">StudentLimitOffsetPagination</span><span class="token punctuation">(</span>LimitOffsetPagination<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    limit_query_param <span class="token operator">=</span> <span class="token string">"limit"</span> <span class="token comment"># 查询字符串中代表每一页数据的变量名</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    offset_query_param <span class="token operator">=</span> <span class="token string">"offset"</span> <span class="token comment"># 查询字符串中代表页码的变量名</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    default_limit <span class="token operator">=</span> <span class="token number">2</span> <span class="token comment"># 每一页的数据量</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    max_limit <span class="token operator">=</span> <span class="token number">4</span> <span class="token comment"># 允许客户端通过查询字符串调整的最大单页数据量</span></pre></td></tr></table></figure><p>视图， <code>views</code> ，代码：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">from</span> <span class="token punctuation">.</span>paginations <span class="token keyword">import</span> StudentPageNumberPagination<span class="token punctuation">,</span>StudentLimitOffsetPagination</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">Student3ModelViewSet</span><span class="token punctuation">(</span>ModelViewSet<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    queryset <span class="token operator">=</span> Student<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    serializer_class <span class="token operator">=</span> StudentModelSerializer</pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token comment"># 取消当前视图类的分页效果</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token comment"># pagination_class = None</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token comment"># 局部分页</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    pagination_class <span class="token operator">=</span> StudentLimitOffsetPagination</pre></td></tr></table></figure><h2 id="异常处理-exceptions"><a class="anchor" href="#异常处理-exceptions">#</a> 异常处理 Exceptions</h2><p>REST framework 提供了异常处理，我们可以自定义异常处理函数。例如我们想在要创建一个自定义异常函数，</p><p>这个函数，我们保存到当前子应用 opt 中 [注意，开发时，我们会找个独立的公共目录来保存这种公共的函数 / 工具 / 类库]。</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>views <span class="token keyword">import</span> exception_handler</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">def</span> <span class="token function">custom_exception_handler</span><span class="token punctuation">(</span>exc<span class="token punctuation">,</span> context<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token comment"># 先调用 REST framework 默认的异常处理方法获得标准错误响应对象</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    response <span class="token operator">=</span> exception_handler<span class="token punctuation">(</span>exc<span class="token punctuation">,</span> context<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token comment"># 在此处补充自定义的异常处理</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token keyword">if</span> response <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        response<span class="token punctuation">.</span>data<span class="token punctuation">[</span><span class="token string">'status_code'</span><span class="token punctuation">]</span> <span class="token operator">=</span> response<span class="token punctuation">.</span>status_code</pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token keyword">return</span> response</pre></td></tr></table></figure><p>在配置文件中声明自定义的异常处理， <code>settings</code> ，代码：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>REST_FRAMEWORK <span class="token operator">=</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token string">'EXCEPTION_HANDLER'</span><span class="token punctuation">:</span> <span class="token string">'drfdemo.exceptions.custom_excetion_handle'</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>如果未声明，会采用默认的方式，如下</p><p>rest_frame/settings.py</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>REST_FRAMEWORK <span class="token operator">=</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token string">'EXCEPTION_HANDLER'</span><span class="token punctuation">:</span> <span class="token string">'rest_framework.views.exception_handler'</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>例如：</p><p>补充上处理关于数据库的异常，这里使用其他异常来举例：</p><p><code>主应用.exceptions</code> ，代码：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># 自定义异常函数：在 drf 本身提供的异常函数基础上，我们增加更多的异常处理就可以了。</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>views <span class="token keyword">import</span> exception_handler</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">from</span> django<span class="token punctuation">.</span>db <span class="token keyword">import</span> DatabaseError</pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">from</span> rest_framework <span class="token keyword">import</span> status</pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>response <span class="token keyword">import</span> Response</pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">def</span> <span class="token function">custom_excetion_handle</span><span class="token punctuation">(</span>exc<span class="token punctuation">,</span> context<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token triple-quoted-string string">"""</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    自定义异常函数，必须要在配置文件中注册才能被drf使用</pre></td></tr><tr><td data-num="9"></td><td><pre>    exc: 异常对象，本次发生的异常对象</pre></td></tr><tr><td data-num="10"></td><td><pre>    context: 字典，本次发生异常时，python解析器提供的执行上下文</pre></td></tr><tr><td data-num="11"></td><td><pre>    所谓的执行上下文[context]，就是程序执行到当前一行代码时，能提供给开发者调用的环境信息异常发生时，代码所在的路径，时间，视图，客户端http请求等等...]</pre></td></tr><tr><td data-num="12"></td><td><pre>    """</pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token comment"># 先让 drf 处理它能识别的异常</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    response <span class="token operator">=</span> exception_handler<span class="token punctuation">(</span>exc<span class="token punctuation">,</span> context<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token comment"># 在经过了 drf 的异常处理以后，还是返回 None 则表示有 2 种情况:</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token keyword">if</span> response <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="17"></td><td><pre>        <span class="token comment"># 异常发生时的视图对象</span></pre></td></tr><tr><td data-num="18"></td><td><pre>        view <span class="token operator">=</span> context<span class="token punctuation">[</span><span class="token string">'view'</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="19"></td><td><pre>        <span class="token comment"># 异常发生时的 http 请求</span></pre></td></tr><tr><td data-num="20"></td><td><pre>        request <span class="token operator">=</span> context<span class="token punctuation">[</span><span class="token string">"request"</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="21"></td><td><pre>        <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>exc<span class="token punctuation">,</span> DatabaseError<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="22"></td><td><pre>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'[%s]: %s'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>view<span class="token punctuation">,</span> exc<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="23"></td><td><pre>            response <span class="token operator">=</span> Response<span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">'detail'</span><span class="token punctuation">:</span> <span class="token string">'服务器内部错误'</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> status<span class="token operator">=</span>status<span class="token punctuation">.</span>HTTP_507_INSUFFICIENT_STORAGE<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="24"></td><td><pre></pre></td></tr><tr><td data-num="25"></td><td><pre>        <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>exc<span class="token punctuation">,</span> TypeError<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="26"></td><td><pre>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"0不能作为除数~"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="27"></td><td><pre>            <span class="token keyword">print</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="28"></td><td><pre>            response <span class="token operator">=</span> Response<span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">'detail'</span><span class="token punctuation">:</span> <span class="token string">'0不能作为除数'</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> status<span class="token operator">=</span>status<span class="token punctuation">.</span>HTTP_500_INTERNAL_SERVER_ERROR<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="29"></td><td><pre></pre></td></tr><tr><td data-num="30"></td><td><pre>    <span class="token keyword">return</span> response</pre></td></tr></table></figure><p>视图中，故意报错：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">from</span> <span class="token punctuation">.</span>paginations <span class="token keyword">import</span> StudentPageNumberPagination<span class="token punctuation">,</span>StudentLimitOffsetPagination</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">Student3ModelViewSet</span><span class="token punctuation">(</span>ModelViewSet<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    queryset <span class="token operator">=</span> Student<span class="token punctuation">.</span>objects  <span class="token comment"># 去掉 .all ()，就会报错。</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    serializer_class <span class="token operator">=</span> StudentModelSerializer</pre></td></tr><tr><td data-num="5"></td><td><pre>    pagination_class <span class="token operator">=</span> StudentPageNumberPagination</pre></td></tr></table></figure><h3 id="rest-framework定义的异常"><a class="anchor" href="#rest-framework定义的异常">#</a> REST framework 定义的异常</h3><ul><li>APIException 所有异常的父类</li><li>ParseError 解析错误</li><li>AuthenticationFailed 认证失败</li><li>NotAuthenticated 尚未认证</li><li>PermissionDenied 权限决绝</li><li>NotFound 未找到</li><li>MethodNotAllowed 请求方式不支持</li><li>NotAcceptable 要获取的数据格式不支持</li><li>Throttled 超过限流次数</li><li>ValidationError 校验失败</li></ul><p>也就是说，很多的没有在上面列出来的异常，就需要我们在自定义异常中自己处理了。</p><h2 id="自动生成接口文档"><a class="anchor" href="#自动生成接口文档">#</a> 自动生成接口文档</h2><p>REST framework 可以自动帮助我们生成接口文档。</p><p>接口文档以网页的方式呈现。</p><p>自动接口文档能生成的是继承自 <code>APIView</code> 及其子类的视图。</p><h3 id="安装依赖"><a class="anchor" href="#安装依赖">#</a> 安装依赖</h3><p>REST framewrok 生成接口文档需要 <code>coreapi</code> 库的支持。</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>pip install coreapi</pre></td></tr></table></figure><h3 id="设置接口文档访问路径"><a class="anchor" href="#设置接口文档访问路径">#</a> 设置接口文档访问路径</h3><p>在总路由中添加接口文档路径。</p><p>文档路由对应的视图配置为 <code>rest_framework.documentation.include_docs_urls</code> ，</p><p>参数 <code>title</code> 为接口文档网站的标题。总路由，代码：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>documentation <span class="token keyword">import</span> include_docs_urls</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre>urlpatterns <span class="token operator">=</span> <span class="token punctuation">[</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    path<span class="token punctuation">(</span><span class="token string">'docs/'</span><span class="token punctuation">,</span> include_docs_urls<span class="token punctuation">(</span>title<span class="token operator">=</span><span class="token string">'站点页面标题'</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">]</span></pre></td></tr></table></figure><p>在 settings.py 中配置接口文档。</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>REST_FRAMEWORK <span class="token operator">=</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token comment"># 。。。 其他选项</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token comment"># 接口文档</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token string">'DEFAULT_SCHEMA_CLASS'</span><span class="token punctuation">:</span> <span class="token string">'rest_framework.schemas.AutoSchema'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h3 id="文档描述说明的定义位置"><a class="anchor" href="#文档描述说明的定义位置">#</a> 文档描述说明的定义位置</h3><p>1） 单一方法的视图，可直接使用类视图的文档字符串，如</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">BookListView</span><span class="token punctuation">(</span>generics<span class="token punctuation">.</span>ListAPIView<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token triple-quoted-string string">"""</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    返回所有图书信息.</pre></td></tr><tr><td data-num="4"></td><td><pre>    """</pre></td></tr></table></figure><p>2）包含多个方法的视图，在类视图的文档字符串中，分开方法定义，如</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">BookListCreateView</span><span class="token punctuation">(</span>generics<span class="token punctuation">.</span>ListCreateAPIView<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token triple-quoted-string string">"""</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    get:</pre></td></tr><tr><td data-num="4"></td><td><pre>    返回所有图书信息.</pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre>    post:</pre></td></tr><tr><td data-num="7"></td><td><pre>    新建图书.</pre></td></tr><tr><td data-num="8"></td><td><pre>    """</pre></td></tr></table></figure><p>3）对于视图集 ViewSet，仍在类视图的文档字符串中封开定义，但是应使用 action 名称区分，如</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">BookInfoViewSet</span><span class="token punctuation">(</span>mixins<span class="token punctuation">.</span>ListModelMixin<span class="token punctuation">,</span> mixins<span class="token punctuation">.</span>RetrieveModelMixin<span class="token punctuation">,</span> GenericViewSet<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token triple-quoted-string string">"""</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    list:</pre></td></tr><tr><td data-num="4"></td><td><pre>    返回图书列表数据</pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre>    retrieve:</pre></td></tr><tr><td data-num="7"></td><td><pre>    返回图书详情数据</pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre>    latest:</pre></td></tr><tr><td data-num="10"></td><td><pre>    返回最新的图书数据</pre></td></tr><tr><td data-num="11"></td><td><pre></pre></td></tr><tr><td data-num="12"></td><td><pre>    read:</pre></td></tr><tr><td data-num="13"></td><td><pre>    修改图书的阅读量</pre></td></tr><tr><td data-num="14"></td><td><pre>    """</pre></td></tr></table></figure><h3 id="访问接口文档网页"><a class="anchor" href="#访问接口文档网页">#</a> 访问接口文档网页</h3><p>浏览器访问 127.0.0.1:8000/docs/，即可看到自动生成的接口文档。</p><p><img data-src="/./images/DRF/%E6%8E%A5%E5%8F%A3%E6%96%87%E6%A1%A3%E9%A1%B5%E9%9D%A2.png" alt></p><p>两点说明：</p><p>1） 视图集 ViewSet 中的 retrieve 名称，在接口文档网站中叫做 read</p><p>2）参数的 Description 需要在模型类或序列化器类的字段中以 help_text 选项定义，如：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">Student</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    age <span class="token operator">=</span> models<span class="token punctuation">.</span>IntegerField<span class="token punctuation">(</span>default<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> verbose_name<span class="token operator">=</span><span class="token string">'年龄'</span><span class="token punctuation">,</span> help_text<span class="token operator">=</span><span class="token string">'年龄'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></pre></td></tr></table></figure><p>或</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">StudentSerializer</span><span class="token punctuation">(</span>serializers<span class="token punctuation">.</span>ModelSerializer<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">class</span> <span class="token class-name">Meta</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="3"></td><td><pre>        model <span class="token operator">=</span> Student</pre></td></tr><tr><td data-num="4"></td><td><pre>        fields <span class="token operator">=</span> <span class="token string">"__all__"</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        extra_kwargs <span class="token operator">=</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>            <span class="token string">'age'</span><span class="token punctuation">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>                <span class="token string">'required'</span><span class="token punctuation">:</span> <span class="token boolean">True</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="8"></td><td><pre>                <span class="token string">'help_text'</span><span class="token punctuation">:</span> <span class="token string">'年龄'</span></pre></td></tr><tr><td data-num="9"></td><td><pre>            <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr></table></figure><div class="tags"><a href="/tags/django/" rel="tag"><i class="ic i-tag"></i> django</a></div></div><footer><div class="meta"><span class="item"><span class="icon"><i class="ic i-calendar-check"></i> </span><span class="text">更新于</span> <time title="修改时间：2022-09-16 17:33:10" itemprop="dateModified" datetime="2022-09-16T17:33:10+08:00">2022-09-16</time></span></div><div class="reward"><button><i class="ic i-heartbeat"></i> 赞赏</button><p>请我喝[茶]~(￣▽￣)~*</p><div id="qr"><div><img data-src="/images/wechatpay.png" alt="yuan 微信支付"><p>微信支付</p></div><div><img data-src="/images/alipay.png" alt="yuan 支付宝"><p>支付宝</p></div><div><img data-src="/images/paypal.png" alt="yuan 贝宝"><p>贝宝</p></div></div></div><div id="copyright"><ul><li class="author"><strong>本文作者： </strong>yuan <i class="ic i-at"><em>@</em></i>yuan</li><li class="link"><strong>本文链接：</strong> <a href="https://jyuanhust.github.io/2022/08/26/backend/django/DRF%E7%BB%84%E4%BB%B6/" title="DRF组件">https://jyuanhust.github.io/2022/08/26/backend/django/DRF组件/</a></li><li class="license"><strong>版权声明： </strong>本站所有文章除特别声明外，均采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> 许可协议。转载请注明出处！</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/2022/08/26/tools/%E7%88%AC%E8%99%AB/scrapy-Item-%E5%8A%A0%E8%BD%BD%E5%99%A8/" itemprop="url" rel="prev" data-background-image="https:&#x2F;&#x2F;gitee.com&#x2F;zkz0&#x2F;image&#x2F;raw&#x2F;master&#x2F;img&#x2F;img(66).webp" title="scrapy-Item-加载器"><span class="type">上一篇</span> <span class="category"><i class="ic i-flag"></i> 爬虫</span><h3>scrapy-Item-加载器</h3></a></div><div class="item right"><a href="/2022/09/01/frontend/javascript/JavaScript%E7%9A%84JSON%E6%95%B0%E6%8D%AE%E6%A0%BC%E5%BC%8F/" itemprop="url" rel="next" data-background-image="https:&#x2F;&#x2F;gitee.com&#x2F;zkz0&#x2F;image&#x2F;raw&#x2F;master&#x2F;img&#x2F;img(19).webp" title="JavaScript的JSON数据格式"><span class="type">下一篇</span> <span class="category"><i class="ic i-flag"></i> 前端</span><h3>JavaScript的JSON数据格式</h3></a></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="文章目录"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#drf"><span class="toc-number">1.</span> <span class="toc-text">DRF</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web%E5%BA%94%E7%94%A8%E6%A8%A1%E5%BC%8F"><span class="toc-number">2.</span> <span class="toc-text">Web 应用模式</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#api%E6%8E%A5%E5%8F%A3"><span class="toc-number">3.</span> <span class="toc-text">api 接口</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#restful-api%E8%A7%84%E8%8C%83"><span class="toc-number">4.</span> <span class="toc-text">RESTful API 规范</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B9%82%E7%AD%89%E6%80%A7"><span class="toc-number">4.1.</span> <span class="toc-text">幂等性</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%BA%8F%E5%88%97%E5%8C%96"><span class="toc-number">5.</span> <span class="toc-text">序列化</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#django_rest_framework"><span class="toc-number">6.</span> <span class="toc-text">Django_Rest_Framework</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%8E%AF%E5%A2%83%E5%AE%89%E8%A3%85%E4%B8%8E%E9%85%8D%E7%BD%AE"><span class="toc-number">7.</span> <span class="toc-text">环境安装与配置</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E8%A3%85drf"><span class="toc-number">7.1.</span> <span class="toc-text">安装 DRF</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BAdjango%E9%A1%B9%E7%9B%AE"><span class="toc-number">7.1.1.</span> <span class="toc-text">创建 django 项目</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0rest_framework%E5%BA%94%E7%94%A8"><span class="toc-number">7.2.</span> <span class="toc-text">添加 rest_framework 应用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BF%AB%E9%80%9F%E4%BD%93%E9%AA%8C"><span class="toc-number">7.3.</span> <span class="toc-text">快速体验</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%AD%90%E5%BA%94%E7%94%A8"><span class="toc-number">7.3.1.</span> <span class="toc-text">创建子应用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E6%A8%A1%E5%9E%8B%E6%93%8D%E4%BD%9C%E7%B1%BB"><span class="toc-number">7.3.2.</span> <span class="toc-text">创建模型操作类</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%89%A7%E8%A1%8C%E6%95%B0%E6%8D%AE%E8%BF%81%E7%A7%BB"><span class="toc-number">7.3.2.1.</span> <span class="toc-text">执行数据迁移</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%BA%8F%E5%88%97%E5%8C%96%E5%99%A8"><span class="toc-number">7.3.3.</span> <span class="toc-text">创建序列化器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%96%E5%86%99%E8%A7%86%E5%9B%BE"><span class="toc-number">7.3.4.</span> <span class="toc-text">编写视图</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9A%E4%B9%89%E8%B7%AF%E7%94%B1"><span class="toc-number">7.3.5.</span> <span class="toc-text">定义路由</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%90%E8%A1%8C%E6%B5%8B%E8%AF%95"><span class="toc-number">7.3.6.</span> <span class="toc-text">运行测试</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#apiview%E8%A7%86%E5%9B%BE"><span class="toc-number">8.</span> <span class="toc-text">APIView 视图</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AF%B7%E6%B1%82"><span class="toc-number">8.1.</span> <span class="toc-text">请求</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E5%B1%9E%E6%80%A7"><span class="toc-number">8.1.1.</span> <span class="toc-text">常用属性</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#data"><span class="toc-number">8.1.1.1.</span> <span class="toc-text">.data</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#query_params"><span class="toc-number">8.1.1.2.</span> <span class="toc-text">.query_params</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#request_request"><span class="toc-number">8.1.1.3.</span> <span class="toc-text">request._request</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8"><span class="toc-number">8.1.2.</span> <span class="toc-text">基本使用</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%93%8D%E5%BA%94"><span class="toc-number">8.2.</span> <span class="toc-text">响应</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9E%84%E9%80%A0%E6%96%B9%E5%BC%8F"><span class="toc-number">8.2.0.1.</span> <span class="toc-text">构造方式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#response%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%B1%9E%E6%80%A7"><span class="toc-number">8.2.0.2.</span> <span class="toc-text">response 对象的属性</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%8A%B6%E6%80%81%E7%A0%81"><span class="toc-number">8.2.0.3.</span> <span class="toc-text">状态码</span></a></li></ol></li></ol></li></ol><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%BA%8F%E5%88%97%E5%8C%96%E5%99%A8-serializer"><span class="toc-number">9.</span> <span class="toc-text">序列化器 - Serializer</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9A%E4%B9%89%E5%BA%8F%E5%88%97%E5%8C%96%E5%99%A8"><span class="toc-number">9.1.</span> <span class="toc-text">定义序列化器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9B%E5%BB%BAserializer%E5%AF%B9%E8%B1%A1"><span class="toc-number">9.2.</span> <span class="toc-text">创建 Serializer 对象</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BA%8F%E5%88%97%E5%8C%96%E5%99%A8%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-number">9.3.</span> <span class="toc-text">序列化器的使用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BA%8F%E5%88%97%E5%8C%96-2"><span class="toc-number">9.3.1.</span> <span class="toc-text">序列化</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E5%BA%8F%E5%88%97%E5%8C%96"><span class="toc-number">9.3.1.1.</span> <span class="toc-text">基本序列化</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%B3%E8%81%94%E5%AD%97%E6%AE%B5%E5%BA%8F%E5%88%97%E5%8C%96"><span class="toc-number">9.3.1.2.</span> <span class="toc-text">关联字段序列化</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96"><span class="toc-number">9.3.2.</span> <span class="toc-text">反序列化</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E9%AA%8C%E8%AF%81"><span class="toc-number">9.3.2.1.</span> <span class="toc-text">数据验证</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#validate_%E5%AD%97%E6%AE%B5%E5%90%8D"><span class="toc-number">9.3.2.1.1.</span> <span class="toc-text">validate_字段名</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#validate"><span class="toc-number">9.3.2.1.2.</span> <span class="toc-text">validate</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96-%E4%BF%9D%E5%AD%98%E6%95%B0%E6%8D%AE"><span class="toc-number">9.3.2.2.</span> <span class="toc-text">反序列化 - 保存数据</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%99%84%E5%8A%A0%E8%AF%B4%E6%98%8E"><span class="toc-number">9.3.2.3.</span> <span class="toc-text">附加说明</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A8%A1%E5%9E%8B%E7%B1%BB%E5%BA%8F%E5%88%97%E5%8C%96%E5%99%A8"><span class="toc-number">9.3.3.</span> <span class="toc-text">模型类序列化器</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9A%E4%B9%89"><span class="toc-number">9.3.3.1.</span> <span class="toc-text">定义</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8C%87%E5%AE%9A%E5%AD%97%E6%AE%B5"><span class="toc-number">9.3.3.2.</span> <span class="toc-text">指定字段</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E9%A2%9D%E5%A4%96%E5%8F%82%E6%95%B0"><span class="toc-number">9.3.3.3.</span> <span class="toc-text">添加额外参数</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%A7%86%E5%9B%BE"><span class="toc-number">10.</span> <span class="toc-text">视图</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%A4%E4%B8%AA%E8%A7%86%E5%9B%BE%E5%9F%BA%E7%B1%BB"><span class="toc-number">10.1.</span> <span class="toc-text">两个视图基类</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#apiview%E5%9F%BA%E6%9C%AC%E8%A7%86%E5%9B%BE%E7%B1%BB"><span class="toc-number">10.1.1.</span> <span class="toc-text">APIView [基本视图类]</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#genericapiview%E9%80%9A%E7%94%A8%E8%A7%86%E5%9B%BE%E7%B1%BB"><span class="toc-number">10.1.2.</span> <span class="toc-text">GenericAPIView [通用视图类]</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#get_serializer_classself"><span class="toc-number">10.1.2.1.</span> <span class="toc-text">get_serializer_class(self)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#get_serializerself-args-kwargs"><span class="toc-number">10.1.2.2.</span> <span class="toc-text">get_serializer(self, *args, **kwargs)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#get_querysetself"><span class="toc-number">10.1.2.3.</span> <span class="toc-text">get_queryset(self)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#get_objectself"><span class="toc-number">10.1.2.4.</span> <span class="toc-text">get_object(self)</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5%E4%B8%AA%E8%A7%86%E5%9B%BE%E6%89%A9%E5%B1%95%E7%B1%BB"><span class="toc-number">10.2.</span> <span class="toc-text">5 个视图扩展类</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#listmodelmixin"><span class="toc-number">10.2.0.1.</span> <span class="toc-text">ListModelMixin</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#createmodelmixin"><span class="toc-number">10.2.0.2.</span> <span class="toc-text">CreateModelMixin</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#retrievemodelmixin"><span class="toc-number">10.2.0.3.</span> <span class="toc-text">RetrieveModelMixin</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#updatemodelmixin"><span class="toc-number">10.2.0.4.</span> <span class="toc-text">UpdateModelMixin</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#destroymodelmixin"><span class="toc-number">10.2.0.5.</span> <span class="toc-text">DestroyModelMixin</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#genericapiview%E7%9A%84%E8%A7%86%E5%9B%BE%E5%AD%90%E7%B1%BB"><span class="toc-number">10.3.</span> <span class="toc-text">GenericAPIView 的视图子类</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#createapiview"><span class="toc-number">10.3.0.1.</span> <span class="toc-text">CreateAPIView</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#listapiview"><span class="toc-number">10.3.0.2.</span> <span class="toc-text">ListAPIView</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#retrieveapiview"><span class="toc-number">10.3.0.3.</span> <span class="toc-text">RetrieveAPIView</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#destoryapiview"><span class="toc-number">10.3.0.4.</span> <span class="toc-text">DestoryAPIView</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#updateapiview"><span class="toc-number">10.3.0.5.</span> <span class="toc-text">UpdateAPIView</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#listcreateapiview"><span class="toc-number">10.3.0.6.</span> <span class="toc-text">ListCreateAPIView</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#retrieveupdateapiview"><span class="toc-number">10.3.0.7.</span> <span class="toc-text">RetrieveUpdateAPIView</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#retrievedestoryapiview"><span class="toc-number">10.3.0.8.</span> <span class="toc-text">RetrieveDestoryAPIView</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#retrieveupdatedestoryapiview"><span class="toc-number">10.3.0.9.</span> <span class="toc-text">RetrieveUpdateDestoryAPIView</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%86%E5%9B%BE%E9%9B%86"><span class="toc-number">10.4.</span> <span class="toc-text">视图集</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#viewset"><span class="toc-number">10.4.1.</span> <span class="toc-text">ViewSet</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#genericviewset"><span class="toc-number">10.4.2.</span> <span class="toc-text">GenericViewSet</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#modelviewset%E5%92%8Creadonlymodelviewset"><span class="toc-number">10.4.3.</span> <span class="toc-text">ModelViewSet 和 ReadOnlyModelViewSet</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%B7%AF%E7%94%B1routers"><span class="toc-number">11.</span> <span class="toc-text">路由 Routers</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95"><span class="toc-number">11.1.</span> <span class="toc-text">使用方法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%86%E5%9B%BE%E9%9B%86%E4%B8%AD%E9%99%84%E5%8A%A0action%E7%9A%84%E5%A3%B0%E6%98%8E"><span class="toc-number">11.2.</span> <span class="toc-text">视图集中附加 action 的声明</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B7%AF%E7%94%B1router%E5%BD%A2%E6%88%90url%E7%9A%84%E6%96%B9%E5%BC%8F"><span class="toc-number">11.3.</span> <span class="toc-text">路由 router 形成 URL 的方式</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%85%B6%E5%AE%83%E5%8A%9F%E8%83%BD%E7%BB%84%E4%BB%B6"><span class="toc-number">12.</span> <span class="toc-text">其它功能组件</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%A4%E8%AF%81authentication"><span class="toc-number">12.1.</span> <span class="toc-text">认证 Authentication</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9D%83%E9%99%90permissions"><span class="toc-number">12.2.</span> <span class="toc-text">权限 Permissions</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8"><span class="toc-number">12.2.1.</span> <span class="toc-text">使用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8F%90%E4%BE%9B%E7%9A%84%E6%9D%83%E9%99%90"><span class="toc-number">12.2.2.</span> <span class="toc-text">提供的权限</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BE%E4%BE%8B"><span class="toc-number">12.2.3.</span> <span class="toc-text">举例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E6%9D%83%E9%99%90"><span class="toc-number">12.2.4.</span> <span class="toc-text">自定义权限</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%99%90%E6%B5%81throttling"><span class="toc-number">12.3.</span> <span class="toc-text">限流 Throttling</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8-2"><span class="toc-number">12.3.1.</span> <span class="toc-text">基本使用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%AF%E9%80%89%E9%99%90%E6%B5%81%E7%B1%BB"><span class="toc-number">12.3.2.</span> <span class="toc-text">可选限流类</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%87%E6%BB%A4filtering"><span class="toc-number">12.4.</span> <span class="toc-text">过滤 Filtering</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8E%92%E5%BA%8Fordering"><span class="toc-number">12.5.</span> <span class="toc-text">排序 Ordering</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%86%E9%A1%B5pagination"><span class="toc-number">12.6.</span> <span class="toc-text">分页 Pagination</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86-exceptions"><span class="toc-number">12.7.</span> <span class="toc-text">异常处理 Exceptions</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#rest-framework%E5%AE%9A%E4%B9%89%E7%9A%84%E5%BC%82%E5%B8%B8"><span class="toc-number">12.7.1.</span> <span class="toc-text">REST framework 定义的异常</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%87%AA%E5%8A%A8%E7%94%9F%E6%88%90%E6%8E%A5%E5%8F%A3%E6%96%87%E6%A1%A3"><span class="toc-number">12.8.</span> <span class="toc-text">自动生成接口文档</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85%E4%BE%9D%E8%B5%96"><span class="toc-number">12.8.1.</span> <span class="toc-text">安装依赖</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E6%8E%A5%E5%8F%A3%E6%96%87%E6%A1%A3%E8%AE%BF%E9%97%AE%E8%B7%AF%E5%BE%84"><span class="toc-number">12.8.2.</span> <span class="toc-text">设置接口文档访问路径</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%87%E6%A1%A3%E6%8F%8F%E8%BF%B0%E8%AF%B4%E6%98%8E%E7%9A%84%E5%AE%9A%E4%B9%89%E4%BD%8D%E7%BD%AE"><span class="toc-number">12.8.3.</span> <span class="toc-text">文档描述说明的定义位置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BF%E9%97%AE%E6%8E%A5%E5%8F%A3%E6%96%87%E6%A1%A3%E7%BD%91%E9%A1%B5"><span class="toc-number">12.8.4.</span> <span class="toc-text">访问接口文档网页</span></a></li></ol></li></ol></li></div><div class="related panel pjax" data-title="系列文章"><ul><li><a href="/2022/07/24/backend/django/django/" rel="bookmark" title="初识django">初识django</a></li><li><a href="/2022/08/24/backend/django/django%E4%B8%AD%E9%81%87%E5%88%B0%E9%94%99%E8%AF%AF%EF%BC%9AForbidden-CSRF-cookie-not-set/" rel="bookmark" title="django中遇到错误：Forbidden_CSRF_cookie_not_set">django中遇到错误：Forbidden_CSRF_cookie_not_set</a></li><li><a href="/2022/08/24/backend/django/%E8%AE%BF%E9%97%AEdjango%E5%90%8E%E5%8F%B0%EF%BC%8C%E6%8F%90%E7%A4%BACSRF%E9%AA%8C%E8%AF%81%E5%A4%B1%E8%B4%A5-%E8%AF%B7%E6%B1%82%E8%A2%AB%E4%B8%AD%E6%96%AD-Referer-checking-failed-does-not-match-any-trust/" rel="bookmark" title="访问django后台，提示CSRF验证失败._请求被中断.Referer_checking_failed_-_does_not_match_any_trust">访问django后台，提示CSRF验证失败._请求被中断.Referer_checking_failed_-_does_not_match_any_trust</a></li><li><a href="/2022/08/25/backend/django/websocket-django/" rel="bookmark" title="websocket-django">websocket-django</a></li><li><a href="/2022/08/25/backend/django/%E5%91%98%E5%B7%A5%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F-django/" rel="bookmark" title="员工管理系统-django">员工管理系统-django</a></li><li><a href="/2022/08/25/backend/django/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0-django/" rel="bookmark" title="文件上传-django">文件上传-django</a></li><li class="active"><a href="/2022/08/26/backend/django/DRF%E7%BB%84%E4%BB%B6/" rel="bookmark" title="DRF组件">DRF组件</a></li><li><a href="/2022/09/12/backend/django/django%E9%85%8D%E7%BD%AE%E8%B7%A8%E5%9F%9F%E8%AF%B7%E6%B1%82/" rel="bookmark" title="django配置跨域请求">django配置跨域请求</a></li><li><a href="/2022/09/13/backend/django/%E5%9C%A8app%E6%96%87%E4%BB%B6%E5%A4%B9%E4%B8%8Btests%E6%A8%A1%E5%9D%97%E4%B8%AD%E6%B5%8B%E8%AF%95/" rel="bookmark" title="在app文件夹下tests模块中测试">在app文件夹下tests模块中测试</a></li><li><a href="/2022/09/14/backend/django/drf%E5%AE%98%E7%BD%91%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/" rel="bookmark" title="drf官网阅读笔记">drf官网阅读笔记</a></li><li><a href="/2022/09/15/backend/django/jwt-django/" rel="bookmark" title="jwt-django">jwt-django</a></li></ul></div><div class="overview panel" data-title="站点概览"><div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="image" itemprop="image" alt="yuan" data-src="/images/avatar.jpg"><p class="name" itemprop="name">yuan</p><div class="description" itemprop="description"></div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">429</span> <span class="name">文章</span></a></div><div class="item categories"><a href="/categories/"><span class="count">72</span> <span class="name">分类</span></a></div><div class="item tags"><a href="/tags/"><span class="count">61</span> <span class="name">标签</span></a></div></nav><div class="social"><span class="exturl item email" data-url="bWFpbHRvOjIwODM2MzU1MjVAcXEuY29t" title="mailto:2083635525@qq.com"><i class="ic i-envelope"></i></span></div><ul class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>首页</a></li><li class="item"><a href="/about/" rel="section"><i class="ic i-user"></i>关于</a></li><li class="item dropdown"><a href="javascript:void(0);"><i class="ic i-feather"></i>文章</a><ul class="submenu"><li class="item"><a href="/archives/" rel="section"><i class="ic i-list-alt"></i>归档</a></li><li class="item"><a href="/categories/" rel="section"><i class="ic i-th"></i>分类</a></li><li class="item"><a href="/tags/" rel="section"><i class="ic i-tags"></i>标签</a></li></ul></li><li class="item"><a href="/friends/" rel="section"><i class="ic i-heart"></i>友達</a></li><li class="item"><a href="/links/" rel="section"><i class="ic i-magic"></i>链接</a></li></ul></div></div></div><ul id="quick"><li class="prev pjax"><a href="/2022/08/26/tools/%E7%88%AC%E8%99%AB/scrapy-Item-%E5%8A%A0%E8%BD%BD%E5%99%A8/" rel="prev" title="上一篇"><i class="ic i-chevron-left"></i></a></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href="/2022/09/01/frontend/javascript/JavaScript%E7%9A%84JSON%E6%95%B0%E6%8D%AE%E6%A0%BC%E5%BC%8F/" rel="next" title="下一篇"><i class="ic i-chevron-right"></i></a></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>随机文章</h2><ul><li class="item"><div class="breadcrumb"><a href="/categories/computer-science/" title="分类于 computer-science">computer-science</a></div><span><a href="/2023/02/27/computer-science/%E6%AF%94%E8%B5%9B/%E8%93%9D%E6%A1%A5%E6%9D%AF/note/" title="蓝桥杯省赛题目理解">蓝桥杯省赛题目理解</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/ai/" title="分类于 ai">ai</a> <i class="ic i-angle-right"></i> <a href="/categories/ai/pytorch%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/" title="分类于 pytorch深度学习">pytorch深度学习</a> <i class="ic i-angle-right"></i> <a href="/categories/ai/pytorch%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/chapter-computer-vision/" title="分类于 chapter_computer-vision">chapter_computer-vision</a></div><span><a href="/2023/02/15/ai/pytorch%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/chapter_computer-vision/anchor/" title="anchor">anchor</a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/2023/06/25/computer-science/base/%E8%BD%AF%E4%BB%B6%E5%B7%A5%E7%A8%8B/%E8%81%8A%E5%A4%A9%E8%87%AA%E4%B9%A0%E5%AE%A4/" title="未命名">未命名</a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/2022/08/24/ai/base/%E6%95%B0%E5%AD%A6-%E5%B8%B8%E8%A7%81%E5%87%BD%E6%95%B0%E6%B1%82%E5%AF%BC%E8%BF%87%E7%A8%8B/" title="数学-常见函数求导过程">数学-常见函数求导过程</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/ai/" title="分类于 ai">ai</a> <i class="ic i-angle-right"></i> <a href="/categories/ai/pytorch%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/" title="分类于 pytorch深度学习">pytorch深度学习</a> <i class="ic i-angle-right"></i> <a href="/categories/ai/pytorch%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/chapter-optimization/" title="分类于 chapter_optimization">chapter_optimization</a></div><span><a href="/2023/02/15/ai/pytorch%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/chapter_optimization/minibatch-sgd/" title="minibatch-sgd">minibatch-sgd</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/ai/" title="分类于 ai">ai</a> <i class="ic i-angle-right"></i> <a href="/categories/ai/pytorch%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/" title="分类于 pytorch深度学习">pytorch深度学习</a> <i class="ic i-angle-right"></i> <a href="/categories/ai/pytorch%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/chapter-natural-language-processing-applications/" title="分类于 chapter_natural-language-processing-applications">chapter_natural-language-processing-applications</a></div><span><a href="/2023/02/15/ai/pytorch%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/chapter_natural-language-processing-applications/finetuning-bert/" title="finetuning-bert">finetuning-bert</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/ai/" title="分类于 ai">ai</a> <i class="ic i-angle-right"></i> <a href="/categories/ai/pytorch%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/" title="分类于 pytorch深度学习">pytorch深度学习</a> <i class="ic i-angle-right"></i> <a href="/categories/ai/pytorch%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/chapter-preliminaries/" title="分类于 chapter_preliminaries">chapter_preliminaries</a></div><span><a href="/2023/02/15/ai/pytorch%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/chapter_preliminaries/calculus/" title="calculus">calculus</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/ai/" title="分类于 ai">ai</a> <i class="ic i-angle-right"></i> <a href="/categories/ai/nlp/" title="分类于 nlp">nlp</a> <i class="ic i-angle-right"></i> <a href="/categories/ai/nlp/huggingface/" title="分类于 huggingface">huggingface</a> <i class="ic i-angle-right"></i> <a href="/categories/ai/nlp/huggingface/%E4%B8%BB%E8%A6%81nlp%E4%BB%BB%E5%8A%A1/" title="分类于 主要nlp任务">主要nlp任务</a></div><span><a href="/2022/11/12/ai/nlp/huggingface/%E4%B8%BB%E8%A6%81%E7%9A%84%20NLP%20%E4%BB%BB%E5%8A%A1/%E5%BE%AE%E8%B0%83%E4%B8%80%E4%B8%AA%E6%8E%A9%E7%A0%81%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B/" title="微调一个掩码语言模型">微调一个掩码语言模型</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/" title="分类于 计算机科学">计算机科学</a></div><span><a href="/2022/08/24/computer-science/algorithm/base/%E7%AE%97%E6%B3%952/" title="算法2">算法2</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/backend/" title="分类于 后端">后端</a> <i class="ic i-angle-right"></i> <a href="/categories/backend/django/" title="分类于 django">django</a></div><span><a href="/2022/07/24/backend/django/django/" title="初识django">初识django</a></span></li></ul></div><div><h2>最新评论</h2><ul class="leancloud-recent-comment"></ul></div></div><div class="status"><div class="copyright">&copy; 2010 – <span itemprop="copyrightYear">2024</span> <span class="with-love"><i class="ic i-sakura rotate"></i> </span><span class="author" itemprop="copyrightHolder">yuan @ Mi Manchi</span></div><div class="count"><span class="post-meta-item-icon"><i class="ic i-chart-area"></i> </span><span title="站点总字数">2.9m 字</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="ic i-coffee"></i> </span><span title="站点阅读时长">44:38</span></div><div class="powered-by">基于 <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL={path:"2022/08/26/backend/django/DRF组件/",favicon:{show:"（●´3｀●）やれやれだぜ",hide:"(´Д｀)大変だ！"},search:{placeholder:"文章搜索",empty:"关于 「 ${query} 」，什么也没搜到",stats:"${time} ms 内找到 ${hits} 条结果"},valine:!0,copy_tex:!0,katex:!0,fancybox:!0,copyright:'复制成功，转载请遵守 <i class="ic i-creative-commons"></i>BY-NC-SA 协议。',ignores:[function(e){return e.includes("#")},function(e){return new RegExp(LOCAL.path+"$").test(e)}]}</script><script src="https://cdn.polyfill.io/v2/polyfill.js"></script><script src="//cdn.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script><script src="/js/app.js?v=0.2.5"></script></body></html>